{"version":3,"sources":["webpack:///./offscreen.js","webpack:///./platform/build-info.js?66bb","webpack:///./platform/about.js?f733","webpack:///./utils/error-booster.js?d9ff","webpack:///../~/lodash/lang/isObject.js?f3fa","webpack:///../~/lodash/object/keysIn.js?b7f7","webpack:///../~/lodash/lang/isArguments.js?84c9","webpack:///../~/lodash/internal/isArrayLike.js?da20","webpack:///../~/lodash/internal/getLength.js?ea82","webpack:///../~/lodash/internal/baseProperty.js?1987","webpack:///../~/lodash/internal/isLength.js?8a30","webpack:///../~/lodash/internal/isObjectLike.js?5f20","webpack:///../~/lodash/lang/isArray.js?0c1e","webpack:///../~/lodash/internal/getNative.js?1a72","webpack:///../~/lodash/lang/isNative.js?e587","webpack:///../~/lodash/lang/isFunction.js?64ed","webpack:///../~/lodash/internal/isIndex.js?8627","webpack:///./utils/xml.js?5c44","webpack:///../~/lodash/lang/toArray.js?0169","webpack:///../~/lodash/internal/arrayCopy.js?9b0f","webpack:///../~/lodash/object/values.js?9607","webpack:///../~/lodash/internal/baseValues.js?5885","webpack:///../~/lodash/object/keys.js?b5a3","webpack:///../~/lodash/internal/shimKeys.js?b818","webpack:///./utils/overrides_v3/xml.js?fe26","webpack:///./modules/offscreen/events.js?d36e","webpack:///./utils/offscreen/offscreen-manager.js?732d","webpack:///./utils/colors.js?7d87","webpack:///./utils/offscreen/load-image.js?f22d","webpack:///./utils/color-names.js?7484","webpack:///./utils/overrides_v3/colors.js?b6a1","webpack:///./modules/voice/consts.js?1869","webpack:///./modules/offscreen/colors-handler.js?3495","webpack:///./modules/offscreen/filer-handler.js?f651","webpack:///./libs/filer.js?b3da","webpack:///./modules/offscreen/messaging.js?eaad","webpack:///./modules/offscreen/speechkit-handler.js?4292","webpack:///../~/speechkit/src/index.js?39cb","webpack:///./modules/offscreen/xml-handler.js?faa4","webpack:///./modules/startup/offscreen.js?e1c4"],"names":["require","run","buildInfo","window","vbBuildInfo","module","exports","getVersion","chrome","runtime","getManifest","version","getRevision","getValue","getTimestamp","isDebug","Boolean","getRegionBrandId","getCustomBrandId","getClids","getErrorboosterProject","ensureBrandedBuildInfo","path","defaultValue","visbookmarksFakeTabUrl","visbookmarksUrl","visbookmarksRealUrl","getURL","id","isChr","extensionId","cid","type","yasoft","browserName","vbUrls","about","ErrorType","UNCAUGHT","CLIENT","ErrorLevel","CRITICAL","DEBUG","ERROR","INFO","TRACE","WARN","Environment","PROD","SEND_USAGE_STAT_SETTING","ErrorBooster","url","isUncaught","includes","storage","local","get","params","fetch","catch","_fallbackError","console","error","message","additional","vars","_getVars","send","_getUrl","URL","toString","level","msg","project","service","timestamp","Date","now","env","useragent","navigator","userAgent","JSON","stringify","Object","keys","filter","key","map","encodeURIComponent","toWellFormed","join","val","toArray","rxEscape","rxUnescape","mapEscape","mapUnescape","funcReplaceEscape","str","funcReplaceUnescape","toLowerCase","xml","escape","String","replace","unescape","fromString","DOMParser","string","parseFromString","xmlDocument","ActiveXObject","async","loadXML","select","Sizzle","selector","parent","document","querySelector","selectAll","querySelectorAll","getText","elem","textContent","innerText","firstChild","data","text","setText","getAttr","attr","arguments","length","getAttribute","getAttrs","node","attributes","reduce","memo","name","value","create","override","events","offscreenManager","fromStringOriginal","bind","getAttrOriginal","getTextOriginal","selectAllOriginal","xmlString","callback","errObj","Error","msgBody","backend","XML_GET_ATTR","sendMessage","XML_GET_TEXT","selection","XML_SELECT_ALL","offscreen","COLORS_DOMINANT_COLOR_BY_URL","COLORS_FONT_COLOR_BY_URL","FILER_CD","FILER_CP","FILER_CREATE","FILER_DF","FILER_GET_ENTRY","FILER_INIT","FILER_LS","FILER_MKDIR","FILER_MV","FILER_OPEN","FILER_PATH_TO_FILESYSTEM_URL","FILER_RM","FILER_WRITE","SPEECHKIT_DATA","SPEECHKIT_ERROR","SPEECHKIT_INIT","SPEECHKIT_STOP","XML_FROM_STRING","errorBooster","creationCount","OffscreenManager","maybeCloseOffscreen","messages","Map","uniqueId","Math","random","substr","has","tabs","query","then","hasOffscreen","hasDocument","closeDocument","finally","isCreatingOffscreenDocument","onRemoved","removeListener","createDocument","reasons","justifications","justification","values","lastError","uncaught","info","isClosingOffscreenDocument","addListener","port","connect","onDisconnect","entry","reject","clear","onMessage","resolve","delete","Promise","maybeCreateOffscreen","_connectPort","_closeOffscreen","_createOffscreen","_rejectMessage","opt_errorHandler","_getMessageId","_ensurePortConnected","set","postMessage","getContexts","contextTypes","contexts","clients","matchAll","matchedClients","some","client","loadImage","FONT_COLOR_THRESHOLD","COLOR_BLACK","COLOR_WHITE","CANVAS_SIZE_THRESHOLD","MAX_THRESHOLD","MIN_THRESHOLD","PASTEL_THRESHOLD","OPACITY_TRESHOLD","WHITE_TRESHOLD","BLACK_TRESHOLD","DEFAULT_BGCOLOR","OVERLAY_COLOR_WHITE","OVERLAY_COLOR_BLACK","toRGB","num","isAcidColor","red","green","blue","sum","isAlmostTransparent","opacity","isAlmostWhite","rgb","isAlmostBlack","isLightGrey","meanValue","abs","calculateFontColorForImage","img","color","getDominant","bottomQuarter","rightHalf","minifyCanvas","preventSkipColors","fontColorNum","getFontColorByBackgroundColor","fontColor","getFontOverlayColorForBackgroundColor","bgColor","getRGBValues","colorString","parseInt","COLOR_NAMES","normalize","trim","normalizeHexValue","HEX_COLOR_RX","test","exec","color3to6","calculateDominantColorByUrl","imageUrl","options","err","calculateFontColorByUrl","tone","canvas","createElement","ctx","getContext","canvasWidth","width","canvasHeight","height","round","setAttribute","drawImage","imgPixels","getImageData","e","maxValueKey","colorsContainer","pixelColorData","Array","startY","startX","y","x","index","z","colorStep","max","getIndexByXY","isBlack","halfX","floor","halfY","listToCheck","push","every","Image","onload","onLoad","onerror","onError","src","setTimeout","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","colors","calculateDominantColorByUrlOriginal","calculateFontColorByUrlOriginal","imgUrl","successCallback","STATUS","READY","CONNECTING","RECORD","PROCESSING","FINISHED","INTERRUPTED","API_KEY","ERROR_REASON","SILENCE","ANIMATION_TIMEOUT_MS","UTTERANCE_SILENCE","SILENCE_TIMEOUT_MS","IS_VOICE_USED","colorUtils","ColorsHandler","sendResponse","req","_sender","_calculateDominantColorByUrl","_calculateFontColorByUrl","Filer","DATA_URI_REG_EXP","FilerHandler","filer","opt_initObj","init","_getErrorHandler","dirEntryOrPath","ls","entries","fullPath","opt_exclusive","mkdir","entryOrPath","open","file","fileToObjectURL","pathToFilesystemURL","dest","opt_newName","mv","rm","cd","cp","writeData","_isDataUri","dataURLToBlob","write","df","byteUsed","byteLeft","byteCap","fileName","getEntry","toURL","isFilerInitializing","persistent","size","handler","_cd","_cp","_create","_df","_getEntry","_init","_ls","_mkdir","_mv","_open","_pathToFilesystemURL","_rm","_write","self","requestFileSystem","webkitRequestFileSystem","resolveLocalFileSystemURL","webkitResolveLocalFileSystemURL","temporaryStorage","webkitTemporaryStorage","persistentStorage","webkitPersistentStorage","BlobBuilder","MozBlobBuilder","WebKitBlobBuilder","FileError","undefined","prototype","Util","list","slice","call","strToDataURL","contentType","opt_isBinary","isBinary","btoa","strToObjectURL","binStr","opt_contentType","ui8a","Uint8Array","i","charCodeAt","blob","Blob","createObjectURL","fileToArrayBuffer","opt_errorCallback","reader","FileReader","target","result","readAsArrayBuffer","dataURL","BASE64_MARKER","indexOf","parts","split","raw","decodeURIComponent","atob","rawLength","uInt8Array","arrayBufferToBlob","buffer","arrayBufferToBinaryString","readAsBinaryString","arrayToBinaryString","bytes","bstr","fromCharCode","getFileExtension","filename","idx","lastIndexOf","substring","MyFileError","obj","code","BROWSER_NOT_SUPPORTED","__defineGetter__","FS_INIT_ERROR_MSG","NOT_IMPLEMENTED_MSG","NOT_A_DIRECTORY","INCORRECT_ARGS","FS_URL_SCHEME","DEFAULT_FS_SIZE","fs_","cwd_","isOpen_","isFsURL_","pathToFsURL_","root","getEntry_","srcStr","destStr","errback","srcEntry","destEntry","copyOrMove_","opt_successCallback","opt_deleteOrig","newName","deleteOrig","isFile","isDirectory","moveTo","copyTo","destDir","fs","isOpen","cwd","initObj","TEMPORARY","PERSISTENT","requestQuota","grantedBytes","dirEntry","entries_","createReader","readEntries","results","sort","a","b","concat","getDirectory","exclusive","folderParts","createDir","rootDir","folders","INVALID_MODIFICATION_ERR","fileEntry","getFile","removeIt","remove","removeRecursively","dataObj","writeFile_","createWriter","fileWriter","append","onwriteend","seek","truncated","truncate","position","__proto__","ArrayBuffer","queryCallback","queryUsageAndQuota","colorsHandler","filerHandler","speechkitHandler","xmlHandler","handlers","Messaging","_handleConnection","_getConnectionHandler","onConnect","handle","sender","speechkit","ya","SpeechkitHandler","streamer","SpeechRecognition","start","apiKey","initCallback","errorCallback","reason","dataCallback","done","utteranceSilence","particialResults","stop","_stop","XMLHandler","xmlDoc","_toXML","_fromString","_getAttr","_getText","_selectAll","messaging"],"mappings":"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CA;AACA,8BAA6B,kBAAkB,EAAE;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACjCA;AACA;;AAEA;AACA;AACA;AACA;AACA,YAAW,EAAE;AACb,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;;;;;;;ACdA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,EAAE;AACf;AACA;;AAEA;;;;;;;;ACdA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACbA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,EAAE;AACb,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;;;;;;;ACnBA;AACA;AACA;AACA;AACA,YAAW,EAAE;AACb,cAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;;;;;;;;ACXA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,EAAE;AACb,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA,0BAAyB,kBAAkB,EAAE;AAC7C;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACvCA;;AAEA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,OAAO;AAClB,cAAa,EAAE;AACf;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACfA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,4DAA2D;AAC3D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,EAAE;AACb,cAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC/CA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;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AAM;AACjB,cAAa,MAAM;AACnB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACnBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AChCA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,YAAW,MAAM;AACjB,cAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACrBA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;AC5CA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,YAAW,OAAO;AAClB,cAAa,MAAM;AACnB;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;ACxCA;;;AAGA;;AAEA,KAAM2C,SAAS,mBAAAjJ,CAAQ,EAAR,CAAf;AACA,KAAMkJ,mBAAmB,mBAAAlJ,CAAQ,EAAR,CAAzB;;AAEAM,SAAQ0I,QAAR,GAAmB,UAAC1C,GAAD,EAAS;AACxB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAI,OAAOA,GAAX,EAAmB,QAAnB,GAA6B;AACzB;AACH;;AAED;AACA;AACAA,SAAI6C,kBAAJ,GAAyB7C,IAAIK,UAAJ,CAAeyC,IAAf,CAAoB,EAApB,CAAzB;AACA9C,SAAI+C,eAAJ,GAAsB/C,IAAI6B,OAAJ,CAAYiB,IAAZ,CAAiB,EAAjB,CAAtB;AACA9C,SAAIgD,eAAJ,GAAsBhD,IAAIqB,OAAJ,CAAYyB,IAAZ,CAAiB,EAAjB,CAAtB;AACA9C,SAAIiD,iBAAJ,GAAwBjD,IAAImB,SAAJ,CAAc2B,IAAd,CAAmB,EAAnB,CAAxB;;AAEA;;;AAGA9C,SAAIK,UAAJ,GAAiB,UAACE,MAAD,EAAY;AACzB,gBAAOA,MAAP;AACH,MAFD;;AAIA;;;AAGAP,SAAI6B,OAAJ,GAAc,UAACqB,SAAD,EAAYnC,QAAZ,EAAsBe,IAAtB,EAA+B;AACzC,aAAMqB,WAAW,SAAXA,QAAW,CAAC1F,OAAD,EAAa;AAAA,iBACnB2F,MADmB,GACH3F,OADG,CACnB2F,MADmB;AAAA,iBACXtB,IADW,GACHrE,OADG,CACXqE,IADW;;AAE1B,iBAAIsB,MAAJ,EAAY;AACR,uBAAM,IAAIC,KAAJ,CAAUD,OAAO3F,OAAjB,CAAN;AACH,cAFD,MAEO;AACH,wBAAOqE,IAAP;AACH;AACJ,UAPD;;AASA,aAAMwB,UACF,EAAC5H,MAAMiH,OAAOY,OAAP,CAAeC,YAAtB,EAAoC9B,MAAM,EAACwB,oBAAD,EAAYnC,kBAAZ,EAAsBe,UAAtB,EAA1C,EADJ;AAEA,gBAAOc,iBAAiBa,WAAjB,CACHH,OADG,EACM,uBADN,EAC+BH,QAD/B,CAAP;AAEH,MAdD;;AAgBA;;;AAGAnD,SAAIqB,OAAJ,GAAc,UAAC6B,SAAD,EAAYnC,QAAZ,EAAyB;AACnC,aAAMoC,WAAW,SAAXA,QAAW,CAAC1F,OAAD,EAAa;AAAA,iBACnB2F,MADmB,GACH3F,OADG,CACnB2F,MADmB;AAAA,iBACXzB,IADW,GACHlE,OADG,CACXkE,IADW;;AAE1B,iBAAIyB,MAAJ,EAAY;AACR,uBAAM,IAAIC,KAAJ,CAAUD,OAAO3F,OAAjB,CAAN;AACH,cAFD,MAEO;AACH,wBAAOkE,IAAP;AACH;AACJ,UAPD;;AASA,aAAM2B,UACF,EAAC5H,MAAMiH,OAAOY,OAAP,CAAeG,YAAtB,EAAoChC,MAAM,EAACwB,oBAAD,EAAYnC,kBAAZ,EAA1C,EADJ;AAEA,gBAAO6B,iBAAiBa,WAAjB,CACHH,OADG,EACM,uBADN,EAC+BH,QAD/B,CAAP;AAEH,MAdD;;AAgBA;;;AAGAnD,SAAImB,SAAJ,GAAgB,UAACJ,QAAD,EAAWC,MAAX,EAAsB;AAClC,aAAMmC,WAAW,SAAXA,QAAW,CAAC1F,OAAD,EAAa;AAAA,iBACnB2F,MADmB,GACE3F,OADF,CACnB2F,MADmB;AAAA,iBACXO,SADW,GACElG,OADF,CACXkG,SADW;;AAE1B,iBAAIP,MAAJ,EAAY;AACR,uBAAM,IAAIC,KAAJ,CAAUD,OAAO3F,OAAjB,CAAN;AACH,cAFD,MAEO;AACH,wBAAOkG,SAAP;AACH;AACJ,UAPD;;AASA,aAAML,UACF,EAAC5H,MAAMiH,OAAOY,OAAP,CAAeK,cAAtB,EAAsClC,MAAM,EAACX,kBAAD,EAAWC,cAAX,EAA5C,EADJ;AAEA,gBAAO4B,iBAAiBa,WAAjB,CACHH,OADG,EACM,yBADN,EACiCH,QADjC,CAAP;AAEH,MAdD;AAeH,EA3ED,C;;;;;;;ACRA;;;AAGA;;AAEApJ,QAAOC,OAAP,GAAiB;AACb;;;AAGA6J,cAAW;AACP;;;AAGAC,mCAA8B,6CAJvB;AAKPC,+BAA0B,yCALnB;;AAOP;;;AAGAC,eAAU,mBAVH;AAWPC,eAAU,mBAXH;AAYPC,mBAAc,uBAZP;AAaPC,eAAU,mBAbH;AAcPC,sBAAiB,yBAdV;AAePC,iBAAY,qBAfL;AAgBPC,eAAU,mBAhBH;AAiBPC,kBAAa,sBAjBN;AAkBPC,eAAU,mBAlBH;AAmBPC,iBAAY,qBAnBL;AAoBPC,mCAA8B,oCApBvB;AAqBPC,eAAU,mBArBH;AAsBPC,kBAAa,sBAtBN;;AAwBP;;;AAGAC,qBAAgB,yBA3BT;AA4BPC,sBAAiB,0BA5BV;AA6BPC,qBAAgB,yBA7BT;AA8BPC,qBAAgB,yBA9BT;;AAgCP;;;AAGAC,sBAAiB,2BAnCV;AAoCPzB,mBAAc,wBApCP;AAqCPE,mBAAc,wBArCP;AAsCPE,qBAAgB;AAtCT,IAJE;;AA6Cb;;;AAGAL,YAAS;AACL;;;AAGAO,mCAA8B,4CAJzB;AAKLC,+BAA0B,wCALrB;;AAOL;;;AAGAC,eAAU,kBAVL;AAWLC,eAAU,kBAXL;AAYLC,mBAAc,sBAZT;AAaLC,eAAU,kBAbL;AAcLC,sBAAiB,wBAdZ;AAeLC,iBAAY,oBAfP;AAgBLC,eAAU,kBAhBL;AAiBLC,kBAAa,qBAjBR;AAkBLC,eAAU,kBAlBL;AAmBLC,iBAAY,oBAnBP;AAoBLC,mCAA8B,mCApBzB;AAqBLC,eAAU,kBArBL;AAsBLC,kBAAa,qBAtBR;;AAwBL;;;AAGAI,qBAAgB,wBA3BX;AA4BLD,qBAAgB,wBA5BX;;AA8BL;;;AAGAE,sBAAiB,0BAjCZ;AAkCLzB,mBAAc,uBAlCT;AAmCLE,mBAAc,uBAnCT;AAoCLE,qBAAgB;AApCX;AAhDI,EAAjB,C;;;;;;;;;;;;;ACLA,KAAMsB,eAAe,mBAAAxL,CAAQ,EAAR,CAArB;;AAEA,KAAIyL,gBAAgB,CAApB;;KAEMC,gB;AACF,iCAAc;AAAA;;AACV,cAAKC,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBvC,IAAzB,CAA8B,IAA9B,CAA3B;AACA,cAAKwC,QAAL,GAAgB,IAAIC,GAAJ,EAAhB;AACH;;;;yCAce;AACZ,iBAAIC,iBAAJ;AACA,gBAAG;AACCA,4BAAWC,KAAKC,MAAL,GAAc1H,QAAd,CAAuB,EAAvB,EAA2B2H,MAA3B,CAAkC,CAAlC,EAAqC,CAArC,CAAX;AACH,cAFD,QAES,KAAKL,QAAL,CAAcM,GAAd,CAAkBJ,QAAlB,CAFT;AAGA,oBAAOA,QAAP;AACH;;;uCAEa;AACV,oBAAOtL,OAAO2L,IAAP,CAAYC,KAAZ,CAAkB,EAAlB,EAAsBC,IAAtB,CAA2B,UAACF,IAAD;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAAUA,KAAK7D,MAAf,EAA0B,CAA1B;AAAA,cAA3B,CAAP;AACH;;;2CAEiB;AAAA;;AACd,oBAAOoD,iBAAiBY,YAAjB,GAAgCD,IAAhC,CAAqC,UAACE,WAAD,EAAiB;AACzD,qBAAIA,WAAJ,EAAiB;AACb,4BAAO/L,OAAO2J,SAAP,CAAiBqC,aAAjB,EAAP;AACH;AACJ,cAJM,EAIJC,OAJI,CAII,YAAM;AACb;AACA,uBAAKC,2BAAL,GAAmC,IAAnC;;AAEAlM,wBAAO2L,IAAP,CAAYQ,SAAZ,CAAsBC,cAAtB,CAAqC,MAAKjB,mBAA1C;AACH,cATM,CAAP;AAUH;;;4CAEkB;AAAA;;AACf,oBAAOD,iBAAiBY,YAAjB,GAAgCD,IAAhC,CAAqC,UAACE,WAAD,EAAiB;AACzD,qBAAI,CAACA,WAAL,EAAkB;AACd,4BAAO/L,OAAO2J,SAAP,CAAiB0C,cAAjB,CAAgC;AACnC1J,8BAAK,wBAD8B;AAEnC2J,kCAAS1H,OAAOC,IAAP,CAAY0H,cAAZ,CAF0B;AAGnCC,wCAAe5H,OAAO6H,MAAP,CAAcF,cAAd,EAA8BpH,IAA9B,CAAmC,IAAnC;AAHoB,sBAAhC,EAIJ,YAAM;AACL,6BAAInF,OAAOC,OAAP,CAAeyM,SAAnB,EAA8B;AAC1B;AACA,oCAAKR,2BAAL,GAAmC,IAAnC;AACAlB,0CAAa2B,QAAb,CAAsB3M,OAAOC,OAAP,CAAeyM,SAArC,EAAgD,EAACzB,4BAAD,EAAhD;AACH,0BAJD,MAIO;AACHA,8CAAiB,CAAjB;AACAD,0CAAa4B,IAAb,CAAkB,sBAAlB,EAA0C,EAAC3B,4BAAD,EAA1C;AACH;AACJ,sBAbM,CAAP;AAcH;AACJ,cAjBM,EAiBJgB,OAjBI,CAiBI,YAAM;AACb;AACA,wBAAKY,0BAAL,GAAkC,IAAlC;;AAEA7M,wBAAO2L,IAAP,CAAYQ,SAAZ,CAAsBW,WAAtB,CAAkC,OAAK3B,mBAAvC;AACH,cAtBM,CAAP;AAuBH;;AAED;;;;;;wCAGe;AAAA;;AACX,kBAAK4B,IAAL,GAAY/M,OAAOC,OAAP,CAAe+M,OAAf,CAAuB,EAAC3E,MAAM,WAAP,EAAvB,CAAZ;;AAEA,kBAAK0E,IAAL,CAAUE,YAAV,CAAuBH,WAAvB,CAAmC,YAAM;AACrC,wBAAKC,IAAL,GAAY,IAAZ;AADqC;AAAA;AAAA;;AAAA;AAErC,0CAAoB,OAAK3B,QAAL,CAAcqB,MAAd,EAApB,8HAA4C;AAAA,6BAAjCS,KAAiC;;AACxC,6BAAI;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,kCAAOA,KAAP,EAAiB,QAAjB,KAA6BA,MAAMC,MAAvC,EAA+C;AAC3CD,mCAAMC,MAAN,CAAa,IAAIhE,KAAJ,CAAU,uBAAV,CAAb;AACH;AACJ;AANoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOrC,wBAAKiC,QAAL,CAAcgC,KAAd;AACH,cARD;;AAUA,kBAAKL,IAAL,CAAUM,SAAV,CAAoBP,WAApB,CAAgC,UAACvJ,OAAD,EAAa;AACzC,qBAAM2J,QAAQ,OAAK9B,QAAL,CAAcpI,GAAd,CAAkBO,QAAQnC,EAA1B,CAAd;AACA,qBAAI8L,KAAJ,EAAW;AACPA,2BAAMI,OAAN,CAAc/J,OAAd;AACA,4BAAK6H,QAAL,CAAcmC,MAAd,CAAqBhK,QAAQnC,EAA7B;AACH;AACJ,cAND;;AAQA,oBAAOoM,QAAQF,OAAR,EAAP;AACH;;AAED;;;;;;gDAGuB;AAAA;;AACnB,iBAAI,KAAKP,IAAT,EAAe;AACX,wBAAOS,QAAQF,OAAR,EAAP;AACH;;AAED,kBAAKG,oBAAL;AACA,oBAAO,KAAKvB,2BAAL,CAAiCL,IAAjC,CAAsC,YAAM;AAC/C,wBAAO,OAAK6B,YAAL,EAAP;AACH,cAFM,CAAP;AAGH;;AAED;;;;;;8CAGqBzE,Q,EAAU;AAC3B,iBAAI,KAAK8D,IAAT,EAAe;AACX,sBAAKA,IAAL,CAAUM,SAAV,CAAoBP,WAApB,CAAgC7D,QAAhC;AACH;AACJ;;AAED;;;;;;iDAGwBA,Q,EAAU;AAC9B,iBAAI,KAAK8D,IAAT,EAAe;AACX,sBAAKA,IAAL,CAAUM,SAAV,CAAoBjB,cAApB,CAAmCnD,QAAnC;AACH;AACJ;;AAED;;;;;;+CAGsB;AAClB,iBAAI,CAAC,KAAK4D,0BAAV,EAAsC;AAClC,sBAAKA,0BAAL,GAAkC,KAAKc,eAAL,EAAlC;AACH;AACJ;;AAED;;;;;;gDAGuB;AACnB,iBAAI,CAAC,KAAKzB,2BAAV,EAAuC;AACnC,sBAAKA,2BAAL,GAAmC,KAAK0B,gBAAL,EAAnC;AACH;AACJ;;AAED;;;;;;qCAGYxE,O,EAASyE,c,EAAgB5E,Q,EAAU6E,gB,EAAkB;AAAA;;AAC7D1E,qBAAQhI,EAAR,GAAa,KAAK2M,aAAL,EAAb;AACA,oBAAO,KAAKC,oBAAL,GAA4BnC,IAA5B,CAAiC,YAAM;AAC1C,wBAAO,IAAI2B,OAAJ,CAAY,UAACF,OAAD,EAAUH,MAAV,EAAqB;AACpC,4BAAK/B,QAAL,CAAc6C,GAAd,CAAkB7E,QAAQhI,EAA1B,EAA8B,EAACkM,gBAAD,EAAUH,cAAV,EAA9B;AACA,4BAAKJ,IAAL,CAAUmB,WAAV,CAAsB9E,OAAtB;AACH,kBAHM,CAAP;AAIH,cALM,EAKJyC,IALI,CAKC,UAACtI,OAAD,EAAa;AACjB,qBAAI0F,QAAJ,EAAc;AACV,4BAAOA,SAAS1F,OAAT,CAAP;AACH;AACJ,cATM,EASJJ,KATI,CASE,UAACG,KAAD,EAAW;AAChB,qBAAIwK,gBAAJ,EAAsB;AAClBA,sCAAiBxK,KAAjB;AACH;AACD,qBAAIA,SAASA,MAAMC,OAAnB,EAA4B;AACxByH,kCAAa2B,QAAb,CAAsBrJ,MAAMC,OAA5B;AACH;AACJ,cAhBM,CAAP;AAiBH;;;wCAlKqB;AAClB,iBAAI,iBAAiBvD,OAAOC,OAA5B,EAAqC;AACjC,wBAAOD,OAAOC,OAAP,CAAekO,WAAf,CAA2B;AAC9BC,mCAAc,CAAC,oBAAD;AADgB,kBAA3B,EAEJvC,IAFI,CAEC;AAAA,4BAAY,CAAC,CAACwC,SAASvG,MAAvB;AAAA,kBAFD,CAAP;AAGH,cAJD,MAIO;AACH,wBAAOwG,QAAQC,QAAR,GAAmB1C,IAAnB,CAAwB;AAAA,4BAC3B2C,eAAeC,IAAf,CAAoB;AAAA,gCAChBC,OAAO/L,GAAP,CAAWE,QAAX,CAAoB7C,OAAOC,OAAP,CAAemB,EAAnC,CADgB;AAAA,sBAApB,CAD2B;AAAA,kBAAxB,CAAP;AAGH;AACJ;;;;;;AAyJJ;;AAEDvB,QAAOC,OAAP,GAAiB,IAAIoL,gBAAJ,EAAjB,C;;;;;;;AC/KA;;;;AAIA;;AAEA,KAAIyD,YAAY,mBAAAnP,CAAQ,GAAR,CAAhB;;AAEA,KAAIoP,uBAAuB,GAA3B;AACA,KAAIC,cAAc,CAAlB;AACA,KAAIC,cAAc,CAAlB;AACA,KAAIC,wBAAwB,GAA5B;AACA,KAAIC,gBAAgB,GAApB;AACA,KAAIC,gBAAgB,EAApB;AACA,KAAIC,mBAAmB,EAAvB;AACA,KAAIC,mBAAmB,GAAvB;AACA,KAAIC,iBAAiB,GAArB;AACA,KAAIC,iBAAiB,EAArB;;AAEAvP,SAAQwP,eAAR,GAA0B,QAA1B;AACAxP,SAAQyP,mBAAR,GAA8B,QAA9B;AACAzP,SAAQ0P,mBAAR,GAA8B,QAA9B;;AAEA,UAASC,KAAT,CAAeC,GAAf,EAAoB;AAChB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAQA,MAAM,EAAN,GAAW,GAAX,GAAiB,EAAzB,EAA+BA,IAAI5L,QAAJ,CAAa,EAAb,CAA/B;AACH;;AAED,UAAS6L,WAAT,CAAqBC,GAArB,EAA0BC,KAA1B,EAAiCC,IAAjC,EAAuC;AACnC,SAAIC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAMH,MAAMC,KAAZ,EAAoBC,IAApB,CAAJ;;AAEA;AACA,SAAKC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAOf,aAAP,EAAuB,CAAvB,CAAD,KAA+BY,OAAOX,aAAP,IAAwBY,SAASZ,aAAjC,IAAkDa,QAAQb,aAAzF,CAAJ,EAA6G;AACzG,gBAAO,IAAP;AACH;;AAED;AACA,SAAKc;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAOf,aAAP,EAAuBC,gBAAgB,CAAvC,CAAD,KAA+CW,OAAOZ,aAAP,IAAwBa,SAASb,aAAjC,IAAkDc,QAAQd,aAAzG,CAAJ,EAA6H;AACzH,gBAAO,IAAP;AACH;;AAED,YAAO,KAAP;AACH;;AAED,UAASgB,mBAAT,CAA6BC,OAA7B,EAAsC;AAClC,YAAQA,UAAUd,gBAAlB;AACH;;AAED,UAASe,aAAT,CAAuBC,GAAvB,EAA4B;AACxB,YAAQA,IAAI,CAAJ,IAASf,cAAT,IAA2Be,IAAI,CAAJ,IAASf,cAApC,IAAsDe,IAAI,CAAJ,IAASf,cAAvE;AACH;;AAED,UAASgB,aAAT,CAAuBD,GAAvB,EAA4B;AACxB,YAAQA,IAAI,CAAJ,IAASd,cAAT,IAA2Bc,IAAI,CAAJ,IAASd,cAApC,IAAsDc,IAAI,CAAJ,IAASd,cAAvE;AACH;;AAED,UAASgB,WAAT,CAAqBF,GAArB,EAA0B;AACtB,SAAIG;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAaH,IAAI,CAAJ,IAASA,IAAI,CAAJ,CAAT,GAAkBA,IAAI,CAAJ,CAA/B,EAAyC,CAAzC,CAAJ;AACA,YAAQ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,YAAKI,GAAL,CAASD,YAAYH,IAAI,CAAJ,CAArB,IAA+B5E,KAAKgF,GAAL,CAASD,YAAYH,IAAI,CAAJ,CAArB,CAA/B,EAA8D5E,KAAKgF,GAAL,CAASD,YAAYH,IAAI,CAAJ,CAArB,CAA9D,IAA6F,EAArG;AACH;;AAEDrQ,SAAQ0Q,0BAAR,GAAqC,UAAUC,GAAV,EAAe;AAChD,SAAIC,QAAQ5Q,QAAQ6Q,WAAR,CAAoBF,GAApB,EAAyB;AACjCG,wBAAe,IADkB;AAEjCC,oBAAW,KAFsB;AAGjCC,uBAAc,IAHmB;AAIjCC,4BAAmB;AAJc,MAAzB,CAAZ;AAMA,SAAIC,eAAelR,QAAQmR,6BAAR,CAAsCP,KAAtC,CAAnB;AACA,SAAIQ,YAAY;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAACF,YAAD,EAAkB,CAAlB,IAAuBlR,QAAQyP,mBAA/B,GAAqDzP,QAAQ0P,mBAA7E;AACA,YAAO0B,SAAP;AACH,EAVD;;AAYApR,SAAQqR,qCAAR,GAAgD,UAAUC,OAAV,EAAmB;AAC/D,SAAIJ,eAAelR,QAAQmR,6BAAR,CAAsCG,OAAtC,CAAnB;AACA,YAAO;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAAiBtC,WAAjB,IAA+BhP,QAAQyP,mBAAvC,GAA6DzP,QAAQ0P,mBAA5E;AACH,EAHD;;AAKA,UAAS6B,YAAT,CAAsBC,WAAtB,EAAmC;AAC/B,YAAO;AACH1B,cAAK2B,SAASD,YAAY7F,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,CAAT,EAAmC,EAAnC,CADF;AAEHoE,gBAAO0B,SAASD,YAAY7F,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,CAAT,EAAmC,EAAnC,CAFJ;AAGHqE,eAAMyB,SAASD,YAAY7F,MAAZ,CAAmB,CAAnB,EAAsB,CAAtB,CAAT,EAAmC,EAAnC;AAHH,MAAP;AAKH;;AAED,KAAI+F,cAAc,mBAAAhS,CAAQ,GAAR,CAAlB;AACAM,SAAQ2R,SAAR,GAAoB,UAAU9L,GAAV,EAAe;AAC/B,SAAI,CAACA,GAAL,EAAU;AACN,gBAAO,IAAP;AACH;AACDA,WAAMK,OAAOL,GAAP,EAAY+L,IAAZ,GAAmB7L,WAAnB,EAAN;AACA,YAAOF,OAAO6L,WAAP,GACDA,YAAY7L,GAAZ,CADC,GAEDgM,kBAAkBhM,GAAlB,CAFN;AAGH,EARD;;AAUA,KAAIiM,eAAe,gCAAnB;AACA,UAASD,iBAAT,CAA2BvM,GAA3B,EAAgC;AAC5B,SAAI,CAACwM,aAAaC,IAAb,CAAkBzM,GAAlB,CAAL,EAA6B;AACzB,gBAAO,IAAP;AACH;AACDA,WAAMwM,aAAaE,IAAb,CAAkB1M,GAAlB,EAAuB,CAAvB,CAAN;AACA,YAAO;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAI0C,MAAJ,EAAe,CAAf,IACDiK,UAAU3M,GAAV,CADC,GAEDA,GAFN;AAGH;;AAED,UAAS2M,SAAT,CAAmBpM,GAAnB,EAAwB;AACpB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAOA,IAAI,CAAJ,IAASA,IAAI,CAAJ,CAAT,GACFA,IAAI,CAAJ,CADE,GACOA,IAAI,CAAJ,CADP,GAEFA,IAAI,CAAJ,CAFL,EAEcA,IAAI,CAAJ,CAFd;AAGH;;AAED7F,SAAQkS,2BAAR,GAAsC,UAAUC,QAAV,EAAoBC,OAApB,EAA6BjJ,QAA7B,EAAuC;AACzE0F,eAAU,EAAChM,KAAKsP,QAAN,EAAV,EAA2B,UAAUE,GAAV,EAAe1B,GAAf,EAAoB;AAC3C,aAAIC,QAAQyB,MACN,IADM,GAENrS,QAAQ6Q,WAAR,CAAoBF,GAApB,EAAyByB,OAAzB,CAFN;AAGAjJ,kBAASyH,KAAT;AACH,MALD;AAMH,EAPD;;AASA5Q,SAAQsS,uBAAR,GAAkC,UAAUH,QAAV,EAAoBhJ,QAApB,EAA8B;AAC5D0F,eAAU,EAAChM,KAAKsP,QAAN,EAAV,EAA2B,UAAUE,GAAV,EAAe1B,GAAf,EAAoB;AAC3C,aAAI0B,GAAJ,EAAS;AACL,oBAAOlJ,SAAS,IAAT,CAAP;AACH;AACD,aAAIyH,QAAQ5Q,QAAQ0Q,0BAAR,CAAmCC,GAAnC,CAAZ;AACAxH,kBAASyH,KAAT;AACH,MAND;AAOH,EARD;;AAUA5Q,SAAQmR,6BAAR,GAAwC,UAAUG,OAAV,EAAmB;AACvDA,eAAUA,WAAWtR,QAAQwP,eAA7B;AACA,SAAIa,MAAMkB,aAAaD,OAAb,CAAV;AACA,SAAIiB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAQlC,IAAIP,GAAJ,GAAUO,IAAIN,KAAd,GAAsBM,IAAIL,IAAlC,EAA0C,CAA1C,CAAJ;AACA,SAAKuC,OAAOzD,oBAAR,KACCuB,IAAIP,GAAJ,GAAUhB,oBAAV,IAAkCuB,IAAIN,KAAJ,GAAYjB,oBAD/C,CAAJ,EAC0E;AACtE,gBAAOE,WAAP;AACH,MAHD,MAGO;AACH,gBAAOD,WAAP;AACH;AACJ,EAVD;;AAYA/O,SAAQ6Q,WAAR,GAAsB,UAAUF,GAAV,EAAeyB,OAAf,EAAwB;AAC1CA,eAAUA,WAAW,EAArB;;AAEA,SAAII,SAASvL,SAASwL,aAAT,CAAuB,QAAvB,CAAb;AACA,SAAIC,MAAMF,OAAOG,UAAP,CAAkB,IAAlB,CAAV;;AAEA,SAAIC,cAAcjC,IAAIkC,KAAtB;AACA,SAAIC,eAAenC,IAAIoC,MAAvB;;AAEA,SAAIpC,IAAIkC,KAAJ,GAAYlC,IAAIoC,MAApB,EAA4B;AACxB,aAAIX,QAAQpB,YAAR,IAAwBL,IAAIkC,KAAJ,GAAY5D,qBAAxC,EAA+D;AAC3D2D,2BAAc3D,qBAAd;AACA6D,4BAAerH,KAAKuH,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAWJ,cAAcjC,IAAIoC,MAA7B,EAAsCpC,IAAIkC,KAA1C,EAAf;AACH;AACJ,MALD,MAKO;AACH,aAAIT,QAAQpB,YAAR,IAAwBL,IAAIoC,MAAJ,GAAa9D,qBAAzC,EAAgE;AAC5D6D,4BAAe7D,qBAAf;AACA2D,2BAAcnH,KAAKuH,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAWF,eAAenC,IAAIkC,KAA9B,EAAsClC,IAAIoC,MAA1C,EAAd;AACH;AACJ;;AAEDP,YAAOS,YAAP,CAAoB,OAApB,EAA6BL,WAA7B;AACAJ,YAAOS,YAAP,CAAoB,QAApB,EAA8BH,YAA9B;AACAJ,SAAIQ,SAAJ,CAAcvC,GAAd,EAAmB,CAAnB,EAAsB,CAAtB,EAAyBiC,WAAzB,EAAsCE,YAAtC;AACA;AACA,SAAIK,SAAJ;AACA,SAAI;AACAA,qBAAYT,IAAIU,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuBZ,OAAOK,KAA9B,EAAqCL,OAAOO,MAA5C,CAAZ;AACH,MAFD,CAEE,OAAOM,CAAP,EAAU;AACR;AACA,gBAAO,EAAP;AACH;AACD,SAAIC,cAAc,IAAlB;AACA,SAAIC,kBAAkB,EAAtB;AACA,SAAIC,iBAAiB,IAAIC,KAAJ,CAAU,CAAV,CAArB;;AAEA,SAAIC,SAAUtB,QAAQtB,aAAT,GAA0BrF,KAAKuH,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAWG,UAAUJ,MAArB,EAA8B,IAA9B,EAA1B,GAAgE,CAA7E;AACA,SAAIY,SAAUvB,QAAQrB,SAAT,GAAsBtF,KAAKuH,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAWG,UAAUN,KAArB,EAA6B,CAA7B,EAAtB,GAAwD,CAArE;;AAEA,UAAK,IAAIe,IAAIF,MAAb,EAAqBE,IAAIT,UAAUJ,MAAnC,EAA2Ca,GAA3C,EAAgD;AAC5C,cAAK,IAAIC,IAAIF,MAAb,EAAqBE,IAAIV,UAAUN,KAAnC,EAA0CgB,GAA1C,EAA+C;AAC3C,iBAAIC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAASF,IAAI,CAAL,GAAUT,UAAUN,KAA5B,EAAoCgB,IAAI,CAAxC,CAAJ;;AAEA;AACA,iBAAI3D,oBAAoBiD,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAeoM,KAAf,EAAuB,CAAvB,EAApB,CAAJ,EAAoD;AAChD;AACH;;AAED;AACAN,4BAAe,CAAf,IAAoBL,UAAUzL,IAAV,CAAeoM,KAAf,CAApB,CAT2C,CASA;AAC3CN,4BAAe,CAAf,IAAoBL,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAeoM,KAAf,EAAuB,CAAvB,EAApB,CAV2C,CAUI;AAC/CN,4BAAe,CAAf,IAAoBL,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAeoM,KAAf,EAAuB,CAAvB,EAApB,CAX2C,CAWI;AAC/CN,4BAAe,CAAf,IAAoBL,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAeoM,KAAf,EAAuB,CAAvB,EAApB,CAZ2C,CAYI;;AAE/C;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAIN,eAAe,CAAf,CAAJ,EAA0B,GAA1B,GAA+B;AAC3B;AACA;AACA;AACA;;AAEA;AACA,sBAAK,IAAIO,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AACxB,yBAAIC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAAa,MAAMR,eAAeO,CAAf,CAAnB,EAAwC,GAAxC,CAAJ;AACAP,oCAAeO,CAAf,IAAoBtI,KAAKuH,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAAW,GAAX,EAAiBgB,YAAYR,eAAe,CAAf,CAA7B,EAApB;AACH;AACJ;;AAED,iBAAI,CAACpB,QAAQnB,iBAAT,KACCb,cAAcoD,cAAd,KACAlD,cAAckD,cAAd,CADA,IAEAjD,YAAYiD,cAAZ,CAHD,CAAJ,EAGmC;AAC/B;AACH;;AAED,iBAAI5C;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAQjB,MAAM6D,eAAe,CAAf,CAAN,IAA2B7D,MAAM6D,eAAe,CAAf,CAAN,CAAnC,EAA8D7D,MAAM6D,eAAe,CAAf,CAAN,CAA9D,CAAJ;AACAD,6BAAgB3C,KAAhB,IAAyB2C,gBAAgB3C,KAAhB,KAA0B,CAAnD;AACA2C,6BAAgB3C,KAAhB,KAA0B,CAA1B;;AAEA,iBAAI0C,gBAAgB,IAAhB,IAAwBC,gBAAgBD,WAAhB,IAA+BC,gBAAgB3C,KAAhB,CAA3D,EAAmF;AAC/E0C,+BAAc1C,KAAd;AACH;AACJ;AACJ;;AAED,SAAI0C,WAAJ,EAAiB;AACb;AACA,aAAIjD,MAAMkB,aAAa+B,WAAb,CAAV;AACA,aAAIzD,YAAYQ,IAAIP,GAAhB,EAAqBO,IAAIN,KAAzB,EAAgCM,IAAIL,IAApC,CAAJ,EAA+C;AAC3CK,iBAAIP,GAAJ,GAAUrE,KAAKwI,GAAL,CAAS5D,IAAIP,GAAb,EAAkBV,gBAAlB,CAAV;AACAiB,iBAAIN,KAAJ,GAAYtE,KAAKwI,GAAL,CAAS5D,IAAIN,KAAb,EAAoBX,gBAApB,CAAZ;AACAiB,iBAAIL,IAAJ,GAAWvE,KAAKwI,GAAL,CAAS5D,IAAIL,IAAb,EAAmBZ,gBAAnB,CAAX;;AAEAkE;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,eAAc3D,MAAMU,IAAIP,GAAV,IAAiBH,MAAMU,IAAIN,KAAV,CAA/B,EAAkDJ,MAAMU,IAAIL,IAAV,CAAlD;AACH;AACJ;;AAED,YAAOsD,eAAetT,QAAQwP,eAA9B;AACH,EAjGD;;AAmGA;;;AAGA,UAAS0E,YAAT,CAAsBL,CAAtB,EAAyBD,CAAzB,EAA4BT,SAA5B,EAAuC;AACnC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAO,CAAP,EAAYA,UAAUN,KAAV,GAAkBe,CAAlB,GAAsBC,CAAlC;AACH;;AAED;;;;;;AAMA7T,SAAQmU,OAAR,GAAkB,UAAUhB,SAAV,EAAqB;AACnC,SAAIiB,QAAQ3I,KAAK4I,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAWlB,UAAUN,KAArB,EAA6B,CAA7B,EAAZ;AACA,SAAIyB,QAAQ7I,KAAK4I,KAAL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAWlB,UAAUJ,MAArB,EAA8B,CAA9B,EAAZ;AACA,SAAIwB,cAAc,EAAlB;;AAEA;AACA,UAAK,IAAIV,IAAI,CAAb,EAAgBA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAIV,UAAUN,KAAd,EAAsB,CAAtB,CAAhB,EAAyCgB,GAAzC,EAA8C;AAC1CU,qBAAYC,IAAZ,CAAiBN,aAAaL,CAAb,EAAgBS,KAAhB,EAAuBnB,SAAvB,CAAjB;AACH;;AAED;AACA,UAAK,IAAIS,IAAI,CAAb,EAAgBA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAIT,UAAUJ,MAAd,EAAuB,CAAvB,CAAhB,EAA0Ca,GAA1C,EAA+C;AAC3CW,qBAAYC,IAAZ,CAAiBN,aAAaE,KAAb,EAAoBR,CAApB,EAAuBT,SAAvB,CAAjB;AACH;;AAED;AACAoB,iBAAYC,IAAZ,CAAiBN,aAAa,CAAb,EAAgB,CAAhB,EAAmBf,SAAnB,CAAjB;AACAoB,iBAAYC,IAAZ,CAAiBN;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAaf,UAAUN,KAAvB,EAA+B,CAA/B,GAAkC,CAAlC,EAAqCM,SAArC,CAAjB;AACAoB,iBAAYC,IAAZ,CAAiBN,aAAa,CAAb;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAgBf,UAAUJ,MAA1B,EAAmC,CAAnC,GAAsCI,SAAtC,CAAjB;AACAoB,iBAAYC,IAAZ,CAAiBN;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAaf,UAAUN,KAAvB,EAA+B,CAA/B;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAkCM,UAAUJ,MAA5C,EAAqD,CAArD,GAAwDI,SAAxD,CAAjB;;AAEA,YAAOoB,YAAYE,KAAZ,CAAkB,UAAUX,KAAV,EAAiB;AACtC,aAAIhE,MAAMqD,UAAUzL,IAAV,CAAeoM,KAAf,CAAV;AACA,aAAI/D,QAAQoD,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAeoM,KAAf,EAAuB,CAAvB,EAAZ;AACA,aAAI9D,OAAOmD,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAeoM,KAAf,EAAuB,CAAvB,EAAX;AACA,aAAI3D,UAAUgD,UAAUzL,IAAV;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAeoM,KAAf,EAAuB,CAAvB,EAAd;;AAEA;AACA,gBAAQ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,gBAAQ,CAAR;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAa/D,KAAb,EAAuB,CAAvB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAA4BC,IAA5B,EAAqC,CAArC,MAA2C;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,oBAAY,GAAZ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAmBG,OAAnB,EAA+B,CAA/B,CAA3C,CAAR;AACH,MARM,CAAP;AASH,EA9BD;;AAgCA,oBAAAzQ,CAAQ,GAAR,EAAiCgJ,QAAjC,CAA0C1I,OAA1C,E;;;;;;;AChSA;;AAEA;;;;;;;;AAOAD,QAAOC,OAAP,GAAiB,SAAS6O,SAAT,CAAmBuD,OAAnB,EAA4BjJ,QAA5B,EAAsC;AACnD,SAAIwH,MAAM,IAAI9Q,OAAO6U,KAAX,EAAV;AACA/D,SAAIgE,MAAJ,GAAaC,OAAO9L,IAAP,CAAY,IAAZ,EAAkB6H,GAAlB,EAAuBxH,QAAvB,CAAb;AACAwH,SAAIkE,OAAJ,GAAcC,QAAQhM,IAAR,CAAa,IAAb,EAAmB6H,GAAnB,EAAwBxH,QAAxB,CAAd;AACAwH,SAAIoE,GAAJ,GAAU3C,QAAQvP,GAAlB;AACA,YAAO8N,GAAP;AACH,EAND;;AAQA;;;;AAIA,UAASiE,MAAT,CAAgBjE,GAAhB,EAAqBxH,QAArB,EAA+B;AAC3B6L,gBAAW,YAAY;AACnB7L,kBAAS,IAAT,EAAewH,GAAf;AACH,MAFD,EAEG,CAFH;AAGH;;AAED;;;;AAIA,UAASmE,OAAT,CAAiBnE,GAAjB,EAAsBxH,QAAtB,EAAgC;AAC5BA,cAAS,IAAIE,KAAJ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAU,oBAAV,EAAiCsH,IAAIoE,GAArC,EAAT,EAAoDpE,GAApD;AACH,E;;;;;;;ACjCD;AACA;;AAEA5Q,QAAOC,OAAP,GAAiB;AACbiV,gBAAW,QADE;AAEbC,mBAAc,QAFD;AAGbC,WAAM,QAHO;AAIbC,iBAAY,QAJC;AAKbC,YAAO,QALM;AAMbC,YAAO,QANM;AAObC,aAAQ,QAPK;AAQbC,YAAO,QARM;AASbC,qBAAgB,QATH;AAUbzF,WAAM,QAVO;AAWb0F,iBAAY,QAXC;AAYbC,YAAO,QAZM;AAabC,gBAAW,QAbE;AAcbC,gBAAW,QAdE;AAebC,iBAAY,QAfC;AAgBbC,gBAAW,QAhBE;AAiBbC,YAAO,QAjBM;AAkBbC,qBAAgB,QAlBH;AAmBbC,eAAU,QAnBG;AAoBbC,cAAS,QApBI;AAqBbC,WAAM,QArBO;AAsBbC,eAAU,QAtBG;AAuBbC,eAAU,QAvBG;AAwBbC,oBAAe,QAxBF;AAyBbC,eAAU,QAzBG;AA0BbC,gBAAW,QA1BE;AA2BbC,eAAU,QA3BG;AA4BbC,gBAAW,QA5BE;AA6BbC,kBAAa,QA7BA;AA8BbC,qBAAgB,QA9BH;AA+BbC,iBAAY,QA/BC;AAgCbC,iBAAY,QAhCC;AAiCbC,cAAS,QAjCI;AAkCbC,iBAAY,QAlCC;AAmCbC,mBAAc,QAnCD;AAoCbC,oBAAe,QApCF;AAqCbC,oBAAe,QArCF;AAsCbC,oBAAe,QAtCF;AAuCbC,oBAAe,QAvCF;AAwCbC,iBAAY,QAxCC;AAyCbC,eAAU,QAzCG;AA0CbC,kBAAa,QA1CA;AA2CbC,cAAS,QA3CI;AA4CbC,cAAS,QA5CI;AA6CbC,iBAAY,QA7CC;AA8CbC,gBAAW,QA9CE;AA+CbC,kBAAa,QA/CA;AAgDbC,kBAAa,QAhDA;AAiDbC,cAAS,QAjDI;AAkDbC,gBAAW,QAlDE;AAmDbC,iBAAY,QAnDC;AAoDbC,WAAM,QApDO;AAqDbC,gBAAW,QArDE;AAsDbC,WAAM,QAtDO;AAuDbtI,YAAO,QAvDM;AAwDbuI,kBAAa,QAxDA;AAyDbC,WAAM,QAzDO;AA0DbC,eAAU,QA1DG;AA2DbC,cAAS,QA3DI;AA4DbC,gBAAW,QA5DE;AA6DbC,aAAQ,QA7DK;AA8DbC,YAAO,QA9DM;AA+DbC,YAAO,QA/DM;AAgEbC,eAAU,QAhEG;AAiEbC,oBAAe,QAjEF;AAkEbC,gBAAW,QAlEE;AAmEbC,mBAAc,QAnED;AAoEbC,gBAAW,QApEE;AAqEbC,iBAAY,QArEC;AAsEbC,gBAAW,QAtEE;AAuEbC,2BAAsB,QAvET;AAwEbC,gBAAW,QAxEE;AAyEbC,iBAAY,QAzEC;AA0EbC,gBAAW,QA1EE;AA2EbC,gBAAW,QA3EE;AA4EbC,kBAAa,QA5EA;AA6EbC,oBAAe,QA7EF;AA8EbC,mBAAc,QA9ED;AA+EbC,qBAAgB,QA/EH;AAgFbC,qBAAgB,QAhFH;AAiFbC,qBAAgB,QAjFH;AAkFbC,kBAAa,QAlFA;AAmFbC,WAAM,QAnFO;AAoFbC,gBAAW,QApFE;AAqFbC,YAAO,QArFM;AAsFbC,cAAS,QAtFI;AAuFbC,aAAQ,QAvFK;AAwFbC,uBAAkB,QAxFL;AAyFbC,iBAAY,QAzFC;AA0FbC,mBAAc,QA1FD;AA2FbC,mBAAc,QA3FD;AA4FbC,qBAAgB,QA5FH;AA6FbC,sBAAiB,QA7FJ;AA8FbC,wBAAmB,QA9FN;AA+FbC,sBAAiB,QA/FJ;AAgGbC,sBAAiB,QAhGJ;AAiGbC,mBAAc,QAjGD;AAkGbC,gBAAW,QAlGE;AAmGbC,gBAAW,QAnGE;AAoGbC,eAAU,QApGG;AAqGbC,kBAAa,QArGA;AAsGbC,WAAM,QAtGO;AAuGbC,cAAS,QAvGI;AAwGbC,YAAO,QAxGM;AAyGbC,gBAAW,QAzGE;AA0GbC,aAAQ,QA1GK;AA2GbC,gBAAW,QA3GE;AA4GbC,aAAQ,QA5GK;AA6GbC,oBAAe,QA7GF;AA8GbC,gBAAW,QA9GE;AA+GbC,oBAAe,QA/GF;AAgHbC,oBAAe,QAhHF;AAiHbC,iBAAY,QAjHC;AAkHbC,gBAAW,QAlHE;AAmHbC,WAAM,QAnHO;AAoHbC,WAAM,QApHO;AAqHbC,WAAM,QArHO;AAsHbC,iBAAY,QAtHC;AAuHbC,aAAQ,QAvHK;AAwHbC,oBAAe,QAxHF;AAyHbxM,UAAK,QAzHQ;AA0HbyM,gBAAW,QA1HE;AA2HbC,gBAAW,QA3HE;AA4HbC,kBAAa,QA5HA;AA6HbC,aAAQ,QA7HK;AA8HbC,iBAAY,QA9HC;AA+HbC,eAAU,QA/HG;AAgIbC,eAAU,QAhIG;AAiIbC,aAAQ,QAjIK;AAkIbC,aAAQ,QAlIK;AAmIbC,cAAS,QAnII;AAoIbC,gBAAW,QApIE;AAqIbC,gBAAW,QArIE;AAsIbC,gBAAW,QAtIE;AAuIbC,WAAM,QAvIO;AAwIbC,kBAAa,QAxIA;AAyIbC,gBAAW,QAzIE;AA0IbC,UAAK,QA1IQ;AA2IbC,WAAM,QA3IO;AA4IbC,cAAS,QA5II;AA6IbC,aAAQ,QA7IK;AA8IbC,gBAAW,QA9IE;AA+IbC,aAAQ,QA/IK;AAgJbC,YAAO,QAhJM;AAiJbC,YAAO,QAjJM;AAkJbC,iBAAY,QAlJC;AAmJbC,aAAQ,QAnJK;AAoJbC,kBAAa;AApJA,EAAjB,C;;;;;;;ACHA;;;AAGA;;AAEA,KAAMtV,SAAS,mBAAAjJ,CAAQ,EAAR,CAAf;AACA,KAAMkJ,mBAAmB,mBAAAlJ,CAAQ,EAAR,CAAzB;;AAEAM,SAAQ0I,QAAR,GAAmB,UAACwV,MAAD,EAAY;AAC3B;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAAI,OAAOA,MAAX,EAAsB,QAAtB,GAAgC;AAC5B;AACH;;AAED;AACA;AACAA,YAAOC,mCAAP,GACID,OAAOhM,2BAAP,CAAmCpJ,IAAnC,CAAwC,EAAxC,CADJ;AAEAoV,YAAOE,+BAAP,GACIF,OAAO5L,uBAAP,CAA+BxJ,IAA/B,CAAoC,EAApC,CADJ;;AAGA;;;;AAIAoV,YAAOhM,2BAAP,GAAqC,UAACmM,MAAD,EAASjM,OAAT,EAAkBkM,eAAlB,EAAsC;AACvE,aAAMnV,WAAW,SAAXA,QAAW,CAAC1F,OAAD,EAAa;AAAA,iBACnB2F,MADmB,GACF3F,OADE,CACnB2F,MADmB;AAAA,iBACXwH,KADW,GACFnN,OADE,CACXmN,KADW;;AAE1B,iBAAIxH,MAAJ,EAAY;AACR,uBAAM,IAAIC,KAAJ,CAAUD,OAAO3F,OAAjB,CAAN;AACH,cAFD,MAEO;AACH,wBAAO6a,gBAAgB1N,KAAhB,CAAP;AACH;AACJ,UAPD;;AASA,aAAMtH,UACF,EAAC5H,MAAMiH,OAAOY,OAAP,CAAeO,4BAAtB,EAAoDpC,MAAM,EAAC2W,cAAD,EAASjM,gBAAT,EAA1D,EADJ;AAEA,gBAAOxJ,iBAAiBa,WAAjB,CACHH,OADG,EACM,8CADN,EACsDH,QADtD,CAAP;AAEH,MAdD;;AAgBA;;;;AAIA+U,YAAO5L,uBAAP,GAAiC,UAAC+L,MAAD,EAASC,eAAT,EAA6B;AAC1D,aAAMnV,WAAW,SAAXA,QAAW,CAAC1F,OAAD,EAAa;AAAA,iBACnB2F,MADmB,GACF3F,OADE,CACnB2F,MADmB;AAAA,iBACXwH,KADW,GACFnN,OADE,CACXmN,KADW;;AAE1B,iBAAIxH,MAAJ,EAAY;AACR,uBAAM,IAAIC,KAAJ,CAAUD,OAAO3F,OAAjB,CAAN;AACH,cAFD,MAEO;AACH,wBAAO6a,gBAAgB1N,KAAhB,CAAP;AACH;AACJ,UAPD;;AASA,aAAMtH,UACF,EAAC5H,MAAMiH,OAAOY,OAAP,CAAeQ,wBAAtB,EAAgDrC,MAAM,EAAC2W,cAAD,EAAtD,EADJ;AAEA,gBAAOzV,iBAAiBa,WAAjB,CACHH,OADG,EACM,0CADN,EACkDH,QADlD,CAAP;AAEH,MAdD;AAeH,EAnDD,C;;;;;;;ACRA;;;AAGA;;AAEA;;;;;;AAKAnJ,SAAQue,MAAR,GAAiB;AACbC,UAAO,CADM;AAEbC,eAAY,CAFC;AAGbC,WAAQ,CAHK;AAIbC,eAAY,CAJC;AAKbC,aAAU,CALG;AAMbC,gBAAa,CANA;AAObxc,UAAO;AAPM,EAAjB;;AAUA;;;;;AAKArC,SAAQ8e,OAAR,GAAkB,sCAAlB;;AAEA;;;;;AAKA9e,SAAQ+e,YAAR,GAAuB;AACnBC,YAAS;AADU,EAAvB;;AAIA;;;;;AAKAhf,SAAQif,oBAAR,GAA+B,IAA/B;;AAEA;;;;;;;AAOAjf,SAAQkf,iBAAR,GAA4B,EAA5B;;AAEA;;;;;;AAMAlf,SAAQmf,kBAAR;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,GAA6B,IAA7B,EAAoC,CAApC;;AAEA;;;;;AAKAnf,SAAQof,aAAR,GAAwB,aAAxB,C;;;;;;;ACjEA;;;;;;AAEA,KAAMC,aAAa,mBAAA3f,CAAQ,GAAR,CAAnB;AACA,KAAMiJ,SAAS,mBAAAjJ,CAAQ,EAAR,CAAf;;KAEM4f,a;AACF,8BAAc;AAAA;AAAE;;AAEhB;;;;;;;;;4DAK8D;AAAA,iBAAhCjB,MAAgC,QAAhCA,MAAgC;AAAA,iBAAxBjM,OAAwB,QAAxBA,OAAwB;AAAA,iBAAfmN,YAAe,QAAfA,YAAe;;AAC1DF,wBAAWlB,mCAAX,CAA+CE,MAA/C,EAAuDjM,OAAvD,EAAgE,UAACxB,KAAD,EAAW;AACvE2O,8BAAa,EAAC3O,YAAD,EAAb;AACH,cAFD;AAGH;;AAED;;;;;;;;yDAKiD;AAAA,iBAAvByN,MAAuB,SAAvBA,MAAuB;AAAA,iBAAfkB,YAAe,SAAfA,YAAe;;AAC7CF,wBAAWjB,+BAAX,CAA2CC,MAA3C,EAAmD,UAACzN,KAAD,EAAW;AAC1D2O,8BAAa,EAAC3O,YAAD,EAAb;AACH,cAFD;AAGH;;;gCAEM4O,G,EAAKC,O,EAAS;AACjB,qBAAQD,IAAI9d,IAAZ;AACI,sBAAKiH,OAAOY,OAAP,CAAeO,4BAApB;AACI,0BAAK4V,4BAAL,CAAkCF,IAAI9X,IAAtC;AACA;AACJ,sBAAKiB,OAAOY,OAAP,CAAeQ,wBAApB;AACI,0BAAK4V,wBAAL,CAA8BH,IAAI9X,IAAlC;AACA;AACJ;AACI;AACA;AATR;;AAYA;AACA,oBAAO,IAAP;AACH;;;;;;AACJ;;AAED3H,QAAOC,OAAP,GAAiB,IAAIsf,aAAJ,EAAjB,C;;;;;;;AChDA;;;;;;AAEA,KAAMM,QAAQ,mBAAAlgB,CAAQ,GAAR,CAAd;AACA,KAAMiJ,SAAS,mBAAAjJ,CAAQ,EAAR,CAAf;;AAEA,KAAMmgB,mBAAmB,QAAzB;;KAEMC,Y;AACF,6BAAc;AAAA;;AACV,cAAKC,KAAL,GAAa,IAAIH,KAAJ,EAAb;AACH;;AAED;;;;;;;;;;oCAMW/c,G,EAAK;AACZ,oBAAO;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,sBAAOA,GAAP,EAAe,QAAf,KACHgd,iBAAiB9N,IAAjB,CAAsBlP,GAAtB,CADJ;AAEH;;AAED;;;;;;;;;0CAMiB0c,Y,EAAc;AAC3B,oBAAO,UAAClN,GAAD,EAAS;AACZkN,8BAAa,EAACnW,QAAQ,EAACb,MAAM8J,IAAI9J,IAAX,EAAiB9E,SAAS4O,IAAI5O,OAA9B,EAAT,EAAb;AACH,cAFD;AAGH;;AAED;;;;;;;;qCAKmC;AAAA,iBAA5Buc,WAA4B,QAA5BA,WAA4B;AAAA,iBAAfT,YAAe,QAAfA,YAAe;;AAC/B,kBAAKQ,KAAL,CAAWE,IAAX,CAAgBD,WAAhB,EAA6B,YAAM;AAC/BT,8BAAa,EAAb;AACH,cAFD,EAEG,KAAKW,gBAAL,CAAsBX,YAAtB,CAFH;AAGH;;AAED;;;;;;;;oCAKoC;AAAA,iBAA/BY,cAA+B,SAA/BA,cAA+B;AAAA,iBAAfZ,YAAe,SAAfA,YAAe;;AAChC,kBAAKQ,KAAL,CAAWK,EAAX,CAAcD,cAAd,EAA8B,UAACE,OAAD,EAAa;AACvCd,8BAAa;AACTc,8BAASA,QAAQnb,GAAR,CAAY,UAACkI,KAAD;AAAA,gCAChB,EAACkT,UAAUlT,MAAMkT,QAAjB,EAA2B/X,MAAM6E,MAAM7E,IAAvC,EADgB;AAAA,sBAAZ;AADA,kBAAb;AAIH,cALD,EAKG,KAAK2X,gBAAL,CAAsBX,YAAtB,CALH;AAMH;;AAED;;;;;;;;uCAK4C;AAAA,iBAApCve,IAAoC,SAApCA,IAAoC;AAAA,iBAA9Buf,aAA8B,SAA9BA,aAA8B;AAAA,iBAAfhB,YAAe,SAAfA,YAAe;;AACxC,kBAAKQ,KAAL,CAAWS,KAAX,CAAiBxf,IAAjB,EAAuBuf,aAAvB,EAAsC,UAACnT,KAAD,EAAW;AAC7CmS,8BAAa;AACTnS,4BAAO,EAACkT,UAAUlT,MAAMkT,QAAjB,EAA2B/X,MAAM6E,MAAM7E,IAAvC;AADE,kBAAb;AAGH,cAJD,EAIG,KAAK2X,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;sCAKmC;AAAA,iBAA5BkB,WAA4B,SAA5BA,WAA4B;AAAA,iBAAflB,YAAe,SAAfA,YAAe;;AAC/B,kBAAKQ,KAAL,CAAWW,IAAX,CAAgBD,WAAhB,EAA6B,UAACE,IAAD,EAAU;AACnCpB,8BAAa;AACToB,2BAAMf,MAAMgB,eAAN,CAAsBD,IAAtB;AADG,kBAAb;AAGH,cAJD,EAIG,KAAKT,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;qDAK2C;AAAA,iBAArBve,IAAqB,SAArBA,IAAqB;AAAA,iBAAfue,YAAe,SAAfA,YAAe;;AACvC,kBAAKQ,KAAL,CAAWc,mBAAX,CAA+B7f,IAA/B,EAAqC,UAACA,IAAD,EAAU;AAC3Cue,8BAAa,EAACve,UAAD,EAAb;AACH,cAFD,EAEG,KAAKkf,gBAAL,CAAsBX,YAAtB,CAFH;AAGH;;AAED;;;;;;;;wCAK6C;AAAA,iBAApCve,IAAoC,SAApCA,IAAoC;AAAA,iBAA9Buf,aAA8B,SAA9BA,aAA8B;AAAA,iBAAfhB,YAAe,SAAfA,YAAe;;AACzC,kBAAKQ,KAAL,CAAWtX,MAAX,CAAkBzH,IAAlB,EAAwBuf,aAAxB,EAAuC,YAAM;AACzChB,8BAAa,EAAb;AACH,cAFD,EAEG,KAAKW,gBAAL,CAAsBX,YAAtB,CAFH;AAGH;;AAED;;;;;;;;oCAK4C;AAAA,iBAAvCxK,GAAuC,SAAvCA,GAAuC;AAAA,iBAAlC+L,IAAkC,SAAlCA,IAAkC;AAAA,iBAA5BC,WAA4B,SAA5BA,WAA4B;AAAA,iBAAfxB,YAAe,SAAfA,YAAe;;AACxC,kBAAKQ,KAAL,CAAWiB,EAAX,CAAcjM,GAAd,EAAmB+L,IAAnB,EAAyBC,WAAzB,EAAsC,UAAC3T,KAAD,EAAW;AAC7CmS,8BAAa;AACTnS,4BAAO,EAACkT,UAAUlT,MAAMkT,QAAjB,EAA2B/X,MAAM6E,MAAM7E,IAAvC;AADE,kBAAb;AAGH,cAJD,EAIG,KAAK2X,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;oCAKiC;AAAA,iBAA5BkB,WAA4B,SAA5BA,WAA4B;AAAA,iBAAflB,YAAe,SAAfA,YAAe;;AAC7B,kBAAKQ,KAAL,CAAWkB,EAAX,CAAcR,WAAd,EAA2B,YAAM;AAC7BlB,8BAAa,EAAb;AACH,cAFD,EAEG,KAAKW,gBAAL,CAAsBX,YAAtB,CAFH;AAGH;;AAED;;;;;;;;oCAKoC;AAAA,iBAA/BY,cAA+B,SAA/BA,cAA+B;AAAA,iBAAfZ,YAAe,SAAfA,YAAe;;AAChC,kBAAKQ,KAAL,CAAWmB,EAAX,CAAcf,cAAd,EAA8B,UAAC/S,KAAD,EAAW;AACrCmS,8BAAa;AACTnS,4BAAO,EAACkT,UAAUlT,MAAMkT,QAAjB,EAA2B/X,MAAM6E,MAAM7E,IAAvC;AADE,kBAAb;AAGH,cAJD,EAIG,KAAK2X,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;qCAK4C;AAAA,iBAAvCxK,GAAuC,UAAvCA,GAAuC;AAAA,iBAAlC+L,IAAkC,UAAlCA,IAAkC;AAAA,iBAA5BC,WAA4B,UAA5BA,WAA4B;AAAA,iBAAfxB,YAAe,UAAfA,YAAe;;AACxC,kBAAKQ,KAAL,CAAWoB,EAAX,CAAcpM,GAAd,EAAmB+L,IAAnB,EAAyBC,WAAzB,EAAsC,UAAC3T,KAAD,EAAW;AAC7CmS,8BAAa;AACTnS,4BAAO,EAACkT,UAAUlT,MAAMkT,QAAjB,EAA2B/X,MAAM6E,MAAM7E,IAAvC;AADE,kBAAb;AAGH,cAJD,EAIG,KAAK2X,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;wCAK+C;AAAA,iBAAvCkB,WAAuC,UAAvCA,WAAuC;AAAA,iBAA1BW,SAA0B,UAA1BA,SAA0B;AAAA,iBAAf7B,YAAe,UAAfA,YAAe;;AAC3C,iBAAI,KAAK8B,UAAL,CAAgBD,SAAhB,CAAJ,EAAgC;AAC5BA,6BAAYxB,MAAM0B,aAAN,CAAoBF,SAApB,CAAZ;AACH;;AAED,kBAAKrB,KAAL,CAAWwB,KAAX,CAAiBd,WAAjB,EAA8BW,SAA9B,EAAyC,UAAChU,KAAD,EAAW;AAChDmS,8BAAa;AACTnS,4BAAO,EAAC7E,MAAM6E,MAAM7E,IAAb,EAAmBvH,MAAMoM,MAAMkT,QAA/B;AADE,kBAAb;AAGH,cAJD,EAIG,KAAKJ,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;qCAKoB;AAAA,iBAAfA,YAAe,UAAfA,YAAe;;AAChB,kBAAKQ,KAAL,CAAWyB,EAAX,CAAc,UAACC,QAAD,EAAWC,QAAX,EAAqBC,OAArB,EAAiC;AAC3CpC,8BAAa;AACT7X,2BAAM,EAAC+Z,kBAAD,EAAWC,kBAAX,EAAqBC,gBAArB;AADG,kBAAb;AAGH,cAJD,EAIG,KAAKzB,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;AAED;;;;;;;;2CAKoC;AAAA,iBAAzBqC,QAAyB,UAAzBA,QAAyB;AAAA,iBAAfrC,YAAe,UAAfA,YAAe;;AAChC,kBAAKQ,KAAL,CAAW8B,QAAX,CAAoBD,QAApB,EAA8B,UAACxU,KAAD,EAAW;AACrCmS,8BAAa;AACTnS,4BAAOA,MAAM0U,KAAN;AADE,kBAAb;AAGH,cAJD,EAIG,KAAK5B,gBAAL,CAAsBX,YAAtB,CAJH;AAKH;;;gCAEMC,G,EAAKC,O,EAAS;AAAA;;AACjB,iBAAI,CAAC,KAAKsC,mBAAV,EAA+B;AAC3B,sBAAKA,mBAAL,GAA2B,IAAIrU,OAAJ,CAAY,UAACF,OAAD,EAAa;AAChD,2BAAKuS,KAAL,CAAWE,IAAX,CAAgB,EAAC+B,YAAY,IAAb,EAAmBC,MAAM,CAAzB,EAAhB,EAA6C,YAAM;AAC/CzU;AACH,sBAFD;AAGH,kBAJ0B,CAA3B;AAKH;;AAED,iBAAI0U,UAAU,IAAd;AACA,qBAAQ1C,IAAI9d,IAAZ;AACI,sBAAKiH,OAAOY,OAAP,CAAeS,QAApB;AACIkY,+BAAU,KAAKC,GAAf;AACA;AACJ,sBAAKxZ,OAAOY,OAAP,CAAeU,QAApB;AACIiY,+BAAU,KAAKE,GAAf;AACA;AACJ,sBAAKzZ,OAAOY,OAAP,CAAeW,YAApB;AACIgY,+BAAU,KAAKG,OAAf;AACA;AACJ,sBAAK1Z,OAAOY,OAAP,CAAeY,QAApB;AACI+X,+BAAU,KAAKI,GAAf;AACA;AACJ,sBAAK3Z,OAAOY,OAAP,CAAea,eAApB;AACI8X,+BAAU,KAAKK,SAAf;AACA;AACJ,sBAAK5Z,OAAOY,OAAP,CAAec,UAApB;AACI6X,+BAAU,KAAKM,KAAf;AACA;AACJ,sBAAK7Z,OAAOY,OAAP,CAAee,QAApB;AACI4X,+BAAU,KAAKO,GAAf;AACA;AACJ,sBAAK9Z,OAAOY,OAAP,CAAegB,WAApB;AACI2X,+BAAU,KAAKQ,MAAf;AACA;AACJ,sBAAK/Z,OAAOY,OAAP,CAAeiB,QAApB;AACI0X,+BAAU,KAAKS,GAAf;AACA;AACJ,sBAAKha,OAAOY,OAAP,CAAekB,UAApB;AACIyX,+BAAU,KAAKU,KAAf;AACA;AACJ,sBAAKja,OAAOY,OAAP,CAAemB,4BAApB;AACIwX,+BAAU,KAAKW,oBAAf;AACA;AACJ,sBAAKla,OAAOY,OAAP,CAAeoB,QAApB;AACIuX,+BAAU,KAAKY,GAAf;AACA;AACJ,sBAAKna,OAAOY,OAAP,CAAeqB,WAApB;AACIsX,+BAAU,KAAKa,MAAf;AACA;AACJ;AACI;AACA;AA1CR;;AA6CAb,uBAAUA,QAAQpZ,IAAR,CAAa,IAAb,CAAV;AACA,kBAAKiZ,mBAAL,CAAyBhW,IAAzB,CAA8B,YAAM;AAChCmW,yBAAQ1C,IAAI9X,IAAZ;AACH,cAFD;;AAIA;AACA,oBAAO,IAAP;AACH;;;;;;AACJ;;AAED3H,QAAOC,OAAP,GAAiB,IAAI8f,YAAJ,EAAjB,C;;;;;;;AC1QA;;;;;;;;;;;;;;;;;;;;;;;AAuBA;;;;AAEA,KAAIkD,OAAOnjB,MAAX,C,CAAmB;;AAEnBmjB,MAAKC,iBAAL,GAAyBD,KAAKC,iBAAL,IAA0BD,KAAKE,uBAAxD;;AAEAF,MAAKG,yBAAL,GAAiCH,KAAKG,yBAAL,IACAH,KAAKI,+BADtC;AAEA1e,WAAU2e,gBAAV,GAA6B3e,UAAU2e,gBAAV,IACA3e,UAAU4e,sBADvC;AAEA5e,WAAU6e,iBAAV,GAA8B7e,UAAU6e,iBAAV,IACA7e,UAAU8e,uBADxC;AAEAR,MAAKS,WAAL,GAAmBT,KAAKS,WAAL,IAAoBT,KAAKU,cAAzB,IACAV,KAAKW,iBADxB;;AAGA;AACA,KAAIX,KAAKY,SAAL,KAAmBC,SAAvB,EAAkC;AAChC,OAAID,YAAY,qBAAW,CAAE,CAA7B;AACAA,aAAUE,SAAV,CAAoBA,SAApB,GAAgCza,MAAMya,SAAtC;AACD,EAHD,MAGO;AACHF,eAAYZ,KAAKY,SAAjB;AACH;;AAED,KAAIG,OAAO;;AAET;;;;;;AAMAxe,YAAS,iBAASye,IAAT,EAAe;AACtB,YAAOvQ,MAAMqQ,SAAN,CAAgBG,KAAhB,CAAsBC,IAAtB,CAA2BF,QAAQ,EAAnC,EAAuC,CAAvC,CAAP;AACD,IAVQ;;AAYT;;;;;AAKA;;;;;;;;;AASAG,iBAAc,sBAASte,GAAT,EAAcue,WAAd,EAA2BC,YAA3B,EAAyC;AACrD,SAAIC,WAAWD,gBAAgBR,SAAhB,GAA4BQ,YAA5B,GAA2C,IAA1D;AACA,SAAIC,QAAJ,EAAc;AACZ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,SAAO,UAAUF,WAAV,GAAwB,UAA/B,EAA4CpB,KAAKuB,IAAL,CAAU1e,GAAV,CAA5C;AACD,MAFD,MAEO;AACL;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,SAAO,UAAUue,WAAV,GAAwB,GAA/B,EAAqCve,GAArC;AACD;AACF,IAjCQ;;AAmCT;;;;;;;AAOA2e,mBAAgB,wBAASC,MAAT,EAAiBC,eAAjB,EAAkC;;AAEhD,SAAIC,OAAO,IAAIC,UAAJ,CAAeH,OAAOzc,MAAtB,CAAX;AACA,UAAK,IAAI6c,IAAI,CAAb,EAAgBA,IAAIF,KAAK3c,MAAzB,EAAiC,EAAE6c,CAAnC,EAAsC;AACpCF,YAAKE,CAAL,IAAUJ,OAAOK,UAAP,CAAkBD,CAAlB,CAAV;AACD;;AAED,SAAIE,OAAO,IAAIC,IAAJ,CAAS,CAACL,IAAD,CAAT,EACSD,kBAAkB,EAAChjB,MAAMgjB,eAAP,EAAlB,GAA4C,EADrD,CAAX;;AAGA,YAAO1B,KAAKjf,GAAL,CAASkhB,eAAT,CAAyBF,IAAzB,CAAP;AACD,IArDQ;;AAuDT;;;;;;AAMAnE,oBAAiB,yBAASmE,IAAT,EAAe;AAC9B,YAAO/B,KAAKjf,GAAL,CAASkhB,eAAT,CAAyBF,IAAzB,CAAP;AACD,IA/DQ;;AAiET;;;;;;;AAOAG,sBAAmB,2BAASH,IAAT,EAAe5b,QAAf,EAAyBgc,iBAAzB,EAA4C;AAC7D,SAAIC,SAAS,IAAIC,UAAJ,EAAb;AACAD,YAAOzQ,MAAP,GAAgB,UAAStB,CAAT,EAAY;AAC1BlK,gBAASkK,EAAEiS,MAAF,CAASC,MAAlB;AACD,MAFD;AAGAH,YAAOvQ,OAAP,GAAiB,UAASxB,CAAT,EAAY;AAC3B,WAAI8R,iBAAJ,EAAuB;AACrBA,2BAAkB9R,CAAlB;AACD;AACF,MAJD;;AAMA+R,YAAOI,iBAAP,CAAyBT,IAAzB;AACD,IApFQ;;AAsFT;;;;;;AAMAzD,kBAAe,uBAASmE,OAAT,EAAkB;AAC/B,SAAIC,gBAAgB,UAApB;AACA,SAAID,QAAQE,OAAR,CAAgBD,aAAhB,KAAkC,CAAC,CAAvC,EAA0C;AACxC,WAAIE,QAAQH,QAAQI,KAAR,CAAc,GAAd,CAAZ;AACA,WAAIzB,cAAcwB,MAAM,CAAN,EAASC,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAlB;AACA,WAAIC,MAAMC,mBAAmBH,MAAM,CAAN,CAAnB,CAAV;;AAEA,cAAO,IAAIZ,IAAJ,CAAS,CAACc,GAAD,CAAT,EAAgB,EAACpkB,MAAM0iB,WAAP,EAAhB,CAAP;AACD;;AAED,SAAIwB,QAAQH,QAAQI,KAAR,CAAcH,aAAd,CAAZ;AACA,SAAItB,cAAcwB,MAAM,CAAN,EAASC,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAlB;AACA,SAAIC,MAAMjmB,OAAOmmB,IAAP,CAAYJ,MAAM,CAAN,CAAZ,CAAV;AACA,SAAIK,YAAYH,IAAI9d,MAApB;;AAEA,SAAIke,aAAa,IAAItB,UAAJ,CAAeqB,SAAf,CAAjB;;AAEA,UAAK,IAAIpB,IAAI,CAAb,EAAgBA,IAAIoB,SAApB,EAA+B,EAAEpB,CAAjC,EAAoC;AAClCqB,kBAAWrB,CAAX,IAAgBiB,IAAIhB,UAAJ,CAAeD,CAAf,CAAhB;AACD;;AAED,YAAO,IAAIG,IAAJ,CAAS,CAACkB,UAAD,CAAT,EAAuB,EAACxkB,MAAM0iB,WAAP,EAAvB,CAAP;AACD,IAlHQ;;AAoHT;;;;;;;AAOA+B,sBAAmB,2BAASC,MAAT,EAAiB1B,eAAjB,EAAkC;AACnD,SAAIwB,aAAa,IAAItB,UAAJ,CAAewB,MAAf,CAAjB;AACA,YAAO,IAAIpB,IAAJ,CAAS,CAACkB,UAAD,CAAT,EACSxB,kBAAkB,EAAChjB,MAAMgjB,eAAP,EAAlB,GAA4C,EADrD,CAAP;AAED,IA/HQ;;AAiIT;;;;;;;AAOA2B,8BAA2B,mCAASD,MAAT,EAAiBjd,QAAjB,EAA2Bgc,iBAA3B,EAA8C;AACvE,SAAIC,SAAS,IAAIC,UAAJ,EAAb;AACAD,YAAOzQ,MAAP,GAAgB,UAAStB,CAAT,EAAY;AAC1BlK,gBAASkK,EAAEiS,MAAF,CAASC,MAAlB;AACD,MAFD;AAGAH,YAAOvQ,OAAP,GAAiB,UAASxB,CAAT,EAAY;AAC3B,WAAI8R,iBAAJ,EAAuB;AACrBA,2BAAkB9R,CAAlB;AACD;AACF,MAJD;;AAMA,SAAI6S,aAAa,IAAItB,UAAJ,CAAewB,MAAf,CAAjB;AACAhB,YAAOkB,kBAAP,CAA0B,IAAItB,IAAJ,CAAS,CAACkB,UAAD,CAAT,CAA1B;AACD,IArJQ;;AAuJT;;;;;;;AAOAK,wBAAqB,6BAASC,KAAT,EAAgB;AACnC,SAAI;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,cAAOA,KAAP,uCAAOA,KAAP,cAAuB,EAAvB,CAAJ,EAA+B;AAC7B,cAAO,IAAP;AACD;AACD,SAAI3B,IAAI2B,MAAMxe,MAAd;AACA,SAAIye,OAAO,IAAIhT,KAAJ,CAAUoR,CAAV,CAAX;AACA,YAAOA,GAAP,EAAY;AACV4B,YAAK5B,CAAL,IAAU3e,OAAOwgB,YAAP,CAAoBF,MAAM3B,CAAN,CAApB,CAAV;AACD;AACD,YAAO4B,KAAKphB,IAAL,CAAU,EAAV,CAAP;AACD,IAxKQ;;AA0KT;;;;;;AAMAshB,qBAAkB,0BAASC,QAAT,EAAmB;AACnC,SAAIC,MAAMD,SAASE,WAAT,CAAqB,GAArB,CAAV;AACA,YAAOD,OAAO,CAAC,CAAR,GAAYD,SAASG,SAAT,CAAmBF,GAAnB,CAAZ,GAAsC,EAA7C;AACD;AAnLQ,EAAX;;AAuLA,KAAIG,cAAc,SAAdA,WAAc,CAASC,GAAT,EAAc;AAC9B,QAAKnD,SAAL,GAAiBF,UAAUE,SAA3B;AACA,QAAKoD,IAAL,GAAYD,IAAIC,IAAhB;AACA,QAAK3e,IAAL,GAAY0e,IAAI1e,IAAhB;AACD,EAJD;AAKA;;AAEA;AACA;AACAqb,WAAUuD,qBAAV,GAAkC,IAAlC;;AAEA;AACAvD,WAAUE,SAAV,CAAoBsD,gBAApB,CAAqC,MAArC,EAA6C,YAAW;AACtD,OAAIriB,OAAOD,OAAOC,IAAP,CAAY6e,SAAZ,CAAX;AACA,QAAK,IAAIiB,IAAI,CAAR,EAAW5f,GAAhB,EAAqBA,MAAMF,KAAK8f,CAAL,CAA3B,EAAoC,EAAEA,CAAtC,EAAyC;AACvC,SAAIjB,UAAU3e,GAAV,KAAkB,KAAKiiB,IAA3B,EAAiC;AAC/B,cAAOjiB,GAAP;AACD;AACF;AACD,UAAO,eAAP;AACD,EARD;;AAWA,KAAI2a,QAAQ,IAAI,YAAW;;AAEzB,OAAIyH,oBAAoB,sCAAxB;AACA,OAAIC,sBAAsB,kBAA1B;AACA,OAAIC,kBAAkB,2BAAtB;AACA,OAAIC,iBAAiB,2CAArB;AACA,OAAIC,gBAAgB,aAApB;AACA,OAAIC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,KAAkB,IAAlB,EAAyB,IAAzB,CAAJ,CAPyB,CAOU;;AAEnC,OAAIC,MAAM,IAAV;AACA,OAAIC,OAAO,IAAX;AACA,OAAIC,UAAU,KAAd;;AAEA,OAAIC,WAAW,SAAXA,QAAW,CAAS9mB,IAAT,EAAe;AAC5B,YAAOA,KAAK2kB,OAAL,CAAa8B,aAAb,KAA+B,CAAtC;AACD,IAFD;;AAIA;AACA;AACA,OAAIM,eAAe,SAAfA,YAAe,CAAS/mB,IAAT,EAAe;AAChC,SAAI,CAAC8mB,SAAS9mB,IAAT,CAAL,EAAqB;AACnB,WAAIA,KAAK,CAAL,KAAW,GAAf,EAAoB;AAClBA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAO2mB,IAAIK,IAAJ,CAASlG,KAAT,EAAP,EAA0B9gB,KAAK+lB,SAAL,CAAe,CAAf,CAA1B;AACD,QAFD,MAEO,IAAI/lB,KAAK2kB,OAAL,CAAa,IAAb,KAAsB,CAAtB,IAA2B3kB,KAAK2kB,OAAL,CAAa,KAAb,KAAuB,CAAtD,EAAyD;AAC9D,aAAI3kB,QAAQ,KAAR,IAAiB4mB,QAAQD,IAAIK,IAAjC,EAAuC;AACrChnB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,aAAO4mB,KAAK9F,KAAL,KAAe,GAAtB,EAA4B9gB,IAA5B;AACD,UAFD,MAEO;AACLA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,aAAO4mB,KAAK9F,KAAL,EAAP,EAAsB9gB,IAAtB;AACD;AACF,QANM,MAMA;AACLA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAO4mB,KAAK9F,KAAL,KAAe,GAAtB,EAA4B9gB,IAA5B;AACD;AACF;;AAED,YAAOA,IAAP;AACD,IAhBD;;AAkBE;;;;;;;;;;;AAWF,OAAIinB,YAAY,SAAZA,SAAY,CAASC,MAAT,EAAiBC,OAAjB,EAA0Bhf,QAA1B,EAAoCif,OAApC,EAA6C;AAC3D,SAAItT,UAAU,SAAVA,OAAU,CAASzB,CAAT,EAAY;AACtB,WAAI+U,OAAJ,EAAa;AACTA,iBAAQ/U,CAAR;AACH;AACJ,MAJD;;AAMA;AACA,SAAI0B,MAAMgT,aAAaG,MAAb,CAAV;;AAEA,SAAIA,UAAUC,OAAd,EAAuB;AACrB,WAAIrH,OAAOiH,aAAaI,OAAb,CAAX;AACAnF,YAAKG,yBAAL,CAA+BpO,GAA/B,EAAoC,UAASsT,QAAT,EAAmB;AACrDrF,cAAKG,yBAAL,CAA+BrC,IAA/B,EAAqC,UAASwH,SAAT,EAAoB;AACvDnf,oBAASkf,QAAT,EAAmBC,SAAnB;AACD,UAFD,EAEGxT,OAFH;AAGD,QAJD,EAIGA,OAJH;AAKD,MAPD,MAOO;AACLkO,YAAKG,yBAAL,CAA+BpO,GAA/B,EAAoC5L,QAApC,EAA8C2L,OAA9C;AACD;AACF,IApBD;;AAsBA;;;;;;;;AAQA,OAAIyT,cAAc,SAAdA,WAAc,CAASxT,GAAT,EAAc+L,IAAd,EAAoBC,WAApB,EAAiCyH,mBAAjC,EACSxa,gBADT,EAC2Bya,cAD3B,EAC2C;AAC3D,SAAIzF,OAAO,IAAX;;AAEA,SAAI,CAAC2E,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAI;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,cAAOtS,GAAP,uCAAOA,GAAP;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,cAAqB+L,IAArB,uCAAqBA,IAArB,EAAJ,EAA+B;AAC7B,aAAM,IAAIzX,KAAJ,CAAUme,cAAV,CAAN;AACD;;AAED,SAAIkB,UAAU3H,eAAe,IAA7B;AACA,SAAI4H,aAAaF,kBAAkB5E,SAAlB,GAA8B4E,cAA9B,GAA+C,KAAhE;;AAEA,SAAI,CAAC1T,IAAI6T,MAAJ,IAAc9H,KAAK+H,WAApB,KAAoC/H,KAAK+H,WAA7C,EAA0D;AACxD,WAAIF,UAAJ,EAAgB;AACd5T,aAAI+T,MAAJ,CAAWhI,IAAX,EAAiB4H,OAAjB,EAA0BF,mBAA1B,EAA+Cxa,gBAA/C;AACD,QAFD,MAEO;AACL+G,aAAIgU,MAAJ,CAAWjI,IAAX,EAAiB4H,OAAjB,EAA0BF,mBAA1B,EAA+Cxa,gBAA/C;AACD;AACF,MAND,MAMO;AACLia,iBAAUlT,GAAV,EAAe+L,IAAf,EAAqB,UAASuH,QAAT,EAAmBW,OAAnB,EAA4B;AAC/C,aAAI,CAACA,QAAQH,WAAb,EAA0B;AACxB,eAAIxV,IAAI,IAAIhK,KAAJ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,aAAU,YAAY2f,QAAQzgB,IAA9B,EAAqC,sBAArC,EAAR;AACA,eAAIyF,gBAAJ,EAAsB;AACpBA,8BAAiBqF,CAAjB;AACD,YAFD,MAEO;AACL,mBAAMA,CAAN;AACD;AACD;AACD;AACD,aAAIsV,UAAJ,EAAgB;AACdN,oBAASS,MAAT,CAAgBE,OAAhB,EAAyBN,OAAzB,EAAkCF,mBAAlC,EAAuDxa,gBAAvD;AACD,UAFD,MAEO;AACLqa,oBAASU,MAAT,CAAgBC,OAAhB,EAAyBN,OAAzB,EAAkCF,mBAAlC,EAAuDxa,gBAAvD;AACD;AACF,QAfD,EAeGA,gBAfH;AAgBD;AACF,IAvCD;;AAyCA,YAAS4R,KAAT,CAAeqJ,EAAf,EAAmB;AACjBtB,WAAOsB,MAAM,IAAb;AACA,SAAItB,GAAJ,EAAS;AACPC,cAAOD,IAAIK,IAAX;AACAH,iBAAU,IAAV,CAFO,CAES;AACjB;AACF;;AAEDjI,SAAM8H,eAAN,GAAwBA,eAAxB;AACA9H,SAAMvf,OAAN,GAAgB,OAAhB;;AAEAuf,SAAMkE,SAAN,GAAkB;AAChB,SAAImF,EAAJ,GAAS;AACP,cAAOtB,GAAP;AACD,MAHe;AAIhB,SAAIuB,MAAJ,GAAa;AACX,cAAOrB,OAAP;AACD,MANe;AAOhB,SAAIsB,GAAJ,GAAU;AACR,cAAOvB,IAAP;AACD;AATe,IAAlB;;AAYA;;;;;;;;AAQAhI,SAAMkE,SAAN,CAAgBjD,mBAAhB,GAAsC,UAAS7f,IAAT,EAAe;AACnD,YAAO+mB,aAAa/mB,IAAb,CAAP;AACD,IAFD;;AAIA;;;;;;;;;;;;;AAaA4e,SAAMkE,SAAN,CAAgB7D,IAAhB,GAAuB,UAASD,WAAT,EAAsBwI,mBAAtB,EACSxa,gBADT,EAC2B;AAChD,SAAI,CAACgV,KAAKC,iBAAV,EAA6B;AAC3B,aAAM,IAAI+D,WAAJ,CAAgB;AACpBE,eAAMtD,UAAUuD,qBADI;AAEpB5e,eAAM;AAFc,QAAhB,CAAN;AAID;;AAED,SAAI6gB,UAAUpJ,cAAcA,WAAd,GAA4B,EAA1C,CARgD,CAQF;;AAE9C,SAAIiC,OAAOmH,QAAQnH,IAAR,IAAgByF,eAA3B;AACA,UAAKhmB,IAAL,GAAYshB,KAAKqG,SAAjB;AACA,SAAI,gBAAgBD,OAAhB,IAA2BA,QAAQpH,UAAvC,EAAmD;AACjD,YAAKtgB,IAAL,GAAYshB,KAAKsG,UAAjB;AACD;;AAED,SAAIrJ,OAAO,SAAPA,IAAO,CAASgJ,EAAT,EAAa;AACtB,YAAKhH,IAAL,GAAYA,IAAZ;AACA0F,aAAMsB,EAAN;AACArB,cAAOD,IAAIK,IAAX;AACAH,iBAAU,IAAV;;AAEAW,8BAAuBA,oBAAoBS,EAApB,CAAvB;AACD,MAPD;;AASA,SAAI,KAAKvnB,IAAL,IAAashB,KAAKsG,UAAlB,IAAgC,CAAC,CAAC5kB,UAAU6e,iBAAhD,EAAmE;AACjE7e,iBAAU6e,iBAAV,CAA4BgG,YAA5B,CAAyCtH,IAAzC,EAA+C,UAASuH,YAAT,EAAuB;AACpExG,cAAKC,iBAAL,CACI,KAAKvhB,IADT,EACe8nB,YADf,EAC6BvJ,KAAKnX,IAAL,CAAU,IAAV,CAD7B,EAC8CkF,gBAD9C;AAED,QAH8C,CAG7ClF,IAH6C,CAGxC,IAHwC,CAA/C,EAGckF,gBAHd;AAID,MALD,MAKO;AACLgV,YAAKC,iBAAL,CACI,KAAKvhB,IADT,EACeugB,IADf,EACqBhC,KAAKnX,IAAL,CAAU,IAAV,CADrB,EACsCkF,gBADtC;AAED;AACF,IAnCD;;AAqCA;;;;;;;;;;AAUA4R,SAAMkE,SAAN,CAAgB1D,EAAhB,GAAqB,UAASD,cAAT,EAAyB7B,eAAzB,EACStQ,gBADT,EAC2B;AAC9C,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAIle,WAAW,SAAXA,QAAW,CAASsgB,QAAT,EAAmB;AAChC;AACA;AACA;AACA,WAAIC,WAAW,EAAf;AACA,WAAItE,SAASqE,SAASE,YAAT,EAAb;;AAEA,WAAIC,cAAc,SAAdA,WAAc,GAAW;AAC3BxE,gBAAOwE,WAAP,CAAmB,UAASC,OAAT,EAAkB;AACnC,eAAI,CAACA,QAAQ7hB,MAAb,EAAqB;AACnB;AACA0hB,sBAASI,IAAT,CAAc,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC3B,sBAAOD,EAAExhB,IAAF,GAASyhB,EAAEzhB,IAAX,GAAkB,CAAC,CAAnB,GAAuByhB,EAAEzhB,IAAF,GAASwhB,EAAExhB,IAAX,GAAkB,CAAlB,GAAsB,CAApD;AACD,cAFD;AAGA+V,6BAAgBoL,QAAhB;AACD,YAND,MAMO;AACLA,wBAAWA,SAASO,MAAT,CAAgBlG,KAAKxe,OAAL,CAAaskB,OAAb,CAAhB,CAAX;AACAD;AACD;AACF,UAXD,EAWG5b,gBAXH;AAYD,QAbD;;AAeA4b;AACD,MAvBD;;AAyBA,SAAIzJ,eAAe0I,WAAnB,EAAgC;AAAE;AAChC1f,gBAASgX,cAAT;AACD,MAFD,MAEO,IAAI2H,SAAS3H,cAAT,CAAJ,EAA8B;AAAE;AACrC8H,iBAAU9H,cAAV,EAA0B,IAA1B,EAAgChX,QAAhC,EAA0C6E,gBAA1C;AACD,MAFM,MAEA;AAAE;AACP;AACA4Z,YAAKsC,YAAL,CAAkB/J,cAAlB,EAAkC,EAAlC,EAAsChX,QAAtC,EAAgD6E,gBAAhD;AACD;AACF,IAvCD;;AAyCA;;;;;;;;;;;;AAYA4R,SAAMkE,SAAN,CAAgBtD,KAAhB,GAAwB,UAASxf,IAAT,EAAeuf,aAAf,EAA8BiI,mBAA9B,EACSxa,gBADT,EAC2B;AACjD,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAI8C,YAAY5J,iBAAiB,IAAjB,GAAwBA,aAAxB,GAAwC,KAAxD;;AAEA,SAAI6J,cAAcppB,KAAK6kB,KAAL,CAAW,GAAX,CAAlB;;AAEA,SAAIwE,YAAY,SAAZA,SAAY,CAASC,OAAT,EAAkBC,OAAlB,EAA2B;AACzC;AACA,WAAIA,QAAQ,CAAR,KAAc,GAAd,IAAqBA,QAAQ,CAAR,KAAc,EAAvC,EAA2C;AACzCA,mBAAUA,QAAQtG,KAAR,CAAc,CAAd,CAAV;AACD;;AAEDqG,eAAQJ,YAAR,CAAqBK,QAAQ,CAAR,CAArB,EAAiC,EAAC9hB,QAAQ,IAAT,EAAe0hB,WAAWA,SAA1B,EAAjC,EACE,UAAUV,QAAV,EAAoB;AAClB,aAAIA,SAASZ,WAAb,EAA0B;AAAE;AAC1B;AACA;AACA,eAAI0B,QAAQviB,MAAR,IAAkBoiB,YAAYpiB,MAAZ,IAAsB,CAA5C,EAA+C;AAC7CqiB,uBAAUZ,QAAV,EAAoBc,QAAQtG,KAAR,CAAc,CAAd,CAApB;AACD,YAFD,MAEO;AACL;AACA,iBAAIuE,mBAAJ,EAAyBA,oBAAoBiB,QAApB;AAC1B;AACF,UATD,MASO;AACL,eAAIpW,IAAI,IAAIhK,KAAJ;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,aAAUrI,IAAV,EAAiB,qBAAjB,EAAR;AACA,eAAIgN,gBAAJ,EAAsB;AACpBA,8BAAiBqF,CAAjB;AACD,YAFD,MAEO;AACL,mBAAMA,CAAN;AACD;AACF;AACF,QAnBH,EAoBE,UAASA,CAAT,EAAY;AACV,aAAIA,EAAE6T,IAAF,IAAUtD,UAAU4G,wBAAxB,EAAkD;AAChDnX,aAAE5P,OAAF;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,aAAY,MAAMzC,IAAlB,EAAyB,kBAAzB;AACA,eAAIgN,gBAAJ,EAAsB;AACpBA,8BAAiBqF,CAAjB;AACD,YAFD,MAEO;AACL,mBAAMA,CAAN;AACD;AACF;AACF,QA7BH;AA+BD,MArCD;;AAuCAgX,eAAUzC,IAAV,EAAgBwC,WAAhB;AACD,IAlDD;;AAoDA;;;;;;;;AAQAxK,SAAMkE,SAAN,CAAgBpD,IAAhB,GAAuB,UAASD,WAAT,EAAsBnC,eAAtB,EAAuCtQ,gBAAvC,EAAyD;AAC9E,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAI5G,YAAYmI,MAAhB,EAAwB;AACtBnI,mBAAYE,IAAZ,CAAiBrC,eAAjB,EAAkCtQ,gBAAlC;AACD,MAFD,MAEO;AACLia,iBAAUF,aAAatH,WAAb,CAAV,EAAqC,IAArC,EAA2C,UAASgK,SAAT,EAAoB;AAC7DA,mBAAU9J,IAAV,CAAerC,eAAf,EAAgCtQ,gBAAhC;AACD,QAFD,EAEGA,gBAFH;AAGD;AACF,IAZD;;AAcA;;;;;;;;;;;AAWA4R,SAAMkE,SAAN,CAAgBrb,MAAhB,GAAyB,UAASzH,IAAT,EAAeuf,aAAf,EAA8BjC,eAA9B,EACStQ,gBADT,EAC2B;AAClD,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAI8C,YAAY5J,iBAAiB,IAAjB,GAAwBA,aAAxB,GAAwC,IAAxD;;AAEAqH,UAAK8C,OAAL,CAAa1pB,IAAb,EAAmB,EAACyH,QAAQ,IAAT,EAAgB0hB,WAAWA,SAA3B,EAAnB,EAA0D7L,eAA1D,EACE,UAASjL,CAAT,EAAY;AACV,WAAIA,EAAE6T,IAAF,IAAUtD,UAAU4G,wBAAxB,EAAkD;AAChDnX,WAAE5P,OAAF;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,WAAY,MAAMzC,IAAlB,EAAyB,kBAAzB;AACD;AACD,WAAIgN,gBAAJ,EAAsB;AACpBA,0BAAiBqF,CAAjB;AACD,QAFD,MAEO;AACL,eAAMA,CAAN;AACD;AACF,MAVH;AAYD,IApBD;;AAsBA;;;;;;;;;;;;;AAaAuM,SAAMkE,SAAN,CAAgB9C,EAAhB,GAAqB,UAASjM,GAAT,EAAc+L,IAAd,EAAoBC,WAApB,EAAiCyH,mBAAjC,EACSxa,gBADT,EAC2B;AAC9Cua,iBAAYzf,IAAZ,CAAiB,IAAjB,EAAuBiM,GAAvB,EAA4B+L,IAA5B,EAAkCC,WAAlC,EAA+CyH,mBAA/C,EACiBxa,gBADjB,EACmC,IADnC;AAED,IAJD;;AAMA;;;;;;;;;;;AAWA4R,SAAMkE,SAAN,CAAgB7C,EAAhB,GAAqB,UAASR,WAAT,EAAsBnC,eAAtB,EACStQ,gBADT,EAC2B;AAC9C,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAIsD,WAAW,SAAXA,QAAW,CAASvd,KAAT,EAAgB;AAC7B,WAAIA,MAAMwb,MAAV,EAAkB;AAChBxb,eAAMwd,MAAN,CAAatM,eAAb,EAA8BtQ,gBAA9B;AACD,QAFD,MAEO,IAAIZ,MAAMyb,WAAV,EAAuB;AAC5Bzb,eAAMyd,iBAAN,CAAwBvM,eAAxB,EAAyCtQ,gBAAzC;AACD;AACF,MAND;;AAQA,SAAIyS,YAAYmI,MAAZ,IAAsBnI,YAAYoI,WAAtC,EAAmD;AACjD8B,gBAASlK,WAAT;AACD,MAFD,MAEO;AACLwH,iBAAUxH,WAAV,EAAuB,IAAvB,EAA6BkK,QAA7B,EAAuC3c,gBAAvC;AACD;AACF,IAnBD;;AAqBA;;;;;;;;;;AAUA4R,SAAMkE,SAAN,CAAgB5C,EAAhB,GAAqB,UAASf,cAAT,EAAyBqI,mBAAzB,EACSxa,gBADT,EAC2B;AAC9C,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAIlH,eAAe0I,WAAnB,EAAgC;AAC9BjB,cAAOzH,cAAP;AACAqI,8BAAuBA,oBAAoBZ,IAApB,CAAvB;AACD,MAHD,MAGO;AACL;AACAzH,wBAAiB4H,aAAa5H,cAAb,CAAjB;AACA8H,iBAAU9H,cAAV,EAA0B,IAA1B,EAAgC,UAASsJ,QAAT,EAAmB;AACjD,aAAIA,SAASZ,WAAb,EAA0B;AACxBjB,kBAAO6B,QAAP;AACAjB,kCAAuBA,oBAAoBZ,IAApB,CAAvB;AACD,UAHD,MAGO;AACL,eAAIvU,IAAI,IAAIhK,KAAJ,CAAUke,eAAV,CAAR;AACA,eAAIvZ,gBAAJ,EAAsB;AACpBA,8BAAiBqF,CAAjB;AACD,YAFD,MAEO;AACL,mBAAMA,CAAN;AACD;AACF;AACF,QAZD,EAYGrF,gBAZH;AAaD;AACF,IA1BD;;AA4BA;;;;;;;;;;;;;AAaA4R,SAAMkE,SAAN,CAAgB3C,EAAhB,GAAqB,UAASpM,GAAT,EAAc+L,IAAd,EAAoBC,WAApB,EAAiCyH,mBAAjC,EACSxa,gBADT,EAC2B;AAC9Cua,iBAAYzf,IAAZ,CAAiB,IAAjB,EAAuBiM,GAAvB,EAA4B+L,IAA5B,EAAkCC,WAAlC,EAA+CyH,mBAA/C,EACiBxa,gBADjB;AAED,IAJD;;AAMA;;;;;;;;;;;;;;AAcA4R,SAAMkE,SAAN,CAAgBvC,KAAhB,GAAwB,UAASd,WAAT,EAAsBqK,OAAtB,EAA+BtC,mBAA/B,EACSxa,gBADT,EAC2B;AACjD,SAAI,CAAC2Z,GAAL,EAAU;AACR,aAAM,IAAIte,KAAJ,CAAUge,iBAAV,CAAN;AACD;;AAED,SAAI0D,aAAa,SAAbA,UAAa,CAASN,SAAT,EAAoB;AACnCA,iBAAUO,YAAV,CAAuB,UAASC,UAAT,EAAqB;;AAE1CA,oBAAWpW,OAAX,GAAqB7G,gBAArB;;AAEA,aAAI8c,QAAQI,MAAZ,EAAoB;AAClBD,sBAAWE,UAAX,GAAwB,UAAS9X,CAAT,EAAY;AAClC,iBAAImV,mBAAJ,EAAyBA,oBAAoBiC,SAApB,EAA+B,IAA/B;AAC1B,YAFD;;AAIAQ,sBAAWG,IAAX,CAAgBH,WAAWjjB,MAA3B,EALkB,CAKkB;AACrC,UAND,MAMO;AACL,eAAIqjB,YAAY,KAAhB;AACAJ,sBAAWE,UAAX,GAAwB,UAAS9X,CAAT,EAAY;AAClC;AACA,iBAAI,CAACgY,SAAL,EAAgB;AACdA,2BAAY,IAAZ;AACA,oBAAKC,QAAL,CAAc,KAAKC,QAAnB;AACA;AACD;AACD,iBAAI/C,mBAAJ,EAAyBA,oBAAoBiC,SAApB,EAA+B,IAA/B;AAC1B,YARD;AASD;;AAED,aAAIK,mBAAmB9F,IAAvB,EAA6B;AAC3BiG,sBAAW1J,KAAX,CAAiBuJ,OAAjB;AACD,UAFD,MAEO;AACL;AACA,eAAIA,QAAQpjB,IAAR,CAAa8jB,SAAb,IAA0BC,YAAY3H,SAA1C,EAAqD;AACnDgH,qBAAQpjB,IAAR,GAAe,IAAIkd,UAAJ,CAAekG,QAAQpjB,IAAvB,CAAf;AACD;AACD,eAAIqd,OAAO,IAAIC,IAAJ,CAAS,CAAC8F,QAAQpjB,IAAT,CAAT,EACSojB,QAAQppB,IAAR,GAAe,EAACA,MAAMopB,QAAQppB,IAAf,EAAf,GAAsC,EAD/C,CAAX;;AAGAupB,sBAAW1J,KAAX,CAAiBwD,IAAjB;AACD;AAEF,QApCD,EAoCG/W,gBApCH;AAqCD,MAtCD;;AAwCA,SAAIyS,YAAYmI,MAAhB,EAAwB;AACtBmC,kBAAWtK,WAAX;AACD,MAFD,MAEO,IAAIqH,SAASrH,WAAT,CAAJ,EAA2B;AAChCwH,iBAAUxH,WAAV,EAAuB,IAAvB,EAA6BsK,UAA7B,EAAyC/c,gBAAzC;AACD,MAFM,MAEA;AACL4Z,YAAK8C,OAAL,CAAajK,WAAb,EAA0B,EAAChY,QAAQ,IAAT,EAAe0hB,WAAW,KAA1B,EAA1B,EAA4DY,UAA5D,EACa/c,gBADb;AAED;AACF,IAtDD;;AAwDA;;;;;;;AAOA4R,SAAMkE,SAAN,CAAgBtC,EAAhB,GAAqB,UAASlD,eAAT,EAA0BtQ,gBAA1B,EAA4C;AAC/D,SAAI0d,gBAAgB,SAAhBA,aAAgB,CAASjK,QAAT,EAAmBE,OAAnB,EAA4B;AAC9CrD,uBAAgBmD,QAAhB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,SAA0BE,OAA1B,EAAoCF,QAApC,GAA8CE,OAA9C;AACD,MAFD;;AAIA,SAAI,EAAEjd,UAAU2e,gBAAV,CAA2BsI,kBAA3B,IAAiDjnB,UAAU6e,iBAAV,CAA4BoI,kBAA/E,CAAJ,EAAwG;AACtG,aAAM,IAAItiB,KAAJ,CAAUie,mBAAV,CAAN;AACD;;AAED,SAAItE,KAAKqG,SAAL,IAAkB,KAAK3nB,IAA3B,EAAiC;AAC/BgD,iBAAU2e,gBAAV,CAA2BsI,kBAA3B,CAA8CD,aAA9C,EAA6D1d,gBAA7D;AACD,MAFD,MAEO,IAAIgV,KAAKsG,UAAL,IAAmB,KAAK5nB,IAA5B,EAAkC;AACvCgD,iBAAU6e,iBAAV,CAA4BoI,kBAA5B,CAA+CD,aAA/C,EAA8D1d,gBAA9D;AACD;AACF,IAdD;;AAgBA4R,SAAMkE,SAAN,CAAgBjC,QAAhB,GAA2B,UAAUD,QAAV,EAAoBzY,QAApB,EAA8Bif,OAA9B,EAAuC;AAC9DH,eAAUrG,QAAV,EAAoB,IAApB,EAA0BzY,QAA1B,EAAoCif,OAApC;AACH,IAFD;;AAIA,UAAOxI,KAAP;AACD,EApkBW,EAAZ;;AAskBA7f,QAAOC,OAAP,GAAiB4f,KAAjB;;AAEA;AACA7f,QAAOC,OAAP,CAAeshB,aAAf,GAA+ByC,KAAKzC,aAAL,CAAmBxY,IAAnB,CAAwB,EAAxB,CAA/B;AACA/I,QAAOC,OAAP,CAAe4gB,eAAf,GAAiCmD,KAAKnD,eAAL,CAAqB9X,IAArB,CAA0B,EAA1B,CAAjC,C;;;;;;;ACt0BA;;;;;;AAEA,KAAM8iB,gBAAgB,mBAAAlsB,CAAQ,GAAR,CAAtB;AACA,KAAMmsB,eAAe,mBAAAnsB,CAAQ,GAAR,CAArB;AACA,KAAMosB,mBAAmB,mBAAApsB,CAAQ,GAAR,CAAzB;AACA,KAAMqsB,aAAa,mBAAArsB,CAAQ,GAAR,CAAnB;;AAEA,KAAMssB,WAAW,CAACJ,aAAD,EAAgBC,YAAhB,EAA8BC,gBAA9B,EAAgDC,UAAhD,CAAjB;;KAEME,S;AACF,0BAAc;AAAA;AAAE;;;;gCAET;AACH,kBAAKC,iBAAL,GAAyB,KAAKC,qBAAL,GAA6BrjB,IAA7B,CAAkC,IAAlC,CAAzB;AACA5I,oBAAOC,OAAP,CAAeisB,SAAf,CAAyBpf,WAAzB,CAAqC,KAAKkf,iBAA1C;AACH;;;iDAEuB;AACpB,oBAAO,UAACjf,IAAD,EAAU;AACb;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAAIA,KAAK1E,IAAT,EAAkB,WAAlB,GAA+B;AAC3B0E,0BAAKM,SAAL,CAAeP,WAAf,CAA2B,UAACwS,GAAD,EAAS;AAChC,6BAAIA,IAAI9X,IAAR,EAAc;AACV8X,iCAAI9X,IAAJ,CAAS6X,YAAT,GAAwB,UAAC9b,OAAD,EAAa;AACjC;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,mCAAI,OAAOA,OAAX,EAAuB,QAAvB,GAAiC;AAC7BA,6CAAQnC,EAAR,GAAake,IAAIle,EAAjB;AACH;AACD2L,sCAAKmB,WAAL,CAAiB3K,OAAjB;AACH,8BALD;AADU;AAAA;AAAA;;AAAA;AAOV,sDAAsBuoB,QAAtB,8HAAgC;AAAA,yCAArB9J,OAAqB;;AAC5B,yCAAIA,QAAQmK,MAAR,CAAe7M,GAAf,EAAoBvS,KAAKqf,MAAzB,CAAJ,EAAsC;AAClC;AACH;AACJ;AAXS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYb;AACJ,sBAdD;AAeH;AACJ,cAlBD;AAmBH;;;;;;AACJ;;AAEDvsB,QAAOC,OAAP,GAAiB,IAAIisB,SAAJ,EAAjB,C;;;;;;;ACxCA;;;;;;KAEOM,S,GAAa,mBAAA7sB,CAAQ,GAAR,EAAqB8sB,E,CAAlCD,S;;gBAC8B,mBAAA7sB,CAAQ,GAAR,C;KAA9Bwf,iB,YAAAA,iB;KAAmBJ,O,YAAAA,O;;AAC1B,KAAMnW,SAAS,mBAAAjJ,CAAQ,EAAR,CAAf;;KAEM+sB,gB;AACF,iCAAc;AAAA;AAAE;;AAEhB;;;;;;;;;qCAKsB;AAAA,iBAAflN,YAAe,QAAfA,YAAe;;AAClB,kBAAKmN,QAAL,GAAgB,IAAIH,UAAUI,iBAAd,EAAhB;;AAEA,kBAAKD,QAAL,CAAcE,KAAd,CAAoB;AAChBC,yBAAQ/N,OADQ;AAEhBgO,+BAAc;AAAA,4BAAMvN,aAAa,EAAb,CAAN;AAAA,kBAFE;AAGhBwN,gCAAe,8BAAS;AACpBxN,kCAAa;AACT7d,+BAAMiH,OAAOkB,SAAP,CAAiBiB,eADd;AAETpD,+BAAM,EAACslB,QAAQxpB,MAAMC,OAAf;AAFG,sBAAb;AAIH,kBARe;AAShBwpB,+BAAc,sBAACtlB,IAAD,EAAOulB,IAAP,EAAgB;AAC1B3N,kCAAa;AACT7d,+BAAMiH,OAAOkB,SAAP,CAAiBgB,cADd;AAETnD,+BAAM,EAACC,UAAD,EAAOulB,UAAP;AAFG,sBAAb;AAIH,kBAde;AAehBC,mCAAkBjO,iBAfF;AAgBhBkO,mCAAkB;AAhBF,cAApB;AAkBH;;AAED;;;;;;;;sCAKsB;AAAA,iBAAf7N,YAAe,SAAfA,YAAe;;AAClB,iBAAI;AACA;AACA,qBAAI,KAAKmN,QAAT,EAAmB;AACf,0BAAKA,QAAL,CAAcW,IAAd;AACH;AACJ,cALD,CAKE,OAAOha,CAAP,EAAU;AACR;AACH,cAPD,SAOU;AACNkM,8BAAa,EAAb;AACH;AACJ;;;gCAGMC,G,EAAKC,O,EAAS;AACjB,qBAAQD,IAAI9d,IAAZ;AACI,sBAAKiH,OAAOY,OAAP,CAAewB,cAApB;AACI,0BAAKyX,KAAL,CAAWhD,IAAI9X,IAAf;AACA;AACJ,sBAAKiB,OAAOY,OAAP,CAAeyB,cAApB;AACI,0BAAKsiB,KAAL,CAAW9N,IAAI9X,IAAf;AACA;AACJ;AACI;AACA;AATR;;AAYA;AACA,oBAAO,IAAP;AACH;;;;;;AACJ;;AAED3H,QAAOC,OAAP,GAAiB,IAAIysB,gBAAJ,EAAjB,C;;;;;;;AC1EA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,oDAAoD,OAAO,6BAA6B;AACvG;AACA,iBAAgB,qDAAqD,OAAO,8BAA8B;AAC1G;AACA,iBAAgB,qDAAqD,OAAO,8BAA8B;AAC1G;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA,cAAa;AACb;AACA,cAAa;AACb;AACA;AACA,UAAS;;AAET;;AAEA;AACA;AACA;AACA,oBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,cAAa;AACb;AACA;;AAEA;AACA;AACA,uCAAsC;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA,cAAa;;AAEb;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,sBAAqB,aAAa;AAClC;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,sBAAqB,aAAa;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,sBAAqB,QAAQ;AAC7B;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,oBAAmB,wBAAwB;AAC3C,oBAAmB,oBAAoB;AACvC;AACA,wGAAuG;AACvG,wFAAuF;AACvF;AACA;AACA;AACA;AACA;AACA;AACA,yEAAwE,2BAA2B;AACnG;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA,4BAA2B,eAAe;AAC1C;AACA;;AAEA,qCAAoC,uBAAuB;AAC3D,UAAS;AACT;AACA;AACA,oBAAmB,qBAAqB;AACxC;AACA,oBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,UAAS;AACT;AACA,sBAAqB,QAAQ;AAC7B;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,oBAAmB,uBAAuB;AAC1C;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,sCAAqC,iBAAiB;AACtD,UAAS;AACT;AACA;AACA,oBAAmB,yBAAyB;AAC5C;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,sCAAqC,sBAAsB;AAC3D,UAAS;AACT;AACA;AACA,oBAAmB,qBAAqB;AACxC,oBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;;AAEA,sCAAqC;;AAErC;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,UAAS;;AAET;AACA;;AAEA;AACA;AACA,gBAAe,6BAA6B;AAC5C,gBAAe,0BAA0B;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,kBAAiB,YAAY;AAC7B;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA,kBAAiB;AACjB,UAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAe,uHAAuH;AACtI;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAe,eAAe;AAC9B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAe,YAAY;AAC3B;AACA;;AAEA,EAAC;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EA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,sBAAsB;AACrC;AACA,gBAAe,sBAAsB;AACrC,gBAAe,uBAAuB;AACtC,gBAAe,OAAO;AACtB;AACA,gBAAe,OAAO;AACtB;AACA,gBAAe,oBAAoB;AACnC,gBAAe,OAAO;AACtB;AACA;AACA,gBAAe,QAAQ;AACvB,gBAAe,QAAQ;AACvB,gBAAe,OAAO;AACtB;AACA;AACA,gBAAe,OAAO;AACtB;AACA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,uCAAsC;AACtC,yCAAwC;AACxC,wCAAuC;AACvC;AACA;AACA,cAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT;AACA;AACA,oBAAmB,OAAO;AAC1B;AACA;AACA;AACA,2CAA0C,4BAA4B;AACtE,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;;AAEA;AACA,qBAAoB;AACpB;AACA;AACA,cAAa;;AAEb;AACA;;AAEA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA;AACA,qBAAoB;AACpB;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;AACA;AACA,oBAAmB,YAAY;AAC/B;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,4BAA2B,0BAA0B;AACrD,6DAA4D,0BAA0B;AACtF;AACA;;AAEA;AACA,6CAA4C,0BAA0B;AACtE,UAAS;AACT;AACA;AACA;AACA;AACA,6BAA4B,kBAAkB;AAC9C,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,UAAS;AACT;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;;AAEA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,QAAQ;AACvB,gBAAe,OAAO;AACtB;AACA;AACA,EAAC;AACD;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB,OAAO;AAC5B,uBAAsB,+BAA+B;AACrD,uBAAsB,gCAAgC;AACtD,uBAAsB,+BAA+B;AACrD,uBAAsB,+BAA+B;AACrD,uBAAsB,+BAA+B;AACrD,uBAAsB,QAAQ;AAC9B,uBAAsB,QAAQ;AAC9B,uBAAsB,OAAO;AAC7B,uBAAsB,OAAO;AAC7B,uBAAsB,oBAAoB;AAC1C,uBAAsB,OAAO;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAmB,OAAO;AAC1B,oBAAmB,sBAAsB;AACzC,oBAAmB,uBAAuB;AAC1C,oBAAmB,sBAAsB;AACzC;AACA,oBAAmB,sBAAsB;AACzC,oBAAmB,sBAAsB;AACzC,oBAAmB,OAAO;AAC1B,qCAAoC,eAAe;AACnD,oBAAmB,QAAQ;AAC3B,oBAAmB,QAAQ;AAC3B,oBAAmB,OAAO;AAC1B;AACA,2DAA0D;AAC1D,iDAAgD;AAChD,oCAAmC;AACnC,mCAAkC;AAClC,sCAAqC;AACrC,qCAAoC;AACpC;AACA;AACA;AACA,wDAAuD,eAAe;AACtE;AACA,oBAAmB,OAAO;AAC1B,oBAAmB,OAAO;AAC1B;AACA,wDAAuD,eAAe;AACtE;AACA,oBAAmB,oBAAoB;AACvC,oBAAmB,QAAQ;AAC3B,oBAAmB,OAAO;AAC1B;AACA,oBAAmB,OAAO;AAC1B;AACA;AACA;AACA;AACA,uBAAsB;AACtB;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,gEAA+D;AAC/D;AACA,2DAA0D;AAC1D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC;AACjC;AACA,8BAA6B;;AAE7B;AACA,0BAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA,0BAAyB;AACzB;AACA;AACA,iEAAgE,sBAAsB,EAAE;AACxF;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB,sBAAqB;AACrB;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,sBAAqB,QAAQ;AAC7B;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,wCAAwC;AACvD;AACA,gBAAe,yCAAyC;AACxD;AACA,gBAAe,mDAAmD;AAClE,gBAAe,OAAO;AACtB,iCAAgC,eAAe;AAC/C,gBAAe,OAAO;AACtB;AACA,+CAA8C;AAC9C,6CAA4C;AAC5C,gCAA+B;AAC/B,+BAA8B;AAC9B,kCAAiC;AACjC,iCAAgC;AAChC;AACA;AACA;AACA,oDAAmD,eAAe;AAClE;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA,oDAAmD,eAAe;AAClE;AACA,gBAAe,QAAQ;AACvB,gBAAe,OAAO;AACtB;AACA;;AAEA;AACA;;AAEA;AACA;AACA,mBAAkB;AAClB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,gBAAe,OAAO;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,QAAQ;AACvB,gBAAe,OAAO;AACtB;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB,gBAAe,oBAAoB;AACnC;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;AACD;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,gBAAe,yGAAyG;AACxH;AACA,gBAAe,SAAS;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,WAAW;AAC1B,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA,uDAAsD;AACtD,0CAAyC;AACzC;AACA;AACA,gBAAe,MAAM;AACrB,gBAAe,OAAO;AACtB;AACA,gEAA+D;AAC/D;AACA;AACA,gBAAe,MAAM;AACrB;AACA,gBAAe,MAAM;AACrB;AACA,gBAAe,QAAQ;AACvB,gBAAe,OAAO;AACtB,gBAAe,MAAM;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA4C;AAC5C;AACA;AACA,kBAAiB;AACjB,cAAa;AACb;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT;AACA;AACA,oBAAmB,OAAO;AAC1B;AACA;AACA;AACA,2CAA0C,4BAA4B;AACtE,UAAS;AACT;AACA;AACA;AACA,oBAAmB,OAAO;AAC1B,oBAAmB,SAAS;AAC5B,oBAAmB,WAAW;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA;AACA;AACA,UAAS;AACT;AACA;AACA,oBAAmB,WAAW;AAC9B,oBAAmB,WAAW;AAC9B;AACA;AACA;AACA;AACA,sBAAqB,WAAW;AAChC;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,cAAa;;AAEb;AACA;;AAEA;;AAEA;AACA;AACA,8CAA6C;AAC7C;AACA;AACA,sBAAqB;AACrB,oCAAmC;AACnC;AACA,kBAAiB;AACjB,gCAA+B;AAC/B;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA,kBAAiB;AACjB;AACA,kBAAiB;AACjB;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA,cAAa;;AAEb;AACA;AACA,cAAa;;AAEb;AACA;AACA,2CAA0C,oBAAoB;AAC9D;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,oBAAmB,OAAO;AAC1B,sBAAqB,QAAQ;AAC7B;AACA;AACA;;AAEA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC;AACjC;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAa;AACb,UAAS;AACT;;AAEA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa,4CAA4C;AACzD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAuD,0BAA0B;AACjF;AACA,2CAA0C;AAC1C;AACA;AACA,mCAAkC;AAClC;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;AACA;AACA,4CAA2C,6BAA6B;AACxE,kBAAiB;AACjB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAiC;AACjC;AACA,8BAA6B;AAC7B;AACA;AACA,0BAAyB;AACzB,iDAAgD;AAChD;AACA,8DAA6D;AAC7D;AACA;AACA;AACA,0BAAyB;AACzB,sBAAqB;AACrB;AACA,UAAS;AACT;AACA;AACA;;AAEA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,UAAS;AACT;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAkC;AAClC;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,cAAa;AACb,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA6B;AAC7B;AACA;AACA;AACA;AACA,0BAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,cAAa;AACb,UAAS;;AAET;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,UAAS;AACT;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAqB;AACrB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA,gCAA+B,aAAa;AAC5C;AACA;AACA,oCAAmC,gBAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAC;AACD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB,gBAAe,OAAO;AACtB;AACA,gBAAe,OAAO;AACtB,iCAAgC,eAAe;AAC/C,gBAAe,QAAQ;AACvB,gBAAe,OAAO;AACtB;AACA,+CAA8C;AAC9C,6CAA4C;AAC5C,gCAA+B;AAC/B,+BAA8B;AAC9B,kCAAiC;AACjC,iCAAgC;AAChC;AACA;AACA;AACA,oDAAmD,eAAe;AAClE;AACA,gBAAe,OAAO;AACtB;AACA,oDAAmD,eAAe;AAClE;AACA,gBAAe,oBAAoB;AACnC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA,0EAAyE;AACzE;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,+EAA8E;AAC9E;;AAEA;AACA,+EAA8E;AAC9E;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAa;AACb;AACA;AACA;AACA;AACA,0BAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA,iBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA,EAAC;;AAED;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,uDAAsD;AACtD,6CAA4C;AAC5C,gCAA+B;AAC/B,+BAA8B;AAC9B,kCAAiC;AACjC,iCAAgC;AAChC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,MAAK;AACL;AACA;AACA,EAAC;;AAED;;;;;;;;ACzuEA;;;;;;AAEA,KAAMzmB,MAAM,mBAAAtG,CAAQ,EAAR,CAAZ;AACA,KAAMiJ,SAAS,mBAAAjJ,CAAQ,EAAR,CAAf;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","file":"bundle.offscreen.js","sourcesContent":["/**\n * Входная точка\n */\n'use strict';\n\nrequire('./modules/startup/offscreen').run();\n\n\n\n// WEBPACK FOOTER //\n// ./offscreen.js","/**\n * Platform.buildInfo\n */\n\n'use strict';\n\n/**\n * window.vbBuildInfo is created in platform build\n */\nvar buildInfo = window.vbBuildInfo;\n\nmodule.exports = {\n    getVersion: function () {\n        return chrome.runtime.getManifest().version;\n    },\n    getRevision: function () {\n        return getValue('buildNumber', 0);\n    },\n    getTimestamp: function () {\n        return getValue('date', 0);\n    },\n    isDebug: function () {\n        return Boolean(getValue('debug', false));\n    },\n    getRegionBrandId: function () {\n        return getValue('regionBrandId');\n    },\n    getCustomBrandId: function () {\n        return getValue('customBrandId');\n    },\n    getClids: function () {\n        return getValue('clids');\n    },\n    getErrorboosterProject: function () {\n        return getValue('errorboosterProject');\n    },\n    ensureBrandedBuildInfo: function () {\n        // Firefox only.\n    }\n};\n\nfunction getValue(path, defaultValue) {\n    if (typeof buildInfo === 'object' && buildInfo[path]) {\n        return buildInfo[path];\n    }\n    return defaultValue;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./platform/build-info.js","/**\n * Различные константы про платформу.\n * Лучше не добавлять зависимостей в этот файл, т.к. он используется логгером\n * и получаются циклические зависимости.\n */\n\n'use strict';\n\nconst visbookmarksFakeTabUrl = '';\nconst visbookmarksUrl = 'chrome://newtab/';\nconst visbookmarksRealUrl = chrome.runtime.getURL('/layout/newtab.html');\n\nmodule.exports = {\n    /**\n     * для опознания платформы\n     */\n    id: 'chr',\n\n    /**\n     * также для опознания платформы, но удобнее\n     */\n    isChr: true,\n\n    /**\n     * Id расширения\n     */\n    extensionId: chrome.runtime.id,\n\n    /**\n     * Client ID платформы\n     */\n    cid: 72482,\n\n    /**\n     * vbID в локализации, используется во ссылках\n     */\n    type: 'vb-chrome',\n\n    /**\n     * параметр, записываемый в ys куку вместе с версией и отправляемый в soft-export статистику\n     */\n    yasoft: 'vbch',\n\n    /**\n     * Имя браузера, используется в dayuse-exp статистике\n     */\n    browserName: 'chrome',\n\n    /**\n     * Ссылка на таб с ВЗ\n     */\n    visbookmarksUrl,\n\n    /**\n     * Ссылка на фейковый таб с ВЗ (about:tabs в ИЕ, yafd:tabs в Firefox)\n     */\n    visbookmarksFakeTabUrl,\n\n    /**\n     * Полная ссылка на html страницу с ВЗ\n     */\n    visbookmarksRealUrl,\n\n    /**\n     * Паттерны урлов которые исключаем из списка закрытых табов\n     */\n    vbUrls: [\n        visbookmarksUrl,\n        visbookmarksFakeTabUrl,\n        visbookmarksRealUrl,\n    ],\n};\n\n\n\n// WEBPACK FOOTER //\n// ./platform/about.js","const about = require('../platform/about');\nconst buildInfo = require('../platform/build-info');\n\nconst ErrorType = {\n    UNCAUGHT: '690.2361',\n    CLIENT: '690.2362',\n};\n\nconst ErrorLevel = {\n    CRITICAL: 'critical',\n    DEBUG: 'debug',\n    ERROR: 'error',\n    INFO: 'info',\n    TRACE: 'trace',\n    WARN: 'warn',\n};\n\nconst Environment = {\n    DEBUG: 'development',\n    PROD: 'production',\n};\n\nconst SEND_USAGE_STAT_SETTING = 'settings.sendUsageStat';\n\nclass ErrorBooster {\n    constructor() {}\n\n    send(url) {\n        const isUncaught = url.includes(ErrorType.UNCAUGHT);\n        return chrome.storage.local.get([SEND_USAGE_STAT_SETTING],\n            (params) => {\n                if (params[SEND_USAGE_STAT_SETTING] || isUncaught) {\n                    return fetch(url).catch(() => this._fallbackError())\n                        .catch(console.error);\n                }\n            });\n    }\n\n    uncaught(message, additional = {}) {\n        const vars = this._getVars(message, ErrorLevel.CRITICAL, additional);\n        return this.send(this._getUrl(ErrorType.UNCAUGHT, vars));\n    }\n\n    error(message, additional = {}) {\n        const vars = this._getVars(message, ErrorLevel.ERROR, additional);\n        return this.send(this._getUrl(ErrorType.CLIENT, vars));\n    }\n\n    info(message, additional = {}) {\n        const vars = this._getVars(message, ErrorLevel.INFO, additional);\n        return this.send(this._getUrl(ErrorType.CLIENT, vars));\n    }\n\n    warn(message, additional = {}) {\n        const vars = this._getVars(message, ErrorLevel.WARN, additional);\n        return this.send(this._getUrl(ErrorType.CLIENT, vars));\n    }\n\n    _fallbackError() {\n        return fetch(this._getUrl(\n            ErrorType.CLIENT,\n            `-project=${buildInfo.getErrorboosterProject()},-msg=ebfallback`));\n    }\n\n    _getUrl(path, vars) {\n        return new URL(\n            `/clck/click/path=${path}/vars=${vars}/*`,\n            'https://yandex.ru').toString();\n    }\n\n    _getVars(message, level, additional){\n        const vars = {\n            msg: message,\n            level,\n            project: buildInfo.getErrorboosterProject(),\n            service: about.yasoft,\n            timestamp: Date.now(),\n            version: buildInfo.getVersion(),\n            env: buildInfo.isDebug() ? Environment.DEBUG : Environment.PROD,\n            useragent: navigator && navigator.userAgent,\n            additional: JSON.stringify(additional),\n        };\n\n        return Object.keys(vars)\n            .filter(key => vars[key])\n            .map(key => `-${key}=${encodeURIComponent(\n                ErrorBooster.toWellFormed(vars[key]))}`)\n            .join(',');\n    }\n\n    static toWellFormed(val) {\n        return val.toWellFormed ? val.toWellFormed() : val;\n    }\n}\n\nmodule.exports = new ErrorBooster();\n\n\n\n// WEBPACK FOOTER //\n// ./utils/error-booster.js","/**\n * Checks if `value` is the [language type](https://es5.github.io/#x8) of `Object`.\n * (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(1);\n * // => false\n */\nfunction isObject(value) {\n  // Avoid a V8 JIT bug in Chrome 19-20.\n  // See https://code.google.com/p/v8/issues/detail?id=2291 for more details.\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/lang/isObject.js\n// module id = 44\n// module chunks = 1 2","var isArguments = require('../lang/isArguments'),\n    isArray = require('../lang/isArray'),\n    isIndex = require('../internal/isIndex'),\n    isLength = require('../internal/isLength'),\n    isObject = require('../lang/isObject');\n\n/** Used for native method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an array of the own and inherited enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects.\n *\n * @static\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keysIn(new Foo);\n * // => ['a', 'b', 'c'] (iteration order is not guaranteed)\n */\nfunction keysIn(object) {\n  if (object == null) {\n    return [];\n  }\n  if (!isObject(object)) {\n    object = Object(object);\n  }\n  var length = object.length;\n  length = (length && isLength(length) &&\n    (isArray(object) || isArguments(object)) && length) || 0;\n\n  var Ctor = object.constructor,\n      index = -1,\n      isProto = typeof Ctor == 'function' && Ctor.prototype === object,\n      result = Array(length),\n      skipIndexes = length > 0;\n\n  while (++index < length) {\n    result[index] = (index + '');\n  }\n  for (var key in object) {\n    if (!(skipIndexes && isIndex(key, length)) &&\n        !(key == 'constructor' && (isProto || !hasOwnProperty.call(object, key)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = keysIn;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/object/keysIn.js\n// module id = 45\n// module chunks = 1 2","var isArrayLike = require('../internal/isArrayLike'),\n    isObjectLike = require('../internal/isObjectLike');\n\n/** Used for native method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Native method references. */\nvar propertyIsEnumerable = objectProto.propertyIsEnumerable;\n\n/**\n * Checks if `value` is classified as an `arguments` object.\n *\n * @static\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  return isObjectLike(value) && isArrayLike(value) &&\n    hasOwnProperty.call(value, 'callee') && !propertyIsEnumerable.call(value, 'callee');\n}\n\nmodule.exports = isArguments;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/lang/isArguments.js\n// module id = 46\n// module chunks = 1 2","var getLength = require('./getLength'),\n    isLength = require('./isLength');\n\n/**\n * Checks if `value` is array-like.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(getLength(value));\n}\n\nmodule.exports = isArrayLike;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/isArrayLike.js\n// module id = 47\n// module chunks = 1 2","var baseProperty = require('./baseProperty');\n\n/**\n * Gets the \"length\" property value of `object`.\n *\n * **Note:** This function is used to avoid a [JIT bug](https://bugs.webkit.org/show_bug.cgi?id=142792)\n * that affects Safari on at least iOS 8.1-8.3 ARM64.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {*} Returns the \"length\" value.\n */\nvar getLength = baseProperty('length');\n\nmodule.exports = getLength;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/getLength.js\n// module id = 48\n// module chunks = 1 2","/**\n * The base implementation of `_.property` without support for deep paths.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @returns {Function} Returns the new function.\n */\nfunction baseProperty(key) {\n  return function(object) {\n    return object == null ? undefined : object[key];\n  };\n}\n\nmodule.exports = baseProperty;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/baseProperty.js\n// module id = 49\n// module chunks = 1 2","/**\n * Used as the [maximum length](http://ecma-international.org/ecma-262/6.0/#sec-number.max_safe_integer)\n * of an array-like value.\n */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This function is based on [`ToLength`](http://ecma-international.org/ecma-262/6.0/#sec-tolength).\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n */\nfunction isLength(value) {\n  return typeof value == 'number' && value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\nmodule.exports = isLength;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/isLength.js\n// module id = 50\n// module chunks = 1 2","/**\n * Checks if `value` is object-like.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/isObjectLike.js\n// module id = 51\n// module chunks = 1 2","var getNative = require('../internal/getNative'),\n    isLength = require('../internal/isLength'),\n    isObjectLike = require('../internal/isObjectLike');\n\n/** `Object#toString` result references. */\nvar arrayTag = '[object Array]';\n\n/** Used for native method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the [`toStringTag`](http://ecma-international.org/ecma-262/6.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objToString = objectProto.toString;\n\n/* Native method references for those with the same name as other `lodash` methods. */\nvar nativeIsArray = getNative(Array, 'isArray');\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(function() { return arguments; }());\n * // => false\n */\nvar isArray = nativeIsArray || function(value) {\n  return isObjectLike(value) && isLength(value.length) && objToString.call(value) == arrayTag;\n};\n\nmodule.exports = isArray;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/lang/isArray.js\n// module id = 52\n// module chunks = 1 2","var isNative = require('../lang/isNative');\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = object == null ? undefined : object[key];\n  return isNative(value) ? value : undefined;\n}\n\nmodule.exports = getNative;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/getNative.js\n// module id = 53\n// module chunks = 1 2","var isFunction = require('./isFunction'),\n    isObjectLike = require('../internal/isObjectLike');\n\n/** Used to detect host constructors (Safari > 5). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used for native method references. */\nvar objectProto = Object.prototype;\n\n/** Used to resolve the decompiled source of functions. */\nvar fnToString = Function.prototype.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  fnToString.call(hasOwnProperty).replace(/[\\\\^$.*+?()[\\]{}|]/g, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/**\n * Checks if `value` is a native function.\n *\n * @static\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function, else `false`.\n * @example\n *\n * _.isNative(Array.prototype.push);\n * // => true\n *\n * _.isNative(_);\n * // => false\n */\nfunction isNative(value) {\n  if (value == null) {\n    return false;\n  }\n  if (isFunction(value)) {\n    return reIsNative.test(fnToString.call(value));\n  }\n  return isObjectLike(value) && reIsHostCtor.test(value);\n}\n\nmodule.exports = isNative;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/lang/isNative.js\n// module id = 54\n// module chunks = 1 2","var isObject = require('./isObject');\n\n/** `Object#toString` result references. */\nvar funcTag = '[object Function]';\n\n/** Used for native method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the [`toStringTag`](http://ecma-international.org/ecma-262/6.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objToString = objectProto.toString;\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in older versions of Chrome and Safari which return 'function' for regexes\n  // and Safari 8 which returns 'object' for typed array constructors.\n  return isObject(value) && objToString.call(value) == funcTag;\n}\n\nmodule.exports = isFunction;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/lang/isFunction.js\n// module id = 55\n// module chunks = 1 2","/** Used to detect unsigned integer values. */\nvar reIsUint = /^\\d+$/;\n\n/**\n * Used as the [maximum length](http://ecma-international.org/ecma-262/6.0/#sec-number.max_safe_integer)\n * of an array-like value.\n */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  value = (typeof value == 'number' || reIsUint.test(value)) ? +value : -1;\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return value > -1 && value % 1 == 0 && value < length;\n}\n\nmodule.exports = isIndex;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/isIndex.js\n// module id = 56\n// module chunks = 1 2","/*\n * Работа с xml\n * Взято из https://github.yandex-team.ru/desktop/slices-new/blob/master/common/adapter/api/xml.js\n */\n\n/* global Sizzle: true, ActiveXObject: true */\n\n'use strict';\n\nvar toArray = require('lodash/lang/toArray');\n\n// for escape/unescape\nvar rxEscape = /&|  |<|>|\\r\\n|\\n|'/g; // eslint-disable-line no-regex-spaces\nvar rxUnescape = /&amp;|&nbsp;|&lt;|&gt;|<(br|BR)\\s*\\/?>|&quot;/g;\nvar mapEscape = {\n    '&': '&amp;',\n    '  ': '&nbsp; ',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\\n': '<br />',\n    '\\r\\n': '<br />',\n    '\"': '&quot;'\n};\nvar mapUnescape = {\n    '&amp;': '&',\n    '&nbsp;': ' ',\n    '&lt;': '<',\n    '&gt;': '>',\n    '<br />': '\\n',\n    '<br/>': '\\n',\n    '<br>': '\\n',\n    '&quot;': '\"'\n};\nvar funcReplaceEscape = function (str) {\n    return mapEscape[str];\n};\nvar funcReplaceUnescape = function (str) {\n    return mapUnescape[str.toLowerCase()];\n};\n\nvar xml = {\n    mapEscape: mapEscape,\n    mapUnescape: mapUnescape,\n    escape: function (str) {\n        return str ? String(str).replace(rxEscape, funcReplaceEscape) : '';\n    },\n    unescape: function (str) {\n        return str ? String(str).replace(rxUnescape, funcReplaceUnescape) : '';\n    },\n    fromString: (typeof DOMParser === 'function'\n        ? function (string) {\n            return new DOMParser().parseFromString(string, 'text/xml');\n        }\n        : function (string) {\n            var xmlDocument = new ActiveXObject('Microsoft.XMLDOM');\n            xmlDocument.async = false;\n            xmlDocument.loadXML(string);\n            return xmlDocument;\n        }\n    ),\n    select: (typeof Sizzle === 'function'\n        ? function (selector, parent) {\n            return Sizzle(selector, parent || window.document)[0] || null;\n        }\n        : function (selector, parent) {\n            return (parent || window.document).querySelector(selector);\n        }\n    ),\n    selectAll: (typeof Sizzle === 'function'\n        ? function (selector, parent) {\n            return Sizzle(selector, parent || window.document);\n        }\n        : function (selector, parent) {\n            return toArray((parent || window.document).querySelectorAll(selector));\n        }\n    ),\n    getText: function (elem, selector) {\n        if (elem && selector) {\n            elem = xml.select(selector, elem);\n        }\n        // vitalets: кто нибудь знает для чего нам проверять elem.firstChild && elem.firstChild.data ?\n        // добавил elem.text, т.к. в ие не работало VB-5277\n        return elem\n            ? (elem.textContent || elem.innerText || (elem.firstChild && elem.firstChild.data) || elem.text || '')\n            : '';\n    },\n    setText: function (elem, text) {\n        if (elem) {\n            elem.textContent = text;\n            elem.innerText = text;\n        }\n    },\n    getAttr: function (elem, selector, attr) {\n        if (arguments.length === 2) {\n            attr = selector;\n            selector = null;\n        }\n        if (elem && selector) {\n            elem = xml.select(selector, elem);\n        }\n        return elem && elem.getAttribute(attr) || '';\n    },\n    getAttrs: function (node) {\n        return toArray(node.attributes).reduce(function (memo, attr) {\n            memo[attr.name] = attr.value;\n            return memo;\n        }, Object.create(null));\n    }\n};\n\nmodule.exports = xml;\n\nrequire('./overrides_v3/xml').override(xml);\n\n\n\n// WEBPACK FOOTER //\n// ./utils/xml.js","var arrayCopy = require('../internal/arrayCopy'),\n    getLength = require('../internal/getLength'),\n    isLength = require('../internal/isLength'),\n    values = require('../object/values');\n\n/**\n * Converts `value` to an array.\n *\n * @static\n * @memberOf _\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {Array} Returns the converted array.\n * @example\n *\n * (function() {\n *   return _.toArray(arguments).slice(1);\n * }(1, 2, 3));\n * // => [2, 3]\n */\nfunction toArray(value) {\n  var length = value ? getLength(value) : 0;\n  if (!isLength(length)) {\n    return values(value);\n  }\n  if (!length) {\n    return [];\n  }\n  return arrayCopy(value);\n}\n\nmodule.exports = toArray;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/lang/toArray.js\n// module id = 62\n// module chunks = 1 2","/**\n * Copies the values of `source` to `array`.\n *\n * @private\n * @param {Array} source The array to copy values from.\n * @param {Array} [array=[]] The array to copy values to.\n * @returns {Array} Returns `array`.\n */\nfunction arrayCopy(source, array) {\n  var index = -1,\n      length = source.length;\n\n  array || (array = Array(length));\n  while (++index < length) {\n    array[index] = source[index];\n  }\n  return array;\n}\n\nmodule.exports = arrayCopy;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/arrayCopy.js\n// module id = 63\n// module chunks = 1 2","var baseValues = require('../internal/baseValues'),\n    keys = require('./keys');\n\n/**\n * Creates an array of the own enumerable property values of `object`.\n *\n * **Note:** Non-object values are coerced to objects.\n *\n * @static\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property values.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.values(new Foo);\n * // => [1, 2] (iteration order is not guaranteed)\n *\n * _.values('hi');\n * // => ['h', 'i']\n */\nfunction values(object) {\n  return baseValues(object, keys(object));\n}\n\nmodule.exports = values;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/object/values.js\n// module id = 64\n// module chunks = 1 2","/**\n * The base implementation of `_.values` and `_.valuesIn` which creates an\n * array of `object` property values corresponding to the property names\n * of `props`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array} props The property names to get values for.\n * @returns {Object} Returns the array of property values.\n */\nfunction baseValues(object, props) {\n  var index = -1,\n      length = props.length,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = object[props[index]];\n  }\n  return result;\n}\n\nmodule.exports = baseValues;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/baseValues.js\n// module id = 65\n// module chunks = 1 2","var getNative = require('../internal/getNative'),\n    isArrayLike = require('../internal/isArrayLike'),\n    isObject = require('../lang/isObject'),\n    shimKeys = require('../internal/shimKeys');\n\n/* Native method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = getNative(Object, 'keys');\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/6.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nvar keys = !nativeKeys ? shimKeys : function(object) {\n  var Ctor = object == null ? undefined : object.constructor;\n  if ((typeof Ctor == 'function' && Ctor.prototype === object) ||\n      (typeof object != 'function' && isArrayLike(object))) {\n    return shimKeys(object);\n  }\n  return isObject(object) ? nativeKeys(object) : [];\n};\n\nmodule.exports = keys;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/object/keys.js\n// module id = 66\n// module chunks = 1 2","var isArguments = require('../lang/isArguments'),\n    isArray = require('../lang/isArray'),\n    isIndex = require('./isIndex'),\n    isLength = require('./isLength'),\n    keysIn = require('../object/keysIn');\n\n/** Used for native method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * A fallback implementation of `Object.keys` which creates an array of the\n * own enumerable property names of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction shimKeys(object) {\n  var props = keysIn(object),\n      propsLength = props.length,\n      length = propsLength && object.length;\n\n  var allowIndexes = !!length && isLength(length) &&\n    (isArray(object) || isArguments(object));\n\n  var index = -1,\n      result = [];\n\n  while (++index < propsLength) {\n    var key = props[index];\n    if ((allowIndexes && isIndex(key, length)) || hasOwnProperty.call(object, key)) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\nmodule.exports = shimKeys;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/lodash/internal/shimKeys.js\n// module id = 67\n// module chunks = 1 2","/**\n * XML util proxy override\n */\n'use strict';\n\nconst events = require('../../modules/offscreen/events');\nconst offscreenManager = require('../offscreen/offscreen-manager');\n\nexports.override = (xml) => {\n    if (typeof xml !== 'object') {\n        return;\n    }\n\n    // Keep functions that is going to be overrided\n    // to call them from the offscreen document.\n    xml.fromStringOriginal = xml.fromString.bind({});\n    xml.getAttrOriginal = xml.getAttr.bind({});\n    xml.getTextOriginal = xml.getText.bind({});\n    xml.selectAllOriginal = xml.selectAll.bind({});\n\n    /**\n     * Override XML.fromString method in the offscreen document.\n     */\n    xml.fromString = (string) => {\n        return string;\n    }\n\n    /**\n     * Override XML.getAttr method in the offscreen document.\n     */\n    xml.getAttr = (xmlString, selector, attr) => {\n        const callback = (message) => {\n            const {errObj, attr} = message;\n            if (errObj) {\n                throw new Error(errObj.message);\n            } else {\n                return attr;\n            }\n        };\n\n        const msgBody =\n            {type: events.backend.XML_GET_ATTR, data: {xmlString, selector, attr}};\n        return offscreenManager.sendMessage(\n            msgBody, 'XML getAttr timed out', callback);\n    }\n\n    /**\n     * Override XML.getText method in the offscreen document.\n     */\n    xml.getText = (xmlString, selector) => {\n        const callback = (message) => {\n            const {errObj, text} = message;\n            if (errObj) {\n                throw new Error(errObj.message);\n            } else {\n                return text;\n            }\n        };\n\n        const msgBody =\n            {type: events.backend.XML_GET_TEXT, data: {xmlString, selector}};\n        return offscreenManager.sendMessage(\n            msgBody, 'XML getText timed out', callback);\n    }\n\n    /**\n     * Override XML.selectAll method in the offscreen document.\n     */\n    xml.selectAll = (selector, parent) => {\n        const callback = (message) => {\n            const {errObj, selection} = message;\n            if (errObj) {\n                throw new Error(errObj.message);\n            } else {\n                return selection;\n            }\n        };\n\n        const msgBody =\n            {type: events.backend.XML_SELECT_ALL, data: {selector, parent}};\n        return offscreenManager.sendMessage(\n            msgBody, 'XML selectAll timed out', callback);\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./utils/overrides_v3/xml.js","/**\n * События (сообщения), которыми обмениваются оффскрин и бэкенд\n */\n'use strict';\n\nmodule.exports = {\n    /**\n     * События посылаемые от оффскрина к бэкенду\n     */\n    offscreen: {\n        /**\n         * COLORS\n         */\n        COLORS_DOMINANT_COLOR_BY_URL: 'Colors.calculateDominantColorByUrl.response',\n        COLORS_FONT_COLOR_BY_URL: 'Colors.calculateFontColorByUrl.response',\n\n        /**\n         * FILER\n         */\n        FILER_CD: 'Filer.cd.response',\n        FILER_CP: 'Filer.cp.response',\n        FILER_CREATE: 'Filer.create.response',\n        FILER_DF: 'Filer.df.response',\n        FILER_GET_ENTRY: 'Filer.getEntry.response',\n        FILER_INIT: 'Filer.init.response',\n        FILER_LS: 'Filer.ls.response',\n        FILER_MKDIR: 'Filer.mkdir.response',\n        FILER_MV: 'Filer.mv.response',\n        FILER_OPEN: 'Filer.open.response',\n        FILER_PATH_TO_FILESYSTEM_URL: 'Filer.pathToFilesystemUrl.response',\n        FILER_RM: 'Filer.rm.response',\n        FILER_WRITE: 'Filer.write.response',\n\n        /**\n         * SPEECHKIT\n         */\n        SPEECHKIT_DATA: 'Speechkit.data.response',\n        SPEECHKIT_ERROR: 'Speechkit.error.response',\n        SPEECHKIT_INIT: 'Speechkit.init.response',\n        SPEECHKIT_STOP: 'Speechkit.stop.response',\n\n        /**\n         * XML\n         */\n        XML_FROM_STRING: 'Filer.fromString.response',\n        XML_GET_ATTR: 'Filer.getAttr.response',\n        XML_GET_TEXT: 'Filer.getText.response',\n        XML_SELECT_ALL: 'Filer.selectAll.response',\n    },\n\n    /**\n     * События посылаемые от бэкенда к оффскрину\n     */\n    backend: {\n        /**\n         * COLORS\n         */\n        COLORS_DOMINANT_COLOR_BY_URL: 'Colors.calculateDominantColorByUrl.request',\n        COLORS_FONT_COLOR_BY_URL: 'Colors.calculateFontColorByUrl.request',\n\n        /**\n         * FILER\n         */\n        FILER_CD: 'Filer.cd.request',\n        FILER_CP: 'Filer.cp.request',\n        FILER_CREATE: 'Filer.create.request',\n        FILER_DF: 'Filer.df.request',\n        FILER_GET_ENTRY: 'Filer.getEntry.request',\n        FILER_INIT: 'Filer.init.request',\n        FILER_LS: 'Filer.ls.request',\n        FILER_MKDIR: 'Filer.mkdir.request',\n        FILER_MV: 'Filer.mv.request',\n        FILER_OPEN: 'Filer.open.request',\n        FILER_PATH_TO_FILESYSTEM_URL: 'Filer.pathToFilesystemUrl.request',\n        FILER_RM: 'Filer.rm.request',\n        FILER_WRITE: 'Filer.write.request',\n\n        /**\n         * SPEECHKIT\n         */\n        SPEECHKIT_STOP: 'Speechkit.stop.request',\n        SPEECHKIT_INIT: 'Speechkit.init.request',\n\n        /**\n         * XML\n         */\n        XML_FROM_STRING: 'Filer.fromString.request',\n        XML_GET_ATTR: 'Filer.getAttr.request',\n        XML_GET_TEXT: 'Filer.getText.request',\n        XML_SELECT_ALL: 'Filer.selectAll.request',\n    }\n};\n\n\n\n// WEBPACK FOOTER //\n// ./modules/offscreen/events.js","const errorBooster = require('../error-booster');\n\nlet creationCount = 0;\n\nclass OffscreenManager {\n    constructor() {\n        this.maybeCloseOffscreen = this.maybeCloseOffscreen.bind(this);\n        this.messages = new Map();\n    }\n\n    static hasOffscreen() {\n        if ('getContexts' in chrome.runtime) {\n            return chrome.runtime.getContexts({\n                contextTypes: ['OFFSCREEN_DOCUMENT']\n            }).then(contexts => !!contexts.length);\n        } else {\n            return clients.matchAll().then(matchedClients =>\n                matchedClients.some(client =>\n                    client.url.includes(chrome.runtime.id)));\n        }\n    }\n\n    _getMessageId() {\n        let uniqueId;\n        do {\n            uniqueId = Math.random().toString(36).substr(2, 9);\n        } while (this.messages.has(uniqueId));\n        return uniqueId;\n    }\n\n    _isTabsLeft() {\n        return chrome.tabs.query({}).then((tabs) => tabs.length !== 0);\n    }\n    \n    _closeOffscreen() {\n        return OffscreenManager.hasOffscreen().then((hasDocument) => {\n            if (hasDocument) {\n                return chrome.offscreen.closeDocument();\n            }\n        }).finally(() => {\n            // Can create an offscreen from now on.\n            this.isCreatingOffscreenDocument = null;\n            \n            chrome.tabs.onRemoved.removeListener(this.maybeCloseOffscreen);\n        });\n    }\n\n    _createOffscreen() {\n        return OffscreenManager.hasOffscreen().then((hasDocument) => {\n            if (!hasDocument) {\n                return chrome.offscreen.createDocument({\n                    url: \"backend/offscreen.html\",\n                    reasons: Object.keys(justifications),\n                    justification: Object.values(justifications).join('; '),\n                }, () => {\n                    if (chrome.runtime.lastError) {\n                        // Attempt again on next sendMessage.\n                        this.isCreatingOffscreenDocument = null;\n                        errorBooster.uncaught(chrome.runtime.lastError, {creationCount});\n                    } else {\n                        creationCount += 1;\n                        errorBooster.info(\"Offscreen is created\", {creationCount});\n                    }\n                });\n            }\n        }).finally(() => {\n            // Can close an offscreen from now on.\n            this.isClosingOffscreenDocument = null;\n\n            chrome.tabs.onRemoved.addListener(this.maybeCloseOffscreen);\n        });\n    }\n\n    /**\n     * Creates a port connected to the offscreen.\n     */\n    _connectPort() {\n        this.port = chrome.runtime.connect({name: 'offscreen'});\n\n        this.port.onDisconnect.addListener(() => {\n            this.port = null;\n            for (const entry of this.messages.values()) {\n                if (typeof entry === 'object' && entry.reject) {\n                    entry.reject(new Error('Port was disconnected'));\n                }\n            }\n            this.messages.clear();\n        });\n\n        this.port.onMessage.addListener((message) => {\n            const entry = this.messages.get(message.id);\n            if (entry) {\n                entry.resolve(message);\n                this.messages.delete(message.id);\n            }\n        });\n\n        return Promise.resolve();\n    }\n\n    /**\n     * Ensures an offscreen is connected.\n     */\n    _ensurePortConnected() {\n        if (this.port) {\n            return Promise.resolve();\n        }\n\n        this.maybeCreateOffscreen();\n        return this.isCreatingOffscreenDocument.then(() => {\n            return this._connectPort();\n        });\n    }\n\n    /**\n     * Adds a callback to handle messages from the offscreen.\n     */\n    addOffscreenListener(callback) {\n        if (this.port) {\n            this.port.onMessage.addListener(callback);\n        }\n    }\n\n    /**\n     * Removes a callback to handle messages from the offscreen.\n     */\n    removeOffscreenListener(callback) {\n        if (this.port) {\n            this.port.onMessage.removeListener(callback);\n        }\n    }\n\n    /**\n     * Closes an offscreen if it exists.\n     */\n    maybeCloseOffscreen() {\n        if (!this.isClosingOffscreenDocument) {\n            this.isClosingOffscreenDocument = this._closeOffscreen();\n        }\n    }\n\n    /**\n     * Creates an offscreen if it do not exists.\n     */\n    maybeCreateOffscreen() {\n        if (!this.isCreatingOffscreenDocument) {\n            this.isCreatingOffscreenDocument = this._createOffscreen();\n        }\n    }\n\n    /**\n     * Sends message to the offscreen if it exists.\n     */\n    sendMessage(msgBody, _rejectMessage, callback, opt_errorHandler) {\n        msgBody.id = this._getMessageId();\n        return this._ensurePortConnected().then(() => {\n            return new Promise((resolve, reject) => {\n                this.messages.set(msgBody.id, {resolve, reject});\n                this.port.postMessage(msgBody);\n            });\n        }).then((message) => {\n            if (callback) {\n                return callback(message);\n            }\n        }).catch((error) => {\n            if (opt_errorHandler) {\n                opt_errorHandler(error);\n            }\n            if (error && error.message) {\n                errorBooster.uncaught(error.message);\n            }\n        });\n    }\n};\n\nmodule.exports = new OffscreenManager();\n\n\n\n// WEBPACK FOOTER //\n// ./utils/offscreen/offscreen-manager.js","/**\n * Модуль, ответственный за определения цвета шрифта для изображения\n */\n\n'use strict';\n\nvar loadImage = require('./offscreen/load-image');\n\nvar FONT_COLOR_THRESHOLD = 170;\nvar COLOR_BLACK = 0;\nvar COLOR_WHITE = 1;\nvar CANVAS_SIZE_THRESHOLD = 800;\nvar MAX_THRESHOLD = 238;\nvar MIN_THRESHOLD = 20;\nvar PASTEL_THRESHOLD = 92;\nvar OPACITY_TRESHOLD = 230;\nvar WHITE_TRESHOLD = 253;\nvar BLACK_TRESHOLD = 10;\n\nexports.DEFAULT_BGCOLOR = 'e5e5e5';\nexports.OVERLAY_COLOR_WHITE = 'ffffff';\nexports.OVERLAY_COLOR_BLACK = '000000';\n\nfunction toRGB(num) {\n    return (num < 16 ? '0' : '') + num.toString(16);\n}\n\nfunction isAcidColor(red, green, blue) {\n    var sum = red + green + blue;\n\n    // один из цветов меньше MIN_THRESHOLD, а сумма больше 2 * MAX_THRESHOLD\n    if ((sum >= MAX_THRESHOLD * 2) && (red <= MIN_THRESHOLD || green <= MIN_THRESHOLD || blue <= MIN_THRESHOLD)) {\n        return true;\n    }\n\n    // один из цветов больше MAX_THRESHOLD, а сумма меньше MAX_THRESHOLD + 2 * MIN_THRESHOLD\n    if ((sum <= MAX_THRESHOLD + MIN_THRESHOLD * 2) && (red >= MAX_THRESHOLD || green >= MAX_THRESHOLD || blue >= MAX_THRESHOLD)) {\n        return true;\n    }\n\n    return false;\n}\n\nfunction isAlmostTransparent(opacity) {\n    return (opacity < OPACITY_TRESHOLD);\n}\n\nfunction isAlmostWhite(rgb) {\n    return (rgb[0] > WHITE_TRESHOLD && rgb[1] > WHITE_TRESHOLD && rgb[2] > WHITE_TRESHOLD);\n}\n\nfunction isAlmostBlack(rgb) {\n    return (rgb[0] < BLACK_TRESHOLD && rgb[1] < BLACK_TRESHOLD && rgb[2] < BLACK_TRESHOLD);\n}\n\nfunction isLightGrey(rgb) {\n    var meanValue = (rgb[0] + rgb[1] + rgb[2]) / 3;\n    return (Math.abs(meanValue - rgb[0]) + Math.abs(meanValue - rgb[1]) + Math.abs(meanValue - rgb[2]) < 15);\n}\n\nexports.calculateFontColorForImage = function (img) {\n    var color = exports.getDominant(img, {\n        bottomQuarter: true,\n        rightHalf: false,\n        minifyCanvas: true,\n        preventSkipColors: true\n    });\n    var fontColorNum = exports.getFontColorByBackgroundColor(color);\n    var fontColor = (fontColorNum === 1) ? exports.OVERLAY_COLOR_WHITE : exports.OVERLAY_COLOR_BLACK;\n    return fontColor;\n};\n\nexports.getFontOverlayColorForBackgroundColor = function (bgColor) {\n    var fontColorNum = exports.getFontColorByBackgroundColor(bgColor);\n    return fontColorNum === COLOR_WHITE ? exports.OVERLAY_COLOR_WHITE : exports.OVERLAY_COLOR_BLACK;\n};\n\nfunction getRGBValues(colorString) {\n    return {\n        red: parseInt(colorString.substr(0, 2), 16),\n        green: parseInt(colorString.substr(2, 2), 16),\n        blue: parseInt(colorString.substr(4, 2), 16)\n    };\n}\n\nvar COLOR_NAMES = require('./color-names');\nexports.normalize = function (str) {\n    if (!str) {\n        return null;\n    }\n    str = String(str).trim().toLowerCase();\n    return str in COLOR_NAMES\n        ? COLOR_NAMES[str]\n        : normalizeHexValue(str);\n};\n\nvar HEX_COLOR_RX = /^#?([\\da-f]{3}(?:[\\da-f]{3})?)/;\nfunction normalizeHexValue(val) {\n    if (!HEX_COLOR_RX.test(val)) {\n        return null;\n    }\n    val = HEX_COLOR_RX.exec(val)[1];\n    return val.length === 3\n        ? color3to6(val)\n        : val;\n}\n\nfunction color3to6(str) {\n    return str[0] + str[0]\n       + str[1] + str[1]\n       + str[2] + str[2];\n}\n\nexports.calculateDominantColorByUrl = function (imageUrl, options, callback) {\n    loadImage({url: imageUrl}, function (err, img) {\n        var color = err\n            ? null\n            : exports.getDominant(img, options);\n        callback(color);\n    });\n};\n\nexports.calculateFontColorByUrl = function (imageUrl, callback) {\n    loadImage({url: imageUrl}, function (err, img) {\n        if (err) {\n            return callback(null);\n        }\n        var color = exports.calculateFontColorForImage(img);\n        callback(color);\n    });\n};\n\nexports.getFontColorByBackgroundColor = function (bgColor) {\n    bgColor = bgColor || exports.DEFAULT_BGCOLOR;\n    var rgb = getRGBValues(bgColor);\n    var tone = (rgb.red + rgb.green + rgb.blue) / 3;\n    if ((tone < FONT_COLOR_THRESHOLD) &&\n        (rgb.red < FONT_COLOR_THRESHOLD || rgb.green < FONT_COLOR_THRESHOLD)) {\n        return COLOR_WHITE;\n    } else {\n        return COLOR_BLACK;\n    }\n};\n\nexports.getDominant = function (img, options) {\n    options = options || {};\n\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n\n    var canvasWidth = img.width;\n    var canvasHeight = img.height;\n\n    if (img.width > img.height) {\n        if (options.minifyCanvas && img.width > CANVAS_SIZE_THRESHOLD) {\n            canvasWidth = CANVAS_SIZE_THRESHOLD;\n            canvasHeight = Math.round(canvasWidth * img.height / img.width);\n        }\n    } else {\n        if (options.minifyCanvas && img.height > CANVAS_SIZE_THRESHOLD) {\n            canvasHeight = CANVAS_SIZE_THRESHOLD;\n            canvasWidth = Math.round(canvasHeight * img.width / img.height);\n        }\n    }\n\n    canvas.setAttribute('width', canvasWidth);\n    canvas.setAttribute('height', canvasHeight);\n    ctx.drawImage(img, 0, 0, canvasWidth, canvasHeight);\n    // here can be DOM Exception: SECURITY_ERR\n    var imgPixels;\n    try {\n        imgPixels = ctx.getImageData(0, 0, canvas.width, canvas.height);\n    } catch (e) {\n        // Do nothing.\n        return '';\n    }\n    var maxValueKey = null;\n    var colorsContainer = {};\n    var pixelColorData = new Array(4);\n\n    var startY = (options.bottomQuarter) ? Math.round(imgPixels.height * 0.75) : 0;\n    var startX = (options.rightHalf) ? Math.round(imgPixels.width / 2) : 0;\n\n    for (var y = startY; y < imgPixels.height; y++) {\n        for (var x = startX; x < imgPixels.width; x++) {\n            var index = (y * 4) * imgPixels.width + x * 4;\n\n            // VB-1902\n            if (isAlmostTransparent(imgPixels.data[index + 3])) {\n                continue;\n            }\n\n            // чистые цвета\n            pixelColorData[0] = imgPixels.data[index]; // red\n            pixelColorData[1] = imgPixels.data[index + 1]; // green\n            pixelColorData[2] = imgPixels.data[index + 2]; // blue\n            pixelColorData[3] = imgPixels.data[index + 3]; // opacity\n\n            if (pixelColorData[3] !== 255) {\n                // color       | opacity\n                // ------------+--------\n                // clean color | 255\n                // 255         | 1\n\n                // накладываем цвет на белый фон\n                for (var z = 0; z < 3; z++) {\n                    var colorStep = (255 - pixelColorData[z]) / 255;\n                    pixelColorData[z] = Math.round(255 - colorStep * pixelColorData[3]);\n                }\n            }\n\n            if (!options.preventSkipColors &&\n                (isAlmostWhite(pixelColorData) ||\n                 isAlmostBlack(pixelColorData) ||\n                 isLightGrey(pixelColorData))) {\n                continue;\n            }\n\n            var color = toRGB(pixelColorData[0]) + toRGB(pixelColorData[1]) + toRGB(pixelColorData[2]);\n            colorsContainer[color] = colorsContainer[color] || 0;\n            colorsContainer[color] += 1;\n\n            if (maxValueKey === null || colorsContainer[maxValueKey] < colorsContainer[color]) {\n                maxValueKey = color;\n            }\n        }\n    }\n\n    if (maxValueKey) {\n        // VB-607\n        var rgb = getRGBValues(maxValueKey);\n        if (isAcidColor(rgb.red, rgb.green, rgb.blue)) {\n            rgb.red = Math.max(rgb.red, PASTEL_THRESHOLD);\n            rgb.green = Math.max(rgb.green, PASTEL_THRESHOLD);\n            rgb.blue = Math.max(rgb.blue, PASTEL_THRESHOLD);\n\n            maxValueKey = toRGB(rgb.red) + toRGB(rgb.green) + toRGB(rgb.blue);\n        }\n    }\n\n    return maxValueKey || exports.DEFAULT_BGCOLOR;\n};\n\n/**\n * Возвращает пиксель по координатам (0-based)\n */\nfunction getIndexByXY(x, y, imgPixels) {\n    return 4 * (imgPixels.width * y + x);\n}\n\n/**\n * Является ли скриншот черным\n *\n * @param {ImageData} imgPixels\n * @return {Boolean}\n */\nexports.isBlack = function (imgPixels) {\n    var halfX = Math.floor(imgPixels.width / 2);\n    var halfY = Math.floor(imgPixels.height / 2);\n    var listToCheck = [];\n\n    // полоса слева направо\n    for (var x = 0; x < imgPixels.width - 1; x++) {\n        listToCheck.push(getIndexByXY(x, halfY, imgPixels));\n    }\n\n    // полоса сверху вниз\n    for (var y = 0; y < imgPixels.height - 1; y++) {\n        listToCheck.push(getIndexByXY(halfX, y, imgPixels));\n    }\n\n    // углы\n    listToCheck.push(getIndexByXY(0, 0, imgPixels));\n    listToCheck.push(getIndexByXY(imgPixels.width - 1, 0, imgPixels));\n    listToCheck.push(getIndexByXY(0, imgPixels.height - 1, imgPixels));\n    listToCheck.push(getIndexByXY(imgPixels.width - 1, imgPixels.height - 1, imgPixels));\n\n    return listToCheck.every(function (index) {\n        var red = imgPixels.data[index];\n        var green = imgPixels.data[index + 1];\n        var blue = imgPixels.data[index + 2];\n        var opacity = imgPixels.data[index + 3];\n\n        // opacity 0 || 255, т.к. иногда хром оставляет прозрачную полоску\n        return (red === 0 && green === 0 && blue === 0 && (opacity === 255 || opacity === 0));\n    });\n};\n\nrequire('./overrides_v3/colors').override(exports);\n\n\n\n// WEBPACK FOOTER //\n// ./utils/colors.js","'use strict';\n\n/**\n * @param {Object} options\n * @param {String} options.url\n * @param {Boolean} [options.noCache]\n * @param {Function} callback\n * @returns {Image}\n */\nmodule.exports = function loadImage(options, callback) {\n    var img = new window.Image();\n    img.onload = onLoad.bind(null, img, callback);\n    img.onerror = onError.bind(null, img, callback);\n    img.src = options.url;\n    return img;\n}\n\n/**\n * @param {Image} img\n * @param {Function} callback\n */\nfunction onLoad(img, callback) {\n    setTimeout(function () {\n        callback(null, img);\n    }, 0);\n}\n\n/**\n * @param {Image} img\n * @param {Function} callback\n */\nfunction onError(img, callback) {\n    callback(new Error('Image load error: ' + img.src), img);\n}\n\n\n// WEBPACK FOOTER //\n// ./utils/offscreen/load-image.js","// https://drafts.csswg.org/css-color/#named-colors\n'use strict';\n\nmodule.exports = {\n    aliceblue: 'f0f8ff',\n    antiquewhite: 'faebd7',\n    aqua: '00ffff',\n    aquamarine: '7fffd4',\n    azure: 'f0ffff',\n    beige: 'f5f5dc',\n    bisque: 'ffe4c4',\n    black: '000000',\n    blanchedalmond: 'ffebcd',\n    blue: '0000ff',\n    blueviolet: '8a2be2',\n    brown: 'a52a2a',\n    burlywood: 'deb887',\n    cadetblue: '5f9ea0',\n    chartreuse: '7fff00',\n    chocolate: 'd2691e',\n    coral: 'ff7f50',\n    cornflowerblue: '6495ed',\n    cornsilk: 'fff8dc',\n    crimson: 'dc143c',\n    cyan: '00ffff',\n    darkblue: '00008b',\n    darkcyan: '008b8b',\n    darkgoldenrod: 'b8860b',\n    darkgray: 'a9a9a9',\n    darkgreen: '006400',\n    darkgrey: 'a9a9a9',\n    darkkhaki: 'bdb76b',\n    darkmagenta: '8b008b',\n    darkolivegreen: '556b2f',\n    darkorange: 'ff8c00',\n    darkorchid: '9932cc',\n    darkred: '8b0000',\n    darksalmon: 'e9967a',\n    darkseagreen: '8fbc8f',\n    darkslateblue: '483d8b',\n    darkslategray: '2f4f4f',\n    darkslategrey: '2f4f4f',\n    darkturquoise: '00ced1',\n    darkviolet: '9400d3',\n    deeppink: 'ff1493',\n    deepskyblue: '00bfff',\n    dimgray: '696969',\n    dimgrey: '696969',\n    dodgerblue: '1e90ff',\n    firebrick: 'b22222',\n    floralwhite: 'fffaf0',\n    forestgreen: '228b22',\n    fuchsia: 'ff00ff',\n    gainsboro: 'dcdcdc',\n    ghostwhite: 'f8f8ff',\n    gold: 'ffd700',\n    goldenrod: 'daa520',\n    gray: '808080',\n    green: '008000',\n    greenyellow: 'adff2f',\n    grey: '808080',\n    honeydew: 'f0fff0',\n    hotpink: 'ff69b4',\n    indianred: 'cd5c5c',\n    indigo: '4b0082',\n    ivory: 'fffff0',\n    khaki: 'f0e68c',\n    lavender: 'e6e6fa',\n    lavenderblush: 'fff0f5',\n    lawngreen: '7cfc00',\n    lemonchiffon: 'fffacd',\n    lightblue: 'add8e6',\n    lightcoral: 'f08080',\n    lightcyan: 'e0ffff',\n    lightgoldenrodyellow: 'fafad2',\n    lightgray: 'd3d3d3',\n    lightgreen: '90ee90',\n    lightgrey: 'd3d3d3',\n    lightpink: 'ffb6c1',\n    lightsalmon: 'ffa07a',\n    lightseagreen: '20b2aa',\n    lightskyblue: '87cefa',\n    lightslategray: '778899',\n    lightslategrey: '778899',\n    lightsteelblue: 'b0c4de',\n    lightyellow: 'ffffe0',\n    lime: '00ff00',\n    limegreen: '32cd32',\n    linen: 'faf0e6',\n    magenta: 'ff00ff',\n    maroon: '800000',\n    mediumaquamarine: '66cdaa',\n    mediumblue: '0000cd',\n    mediumorchid: 'ba55d3',\n    mediumpurple: '9370db',\n    mediumseagreen: '3cb371',\n    mediumslateblue: '7b68ee',\n    mediumspringgreen: '00fa9a',\n    mediumturquoise: '48d1cc',\n    mediumvioletred: 'c71585',\n    midnightblue: '191970',\n    mintcream: 'f5fffa',\n    mistyrose: 'ffe4e1',\n    moccasin: 'ffe4b5',\n    navajowhite: 'ffdead',\n    navy: '000080',\n    oldlace: 'fdf5e6',\n    olive: '808000',\n    olivedrab: '6b8e23',\n    orange: 'ffa500',\n    orangered: 'ff4500',\n    orchid: 'da70d6',\n    palegoldenrod: 'eee8aa',\n    palegreen: '98fb98',\n    paleturquoise: 'afeeee',\n    palevioletred: 'db7093',\n    papayawhip: 'ffefd5',\n    peachpuff: 'ffdab9',\n    peru: 'cd853f',\n    pink: 'ffc0cb',\n    plum: 'dda0dd',\n    powderblue: 'b0e0e6',\n    purple: '800080',\n    rebeccapurple: '663399',\n    red: 'ff0000',\n    rosybrown: 'bc8f8f',\n    royalblue: '4169e1',\n    saddlebrown: '8b4513',\n    salmon: 'fa8072',\n    sandybrown: 'f4a460',\n    seagreen: '2e8b57',\n    seashell: 'fff5ee',\n    sienna: 'a0522d',\n    silver: 'c0c0c0',\n    skyblue: '87ceeb',\n    slateblue: '6a5acd',\n    slategray: '708090',\n    slategrey: '708090',\n    snow: 'fffafa',\n    springgreen: '00ff7f',\n    steelblue: '4682b4',\n    tan: 'd2b48c',\n    teal: '008080',\n    thistle: 'd8bfd8',\n    tomato: 'ff6347',\n    turquoise: '40e0d0',\n    violet: 'ee82ee',\n    wheat: 'f5deb3',\n    white: 'ffffff',\n    whitesmoke: 'f5f5f5',\n    yellow: 'ffff00',\n    yellowgreen: '9acd32'\n};\n\n\n\n// WEBPACK FOOTER //\n// ./utils/color-names.js","/**\n * Colors util proxy override\n */\n'use strict';\n\nconst events = require('../../modules/offscreen/events');\nconst offscreenManager = require('../offscreen/offscreen-manager');\n\nexports.override = (colors) => {\n    if (typeof colors !== 'object') {\n        return;\n    }\n\n    // Keep functions that is going to be overrided\n    // to call them from the offscreen document.\n    colors.calculateDominantColorByUrlOriginal =\n        colors.calculateDominantColorByUrl.bind({});\n    colors.calculateFontColorByUrlOriginal =\n        colors.calculateFontColorByUrl.bind({});\n\n    /**\n     * Proxy request to the Colors.calculateDominantColorByUrl method\n     * in the offscreen document.\n     */\n    colors.calculateDominantColorByUrl = (imgUrl, options, successCallback) => {\n        const callback = (message) => {\n            const {errObj, color} = message;\n            if (errObj) {\n                throw new Error(errObj.message);\n            } else {\n                return successCallback(color);\n            }\n        };\n\n        const msgBody =\n            {type: events.backend.COLORS_DOMINANT_COLOR_BY_URL, data: {imgUrl, options}};\n        return offscreenManager.sendMessage(\n            msgBody, 'Colors calculateDominantColorByUrl timed out', callback);\n    };\n\n    /**\n     * Proxy request to the Colors.calculateFontColorByUrl method\n     * in the offscreen document.\n     */\n    colors.calculateFontColorByUrl = (imgUrl, successCallback) => {\n        const callback = (message) => {\n            const {errObj, color} = message;\n            if (errObj) {\n                throw new Error(errObj.message);\n            } else {\n                return successCallback(color);\n            }\n        };\n\n        const msgBody =\n            {type: events.backend.COLORS_FONT_COLOR_BY_URL, data: {imgUrl}};\n        return offscreenManager.sendMessage(\n            msgBody, 'Colors calculateFontColorByUrl timed out', callback);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./utils/overrides_v3/colors.js","/**\n * Константы для модуля voice\n */\n'use strict';\n\n/**\n * Статусы\n *\n * @type {{READY: number, CONNECTING: number, RECORD: number, PROCESSING: number, FINISHED: number, ERROR: number}}\n */\nexports.STATUS = {\n    READY: 0,\n    CONNECTING: 1,\n    RECORD: 2,\n    PROCESSING: 3,\n    FINISHED: 4,\n    INTERRUPTED: 5,\n    ERROR: 6,\n};\n\n/**\n * API ключ для speechkit\n *\n * @type {string}\n */\nexports.API_KEY = 'ea0ff746-a756-4bd9-882d-0ab983fae8a8';\n\n/**\n * Ошибки\n *\n * @type {{SILENCE: string}}\n */\nexports.ERROR_REASON = {\n    SILENCE: 'silence',\n};\n\n/**\n * Задержка перед вызовом перехода на серп (в миллисекундах)\n *\n * @type {number}\n */\nexports.ANIMATION_TIMEOUT_MS = 1200;\n\n/**\n * Длительность промежутка тишины во время записи речи (в десятках миллисекунд).\n * Как только встречается такой перерыв в речи, запись звука останавливается,\n * и записанный фрагмент речи отправляется на сервер.\n *\n * @type {number}\n */\nexports.UTTERANCE_SILENCE = 60;\n\n/**\n * Таймаут ожидания начала речи (в миллисекундах). speechkit сам не обрывает сессию, если пользователь\n * не начинает говорить.\n *\n * @type {number}\n */\nexports.SILENCE_TIMEOUT_MS = 1000 * 8;\n\n/**\n * Имя настройки показывающей пользовался ли пользователь голосовым модулем\n *\n * @type {string}\n */\nexports.IS_VOICE_USED = 'isVoiceUsed';\n\n\n\n// WEBPACK FOOTER //\n// ./modules/voice/consts.js","'use strict';\n\nconst colorUtils = require('../../utils/colors');\nconst events = require('./events');\n\nclass ColorsHandler {\n    constructor() {}\n\n    /**\n     * Handles Filer.calculateDominantColorByUrl method call.\n     * @param {Object} params\n     * @private\n     */\n    _calculateDominantColorByUrl({imgUrl, options, sendResponse}) {\n        colorUtils.calculateDominantColorByUrlOriginal(imgUrl, options, (color) => {\n            sendResponse({color});\n        });\n    }\n\n    /**\n     * Handles Filer.calculateFontColorByUrl method call.\n     * @param {Object} params\n     * @private\n     */\n    _calculateFontColorByUrl({imgUrl, sendResponse}) {\n        colorUtils.calculateFontColorByUrlOriginal(imgUrl, (color) => {\n            sendResponse({color});\n        });\n    }\n\n    handle(req, _sender) {\n        switch (req.type) {\n            case events.backend.COLORS_DOMINANT_COLOR_BY_URL:\n                this._calculateDominantColorByUrl(req.data);\n                break;\n            case events.backend.COLORS_FONT_COLOR_BY_URL:\n                this._calculateFontColorByUrl(req.data);\n                break;     \n            default:\n                // Cannot handle.\n                return;\n        }\n\n        // Indicate an async response.\n        return true;\n    }\n};\n\nmodule.exports = new ColorsHandler();\n\n\n\n// WEBPACK FOOTER //\n// ./modules/offscreen/colors-handler.js","'use strict';\n\nconst Filer = require('../../libs/filer');\nconst events = require('./events');\n\nconst DATA_URI_REG_EXP = /^data:/;\n\nclass FilerHandler {\n    constructor() {\n        this.filer = new Filer();\n    }\n\n    /**\n     * Returns whether url string is data uri.\n     * @param {String} url\n     * @returns {Boolean}\n     * @private\n     */\n    _isDataUri(url) {\n        return typeof url === 'string' &&\n            DATA_URI_REG_EXP.test(url);\n    }\n\n    /**\n     * Returns error handler for the backend message.\n     * @param {Function} sendResponse\n     * @returns {Function}\n     * @private\n     */\n    _getErrorHandler(sendResponse) {\n        return (err) => {\n            sendResponse({errObj: {name: err.name, message: err.message}});\n        }\n    }\n\n    /**\n     * Handles Filer.init method call.\n     * @param {Object} params\n     * @private\n     */\n    _init({opt_initObj, sendResponse}) {\n        this.filer.init(opt_initObj, () => {\n            sendResponse({})\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.ls method call.\n     * @param {Object} params\n     * @private\n     */\n    _ls({dirEntryOrPath, sendResponse}) {\n        this.filer.ls(dirEntryOrPath, (entries) => {\n            sendResponse({\n                entries: entries.map((entry) =>\n                    ({fullPath: entry.fullPath, name: entry.name}))\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.mkdir method call.\n     * @param {Object} params\n     * @private\n     */\n    _mkdir({path, opt_exclusive, sendResponse}) {\n        this.filer.mkdir(path, opt_exclusive, (entry) => {\n            sendResponse({\n                entry: {fullPath: entry.fullPath, name: entry.name}\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.open method call.\n     * @param {Object} params\n     * @private\n     */\n    _open({entryOrPath, sendResponse}) {\n        this.filer.open(entryOrPath, (file) => {\n            sendResponse({\n                file: Filer.fileToObjectURL(file)\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.pathToFilesystemURL method call.\n     * @param {Object} params\n     * @private\n     */\n    _pathToFilesystemURL({path, sendResponse}) {\n        this.filer.pathToFilesystemURL(path, (path) => {\n            sendResponse({path});\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.create method call.\n     * @param {Object} params\n     * @private\n     */\n    _create({path, opt_exclusive, sendResponse}) {\n        this.filer.create(path, opt_exclusive, () => {\n            sendResponse({});\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.mv method call.\n     * @param {Object} params\n     * @private\n     */\n    _mv({src, dest, opt_newName, sendResponse}) {\n        this.filer.mv(src, dest, opt_newName, (entry) => {\n            sendResponse({\n                entry: {fullPath: entry.fullPath, name: entry.name}\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.rm method call.\n     * @param {Object} params\n     * @private\n     */\n    _rm({entryOrPath, sendResponse}) {\n        this.filer.rm(entryOrPath, () => {\n            sendResponse({});\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.cd method call.\n     * @param {Object} params\n     * @private\n     */\n    _cd({dirEntryOrPath, sendResponse}) {\n        this.filer.cd(dirEntryOrPath, (entry) => {\n            sendResponse({\n                entry: {fullPath: entry.fullPath, name: entry.name}\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.cp method call.\n     * @param {Object} params\n     * @private\n     */\n    _cp({src, dest, opt_newName, sendResponse}) {\n        this.filer.cp(src, dest, opt_newName, (entry) => {\n            sendResponse({\n                entry: {fullPath: entry.fullPath, name: entry.name}\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.write method call.\n     * @param {Object} params\n     * @private\n     */\n    _write({entryOrPath, writeData, sendResponse}) {\n        if (this._isDataUri(writeData)) {\n            writeData = Filer.dataURLToBlob(writeData);\n        }\n\n        this.filer.write(entryOrPath, writeData, (entry) => {\n            sendResponse({\n                entry: {name: entry.name, path: entry.fullPath}\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.df method call.\n     * @param {Object} params\n     * @private\n     */\n    _df({sendResponse}) {\n        this.filer.df((byteUsed, byteLeft, byteCap) => {\n            sendResponse({\n                data: {byteUsed, byteLeft, byteCap}\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    /**\n     * Handles Filer.getEntry method call.\n     * @param {Object} params\n     * @private\n     */\n    _getEntry({fileName, sendResponse}) {\n        this.filer.getEntry(fileName, (entry) => {\n            sendResponse({\n                entry: entry.toURL()\n            });\n        }, this._getErrorHandler(sendResponse));\n    }\n\n    handle(req, _sender) {\n        if (!this.isFilerInitializing) {\n            this.isFilerInitializing = new Promise((resolve) => {\n                this.filer.init({persistent: true, size: 0}, () => {\n                    resolve();\n                });\n            });\n        }\n\n        let handler = null;\n        switch (req.type) {\n            case events.backend.FILER_CD:\n                handler = this._cd;\n                break;\n            case events.backend.FILER_CP:\n                handler = this._cp;\n                break;\n            case events.backend.FILER_CREATE:\n                handler = this._create;\n                break;\n            case events.backend.FILER_DF:\n                handler = this._df;\n                break;\n            case events.backend.FILER_GET_ENTRY:\n                handler = this._getEntry;\n                break;\n            case events.backend.FILER_INIT:\n                handler = this._init;\n                break;\n            case events.backend.FILER_LS:\n                handler = this._ls;\n                break;\n            case events.backend.FILER_MKDIR:\n                handler = this._mkdir;\n                break;\n            case events.backend.FILER_MV:\n                handler = this._mv;\n                break;\n            case events.backend.FILER_OPEN:\n                handler = this._open;\n                break;\n            case events.backend.FILER_PATH_TO_FILESYSTEM_URL:\n                handler = this._pathToFilesystemURL;\n                break;\n            case events.backend.FILER_RM:\n                handler = this._rm;\n                break;\n            case events.backend.FILER_WRITE:\n                handler = this._write;\n                break;\n            default:\n                // Cannot handle.\n                return;\n        }\n\n        handler = handler.bind(this);\n        this.isFilerInitializing.then(() => {\n            handler(req.data);  \n        });\n\n        // Indicate an async response.\n        return true;\n    }\n};\n\nmodule.exports = new FilerHandler();\n\n\n\n// WEBPACK FOOTER //\n// ./modules/offscreen/filer-handler.js","/**\n * Copyright 2013 - Eric Bidelman\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n\n * @fileoverview\n * Convenient wrapper library for the HTML5 Filesystem API, implementing\n * familiar UNIX commands (cp, mv, ls) for its API.\n *\n * @author Eric Bidelman (ebidel@gmail.com)\n * @version: 0.4.3\n */\n\n'use strict';\n\nvar self = window; // window or worker context.\n\nself.requestFileSystem = self.requestFileSystem || self.webkitRequestFileSystem;\n\nself.resolveLocalFileSystemURL = self.resolveLocalFileSystemURL ||\n                                 self.webkitResolveLocalFileSystemURL;\nnavigator.temporaryStorage = navigator.temporaryStorage ||\n                             navigator.webkitTemporaryStorage;\nnavigator.persistentStorage = navigator.persistentStorage ||\n                              navigator.webkitPersistentStorage;\nself.BlobBuilder = self.BlobBuilder || self.MozBlobBuilder ||\n                   self.WebKitBlobBuilder;\n\n// Prevent errors in browsers that don't support FileError.\nif (self.FileError === undefined) {\n  var FileError = function() {};\n  FileError.prototype.prototype = Error.prototype;\n} else {\n    FileError = self.FileError;\n}\n\nvar Util = {\n\n  /**\n   * Turns a NodeList into an array.\n   *\n   * @param {NodeList} list The array-like object.\n   * @return {Array} The NodeList as an array.\n   */\n  toArray: function(list) {\n    return Array.prototype.slice.call(list || [], 0);\n  },\n\n  /*toDataURL: function(contentType, uint8Array) {\n    return 'data:' + contentType + ';base64,' +\n        self.btoa(this.arrayToBinaryString(uint8Array));\n  },*/\n\n  /**\n   * Creates a data: URL from string data.\n   *\n   * @param {string} str The content to encode the data: URL from.\n   * @param {string} contentType The mimetype of the data str represents.\n   * @param {bool=} opt_isBinary Whether the string data is a binary string\n   *     (and therefore should be base64 encoded). True by default.\n   * @return {string} The created data: URL.\n   */\n  strToDataURL: function(str, contentType, opt_isBinary) {\n    var isBinary = opt_isBinary != undefined ? opt_isBinary : true;\n    if (isBinary) {\n      return 'data:' + contentType + ';base64,' + self.btoa(str);\n    } else {\n      return 'data:' + contentType + ',' + str;\n    }\n  },\n\n  /**\n   * Creates a blob: URL from a binary str.\n   *\n   * @param {string} binStr The content as a binary string.\n   * @param {string=} opt_contentType An optional mimetype of the data.\n   * @return {string} A new blob: URL.\n   */\n  strToObjectURL: function(binStr, opt_contentType) {\n\n    var ui8a = new Uint8Array(binStr.length);\n    for (var i = 0; i < ui8a.length; ++i) {\n      ui8a[i] = binStr.charCodeAt(i);\n    }\n\n    var blob = new Blob([ui8a],\n                        opt_contentType ? {type: opt_contentType} : {});\n\n    return self.URL.createObjectURL(blob);\n  },\n\n  /**\n   * Creates a blob: URL from a File or Blob object.\n   *\n   * @param {Blob|File} blob The File or Blob data.\n   * @return {string} A new blob: URL.\n   */\n  fileToObjectURL: function(blob) {\n    return self.URL.createObjectURL(blob);\n  },\n\n  /**\n   * Reads a File or Blob object and returns it as an ArrayBuffer.\n   *\n   * @param {Blob|File} blob The File or Blob data.\n   * @param {Function} callback Success callback passed the array buffer.\n   * @param {Function=} opt_error Optional error callback if the read fails.\n   */\n  fileToArrayBuffer: function(blob, callback, opt_errorCallback) {\n    var reader = new FileReader();\n    reader.onload = function(e) {\n      callback(e.target.result);\n    };\n    reader.onerror = function(e) {\n      if (opt_errorCallback) {\n        opt_errorCallback(e);\n      }\n    };\n\n    reader.readAsArrayBuffer(blob);\n  },\n\n  /**\n   * Creates and returns a blob from a data URL (either base64 encoded or not).\n   *\n   * @param {string} dataURL The data URL to convert.\n   * @return {Blob} A blob representing the array buffer data.\n   */\n  dataURLToBlob: function(dataURL) {\n    var BASE64_MARKER = ';base64,';\n    if (dataURL.indexOf(BASE64_MARKER) == -1) {\n      var parts = dataURL.split(',');\n      var contentType = parts[0].split(':')[1];\n      var raw = decodeURIComponent(parts[1]);\n\n      return new Blob([raw], {type: contentType});\n    }\n\n    var parts = dataURL.split(BASE64_MARKER);\n    var contentType = parts[0].split(':')[1];\n    var raw = window.atob(parts[1]);\n    var rawLength = raw.length;\n\n    var uInt8Array = new Uint8Array(rawLength);\n\n    for (var i = 0; i < rawLength; ++i) {\n      uInt8Array[i] = raw.charCodeAt(i);\n    }\n\n    return new Blob([uInt8Array], {type: contentType});\n  },\n\n  /**\n   * Reads an ArrayBuffer as returns its contents as a binary string.\n   *\n   * @param {ArrayBuffer} buffer The buffer of data.\n   * @param {string=} opt_contentType An optional mimetype of the data.\n   * @return {Blob} A blob representing the array buffer data.\n   */\n  arrayBufferToBlob: function(buffer, opt_contentType) {\n    var uInt8Array = new Uint8Array(buffer);\n    return new Blob([uInt8Array],\n                    opt_contentType ? {type: opt_contentType} : {});\n  },\n\n  /**\n   * Reads an ArrayBuffer as returns its contents as a binary string.\n   *\n   * @param {ArrayBuffer} buffer The buffer of data.\n   * @param {Function} callback Success callback passed the binary string.\n   * @param {Function=} opt_error Optional error callback if the read fails.\n   */\n  arrayBufferToBinaryString: function(buffer, callback, opt_errorCallback) {\n    var reader = new FileReader();\n    reader.onload = function(e) {\n      callback(e.target.result);\n    };\n    reader.onerror = function(e) {\n      if (opt_errorCallback) {\n        opt_errorCallback(e);\n      }\n    };\n\n    var uInt8Array = new Uint8Array(buffer);\n    reader.readAsBinaryString(new Blob([uInt8Array]));\n  },\n\n  /**\n   * Create a binary string out of an array of numbers (bytes), each varying\n   * from 0-255.\n   *\n   * @param {Array} bytes The array of numbers to transform into a binary str.\n   * @return {string} The byte array as a string.\n   */\n  arrayToBinaryString: function(bytes) {\n    if (typeof bytes != typeof []) {\n      return null;\n    }\n    var i = bytes.length;\n    var bstr = new Array(i);\n    while (i--) {\n      bstr[i] = String.fromCharCode(bytes[i]);\n    }\n    return bstr.join('');\n  },\n\n  /**\n   * Returns the file extension for a given filename.\n   *\n   * @param {string} filename The filename.\n   * @return {string} The file's extension.\n   */\n  getFileExtension: function(filename) {\n    var idx = filename.lastIndexOf('.');\n    return idx != -1 ? filename.substring(idx) : '';\n  }\n};\n\n\nvar MyFileError = function(obj) {\n  this.prototype = FileError.prototype;\n  this.code = obj.code;\n  this.name = obj.name;\n};\n//MyFileError.prototype.__proto__ = FileError.prototype;\n\n// Extend FileError with custom errors and a convenience method to get error\n// code mnemonic.\nFileError.BROWSER_NOT_SUPPORTED = 1000;\n\n// TODO: remove when FileError.name is implemented (crbug.com/86014).\nFileError.prototype.__defineGetter__('name', function() {\n  var keys = Object.keys(FileError);\n  for (var i = 0, key; key = keys[i]; ++i) {\n    if (FileError[key] == this.code) {\n      return key;\n    }\n  }\n  return 'Unknown Error';\n});\n\n\nvar Filer = new function() {\n\n  var FS_INIT_ERROR_MSG = 'Filesystem has not been initialized.';\n  var NOT_IMPLEMENTED_MSG = 'Not implemented.';\n  var NOT_A_DIRECTORY = 'Path was not a directory.';\n  var INCORRECT_ARGS = 'These method arguments are not supported.';\n  var FS_URL_SCHEME = 'filesystem:';\n  var DEFAULT_FS_SIZE = 1024 * 1024; // 1MB.\n\n  var fs_ = null;\n  var cwd_ = null;\n  var isOpen_ = false;\n\n  var isFsURL_ = function(path) {\n    return path.indexOf(FS_URL_SCHEME) == 0;\n  };\n\n  // Path can be relative or absolute. If relative, it's taken from the cwd_.\n  // If a filesystem URL is passed it, it is simple returned\n  var pathToFsURL_ = function(path) {\n    if (!isFsURL_(path)) {\n      if (path[0] == '/') {\n        path = fs_.root.toURL() + path.substring(1);\n      } else if (path.indexOf('./') == 0 || path.indexOf('../') == 0) {\n        if (path == '../' && cwd_ != fs_.root) {\n          path = cwd_.toURL() + '/' + path;\n        } else {\n          path = cwd_.toURL() + path;\n        }\n      } else {\n        path = cwd_.toURL() + '/' + path;\n      }\n    }\n\n    return path;\n  };\n\n    /**\n     * Looks up a FileEntry or DirectoryEntry for a given path.\n     *\n     * @param srcStr\n     * @param destStr\n     * @param {function(...FileEntry|DirectorEntry)} callback A callback to be\n     *     passed the entry/entries that were fetched. The ordering of the\n     *     entries passed to the callback correspond to the same order passed\n     *     to this method.\n     * @param {function} errback\n     */\n  var getEntry_ = function(srcStr, destStr, callback, errback) {\n    var onError = function(e) {\n        if (errback) {\n            errback(e);\n        }\n    };\n\n    // Build a filesystem: URL manually if we need to.\n    var src = pathToFsURL_(srcStr);\n\n    if (srcStr && destStr) {\n      var dest = pathToFsURL_(destStr);\n      self.resolveLocalFileSystemURL(src, function(srcEntry) {\n        self.resolveLocalFileSystemURL(dest, function(destEntry) {\n          callback(srcEntry, destEntry);\n        }, onError);\n      }, onError);\n    } else {\n      self.resolveLocalFileSystemURL(src, callback, onError);\n    }\n  };\n\n  /**\n   * Copy or moves a file or directory to a destination.\n   *\n   * See public method's description (Filer.cp()) for rest of params.\n   * @param {Boolean=} opt_deleteOrig True if the original entry should be\n   *     deleted after the copy takes place, essentially making the operation\n   *     a move instead of a copy. Defaults to false.\n   */\n  var copyOrMove_ = function(src, dest, opt_newName, opt_successCallback,\n                             opt_errorHandler, opt_deleteOrig) {\n    var self = this;\n\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    if (typeof src != typeof dest) {\n      throw new Error(INCORRECT_ARGS);\n    }\n\n    var newName = opt_newName || null;\n    var deleteOrig = opt_deleteOrig != undefined ? opt_deleteOrig : false;\n\n    if ((src.isFile || dest.isDirectory) && dest.isDirectory) {\n      if (deleteOrig) {\n        src.moveTo(dest, newName, opt_successCallback, opt_errorHandler);\n      } else {\n        src.copyTo(dest, newName, opt_successCallback, opt_errorHandler);\n      }\n    } else {\n      getEntry_(src, dest, function(srcEntry, destDir) {\n        if (!destDir.isDirectory) {\n          var e = new Error('Oops! \"' + destDir.name + ' is not a directory!');\n          if (opt_errorHandler) {\n            opt_errorHandler(e);\n          } else {\n            throw e;\n          }\n          return;\n        }\n        if (deleteOrig) {\n          srcEntry.moveTo(destDir, newName, opt_successCallback, opt_errorHandler);\n        } else {\n          srcEntry.copyTo(destDir, newName, opt_successCallback, opt_errorHandler);\n        }\n      }, opt_errorHandler);\n    }\n  }\n\n  function Filer(fs) {\n    fs_  = fs || null;\n    if (fs_) {\n      cwd_ = fs_.root;\n      isOpen_ = true; // TODO: this may not be the case.\n    }\n  }\n\n  Filer.DEFAULT_FS_SIZE = DEFAULT_FS_SIZE;\n  Filer.version = '0.4.3';\n\n  Filer.prototype = {\n    get fs() {\n      return fs_;\n    },\n    get isOpen() {\n      return isOpen_;\n    },\n    get cwd() {\n      return cwd_;\n    }\n  }\n\n  /**\n   * Constructs and returns a filesystem: URL given a path.\n   *\n   * @param {string=} path The path to construct a URL for.\n   *     size {int=} The storage size (in bytes) to open the filesystem with.\n   *         Defaults to DEFAULT_FS_SIZE.\n   * @return {string} The filesystem: URL.\n   */\n  Filer.prototype.pathToFilesystemURL = function(path) {\n    return pathToFsURL_(path);\n  }\n\n  /**\n   * Initializes (opens) the file system.\n   *\n   * @param {object=} opt_initObj Optional object literal with the following\n   *     properties. Note: If {} or null is passed, default values are used.\n   *     persistent {Boolean=} Whether the browser should use persistent quota.\n   *         Default is false.\n   *     size {int=} The storage size (in bytes) to open the filesystem with.\n   *         Defaults to DEFAULT_FS_SIZE.\n   * @param {Function=} opt_successCallback Optional success handler passed a\n   *      DOMFileSystem object.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.init = function(opt_initObj, opt_successCallback,\n                                  opt_errorHandler) {\n    if (!self.requestFileSystem) {\n      throw new MyFileError({\n        code: FileError.BROWSER_NOT_SUPPORTED,\n        name: 'BROWSER_NOT_SUPPORTED'\n      });\n    }\n\n    var initObj = opt_initObj ? opt_initObj : {}; // Use defaults if obj is null.\n\n    var size = initObj.size || DEFAULT_FS_SIZE;\n    this.type = self.TEMPORARY;\n    if ('persistent' in initObj && initObj.persistent) {\n      this.type = self.PERSISTENT;\n    }\n\n    var init = function(fs) {\n      this.size = size;\n      fs_ = fs;\n      cwd_ = fs_.root;\n      isOpen_ = true;\n\n      opt_successCallback && opt_successCallback(fs);\n    };\n\n    if (this.type == self.PERSISTENT && !!navigator.persistentStorage) {\n      navigator.persistentStorage.requestQuota(size, function(grantedBytes) {\n        self.requestFileSystem(\n            this.type, grantedBytes, init.bind(this), opt_errorHandler);\n      }.bind(this), opt_errorHandler);\n    } else {\n      self.requestFileSystem(\n          this.type, size, init.bind(this), opt_errorHandler);\n    }\n  };\n\n  /**\n   * Reads the contents of a directory.\n   *\n   * @param {string|DirectoryEntry} dirEntryOrPath A path relative to the\n   *     current working directory. In most cases that is the root entry, unless\n   *     cd() has been called. A DirectoryEntry or filesystem URL can also be\n   *     passed, in which case, the folder's contents will be returned.\n   * @param {Function} successCallback Success handler passed an Array<Entry>.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.ls = function(dirEntryOrPath, successCallback,\n                                opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    var callback = function(dirEntry) {\n      // Read contents of current working directory. According to spec, need to\n      // keep calling readEntries() until length of result array is 0. We're\n      // guarenteed the same entry won't be returned again.\n      var entries_ = [];\n      var reader = dirEntry.createReader();\n\n      var readEntries = function() {\n        reader.readEntries(function(results) {\n          if (!results.length) {\n            // By default, sort the list by name.\n            entries_.sort(function(a, b) {\n              return a.name < b.name ? -1 : b.name < a.name ? 1 : 0;\n            });\n            successCallback(entries_);\n          } else {\n            entries_ = entries_.concat(Util.toArray(results));\n            readEntries();\n          }\n        }, opt_errorHandler);\n      };\n\n      readEntries();\n    };\n\n    if (dirEntryOrPath.isDirectory) { // passed a DirectoryEntry.\n      callback(dirEntryOrPath);\n    } else if (isFsURL_(dirEntryOrPath)) { // passed a filesystem URL.\n      getEntry_(dirEntryOrPath, null, callback, opt_errorHandler);\n    } else { // Passed a path. Look up DirectoryEntry and proceeed.\n      // TODO: Find way to use getEntry_(callback, dirEntryOrPath); with cwd_.\n      cwd_.getDirectory(dirEntryOrPath, {}, callback, opt_errorHandler);\n    }\n  };\n\n  /**\n   * Creates a new directory.\n   *\n   * @param {string} path The name of the directory to create. If a path is\n   *     given, each intermediate dir is created (e.g. similar to mkdir -p).\n   * @param {bool=} opt_exclusive True if an error should be thrown if\n   *     one or more of the directories already exists. False by default.\n   * @param {Function} opt_successCallback Success handler passed the\n   *     DirectoryEntry that was created. If we were passed a path, the last\n   *     directory that was created is passed back.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.mkdir = function(path, opt_exclusive, opt_successCallback,\n                                   opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    var exclusive = opt_exclusive != null ? opt_exclusive : false;\n\n    var folderParts = path.split('/');\n\n    var createDir = function(rootDir, folders) {\n      // Throw out './' or '/' and move on. Prevents: '/foo/.//bar'.\n      if (folders[0] == '.' || folders[0] == '') {\n        folders = folders.slice(1);\n      }\n\n      rootDir.getDirectory(folders[0], {create: true, exclusive: exclusive},\n        function (dirEntry) {\n          if (dirEntry.isDirectory) { // TODO: check shouldn't be necessary.\n            // Recursively add the new subfolder if we have more to create and\n            // There was more than one folder to create.\n            if (folders.length && folderParts.length != 1) {\n              createDir(dirEntry, folders.slice(1));\n            } else {\n              // Return the last directory that was created.\n              if (opt_successCallback) opt_successCallback(dirEntry);\n            }\n          } else {\n            var e = new Error(path + ' is not a directory');\n            if (opt_errorHandler) {\n              opt_errorHandler(e);\n            } else {\n              throw e;\n            }\n          }\n        },\n        function(e) {\n          if (e.code == FileError.INVALID_MODIFICATION_ERR) {\n            e.message = \"'\" + path + \"' already exists\";\n            if (opt_errorHandler) {\n              opt_errorHandler(e);\n            } else {\n              throw e;\n            }\n          }\n        }\n      );\n    };\n\n    createDir(cwd_, folderParts);\n  };\n\n  /**\n   * Looks up and return a File for a given file entry.\n   *\n   * @param {string|FileEntry} entryOrPath A path, filesystem URL, or FileEntry\n   *     of the file to lookup.\n   * @param {Function} successCallback Success callback passed the File object.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.open = function(entryOrPath, successCallback, opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    if (entryOrPath.isFile) {\n      entryOrPath.file(successCallback, opt_errorHandler);\n    } else {\n      getEntry_(pathToFsURL_(entryOrPath), null, function(fileEntry) {\n        fileEntry.file(successCallback, opt_errorHandler);\n      }, opt_errorHandler);\n    }\n  };\n\n  /**\n   * Creates an empty file.\n   *\n   * @param {string} path The relative path of the file to create, from the\n   *     current working directory.\n   * @param {bool=} opt_exclusive True (default) if an error should be thrown if\n   *     the file already exists.\n   * @param {Function} successCallback A success callback, which is passed\n   *     the new FileEntry.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.create = function(path, opt_exclusive, successCallback,\n                                    opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    var exclusive = opt_exclusive != null ? opt_exclusive : true;\n\n    cwd_.getFile(path, {create: true,  exclusive: exclusive}, successCallback,\n      function(e) {\n        if (e.code == FileError.INVALID_MODIFICATION_ERR) {\n          e.message = \"'\" + path + \"' already exists\";\n        }\n        if (opt_errorHandler) {\n          opt_errorHandler(e);\n        } else {\n          throw e;\n        }\n      }\n    );\n  };\n\n  /**\n    * Moves a file or directory.\n    *\n    * @param {string|FileEntry|DirectoryEntry} src The file/directory\n    *     to move. If src is a string, a path or filesystem: URL is accepted.\n    * @param {string|DirectoryEntry} dest The directory to move the src into.\n    *     If dest is a string, a path or filesystem: URL is accepted.\n    *     Note: dest needs to be the same type as src.\n    * @param {string=} opt_newName An optional new name for the moved entry.\n    * @param {Function=} opt_successCallback Optional callback passed the moved\n    *     entry on a successful move.\n    * @param {Function=} opt_errorHandler Optional error callback.\n    */\n  Filer.prototype.mv = function(src, dest, opt_newName, opt_successCallback,\n                                opt_errorHandler) {\n    copyOrMove_.bind(this, src, dest, opt_newName, opt_successCallback,\n                     opt_errorHandler, true)();\n  };\n\n  /**\n   * Deletes a file or directory entry.\n   *\n   * @param {string|FileEntry|DirectoryEntry} entryOrPath The file or directory\n   *     to remove. If entry is a DirectoryEntry, its contents are removed\n   *     recursively. If entryOrPath is a string, a path or filesystem: URL is\n   *     accepted.\n   * @param {Function} successCallback Zero arg callback invoked on\n   *     successful removal.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.rm = function(entryOrPath, successCallback,\n                                opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    var removeIt = function(entry) {\n      if (entry.isFile) {\n        entry.remove(successCallback, opt_errorHandler);\n      } else if (entry.isDirectory) {\n        entry.removeRecursively(successCallback, opt_errorHandler);\n      }\n    };\n\n    if (entryOrPath.isFile || entryOrPath.isDirectory) {\n      removeIt(entryOrPath);\n    } else {\n      getEntry_(entryOrPath, null, removeIt, opt_errorHandler);\n    }\n  };\n\n  /**\n   * Changes the current working directory.\n   *\n   * @param {string|DirectoryEntry} dirEntryOrPath A DirectoryEntry to move into\n   *     or a path relative to the current working directory. A filesystem: URL\n   *     is also accepted\n   * @param {Function=} opt_successCallback Optional success callback, which is\n   *     passed the DirectoryEntry of the new current directory.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.cd = function(dirEntryOrPath, opt_successCallback,\n                                opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    if (dirEntryOrPath.isDirectory) {\n      cwd_ = dirEntryOrPath;\n      opt_successCallback && opt_successCallback(cwd_);\n    } else {\n      // Build a filesystem: URL manually if we need to.\n      dirEntryOrPath = pathToFsURL_(dirEntryOrPath);\n      getEntry_(dirEntryOrPath, null, function(dirEntry) {\n        if (dirEntry.isDirectory) {\n          cwd_ = dirEntry;\n          opt_successCallback && opt_successCallback(cwd_);\n        } else {\n          var e = new Error(NOT_A_DIRECTORY);\n          if (opt_errorHandler) {\n            opt_errorHandler(e);\n          } else {\n            throw e;\n          }\n        }\n      }, opt_errorHandler);\n    }\n  };\n\n  /**\n    * Copies a file or directory to a destination.\n    *\n    * @param {string|FileEntry|DirectoryEntry} src The file/directory\n    *     to copy. If src is a string, a path or filesystem: URL is accepted.\n    * @param {string|DirectoryEntry} dest The directory to copy the src into.\n    *     If dest is a string, a path or filesystem: URL is accepted.\n    *     Note: dest needs to be the same type as src.\n    * @param {string=} opt_newName An optional name for the copied entry.\n    * @param {Function=} opt_successCallback Optional callback passed the moved\n    *     entry on a successful copy.\n    * @param {Function=} opt_errorHandler Optional error callback.\n    */\n  Filer.prototype.cp = function(src, dest, opt_newName, opt_successCallback,\n                                opt_errorHandler) {\n    copyOrMove_.bind(this, src, dest, opt_newName, opt_successCallback,\n                     opt_errorHandler)();\n  };\n\n  /**\n   * Writes data to a file.\n   *\n   * If the file already exists, its contents are overwritten.\n   *\n   * @param {string|FileEntry} entryOrPath A path, filesystem URL, or FileEntry\n    *     of the file to lookup.\n   * @param {object} dataObj The data to write. Example:\n   *     {data: string|Blob|File|ArrayBuffer, type: mimetype, append: true}\n   *     If append is specified, data is appended to the end of the file.\n   * @param {Function} opt_successCallback Success callback, which is passed\n   *     the created FileEntry and FileWriter object used to write the data.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.write = function(entryOrPath, dataObj, opt_successCallback,\n                                   opt_errorHandler) {\n    if (!fs_) {\n      throw new Error(FS_INIT_ERROR_MSG);\n    }\n\n    var writeFile_ = function(fileEntry) {\n      fileEntry.createWriter(function(fileWriter) {\n\n        fileWriter.onerror = opt_errorHandler;\n\n        if (dataObj.append) {\n          fileWriter.onwriteend = function(e) {\n            if (opt_successCallback) opt_successCallback(fileEntry, this);\n          };\n\n          fileWriter.seek(fileWriter.length); // Start write position at EOF.\n        } else {\n          var truncated = false;\n          fileWriter.onwriteend = function(e) {\n            // Truncate file to newly written file size.\n            if (!truncated) {\n              truncated = true;\n              this.truncate(this.position);\n              return;\n            }\n            if (opt_successCallback) opt_successCallback(fileEntry, this);\n          };\n        }\n\n        if (dataObj instanceof Blob) {\n          fileWriter.write(dataObj);\n        } else {\n          // Blob() takes ArrayBufferView, not ArrayBuffer.\n          if (dataObj.data.__proto__ == ArrayBuffer.prototype) {\n            dataObj.data = new Uint8Array(dataObj.data);\n          }\n          var blob = new Blob([dataObj.data],\n                              dataObj.type ? {type: dataObj.type} : {});\n\n          fileWriter.write(blob);\n        }\n\n      }, opt_errorHandler);\n    };\n\n    if (entryOrPath.isFile) {\n      writeFile_(entryOrPath);\n    } else if (isFsURL_(entryOrPath)) {\n      getEntry_(entryOrPath, null, writeFile_, opt_errorHandler);\n    } else {\n      cwd_.getFile(entryOrPath, {create: true, exclusive: false}, writeFile_,\n                   opt_errorHandler);\n    }\n  };\n\n  /**\n   * Displays disk space usage.\n   *\n   * @param {Function} successCallback Success callback, which is passed\n   *     Used space, Free space and Currently allocated total space in bytes.\n   * @param {Function=} opt_errorHandler Optional error callback.\n   */\n  Filer.prototype.df = function(successCallback, opt_errorHandler) {\n    var queryCallback = function(byteUsed, byteCap) {\n      successCallback(byteUsed, byteCap - byteUsed, byteCap);\n    }\n\n    if (!(navigator.temporaryStorage.queryUsageAndQuota && navigator.persistentStorage.queryUsageAndQuota)) {\n      throw new Error(NOT_IMPLEMENTED_MSG);\n    }\n\n    if (self.TEMPORARY == this.type) {\n      navigator.temporaryStorage.queryUsageAndQuota(queryCallback, opt_errorHandler);\n    } else if (self.PERSISTENT == this.type) {\n      navigator.persistentStorage.queryUsageAndQuota(queryCallback, opt_errorHandler);\n    }\n  };\n\n  Filer.prototype.getEntry = function (fileName, callback, errback) {\n      getEntry_(fileName, null, callback, errback);\n  };\n\n  return Filer;\n};\n\nmodule.exports = Filer;\n\n// Import as 'static' methods.\nmodule.exports.dataURLToBlob = Util.dataURLToBlob.bind({});\nmodule.exports.fileToObjectURL = Util.fileToObjectURL.bind({});\n\n\n\n// WEBPACK FOOTER //\n// ./libs/filer.js","'use strict';\n\nconst colorsHandler = require('./colors-handler');\nconst filerHandler = require('./filer-handler');\nconst speechkitHandler = require('./speechkit-handler');\nconst xmlHandler = require('./xml-handler');\n\nconst handlers = [colorsHandler, filerHandler, speechkitHandler, xmlHandler];\n\nclass Messaging {\n    constructor() {}\n\n    init() {\n        this._handleConnection = this._getConnectionHandler().bind(this);\n        chrome.runtime.onConnect.addListener(this._handleConnection);\n    }\n\n    _getConnectionHandler() {\n        return (port) => {\n            if (port.name === 'offscreen') { \n                port.onMessage.addListener((req) => {\n                    if (req.data) {\n                        req.data.sendResponse = (message) => {\n                            if (typeof message === 'object') {\n                                message.id = req.id;\n                            }\n                            port.postMessage(message);\n                        };\n                        for (const handler of handlers) {\n                            if (handler.handle(req, port.sender)) {\n                                return;\n                            }\n                        }\n                    }\n                });\n            }\n        };\n    }\n};\n\nmodule.exports = new Messaging();\n\n\n\n// WEBPACK FOOTER //\n// ./modules/offscreen/messaging.js","'use strict';\n\nconst {speechkit} = require('speechkit').ya;\nconst {UTTERANCE_SILENCE, API_KEY} = require('../voice/consts');\nconst events = require('./events');\n\nclass SpeechkitHandler {\n    constructor() {}\n\n    /**\n     * Handles speechkit.start method call.\n     * @param {Object} params\n     * @private\n     */\n    _init({sendResponse}) {\n        this.streamer = new speechkit.SpeechRecognition();\n\n        this.streamer.start({\n            apiKey: API_KEY,\n            initCallback: () => sendResponse({}),\n            errorCallback: error => {\n                sendResponse({\n                    type: events.offscreen.SPEECHKIT_ERROR,\n                    data: {reason: error.message},\n                });\n            },\n            dataCallback: (text, done) => {\n                sendResponse({\n                    type: events.offscreen.SPEECHKIT_DATA,\n                    data: {text, done},\n                });\n            },\n            utteranceSilence: UTTERANCE_SILENCE,\n            particialResults: true,\n        });\n    }\n\n    /**\n     * Handles speechkit.stop method call.\n     * @param {Object} params\n     * @private\n     */\n    _stop({sendResponse}) {\n        try {\n            // Streamer may throw websocket close error.\n            if (this.streamer) {\n                this.streamer.stop();\n            }\n        } catch (e) {\n            // do nothing\n        } finally {\n            sendResponse({});\n        }\n    }\n\n\n    handle(req, _sender) {\n        switch (req.type) {\n            case events.backend.SPEECHKIT_INIT:\n                this._init(req.data);\n                break;\n            case events.backend.SPEECHKIT_STOP:\n                this._stop(req.data);\n                break;\n            default:\n                // Cannot handle.\n                return;\n        }\n\n        // Indicate an async response.\n        return true;\n    }\n};\n\nmodule.exports = new SpeechkitHandler();\n\n\n\n// WEBPACK FOOTER //\n// ./modules/offscreen/speechkit-handler.js","var speechkitNamespace = {\n    ya: {\n        speechkit: {}\n    }\n};\n\n(function (namespace) {\n    'use strict';\n\n\n    namespace.ya.speechkit.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n    /** Набор поддерживаемых форматов аудио.\n     * @readonly\n     * @enum\n     * @memberof ya.speechkit\n     */\n    namespace.ya.speechkit.FORMAT = {\n        /** PCM 8KHz дает плохое качество распознавания, но малый объем передаваемых на сервер данных */\n        PCM8: {format: 'pcm', sampleRate: 8000, mime: 'audio/x-pcm;bit=16;rate=8000', bufferSize: 1024},\n        /** PCM 16 KHz наилучшее качество распознавания при среднем объеме данных */\n        PCM16: {format: 'pcm', sampleRate: 16000, mime: 'audio/x-pcm;bit=16;rate=16000', bufferSize: 2048},\n        /** PCM 44 KHz большой размер передаваемых данных, возможны задержки на узком канале */\n        PCM44: {format: 'pcm', sampleRate: 44100, mime: 'audio/x-pcm;bit=16;rate=44100', bufferSize: 4096},\n    };\n\n    /** Media stream used by SpeechKit\n     * @private\n     * @memberof ya.speechkit\n     */\n    namespace.ya.speechkit._stream = null;\n\n    /**\n     * Deep copies fileds from object 'from' to object 'to'\n     * @param {Object} from Source object\n     * @param {Object} to Destination object\n     * @private\n     */\n    namespace.ya.speechkit._extend = function (to, from) {\n        var i;\n        var toStr = Object.prototype.toString;\n        var astr = '[object Array]';\n        to = to || {};\n\n        for (i in from) {\n            if (from.hasOwnProperty(i)) {\n                if (typeof from[i] === 'object') {\n                    to[i] = (toStr.call(from[i]) === astr) ? [] : {};\n                    namespace.ya.speechkit._extend(to[i], from[i]);\n                } else if (typeof from[i] !== 'undefined' || typeof to[i] === 'undefined') {\n                    to[i] = from[i];\n                }\n            }\n        }\n        return to;\n    };\n\n    /**\n     * Создает объект для записи аудио-сигнала с микрофона.\n     * @class Класс, управляющий записью звука с микрофона.\n     * @name Recorder\n     */\n    var Recorder = function ()\n    {\n        if (!namespace.ya.speechkit._stream) {\n            return null;\n        }\n\n        if (!(this instanceof Recorder)) {\n            return new Recorder();\n        }\n\n        this.worker = namespace.ya.speechkit.newWorker();\n\n        this.recording = false;\n\n        this.paused = false;\n        this.lastDataOnPause = 0;\n\n        this.nullsArray = [];\n\n        this.currCallback = null;\n        this.buffCallback = null;\n        this.startCallback = null;\n\n        this.worker.onmessage = function (e) {\n            if (e.data.command == 'int16stream')\n            {\n                var data = e.data.buffer;\n\n                if (this.startCallback) {\n                    this.startCallback(data);\n                }\n            } else if (e.data.command == 'getBuffers' && this.buffCallback) {\n                this.buffCallback(e.data.blob);\n            } else if (e.data.command == 'clear' && this.currCallback) {\n                this.currCallback();\n            } else if (this.currCallback) {\n                this.currCallback(e.data.blob);\n            }\n        }.bind(this);\n\n    };\n\n    Recorder.prototype = /** @lends Recorder.prototype */ {\n        /**\n         * Creates an input point for a given audio format (sets samplerate and buffer size\n         * @param {ya.speechkit.FORMAT} format audio format (it's samplerate and bufferSize are being used)\n         * @private\n         */\n        _createNode: function (format) {\n            if (!namespace.ya.speechkit.audiocontext) {\n                namespace.ya.speechkit.audiocontext = new namespace.ya.speechkit.AudioContext();\n            }\n\n            this.audioInput = namespace.ya.speechkit.audiocontext.createMediaStreamSource(\n                namespace.ya.speechkit._stream);\n\n            if (!namespace.ya.speechkit.audiocontext.createScriptProcessor) {\n                this.node = namespace.ya.speechkit.audiocontext.createJavaScriptNode(format.bufferSize, 2, 2);\n            } else {\n                this.node = namespace.ya.speechkit.audiocontext.createScriptProcessor(format.bufferSize, 2, 2);\n            }\n\n            this.audioInput.connect(this.node);\n            this.node.onaudioprocess = function (e) {\n                if (!this.recording) {return;}\n\n                if (this.paused) {\n                    if (Number(new Date()) - this.lastDataOnPause > 2000) {\n                        this.lastDataOnPause = Number(new Date());\n                        this.worker.postMessage({\n                            command: 'record',\n                            buffer: [\n                                this.nullsArray,\n                                this.nullsArray\n                            ]\n                        });\n                    }\n                } else {\n                    this.worker.postMessage({\n                        command: 'record',\n                        buffer: [\n                            e.inputBuffer.getChannelData(0),\n                            e.inputBuffer.getChannelData(1)\n                        ]\n                    });\n                }\n            }.bind(this);\n\n            this.node.connect(namespace.ya.speechkit.audiocontext.destination);\n        },\n        /**\n         * Ставит запись звука на паузу.\n         * Во время паузы на сервер будут отправляться периодически запросы с пустым звуком, чтобы сервер не обрывал сессию.\n         */\n        pause: function () {\n            this.paused = true;\n            this.lastDataOnPause = Number(new Date());\n        },\n        /**\n         * @returns {AudioContext} Текущий <xref scope=\"external\" locale=\"ru\" href=\"https://developer.mozilla.org/ru/docs/Web/API/AudioContext\">\n         * AudioContext</xref><xref scope=\"external\" locale=\"en-com\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/AudioContext\">AudioContext</xref>,\n         * с которого записывается звук.\n         */\n        getAudioContext: function () {\n            return namespace.ya.speechkit.audiocontext;\n        },\n        /**\n         * @returns {AnalyserNode} <xref scope=\"external\" locale=\"ru\" href=\"https://developer.mozilla.org/ru/docs/Web/API/AnalyserNode\">\n         * AnalyserNode</xref><xref scope=\"external\" locale=\"en-com\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode\">\n         * AnalyserNode</xref> — объект, предназначенный для анализа аудио-сигнала в реальном времени.\n         */\n        getAnalyserNode: function () {\n            if (!namespace.ya.speechkit.audiocontext) {\n                namespace.ya.speechkit.audiocontext = new namespace.ya.speechkit.AudioContext();\n            }\n            var analyserNode = namespace.ya.speechkit.audiocontext.createAnalyser();\n            analyserNode.fftSize = 2048;\n            this.audioInput.connect(analyserNode);\n            return analyserNode;\n        },\n        /**\n         * @returns {Boolean} true, если запись звука стоит на паузе, false — в противном случае.\n         */\n        isPaused: function () {\n            return this.paused;\n        },\n        /**\n         * Начинает запись звука с микрофона.\n         * @param {callback:streamCallback} cb Функция-обработчик, в которую будет передаваться записанный аудио-поток.\n         * @param {ya.speechkit.FORMAT} [format=PCM16] Формат для записи аудио-сигнала. Доступные значения:\n         * <ul>\n         *     <li> PCM8 — плохое качество распознавания, но малый объем передаваемых на сервер данных;</li>\n         *     <li> PCM16 — наилучшее качество распознавания при среднем объеме данных; </li>\n         *     <li> PCM44 — большой размер передаваемых данных, возможны задержки на узком канале.</li>\n         *</ul>\n         */\n        start: function (cb, format) {\n            var backref = this;\n            if (!namespace.ya.speechkit._stream) {\n                return namespace.ya.speechkit.initRecorder(function () {backref.start(cb, format);}, console.log);\n            }\n\n            if (!this.node) {\n                this._createNode(format);\n            }\n\n            if (this.isPaused()) {\n                this.paused = false;\n                return;\n            }\n            if (typeof cb !== 'undefined') {\n                this.startCallback = cb;\n            } else {\n                this.startCallback = null;\n            }\n            this.worker.postMessage({\n                command: 'init',\n                config: {\n                    sampleRate: namespace.ya.speechkit.audiocontext.sampleRate,\n                    format: format || namespace.ya.speechkit.FORMAT.PCM16,\n                    channels: this.channelCount,\n                }\n            });\n\n            this.nullsArray = [];\n            var bufferLen = (format || namespace.ya.speechkit.FORMAT.PCM16).bufferSize;\n            for (var i = 0; i < bufferLen; i++) {\n                this.nullsArray.push(0);\n            }\n\n            this.clear(function () {this.recording = true;}.bind(this));\n        },\n        /**\n         * Останавливает запись звука.\n         * @param {callback:wavCallback} cb Функция-обработчик, в которую будет передан объект <xref href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" scope=\"external\">Blob</xref>\n         * с записанным аудио в формате wav.\n         * @param {Number} [channelCount=2] Сколько каналов должно быть в wav-файле: 1 — mono, 2 — stereo.\n         */\n        stop: function (cb, channelCount) {\n            this.recording = false;\n            if (this.node) {\n                this.node.disconnect();\n            }\n\n            this.node = null;\n            this.startCallback = null;\n            \n            if (namespace.ya.speechkit._stream &&\n                namespace.ya.speechkit._stream.getAudioTracks) {\n                namespace.ya.speechkit._stream.getAudioTracks()[0].stop();\n            } else if (namespace.ya.speechkit._stream &&\n                typeof namespace.ya.speechkit._stream.stop !== 'undefined') {\n                namespace.ya.speechkit._stream.stop();\n            }\n            namespace.ya.speechkit._stream = null;\n            if (typeof namespace.ya.speechkit.audiocontext !== 'undefined' &&\n                namespace.ya.speechkit.audiocontext !== null &&\n                typeof namespace.ya.speechkit.audiocontext.close !== 'undefined') {\n                namespace.ya.speechkit.audiocontext.close();\n                namespace.ya.speechkit.audiocontext = null;\n            }\n\n            if (typeof cb !== 'undefined') {\n                this.exportWav(function (blob) {\n                    cb(blob);\n                }, channelCount || 2);\n            }\n        },\n        /**\n         * @returns {Boolean} true, если идет запись звука, false — если запись стоит в режиме паузы.\n         */\n        isRecording: function () {\n            return this.recording;\n        },\n        /**\n         * Очищает буферы с записанным аудио-сигналом.\n         * @param {callback:clearCallback} cb Функция-обработчик, которая будет вызвана, когда произойдет очистка.\n         */\n        clear: function (cb) {\n            if (typeof cb !== 'undefined') {\n                this.currCallback = cb;\n            } else {\n                this.currCallback = null;\n            }\n            this.worker.postMessage({command: 'clear'});\n        },\n        /**\n         * Метод для получения буферов с записанным аудио-сигналом.\n         * @param {callback:buffersCallback} cb Функция, в которую будут переданы буферы с аудио-сигналом.\n         */\n        getBuffers: function (cb) {\n            if (typeof cb !== 'undefined') {\n                this.buffCallback = cb;\n            } else {\n                this.buffCallback = null;\n            }\n            this.worker.postMessage({command: 'getBuffers'});\n        },\n        /**\n         * Экспортирует записанный звук в wav-файл.\n         * @param {callback:wavCallback} cb Функция, в которую будет передан объект <xref href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" scope=\"external\">Blob</xref> с файлом.\n         * @param {Number} [channelCount=1] Количество каналов в wav-файле: 1 — mono, 2 — stereo.\n         */\n        exportWav: function (cb, channelCount) {\n            if (typeof cb !== 'undefined') {\n                this.currCallback = cb;\n            } else {\n                this.currCallback = null;\n            }\n            var type = 'audio/wav';\n\n            if (!this.currCallback) {throw new Error('Callback not set');}\n\n            var exportCommand = 'export' + (channelCount != 2 && 'Mono' || '') + 'WAV';\n\n            this.worker.postMessage({\n                command: exportCommand,\n                type: type\n            });\n        }\n    };\n\n    namespace.ya.speechkit.Recorder = Recorder;\n\n    namespace.ya.speechkit.getUserMedia = navigator.getUserMedia ||\n        navigator.mozGetUserMedia ||\n        navigator.msGetUserMedia ||\n        navigator.webkitGetUserMedia;\n\n    namespace.ya.speechkit.mediaDevices = (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) ?\n        navigator.mediaDevices :\n        (namespace.ya.speechkit.getUserMedia ? {\n            getUserMedia: function (c) {\n                return new Promise(function (y, n) {\n                    namespace.ya.speechkit.getUserMedia.call(navigator, c, y, n);\n                });\n            }\n        } : null);\n\n    namespace.ya.speechkit._stream = null;\n    namespace.ya.speechkit.audiocontext = null;\n\n    /**\n     * Запрашивает у пользователя права для записи звука с микрофона.\n     * @param {callback:initSuccessCallback} initSuccess Функция-обработчик, которая будет вызвана при успешном подключении к микрофону.\n     * @param {callback:initFailCallback} initFail Функция-обработчик, в которую будет передано сообщения об ошибке, в случае неуспеха.\n     */\n    namespace.ya.speechkit.initRecorder = function (initSuccess, initFail)\n    {\n        var badInitialization = function (err) {\n            namespace.ya.speechkit._stream = null;\n            if (typeof initFail !== 'undefined') {\n                initFail(err);\n            }\n        };\n\n        if (namespace.ya.speechkit.mediaDevices)\n        {\n            namespace.ya.speechkit.mediaDevices.getUserMedia(\n                {audio: true}).then(\n                function (stream) {\n                    namespace.ya.speechkit._stream = stream;\n                    if (typeof initSuccess !== 'undefined') {\n                        initSuccess();\n                    }\n                }).catch(\n                function (err) {\n                    badInitialization(err.message || err.name || err);\n                });\n        } else {\n            badInitialization('Your browser doesn\\'t support Web Audio API. ' +\n                'Please, use Yandex.Browser: https://browser.yandex.ru');\n        }\n    };\n\n    /**\n     * Поддерживается ли рапознавание заданного языка.\n     * @return true, если язык поддерживается, false — иначе.\n     */\n    namespace.ya.speechkit.isLanguageSupported = function (lang)\n    {\n        if (namespace.ya.speechkit.settings.langWhitelist.indexOf(lang) >= 0) {\n            return namespace.ya.speechkit.isSupported();\n        } else {\n            return namespace.ya.speechkit.isWebAudioSupported();\n        }\n    };\n\n    /**\n     * Поддерживаются ли технологии рапознавания Яндекса.\n     * @return true, если поддерживаются, false — иначе.\n     */\n    namespace.ya.speechkit.isSupported = function ()\n    {\n        var userAgent = navigator.userAgent.toLowerCase();\n        // Yandex recognition is 100% supported on mobile devices only in firefox\n        return ((namespace.ya.speechkit.mediaDevices !== null) &&\n        ((/mozilla|firefox/.test(userAgent) && !/yabrowser/.test(userAgent)) ||\n        !/iphone|ipod|ipad|android|blackberry/.test(userAgent)));\n    };\n\n    /**\n     * Поддерживается ли рапознавание с помощью WebAudio API.\n     * @return true, если поддерживается, false — иначе.\n     */\n    namespace.ya.speechkit.isWebAudioSupported = function ()\n    {\n        var userAgent = navigator.userAgent.toLowerCase();\n        var SpeechRecognition = namespace.SpeechRecognition || namespace.webkitSpeechRecognition;\n        // Native recognition is only supported in original chrome and chromium\n        return (typeof SpeechRecognition !== 'undefined' && !/yabrowser|opera|opr/.test(userAgent));\n    };\n\n\n    /**\n     * Функция, которая будет вызвана по факту успешного получения прав на доступ к микрофону.\n     * @callback\n     * @name initSuccessCallback\n     * @memberof Recorder\n     */\n\n    /**\n     * Функция-обработчик, которая будет вызвана при возникновении ошибки при получении доступа к микрофону.\n     * @callback initFailCallback\n     * @param {String} error Сообщение об ошибке.\n     * @memberof Recorder\n     */\n\n    /**\n     * Функция для <xref href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" scope=\"external\">Blob</xref> с wav-файлом.\n     * @callback\n     * @name wavCallback\n     * @param {<xref href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" scope=\"external\">Blob</xref> с MIME типом audio/wav} data wav-файл.\n     * @memberof Recorder\n     */\n\n    /**\n     * Функция-обработчик, в которую будут переданы буферы записанного аудио.\n     * @callback\n     * @name buffersCallback\n     * @param {Float32Array[]} buffers Буферы записанного аудио для двух каналов (моно и стерео).\n     * @memberof Recorder\n     */\n\n    /**\n     * Функция, которая будет вызвана после очистки буферов (это сигнал готовности к повторному запуску).\n     * @callback\n     * @name clearCallback\n     * @memberof Recorder\n     */\n\n    /**\n     * Функция-обработчик, в которую будет передаваться записанный аудио-поток.\n     * @callback\n     * @name streamCallback\n     * @param {ArrayBuffer} stream Записанный PCM поток 16-bit.\n     * @memberof Recorder\n     */\n\n}(speechkitNamespace));\n(function (namespace) {\n    'use strict';\n\n\n    function _makeWorker(script) {\n        var URL = window.URL || window.webkitURL;\n        var Blob = window.Blob;\n        var Worker = window.Worker;\n\n        if (!URL || !Blob || !Worker || !script) {\n            return null;\n        }\n\n        var blob = new Blob([script], {type: 'application/javascript'});\n        var worker = new Worker(URL.createObjectURL(blob));\n        return worker;\n    }\n\n    var inline_worker =\n        \"function iirFilter (sampleRate, cutoff, resonance, type) {\" +\n        \"\" +\n        \"    var\tself\t= this,\" +\n        \"            f\t= [0.0, 0.0, 0.0, 0.0],\" +\n        \"            freq, damp,\" +\n        \"            prevCut, prevReso,\" +\n        \"\" +\n        \"            sin\t= Math.sin,\" +\n        \"            min\t= Math.min,\" +\n        \"            pow\t= Math.pow;\" +\n        \"\" +\n        \"    self.cutoff = cutoff || 20000;\" +\n        \"    self.resonance = resonance || 0.1;\" +\n        \"    self.samplerate = sampleRate || 44100;\" +\n        \"    self.type = type || 0;\" +\n        \"\" +\n        \"    function calcCoeff () {\" +\n        \"            freq = 2 * sin(Math.PI * min(0.25, self.cutoff / (self.samplerate * 2)));\" +\n        \"            damp = min(2 * (1 - pow(self.resonance, 0.25)), min(2, 2 / freq - freq * 0.5));\" +\n        \"    }\" +\n        \"\" +\n        \"    self.pushSample = function (sample) {\" +\n        \"            if (prevCut !== self.cutoff || prevReso !== self.resonance){\" +\n        \"                    calcCoeff();\" +\n        \"                    prevCut = self.cutoff;\" +\n        \"                    prevReso = self.resonance;\" +\n        \"            }\" +\n        \"\" +\n        \"            f[3] = sample - damp * f[2];\" +\n        \"            f[0] = f[0] + freq * f[2];\" +\n        \"            f[1] = f[3] - f[0];\" +\n        \"            f[2] = freq * f[1] + f[2];\" +\n        \"\" +\n        \"            f[3] = sample - damp * f[2];\" +\n        \"            f[0] = f[0] + freq * f[2];\" +\n        \"            f[1] = f[3] - f[0];\" +\n        \"            f[2] = freq * f[1] + f[2];\" +\n        \"\" +\n        \"            return f[self.type];\" +\n        \"    };\" +\n        \"\" +\n        \"    self.getMix = function (type) {\" +\n        \"            return f[type || self.type];\" +\n        \"    };\" +\n        \"}\" +\n        \"\" +\n        \"var speex_loaded = false;\" +\n        \"var recLength = 0;\" +\n        \"var recBuffersL = [];\" +\n        \"var recBuffersR = [];\" +\n        \"var sampleRate;\" +\n        \"var outSampleRate;\" +\n        \"var tmp_buf = 0;\" +\n        \"var need_buf_size = 4096;\" +\n        \"var speex_converter = null;\" +\n        \"    \" +\n        \"this.onmessage = function (e) {\" +\n        \"    switch (e.data.command) {\" +\n        \"    case 'init':\" +\n        \"        init(e.data.config);\" +\n        \"        break;\" +\n        \"    case 'record':\" +\n        \"        record(e.data.buffer);\" +\n        \"        break;\" +\n        \"    case 'exportWAV':\" +\n        \"        exportWAV(e.data.type);\" +\n        \"        break;\" +\n        \"    case 'exportMonoWAV':\" +\n        \"        exportMonoWAV(e.data.type);\" +\n        \"        break;\" +\n        \"    case 'getBuffers':\" +\n        \"        getBuffers();\" +\n        \"        break;\" +\n        \"    case 'clear':\" +\n        \"        clear();\" +\n        \"        break;\" +\n        \"    }\" +\n        \"};\" +\n        \"    \" +\n        \"function init(config) {\" +\n        \"    sampleRate = config.sampleRate;\" +\n        \"    outSampleRate = config.format.sampleRate || sampleRate;\" +\n        \"    need_buf_size = config.format.bufferSize || 4096;\" +\n        \"    speex_converter = null;\" +\n        \"    /*if (config.format.format == \\'speex\\') {\" +\n        \"        if (!speex_loaded) {\" +\n        \"            importScripts(\\'./speex.min.js\\');\" +\n        \"            speex_loaded = true;\" +\n        \"        }\" +\n        \"        need_buf_size /= 16;\" +\n        \"        speex_converter = new SpeexConverter(outSampleRate);\" +\n        \"    }*/\" +\n        \"}\" +\n        \"\" +\n        \"var resample = function (inbuf) {\" +\n        \"    var speed = 1.0 * sampleRate / outSampleRate;\" +\n        \"    var l = Math.ceil(inbuf.length / speed);\" +\n        \"    var result = new Float32Array(l);\" +\n        \"    var bin = 0;\" +\n        \"    var num = 0;\" +\n        \"    var indexIn = 0;\" +\n        \"    var indexOut = 0;\" +\n        \"    for (indexOut = 1, indexIn = speed; indexOut < l - 1; indexIn += speed, indexOut++) {\" +\n        \"        var pos = Math.floor(indexIn);\" +\n        \"        var dt = indexIn - pos;\" +\n        \"        var second = (pos + 1 < inbuf.length) ? pos + 1 : inbuf.length - 1; \" +\n        \"        result[indexOut] = inbuf[pos] * (1 - dt) + inbuf[second] * dt;\" +\n        \"    }\" +\n        \"    result[0] = inbuf[0];\" +\n        \"    result[l - 1] = inbuf[inbuf.length - 1];\" +\n        \"    return result;\" +\n        \"};\" +\n        \"    \" +\n        \"function record(inputBuffer) {\" +\n        \"    if (outSampleRate == sampleRate) {\" +\n        \"        recBuffersL.push(inputBuffer[0]);\" +\n        \"        recBuffersR.push(inputBuffer[1]);\" +\n        \"        recLength += inputBuffer[0].length;\" +\n        \"    \" +\n        \"        var samples = inputBuffer[0];\" +\n        \"        var buffer = new ArrayBuffer(samples.length * 2);\" +\n        \"        var view = new DataView(buffer);\" +\n        \"        floatTo16BitPCM(view, 0, samples);\" +\n        \"        this.postMessage({command: 'int16stream', buffer: buffer});\" +\n        \"    } else {\" +\n        \"        var filter0 = new iirFilter(outSampleRate, outSampleRate * 0.125, 0.0); \" +\n        \"        var filter1 = new iirFilter(outSampleRate, outSampleRate * 0.125, 0.0); \" +\n        \"\" +\n        \"        for (var i =0; i < inputBuffer[0].length; i++) { \" +\n        \"            inputBuffer[0][i] = filter0.pushSample(inputBuffer[0][i]); \" +\n        \"            inputBuffer[1][i] = filter1.pushSample(inputBuffer[1][i]); \" +\n        \"        }\" +\n        \"\" +\n        \"        var resin0 = resample(inputBuffer[0], outSampleRate, sampleRate);\" +\n        \"        var resin1 = resample(inputBuffer[1], outSampleRate, sampleRate);\" +\n        \"    \" +\n        \"        recBuffersL.push(resin0);\" +\n        \"        recBuffersR.push(resin1);\" +\n        \"        recLength += resin0.length;\" +\n        \"    \" +\n        \"        var result = new Int16Array(resin0.length);\" +\n        \"    \" +\n        \"        for (var i = 0 ; i < resin0.length ; i++) {\" +\n        \"            result[i] = Math.floor(Math.min(Math.max((resin0[i] + resin1[i]) * 0.5, -1.0), 1.0) * 16383);\" +\n        \"        }\" +\n        \"    \" +\n        \"        if (speex_converter) {\" +\n        \"            result = speex_converter.convert(result);\" +\n        \"        } else {\" +\n        \"            result = result.buffer;\" +\n        \"        }\" +\n        \"    \" +\n        \"        if (!tmp_buf) {\" +\n        \"            tmp_buf = result;\" +\n        \"        } else {\" +\n        \"            var tmp = new DataView(new ArrayBuffer(tmp_buf.byteLength + result.byteLength));\" +\n        \"            tmp_buf = new DataView(tmp_buf);\" +\n        \"            result = new DataView(result);\" +\n        \"    \" +\n        \"            for (i = 0; i < tmp_buf.byteLength; i++) {\" +\n        \"                tmp.setUint8(i, tmp_buf.getUint8(i));\" +\n        \"            }\" +\n        \"    \" +\n        \"            for (i = 0; i < result.byteLength; i++) {\" +\n        \"                tmp.setUint8(i + tmp_buf.byteLength, result.getUint8(i));\" +\n        \"            }\" +\n        \"    \" +\n        \"            tmp_buf = tmp.buffer;\" +\n        \"        }\" +\n        \"    \" +\n        \"        if (tmp_buf.byteLength >= need_buf_size) {\" +\n        \"            this.postMessage({command: 'int16stream', buffer: tmp_buf});\" +\n        \"            tmp_buf = false;\" +\n        \"        }\" +\n        \"    }\" +\n        \"}\" +\n        \"    \" +\n        \"function exportWAV(type) {\" +\n        \"    var bufferL = mergeBuffers(recBuffersL, recLength);\" +\n        \"    var bufferR = mergeBuffers(recBuffersR, recLength);\" +\n        \"    var interleaved = interleave(bufferL, bufferR);\" +\n        \"    var dataview = encodeWAV(interleaved);\" +\n        \"    var audioBlob = new Blob([dataview], {type: type});\" +\n        \"    \" +\n        \"    this.postMessage({command: 'exportWAV', blob: audioBlob});\" +\n        \"}\" +\n        \"    \" +\n        \"function exportMonoWAV(type) {\" +\n        \"    var bufferL = mergeBuffers(recBuffersL, recLength);\" +\n        \"    var dataview = encodeWAV(bufferL, true);\" +\n        \"    var audioBlob = new Blob([dataview], {type: type});\" +\n        \"    \" +\n        \"    this.postMessage({command: 'exportMonoWAV', blob: audioBlob});\" +\n        \"}\" +\n        \"    \" +\n        \"function getBuffers() {\" +\n        \"    var buffers = [];\" +\n        \"    buffers.push(mergeBuffers(recBuffersL, recLength));\" +\n        \"    buffers.push(mergeBuffers(recBuffersR, recLength));\" +\n        \"    this.postMessage({command: 'getBuffers', blob: buffers});\" +\n        \"}\" +\n        \"    \" +\n        \"function clear() {\" +\n        \"    recLength = 0;\" +\n        \"    recBuffersL = [];\" +\n        \"    recBuffersR = [];\" +\n        \"    if (speex_converter) {\" +\n        \"        speex_converter.clear();\" +\n        \"    }\" +\n        \"    this.postMessage({command: 'clear'});\" +\n        \"}\" +\n        \"    \" +\n        \"function mergeBuffers(recBuffers, recLength) {\" +\n        \"    var result = new Float32Array(recLength);\" +\n        \"    var offset = 0;\" +\n        \"    for (var i = 0; i < recBuffers.length; i++){\" +\n        \"        result.set(recBuffers[i], offset);\" +\n        \"        offset += recBuffers[i].length;\" +\n        \"    }\" +\n        \"    return result;\" +\n        \"}\" +\n        \"    \" +\n        \"function interleave(inputL, inputR) {\" +\n        \"    var length = inputL.length + inputR.length;\" +\n        \"    var result = new Float32Array(length);\" +\n        \"    \" +\n        \"    var index = 0;\" +\n        \"    var inputIndex = 0;\" +\n        \"    \" +\n        \"    while (index < length){\" +\n        \"        result[index++] = inputL[inputIndex];\" +\n        \"        result[index++] = inputR[inputIndex];\" +\n        \"        inputIndex++;\" +\n        \"    }\" +\n        \"    return result;\" +\n        \"}\" +\n        \"    \" +\n        \"function floatTo16BitPCM(output, offset, input) {\" +\n        \"    for (var i = 0; i < input.length; i++, offset += 2){\" +\n        \"        var s = Math.max(-1, Math.min(1, input[i]));\" +\n        \"        output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\" +\n        \"    }\" +\n        \"}\" +\n        \"    \" +\n        \"function writeString(view, offset, string) {\" +\n        \"    for (var i = 0; i < string.length; i++){\" +\n        \"        view.setUint8(offset + i, string.charCodeAt(i));\" +\n        \"    }\" +\n        \"}\" +\n        \"    \" +\n        \"function encodeWAV(samples, mono) {\" +\n        \"    var buffer = new ArrayBuffer(44 + samples.length * 2);\" +\n        \"    var view = new DataView(buffer);\" +\n        \"    \" +\n        \"    /* RIFF identifier */\" +\n        \"    writeString(view, 0, 'RIFF');\" +\n        \"    /* file length */\" +\n        \"    view.setUint32(4, 32 + samples.length * 2, true);\" +\n        \"    /* RIFF type */\" +\n        \"    writeString(view, 8, 'WAVE');\" +\n        \"    /* format chunk identifier */\" +\n        \"    writeString(view, 12, 'fmt ');\" +\n        \"    /* format chunk length */\" +\n        \"    view.setUint32(16, 16, true);\" +\n        \"    /* sample format (raw) */\" +\n        \"    view.setUint16(20, 1, true);\" +\n        \"    /* channel count */\" +\n        \"    view.setUint16(22, mono ? 1 : 2, true);\" +\n        \"    /* sample rate */\" +\n        \"    view.setUint32(24, outSampleRate, true);\" +\n        \"    /* block align (channel count * bytes per sample) */\" +\n        \"    var block_align = mono ? 2 : 4;\" +\n        \"    /* byte rate (sample rate * block align) */\" +\n        \"    view.setUint32(28, outSampleRate * block_align, true);\" +\n        \"    /* block align (channel count * bytes per sample) */\" +\n        \"    view.setUint16(32, block_align, true);\" +\n        \"    /* bits per sample */\" +\n        \"    view.setUint16(34, 16, true);\" +\n        \"    /* data chunk identifier */\" +\n        \"    writeString(view, 36, 'data');\" +\n        \"    /* data chunk length */\" +\n        \"    view.setUint32(40, samples.length * 2, true);\" +\n        \"    \" +\n        \"    floatTo16BitPCM(view, 44, samples);\" +\n        \"    \" +\n        \"    return view;\" +\n        \"}\" +\n        \" \";\n\n    namespace.ya.speechkit.newWorker = function () {\n        return _makeWorker(inline_worker);\n    };\n}(speechkitNamespace));\n\n(function (namespace) {\n    'use strict';\n\n    /**\n     * Соединение разорвано\n     *\n     * @type {Number}\n     */\n    var SOCKET_CLOSED_ABNORMALLY = 1000;\n\n    /**\n     * Соединение было закрыто из-за получения\n     * сообщения об ошибке от сервера\n     *\n     * @type {Number}\n     */\n    var ERROR_MESSAGE_WAS_RECEIVED = 1001;\n\n    /**\n     * Соединение было закрыто из-за ошибки\n     *\n     * @type {Number}\n     */\n    var SOCKET_CLOSED_WITH_ERROR = 1002;\n\n    /**\n     * Ошибка при создании сокета\n     *\n     * @type {Number}\n     */\n    var CANT_CREATE_SOCKET = 1003;\n\n    /**\n     * Создает новый объект типа Recognizer.\n     * @class Создает сессию и отправляет запрос на сервер для распознавания речи.\n     * @name Recognizer\n     * @param {Object} [options] Опции.\n     * @param {callback:initCallback} [options.onInit] Функция-обработчик, которая будет вызвана после успешной инициализации\n     * сессии.\n     * @param {callback:dataCallback} [options.onResult] Функция-обработчик, которая будет вызвана после завершения распознавания речи.\n     * @param {callback:errorCallback} [options.onError]\n     * @param {String} [options.uuid=см. описание] UUID сессии. По умолчанию принимает значение, указанное\n     * в настройках ya.speechkit.settings.uuid.\n     * @param {String} [options.apikey] API-ключ. Если не задан, то используется ключ, указанный\n     * в настройках ya.speechkit.settings.apikey.\n     * @param {ya.speechkit.FORMAT} [options.format=ya.speechkit.FORMAT.PCM16] Формат аудиопотока.\n     * @param {String} [options.url=см. описание] URL сервера, на котором будет производиться распознавание.\n     * Если параметр не указан, то берется значение, заданное в настройках ya.speechkit.settings.asrUrl. По умолчанию оно равно\n     * 'webasr.yandex.net/asrsocket.ws'.\n     * @param {Boolean} [options.punctuation=true] Использовать ли пунктуацию.\n     * @param {Boolean} [options.allowStrongLanguage=false] Отключить фильтрацию обсценной лексики.\n     * @param {String} [options.model='notes'] Языковая модель, которая должна быть использована при распознавании.\n     * Если параметр не указан, то используется значение, заданное в настройках ya.speechkit.model. Если в настройках значение не задано, то\n     * используется модель 'notes'.\n     * @param {String} [options.lang='ru-RU'] Язык распознавания. Возможные значения: 'ru-RU', 'en-US', 'tr-TR', 'uk-UA'.\n     * <p>Если параметр не указан, то используется\n     * значение, заданное в настройках ya.speechkit.lang. Если в настройках значение не задано, то по умолчанию\n     * выбирается русский язык: 'ru-RU'. </p>\n     * @param {String} [options.applicationName] Название приложения. Для некоторых приложений мы поддерживаем специальную логику. Пример - sandbox.\n     */\n    var Recognizer = function (options) {\n        if (!(this instanceof namespace.ya.speechkit.Recognizer)) {\n            return new namespace.ya.speechkit.Recognizer(options);\n        }\n        this.options = namespace.ya.speechkit._extend(\n            {apikey: namespace.ya.speechkit.settings.apikey,\n                uuid: namespace.ya.speechkit.settings.uuid,\n                applicationName: namespace.ya.speechkit.settings.applicationName,\n                url: namespace.ya.speechkit.settings.websocketProtocol +\n                namespace.ya.speechkit.settings.asrUrl,\n                onInit: function () {},\n                onResult: function () {},\n                onError: function () {},\n                punctuation: true,\n                allowStrongLanguage: false\n            },\n            options);\n\n        // Backward compatibility\n        this.options.key = this.options.apikey;\n        this.options.format = this.options.format.mime;\n\n        this.sessionId = null;\n        this.socket = null;\n        // Закрыта ли сессия распознавания\n        this.closed = false;\n\n        this.buffered = [];\n        this.totaldata = 0;\n    };\n\n    Recognizer.prototype = /** @lends Recognizer.prototype */{\n        /**\n         * Send raw data to websocket.\n         * @param data Any data to send to websocket (json string, raw audio data).\n         * @private\n         */\n        _sendRaw: function (data) {\n            if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n                // Сокет может и не закрыться сам при потере интернета.\n                // Поэтому в случае если пакеты не отсылаются, то закрываем\n                // сокет вручную\n                try {\n                    this.socket.send(data);\n                } catch (e) {\n                    this.options.onError('Can\\'t send data', SOCKET_CLOSED_ABNORMALLY);\n                    this.close();\n                }\n            } else {\n                console.warn('Attempting to send message while socket is not open');\n            }\n        },\n        /**\n         * Stringify JSON and send it to websocket.\n         * @param {Object} json Object needed to be send to websocket.\n         * @private\n         */\n        _sendJson: function (json) {\n            this._sendRaw(JSON.stringify({type: 'message', data: json}));\n        },\n        /**\n         * Запускает процесс распознавания.\n         */\n        start: function () {\n            this.sessionId = null;\n            try {\n                this.socket = new WebSocket(this.options.url);\n            } catch (e) {\n                this.options.onError('Error on socket creation: ' + e, CANT_CREATE_SOCKET);\n                this.options.stopCallback();\n                return;\n            }\n\n            this.socket.onopen = function () {\n                // {uuid: uuid, key: key, format: audioFormat, punctuation: punctuation ...\n                // console.log('Initial request: ' + JSON.stringify(this.options));\n                this._sendJson(this.options);\n            }.bind(this);\n\n            this.socket.onmessage = function (e) {\n                var message = JSON.parse(e.data);\n\n                if (message.type == 'InitResponse'){\n                    this.sessionId = message.data.sessionId;\n                    this.options.onInit(message.data.sessionId, message.data.code);\n                } else if (message.type == 'AddDataResponse'){\n                    this.options.onResult(message.data.text, message.data.uttr, message.data.merge, message.data.words);\n                    if (typeof message.data.close !== 'undefined' && message.data.close) {\n                        this.close();\n                    }\n                } else if (message.type == 'Error'){\n                    this.options.onError('Session ' + this.sessionId + ': ' + message.data, ERROR_MESSAGE_WAS_RECEIVED);\n                    this.close();\n                } else {\n                    this.options.onError('Session ' + this.sessionId + ': ' + message, ERROR_MESSAGE_WAS_RECEIVED);\n                    this.close();\n                }\n            }.bind(this);\n\n            this.socket.onerror = function (error) {\n                this.options.onError('Socket error: ' + error.message, SOCKET_CLOSED_WITH_ERROR);\n                this.close();\n            }.bind(this);\n\n            this.socket.onclose = function (event) {\n                // Нужно попробовать закрыть сессию, так как сокет может сам выбросить\n                // случае onclose потери связи с сервером и т.п.\n                // {@link https://tools.ietf.org/html/rfc6455#section-7.4}\n                if (!event.wasClean) {\n                    this.options.onError('Socket closed abnormally', SOCKET_CLOSED_ABNORMALLY);\n                    this.close();\n                }\n            }.bind(this);\n        },\n        /**\n         * Добавляет данные с аудио к потоку для распознавания речи.\n         * Если сессия распознавания еще не была создана, то данные будут буферизованы и отправятся на сервер\n         * по факту установления соединения.\n         * @param {ArrayBuffer} data Буфер с аудио сигналом в формате PCM 16bit.\n         */\n        addData: function (data) {\n            this.totaldata += data.byteLength;\n\n            if (!this.sessionId) {\n                this.buffered.push(data);\n                return;\n            }\n\n            for (var i = 0; i < this.buffered.length; i++){\n                this._sendRaw(new Blob([this.buffered[i]], {type: this.options.format}));\n                this.totaldata += this.buffered[i].byteLength;\n            }\n\n            this.buffered = [];\n            this._sendRaw(new Blob([data], {type: this.options.format}));\n        },\n        /**\n         * Принудительно завершает запись звука и отсылает запрос (не закрывает сессию распознавания, пока не получит от сервера последний ответ).\n         */\n        finish: function () {\n            this._sendJson({command: 'finish'});\n        },\n        /**\n         * Завершает сессию распознавания речи, закрывая соединение с сервером.\n         */\n        close: function () {\n            if (this.closed) {\n                return;\n            }\n\n            this.closed = true;\n            this.options.onInit = function () {};\n            this.options.onResult = function () {};\n            this.options.onError = function () {};\n\n            if (this.isSocketAlive()) {\n                this.socket.close();\n            }\n\n            this.socket = null;\n            this.options.stopCallback();\n        },\n        /**\n         * Работает ли сокет\n         * @returns {boolean}\n         */\n        isSocketAlive: function () {\n            if (!this.socket) {\n                return false;\n            }\n\n            var readyState = this.socket.readyState;\n            return readyState === WebSocket.OPEN || readyState === WebSocket.CONNECTING;\n        }\n    };\n\n    namespace.ya.speechkit.Recognizer = Recognizer;\n\n    /**\n     * Функция-обработчик, которая будет вызвана после успешной инициализации\n     * сессии.\n     * @callback\n     * @name initCallback\n     * @param {String} sessionId Идентификатор сессии.\n     * @param {Number} code HTTP-статус, который будет содержаться в ответе сервера после инициализации сессии (200).\n     * @memberOf Recognizer\n     */\n\n    /**\n     * Функция-обработчик, которая будет вызвана в случае возникновения ошибки.\n     * @callback\n     * @name errorCallback\n     * @param {String} message Текст сообщения об ошибке.\n     * @memberOf Recognizer\n     */\n\n    /**\n     * Функция-обработчик, которая будет вызвана после завершения распознавания речи.\n     * @callback\n     * @name dataCallback\n     * @param {String} text Распознанный текст.\n     * @param {Boolean} utterance Является ли данный текст финальным результатом распознавания.\n     * @param {Number} merge Число обработанных запросов по которым выдан ответ. (Сколько пакетов с данными были соединены в этот результат).\n     * @memberOf Recognizer\n     */\n}(speechkitNamespace));\n(function (namespace) {\n    'use strict';\n\n    function noop() {}\n\n    /**\n     * Параметры по умолчанию для SpeechRecognition\n     * @private\n     */\n    namespace.ya.speechkit._defaultOptions = function () {\n        /**\n         * @typedef {Object} SpeechRecognitionOptions\n         * @property {SpeechRecognition~initCallback} initCallback - Функция, которая будет вызвана по факту инициализации сессии распознавания\n         * @property {SpeechRecognition~errorCallback} errorCallback - Функция, которая будет вызвана по факту ошибки (все ошибки - критичны, и приводят к порче сессии)\n         * @property {SpeechRecognition~dataCallback} dataCallback - Функция, в которую будут приходить результаты распознавания\n         * @property {SpeechRecognition~infoCallback} infoCallback - Функция для технической информации\n         * @property {SpeechRecognition~stopCallback} stopCallback - Функция, которая будет вызвана в момент остановки сессии распознавания\n         * @property {Boolean} punctuation - Следует ли пытаться расставлять знаки препинания\n         * @property {Boolean} allowStringLanguage - Следует ли отключить фильтрацию обсценной лексики\n         * @property {String} model - Языковая модель для распознавания речи\n         * @property {String} lang - Язык, речь на котором следует распознавать\n         * @property {ya.speechkit.FORMAT} format - Формат передачи аудио сигнала\n         * @property {String} [options.applicationName] Название приложения. Для некоторых приложений мы поддерживаем специальную логику. Пример - sandbox.\n         */\n        return {\n            initCallback: noop,\n            errorCallback: noop,\n            dataCallback: noop,\n            infoCallback: noop,\n            stopCallback: noop,\n            punctuation: false,\n            allowStrongLanguage: false,\n            model: namespace.ya.speechkit.settings.model,\n            applicationName: namespace.ya.speechkit.settings.applicationName,\n            lang: namespace.ya.speechkit.settings.lang,\n            format: namespace.ya.speechkit.FORMAT.PCM16,\n            url: namespace.ya.speechkit.settings.websocketProtocol +\n            namespace.ya.speechkit.settings.asrUrl,\n            vad: false,\n            speechStart: noop,\n            speechEnd: noop,\n        };\n    };\n\n    /**\n     * Создает новый объект типа SpeechRecognition.\n     * @class Класс для распознавания большого потока аудио-сигнала.\n     * @name SpeechRecognition\n     */\n    var SpeechRecognition = function () {\n        if (!(this instanceof namespace.ya.speechkit.SpeechRecognition)) {\n            return new namespace.ya.speechkit.SpeechRecognition();\n        }\n        this.send = 0;\n        this.send_bytes = 0;\n        this.proc = 0;\n        this.recorder = null;\n        this.recognizer = null;\n        this.vad = null;\n    };\n\n    SpeechRecognition.prototype = /** @lends SpeechRecognition.prototype */ {\n        /**\n         * Запускает процесс распознавания речи.\n         * @param {Object} [options] Параметры, которые будут использоваться во время сессии.\n         * @param {callback:initCallback} [options.initCallback] Функция-обработчик, которая будет вызвана по факту инициализации сессии распознавания.\n         * @param {callback:errorCallback} [options.errorCallback] Функция-обработчик, которая будет вызвана по факту ошибки (все ошибки критичны и приводят к завершению сессии).\n         * @param {callback:dataCallback} [options.dataCallback] Функция-обработчик, которая будет вызвана после успешного завершения\n         * распознавания. В качестве аргумента ей передаются результаты распознавания.\n         * @param {callback:infoCallback} [options.infoCallback] Функция для получения технической информации.\n         * @param {callback:stopCallback} [options.stopCallback] Функция-обработчик, которая будет вызвана в момент остановки сессии распознавания.\n         * @param {String} [options.apikey] API-ключ. Если не задан, то используется ключ, указанный\n         * в глобальных настройках {@link settings}.\n         * @param {Boolean} [options.punctuation=false] Следует ли использовать пунктуацию.\n         * @param {Boolean} [options.allowStrongLanguage=false] Следует ли отключить фильтрацию обсценной лексики.\n         * @param {String} [options.model='notes'] Языковая модель для распознавания речи. Список доступных значений:\n         * <ul>\n         *     <li>'notes' (по умолчанию) — общая лексика;</li>\n         *     <li>'queries' — короткие запросы;</li>\n         *     <li>'names' — имена; </li>\n         *     <li>'dates' — даты; </li>\n         *     <li>'maps' — топонимы;</li>\n         *     <li>'notes' — тексты;</li>\n         *     <li>'numbers' — числа.</li>\n         * </ul>\n         * <p>Если параметр не указан, то используется\n         * значение, заданное в глобальных настройках {@link settings}. Если в настройках значение не задано, то\n         * используется модель по умолчанию — 'notes'. </p>\n         * @param {String} [options.applicationName] Название приложения. Для некоторых приложений мы поддерживаем специальную логику. Пример - sandbox.\n         * @param {String} [options.lang='ru-RU'] Язык, речь на котором следует распознавать. Возможные значения: 'ru-RU', 'en-US', 'tr-TR'.\n         * <p>Если параметр не указан, то используется\n         * значение, заданное в глобальных настройках {@link settings}. Если в настройках значение не задано, то по умолчанию\n         * выбирается русский язык: 'ru-RU'. </p>\n         * @param {ya.speechkit.FORMAT} [options.format=ya.speechkit.FORMAT.PCM16] Формат передачи аудио-сигнала.\n         * @param {Boolean} [options.partialResults=true] Отправлять ли на сервер промежуточные результаты.\n         * @param {Number} [options.utteranceSilence=120] Длительность промежутка тишины во время записи речи (в десятках миллисекунд). Как только встречается\n         * такой перерыв в речи, запись звука останавливается, и записанный фрагмент речи отправляется на сервер.\n         * @param {Number} [options.expNumCount=0] Количество ожидаемых подряд идущих цифр (предотвращает их превращение в телефонные номера).\n         */\n        start: function (options) {\n            this.options = namespace.ya.speechkit._extend(\n                namespace.ya.speechkit._extend(\n                    {},\n                    namespace.ya.speechkit._defaultOptions()\n                ),\n                options);\n            if (namespace.ya.speechkit.settings.langWhitelist.indexOf(this.options.lang) >= 0) {\n                if (namespace.ya.speechkit._stream !== null) {\n                    this._onstart();\n                } else {\n                    namespace.ya.speechkit.initRecorder(\n                        this._onstart.bind(this),\n                        this.options.errorCallback\n                    );\n                }\n            } else {\n                var old_error_callback = this.options.errorCallback;\n                this.recorder = namespace.ya.speechkit.WebAudioRecognition(\n                    namespace.ya.speechkit._extend(\n                        this.options,\n                        {\n                            errorCallback: function (e) {\n                                this.recorder = null;\n                                old_error_callback(e);\n                            }.bind(this)\n                        }\n                    ));\n                this.recorder.start();\n            }\n        },\n        /**\n         * Will be called after successful call of initRecorder\n         * @private\n         */\n        _onstart: function () {\n            if (this.recorder && this.recorder.isPaused()) {\n                this.recorder.start();\n            }\n\n            if (this.recognizer) {\n                return;\n            }\n\n            this.send = 0;\n            this.send_bytes = 0;\n            this.proc = 0;\n\n            if (!this.recorder) {\n                this.recorder = new namespace.ya.speechkit.Recorder();\n                if (this.options.vad) {\n                    this.vad = new namespace.ya.speechkit.Vad({recorder: this.recorder,\n                        speechStart: this.options.speechStart,\n                        speechEnd: this.options.speechEnd});\n                }\n            }\n\n            this.recognizer = new namespace.ya.speechkit.Recognizer(\n                namespace.ya.speechkit._extend(this.options,\n                    {\n                        onInit: function (sessionId, code) {\n                            if (!this.recorder) {\n                                return;\n                            }\n\n                            this.recorder.start(function (data) {\n                                if (this.options.vad && this.vad) {\n                                    this.vad.update();\n                                }\n                                this.send++;\n                                this.send_bytes += data.byteLength;\n                                this.options.infoCallback({\n                                    send_bytes: this.send_bytes,\n                                    format: this.options.format,\n                                    send_packages: this.send,\n                                    processed: this.proc\n                                });\n                                this.recognizer.addData(data);\n                            }.bind(this), this.options.format);\n\n                            this.options.initCallback(sessionId, code, 'yandex');\n                        }.bind(this),\n                        onResult: function (text, uttr, merge, words) {\n                            this.proc += merge;\n                            this.options.infoCallback({\n                                send_bytes: this.send_bytes,\n                                format: this.options.format,\n                                send_packages: this.send,\n                                processed: this.proc\n                            });\n                            this.options.dataCallback(text, uttr, merge, words);\n                        }.bind(this),\n                        onError: function (msg, code) {\n                            if (this.recorder) {\n                                this.recorder.stop(function () { this.recorder = null; }.bind(this));\n                            }\n                            if (this.recognizer) {\n                                this.recognizer.close();\n                                this.recognizer = null;\n                            }\n                            this.options.errorCallback(msg, code);\n                        }.bind(this),\n                    }));\n            this.recognizer.start();\n        },\n        /**\n         * Завершает сессию распознавания речи.\n         * По завершении сессии будет вызвана функция-обработчик stopCallback.\n         */\n        stop: function () {\n            this.options.initCallback = noop;\n            this.options.dataCallback = noop;\n            // todo: может не обнулять errorCallback, чтобы ошибки не терять?\n            this.options.errorCallback = noop;\n\n            if (this.recognizer) {\n                this.recognizer.finish();\n            }\n\n            if (this.recorder) {\n                this.recorder.stop(\n                    function () {\n                        this.recognizer = null;\n                        this.recorder = null;\n                    }.bind(this)\n                );\n            }\n        },\n        /**\n         * Прерывает сессию распознавания речи (не дожидается финального результата распознавания).\n         * По завершении сессии будет вызвана функция-обработчик stopCallback.\n         */\n        abort: function () {\n            this.options.initCallback = noop;\n            this.options.dataCallback = noop;\n            // todo: может не обнулять errorCallback, чтобы ошибки не терять?\n            this.options.errorCallback = noop;\n\n            if (this.recognizer) {\n                this.recognizer.close();\n            }\n            if (this.recorder) {\n                this.recorder.stop(\n                    function () {\n                        this.recognizer = null;\n                        this.recorder = null;\n                    }.bind(this)\n                );\n            }\n        },\n        /**\n         * Ставит сессию распознавания на паузу.\n         * Чтобы соединение с сервером не прерывалось и можно было моментально возобновить распознавание,\n         * на сервер периодически посылаются небольшие куски данных.\n         */\n        pause: function () {\n            if (this.recorder) {\n                this.recorder.pause();\n            }\n        },\n        /**\n         * Определяет, стоит ли на паузе сессия распознавания.\n         * @returns {Boolean} true, если сессия распознавания речи стоит на паузе, false — иначе.\n         */\n        isPaused: function () {\n            return (!this.recorder || this.recorder.isPaused());\n        }\n    };\n\n    namespace.ya.speechkit.SpeechRecognition = SpeechRecognition;\n\n    /**\n     * Функция для распознавания коротких фрагментов речи.\n     * <p> При вызове функции recognize() начинается запись звука с микрофона.\n     * Как только наступает тишина более чем на одну секунду, запись\n     * прекращается, и функция отправляет запрос на сервер для распознавания записанного фрагмента.</p>\n     * <p>Приемлемое качество распознавания обеспечивается на фрагментах длительностью не более 10 секунд.\n     * При более длительном фрагменте качество распознавания ухудшается.</p>\n     * @static\n     * @function\n     * @name recognize\n     * @param {Object} [options] Параметры распознавания речи.\n     * @param {callback:SpeechRecognition.initCallback} [options.initCallback] Функция-обработчик, которая будет вызвана по факту\n     * инициализации сессии распознавания.\n     * @param {callback:SpeechRecognition.errorCallback} [options.errorCallback] Функция-обработчик, которая будет вызвана при возникновении ошибки\n     * (все ошибки критичны и приводят к завершению сессии).\n     * @param {callback:SpeechRecognition.recognitionDoneCallback} [options.doneCallback] Функция-обработчик, в которую будет отправлен результат распознавания речи.\n     * @param {String} [options.apikey] API-ключ. По умолчанию принимает значение, указанное\n     * в глобальных настройках {@link settings}.\n     * @param {String} [options.model='notes'] Список доступных значений:\n     * <ul>\n     *     <li>'notes' (по умолчанию) — текст;</li>\n     *     <li>'queries' — короткие запросы;</li>\n     *     <li>'names' — имена; </li>\n     *     <li>'dates' — даты; </li>\n     *     <li>'maps' — топонимы;</li>\n     *     <li>'notes' — тексты;</li>\n     *     <li>'numbers' — числа.</li>\n     * </ul>\n     * <p>Если параметр не указан, то используется\n     * значение, заданное в глобальных настройках {@link settings}. Если в настройках значение не задано, то\n     * используется модель по умолчанию — 'notes'. </p>\n     * @param {String} [options.applicationName] Название приложения. Для некоторых приложений мы поддерживаем специальную логику. Пример — sandbox.\n     * @param {String} [options.lang='ru-RU'] Язык, речь на котором следует распознавать. Возможные значения: 'ru-RU', 'en-US', 'tr-TR'.\n     * <p>Если параметр не указан, то используется\n     * значение, заданное в глобальных настройках {@link settings}. Если в настройках значение не задано, то по умолчанию\n     * выбирается русский язык: 'ru-RU'. </p>\n     * @param {Boolean} [options.partialResults=true] Отправлять ли на сервер промежуточные результаты.\n     * @param {Number} [options.utteranceSilence=120] Длительность промежутка тишины во время записи речи (в десятках миллисекунд). Как только встречается\n     * такой перерыв в речи, запись звука останавливается, и записанный фрагмент речи отправляется на сервер.\n     */\n\n    namespace.ya.speechkit.recognize = function (options) {\n        var dict = new namespace.ya.speechkit.SpeechRecognition();\n\n        var opts = namespace.ya.speechkit._extend(\n            namespace.ya.speechkit._extend(\n                {},\n                namespace.ya.speechkit._defaultOptions()\n            ),\n            options);\n\n        opts.doneCallback = options.doneCallback;\n\n        opts.dataCallback = function (text, uttr, merge) {\n            if (uttr) {\n                if (opts.doneCallback) {\n                    opts.doneCallback(text);\n                }\n                dict.stop();\n            }\n        };\n\n        opts.stopCallback = function () {\n            dict = null;\n        };\n\n        dict.start(opts);\n    };\n\n    /**\n     * Функция, в которую передается полностью распознанный фрагмент текста.\n     * @param {String} text Распознанная речь.\n     * @callback\n     * @name recognitionDoneCallback\n     * @memberOf SpeechRecognition\n     */\n\n    /**\n     * Функция, которая будет вызвана после успешной инициализации сессии распознавания речи.\n     * @callback\n     * @name initCallback\n     * @memberOf SpeechRecognition\n     * @param {String} sessionId Идентификатор сессии.\n     * @param {Number} code HTTP-статус, который будет содержаться в ответе сервера (200 в случае успеха).\n     */\n\n    /**\n     * Функция, в которую будут переданы сообщения об ошибках.\n     * @callback\n     * @name errorCallback\n     * @memberOf SpeechRecognition\n     * @param {String} message Текст сообщения об ошибке.\n     */\n\n    /**\n     * Функция для результатов распознавания речи.\n     * @callback\n     * @name dataCallback\n     * @memberOf SpeechRecognition\n     * @param {String} text Распознанный текст.\n     * @param {Boolean} utterance Является ли данный текст финальным результатом распознавания.\n     * @param {Number} merge Число обработанных запросов, по которым выдан ответ от сервера.\n     */\n\n    /**\n     * В эту функцию будет передаваться техническая информация.\n     * @callback\n     * @name infoCallback\n     * @memberOf SpeechRecognition.\n     * @param {Number} send_bytes Сколько байт аудио-данных было передано на сервер.\n     * @param {Number} send_packages Сколько пакетов аудио-данных было передано на сервер.\n     * @param {Number} processed Количество пакетов, на которые ответил сервер.\n     * @param {ya.speechkit.FORMAT} format Какой формат аудио используется.\n     */\n\n    /**\n     * Функция, которая будет вызвана после остановки сессии распознавания речи.\n     * @callback\n     * @name stopCallback\n     * @memberOf SpeechRecognition\n     */\n}(speechkitNamespace));\n(function (namespace) {\n    'use strict';\n\n    var speakersCache = null;\n\n    /**\n     * Воспроизводит аудиофайл.\n     * @function\n     * @static\n     * @param {String | <xref href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" scope=\"external\">Blob</xref>} url URL, по которому доступен либо аудио-файл,\n     * либо объект <xref href=\"https://developer.mozilla.org/en-US/docs/Web/API/Blob\" scope=\"external\">Blob</xref> со звуком в поддерживаемом браузером формате.\n     * @param {Function} [cb] Функция-обработчик, которая будет вызвана после завершения воспроизведения.\n     * @name play\n     */\n    namespace.ya.speechkit.play = function (url, cb) {\n        var audio = new Audio(url);\n        audio.volume = 1.0;\n        audio.onended = cb || function () {};\n        audio.play();\n    };\n\n    /**\n     * @class Класс, предназначенный для использования технологии синтеза речи (озвучивания текста).\n     * @name Tts\n     * @param {TtsOptions} [options] Опции.\n     * @param {String} [options.apikey] API-ключ (если в настройках ключ не был указан, то в конструкторе его необходимо указать).\n     * @param {String} [options.emotion='neutral'] Эмоциональная окраска голоса. Доступные значения:\n     * <ul>\n     *     <li>'neutral' — нейтральный (по умолчанию);</li>\n     *     <li>'good' — доброжелательный;</li>\n     *     <li>'evil' — злой.</li>\n     * </ul>\n     * @param {Array} [options.emotions] Массив эмоций вида [['emotion1', weight1], ['emotion2', weight2]], предназначенный для взвешенного смешивания эмоций\n     * @param {String} [options.speaker='omazh'] Голос для озвучивания. Список доступных значений можно получить вызвав функцию Tts.speakers:\n     * * <ul>\n     *     <li>женские голоса: 'omazh' (по умолчанию) и 'jane';</li>\n     *     <li>'мужские голоса: 'zahar' и 'ermil'.</li>\n     * </ul>\n     * @param {Array} [options.speakers] Массив голосов вида [['speaker1', weight1], ['speaker2', weight2]], предназначенный для взвешенного смешивания голосов.\n     * weight может принимать значения от 1.0 до 3.0. Например, [['omazh', 1.5], ['zahar', 2.2]].\n     * @param {Array} [options.genders] Массив полов вида [['gender1', weight1], ['gender2', weight2]], предназначенный для взвешенного смешивания полов говорящего.\n     * weight может принимать значения от 1.0 до 3.0.\n     * @param {Boolean} [options.fast=false] Использовать \"быстрый\" синтез, который ускоряет генерацию звука путём уменьшения его качества.\n     * @param {String} [options.lang='ru-RU'] Язык текста, который надо произнести. Доступные значения: 'ru-RU', 'en-US', 'tr-TR', 'uk-UA'.\n     * @param {Float} [options.speed=1.0] Скорость синтеза речи. Принимает значения от 0.0 (медленно) до 2.0 (быстро).\n     */\n    var Tts = function (options) {\n        if (!(this instanceof namespace.ya.speechkit.Tts)) {\n            return new namespace.ya.speechkit.Tts(options);\n        }\n        var _this = this;\n        /**\n         * Опции озвучивания текста.\n         * @type TtsOptions\n         * @name Tts.options\n         * @field\n         */\n        this.options = namespace.ya.speechkit._extend(\n            {\n                apikey: namespace.ya.speechkit.settings.apikey,\n                uuid: namespace.ya.speechkit.settings.uuid,\n                url: namespace.ya.speechkit.settings.websocketProtocol +\n                namespace.ya.speechkit.settings.ttsStreamUrl,\n                infoCallback: function () {},\n                errorCallback: function (msg) {\n                    console.log(msg);\n                },\n            },\n            options);\n        this.sessionId = null;\n        this.socket = null;\n\n        this.buffered = [];\n\n    };\n\n    Tts.prototype = /** @lends Tts.prototype */{\n        /**\n         * Send raw data to websocket\n         * @param data Any data to send to websocket (json string, raw audio data)\n         * @private\n         */\n        _sendRaw: function (data) {\n            if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n                this.socket.send(data);\n            } else {\n                console.warn('Attempting to send message while socket is not open');\n            }\n        },\n        /**\n         * Stringify JSON and send it to websocket\n         * @param {Object} json Object needed to be send to websocket\n         * @private\n         */\n        _sendJson: function (json) {\n            this._sendRaw(JSON.stringify({type: 'message', data: json}));\n        },\n        /**\n         * @private\n         * Озвучивание текста.\n         * @param {String} text Текст.\n         * @param {Function} [cb] Функция-обработчик, которая будет вызвана по завершении воспроизведения.\n         * @param {TtsOptions} [options] Опции.\n         */\n        say: function (text, cb, options) {\n            this.speak(\n                text,\n                namespace.ya.speechkit._extend(\n                    this.options,\n                    namespace.ya.speechkit._extend(\n                        {\n                            dataCallback: function (blob) {\n                                var url = URL.createObjectURL(blob);\n                                namespace.ya.speechkit.play(url, cb);\n                            }\n                        },\n                        options)\n                )\n            );\n        },\n        /**\n         * Озвучивание текста.\n         * @param {TtsOptions} text Опции.\n         * @param {TtsOptions} [options] Опции.\n         */\n        speak: function (text, options) {\n            var opts = namespace.ya.speechkit._extend(\n                namespace.ya.speechkit._extend(\n                    {text: text},\n                    this.options),\n                options);\n            try {\n                this.socket = new WebSocket(opts.url);\n            } catch (e) {\n                opts.errorCallback('Error on socket creation: ' + e);\n                return;\n            }\n\n            var context = namespace.ya.speechkit.audiocontext || new namespace.ya.speechkit.AudioContext();\n            namespace.ya.speechkit.audiocontext = context;\n\n            this.socket.onopen = function () {\n                this._sendJson(opts);\n            }.bind(this);\n\n            var play_queue = [];\n            var playing = false;\n\n            this.socket.binaryType = 'arraybuffer';\n\n            this.socket.onmessage = function (e) {\n                var message = {};\n                if (e.data && e.data[0] == '{') {\n                    try {\n                        message = JSON.parse(e.data);\n                    } catch (ex) {\n                        message = {type: 'Audio', data: e.data};\n                    }\n                } else {\n                    message = {type: 'Audio', data: e.data};\n                }\n                if (message.type == 'InitResponse') {\n                    this.sessionId = message.data.sessionId;\n                } else if (message.type == 'Error') {\n                    opts.errorCallback('Session ' + this.sessionId + ': ' + message.data);\n                    this.socket.onclose = function () {};\n                    this.socket.close();\n                } else if (message.type == 'Phonemes') {\n                    opts.infoCallback(message.data);\n                } else if (message.type == 'Audio') {\n                    play_queue.push(message.data);\n                } else {\n                    opts.errorCallback('Session ' + this.sessionId + ': ' + message);\n                    this.socket.onclose = function () {};\n                    this.socket.close();\n                }\n            }.bind(this);\n\n            this.socket.onerror = function (error) {\n                opts.errorCallback('Socket error: ' + error.message);\n            }.bind(this);\n\n            this.socket.onclose = function (event) {\n                var res = Array.prototype.concat.apply([], play_queue);\n                var blob = new Blob(res, {type: 'audio/x-wav'});\n                if (typeof opts.dataCallback !== 'undefined') {\n                    opts.dataCallback(blob);\n                } else {\n                    var url = URL.createObjectURL(blob);\n                    namespace.ya.speechkit.play(url, opts.stopCallback);\n                }\n            }.bind(this);\n        },\n        /**\n         * Возвращает список доступных голосов и эмоций.\n         * @param {String} [lang] Язык, для которого следует вернуть список доступных языков\n         * @returns {Promise} Promise, который вернёт в resolve список доступных языков и эмоций\n         */\n        speakers: function (lang) {\n            return new Promise(function (resolve, reject) {\n\n                if (speakersCache) {\n                    resolve(speakersCache);\n                } else {\n                    var xhr = new XMLHttpRequest();\n                    xhr.open('GET', this.options.url.replace('wss://', 'https://')\n                        .replace('ws://', 'http://')\n                        .replace('ttssocket.ws', 'speakers?engine=ytcp&lang=' + (lang || '')));\n\n                    xhr.onreadystatechange = function () {\n                        if (this.readyState == 4) {\n                            if (this.status == 200) {\n                                try {\n                                    speakersCache = JSON.parse(this.responseText);\n                                    resolve(speakersCache);\n                                } catch (ex) {\n                                    reject(ex.message);\n                                }\n                            } else {\n                                reject('Can\\'t get speakers list!');\n                            }\n                        }\n                    };\n\n                    xhr.send();\n                }\n            }.bind(this));\n        },\n    };\n\n    namespace.ya.speechkit.Tts = Tts;\n}(speechkitNamespace));\n\n(function (namespace) {\n    'use strict';\n\n    var WebAudioRecognition = function (options) {\n        if (!(this instanceof namespace.ya.speechkit.WebAudioRecognition)) {\n            return new namespace.ya.speechkit.WebAudioRecognition(options);\n        }\n        this.recognition = null;\n        this.recorder = null;\n        this.options = namespace.ya.speechkit._extend(\n            namespace.ya.speechkit._extend(\n                namespace.ya.speechkit._defaultOptions(),\n                options),\n            {format: namespace.ya.speechkit.FORMAT.PCM44});\n    };\n\n    WebAudioRecognition.prototype = {\n        _onstart: function () {\n            this.send = 0;\n            this.send_bytes = 0;\n\n            this.recognition = namespace.ya.speechkit._extend(this.recognition,\n                {\n                    interim_transcript: '',\n                    lang: this.options.lang,\n                    onend: this.stop.bind(this),\n                    onresult: function (event) {\n                        this.interim_transcript = '';\n                        var arr = [];\n                        for (var i = event.resultIndex; i < event.results.length; ++i) {\n                            if (event.results[i].isFinal) {\n                                arr.push({0:{\n                                    transcript: event.results[i][0].transcript,\n                                    confidence: event.results[i][0].confidence\n                                }});\n                                this.backref.options.dataCallback(event.results[i][0].transcript, true, 1);\n                                this.interim_transcript = '';\n                            } else {\n                                this.interim_transcript += event.results[i][0].transcript;\n                            }\n                        }\n                        if (arr.length) {\n                            this.backref.recognizer._sendJson(arr);\n                        }\n                        this.backref.options.dataCallback(this.interim_transcript, false, 1);\n                    },\n                    continuous: true,\n                    interimResults: true,\n                    maxAlternatives: 5,\n                    errorCallback: this.options.errorCallback,\n                    onerror: function (e) { this.errorCallback(e.error); }\n                });\n            this.recognition.backref = this;\n\n            this.recorder = new namespace.ya.speechkit.Recorder();\n            this.recognizer = new namespace.ya.speechkit.Recognizer(\n                namespace.ya.speechkit._extend(this.options,\n                    {\n                        url: this.options.url.replace('asrsocket.ws', 'logsocket.ws'),\n                        samplerate: this.options.format.sampleRate,\n                        onInit: function (sessionId, code) {\n                            this.recorder.start(function (data) {\n                                if (this.options.vad && this.vad) {\n                                    this.vad.update();\n                                }\n                                this.send++;\n                                this.send_bytes += data.byteLength;\n                                this.options.infoCallback({\n                                    send_bytes: this.send_bytes,\n                                    format: this.options.format,\n                                    send_packages: this.send,\n                                    processed: this.proc\n                                });\n                                this.recognizer.addData(data);\n                            }.bind(this), this.options.format);\n                            this.recognition.onstart = this.options.initCallback.bind(this, sessionId, code, 'native');\n                            this.recognition.start();\n                        }.bind(this),\n                        onResult: function () {},\n                        onError: function (msg) {\n                            this.recorder.stop(function () {});\n                            this.recognizer.close();\n                            this.recognizer = null;\n                            this.options.errorCallback(msg);\n                        }.bind(this),\n                    }));\n            this.recognizer.start();\n        },\n        start: function () {\n            if (typeof namespace.webkitSpeechRecognition !== 'undefined') {\n                this.recognition = new namespace.webkitSpeechRecognition();\n\n                if (namespace.ya.speechkit._stream !== null) {\n                    this._onstart();\n                } else {\n                    namespace.ya.speechkit.initRecorder(\n                        this._onstart.bind(this),\n                        this.options.errorCallback\n                    );\n                }\n            } else {\n                this.options.errorCallback('Your browser doesn\\'t implement Web Speech API');\n            }\n        },\n        stop: function (cb) {\n            if (this.recognition) {\n                this.recognition.onend = function () {};\n                this.recognition.stop();\n            }\n            if (this.recorder) {\n                this.recorder.stop();\n            }\n            if (this.recognizer) {\n                this.recognizer.close();\n            }\n            this.options.stopCallback();\n            if (typeof cb !== 'undefined') {\n                if (Object.prototype.toString.call(cb) == '[object Function]') {\n                    cb();\n                }\n            }\n        },\n        pause: function () {\n        },\n        isPaused: function () {\n            return false;\n        },\n        getAnalyserNode: function () {\n            if (this.recorder) {\n                return this.recorder.getAnalyserNode();\n            }\n        }\n    };\n\n    namespace.ya.speechkit.WebAudioRecognition = WebAudioRecognition;\n}(speechkitNamespace));\n(function (namespace) {\n    'use strict';\n\n    namespace.ya.speechkit.SpeakerId = function () {\n        if (!(this instanceof namespace.ya.speechkit.SpeakerId)) {\n            return new namespace.ya.speechkit.SpeakerId();\n        }\n\n        if (!namespace.ya.speechkit._recorderInited) {\n            namespace.ya.speechkit.initRecorder(\n                this.onInited.bind(this),\n                function (error) {alert('Failed to init recorder: ' + error);}\n            );\n        }\n    };\n\n    namespace.ya.speechkit.SpeakerId.prototype = {\n        onInited: function () {\n            this.recorder = new namespace.ya.speechkit.Recorder();\n        },\n\n        startRecord: function () {\n            console.log('Start recording...');\n            this.recorder.start(\n                function (data) {\n                    console.log('Recorder callback, recorded data length: ' + data.byteLength);\n                },\n                namespace.ya.speechkit.FORMAT.PCM8);\n        },\n\n        completeRecordAndRegister: function (userid, keepPrev, text, onRegister) {\n            console.log('completeRecordAndRegister');\n            this.recorder.stop(function (wav) {\n                console.log('Wav is ready:');\n                console.log(wav);\n                var fd = new FormData();\n                fd.append('name', userid);\n                fd.append('text', text);\n                fd.append('audio', wav);\n                fd.append('keepPrev', keepPrev ? 'true' : 'false');\n\n                var xhr = new XMLHttpRequest();\n\n                xhr.open('POST', namespace.ya.speechkit.settings.voicelabUrl + 'register_voice');\n\n                xhr.onreadystatechange = function () {\n                    if (this.readyState == 4) {\n                        if (this.status == 200) {\n                            console.log(this.responseText);\n                            onRegister(this.responseText);\n                        } else {\n                            onRegister('Failed to register data, could not access ' +\n                                namespace.ya.speechkit.settings.voicelabUrl +\n                                ' Check out developer tools -> console for more details.');\n                        }\n                    }\n                };\n\n                xhr.send(fd);\n\n            });\n        },\n\n        completeRecordAndIdentify: function (onFoundUser) {\n            console.log('Indentify');\n            this.recorder.stop(function (wav) {\n                console.log('Wav is ready:');\n                console.log(wav);\n                var fd = new FormData();\n                fd.append('audio', wav);\n\n                var xhr = new XMLHttpRequest();\n\n                xhr.open('POST', namespace.ya.speechkit.settings.voicelabUrl + 'detect_voice');\n\n                xhr.onreadystatechange = function () {\n                    if (this.readyState == 4) {\n                        if (this.status == 200) {\n                            console.log(this.responseText);\n                            var data = {};\n                            try {\n                                data = JSON.parse(this.responseText);\n                            } catch (e) {\n                                onFoundUser(false, 'Failed to find user, internal server error: ' + e);\n                                return;\n                            }\n                            onFoundUser(true, data);\n                        } else {\n                            onFoundUser(false, 'Failed to find user, could not access ' +\n                                namespace.ya.speechkit.settings.voicelabUrl +\n                                ' Check out developer tools -> console for more details.');\n                        }\n                    }\n                };\n\n                xhr.send(fd);\n            }, 1);\n        },\n\n        feedback: function (requestId, feedback) {\n            console.log('Post feedback');\n            var fd = new FormData();\n            fd.append('requestId', requestId);\n            fd.append('feedback', feedback);\n\n            var xhr = new XMLHttpRequest();\n\n            xhr.open('POST', namespace.ya.speechkit.settings.voicelabUrl + 'postFeedback');\n\n            xhr.onreadystatechange = function () {\n                if (this.readyState == 4) {\n                    console.log(this.responseText);\n                }\n            };\n\n            xhr.send(fd);\n        },\n    };\n}(speechkitNamespace));\n(function (namespace) {\n    'use strict';\n\n    namespace.ya.speechkit.Equalizer = function (target, recorder) {\n        this.recorder = recorder;\n        this.element = document.getElementById(target);\n        this.element.style.textAlign = 'center';\n        this.element.innerText = '';\n        this.graf = document.createElement('canvas');\n        this.graf.style.width = '100%';\n        this.graf.style.height = '100%';\n        this.graf.width = 1000;\n\n        this.element.appendChild(this.graf);\n\n        if (!navigator.cancelAnimationFrame) {\n            navigator.cancelAnimationFrame = navigator.webkitCancelAnimationFrame ||\n                navigator.mozCancelAnimationFrame;\n        }\n        if (!navigator.requestAnimationFrame) {\n            navigator.requestAnimationFrame = navigator.webkitRequestAnimationFrame ||\n                navigator.mozRequestAnimationFrame;\n        }\n\n        this.refID = null;\n\n        this.startDrawRealtime();\n    };\n\n    namespace.ya.speechkit.Equalizer.prototype = {\n        destroy: function () {\n            this.stopDrawRealtime();\n            this.element.removeChild(this.graf);\n        },\n        stopDrawRealtime: function () {\n            window.cancelAnimationFrame(this.rafID);\n            this.rafID = null;\n        },\n        startDrawRealtime: function () {\n            var _this = this;\n            function updateAnalysers(time) {\n                if (!_this.analyserNode) {\n                    if (_this.recorder) {\n                        _this.analyserNode = _this.recorder.getAnalyserNode();\n                        _this.context = _this.recorder.context;\n                    } else {\n                        return;\n                    }\n                }\n\n                var canvasWidth = _this.graf.width;\n                var canvasHeight = _this.graf.height;\n                var analyserContext = _this.graf.getContext('2d');\n\n                var SPACING = 2;\n                var BAR_WIDTH = 1;\n                var numBars = Math.round(canvasWidth / SPACING);\n                var freqByteData = new Uint8Array(_this.analyserNode.frequencyBinCount);\n\n                _this.analyserNode.getByteFrequencyData(freqByteData);\n\n                analyserContext.clearRect(0, 0, canvasWidth, canvasHeight);\n                analyserContext.fillStyle = '#F6D565';\n                analyserContext.lineCap = 'round';\n                var multiplier = _this.analyserNode.frequencyBinCount / numBars;\n\n                for (var i = 0; i < numBars; ++i) {\n                    var magnitude = 0;\n                    var offset = Math.floor(i * multiplier);\n                    for (var j = 0; j < multiplier; j++) {\n                        magnitude += freqByteData[offset + j];\n                    }\n                    magnitude = magnitude / multiplier / 2;\n                    analyserContext.fillStyle = 'hsl( ' + Math.round(i * 60 / numBars) + ', 100%, 50%)';\n                    analyserContext.fillRect(i * SPACING, canvasHeight, BAR_WIDTH, -magnitude);\n                }\n                _this.rafID = window.requestAnimationFrame(updateAnalysers);\n            }\n\n            this.rafID = window.requestAnimationFrame(updateAnalysers);\n        }\n    };\n}(speechkitNamespace));\n(function (namespace) {\n    'use strict';\n\n    namespace.ya.speechkit._mic_on = '<svg version=\"1.1\" id=\"Layer_1\" ' +\n        ' xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\"' +\n        ' xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n        ' x=\"0px\" y=\"0px\" viewBox=\"0 0 112 112\"' +\n        ' enable-background=\"new 0 0 112 112\" xml:space=\"preserve\">' +\n        ' <g id=\"tuts\" sketch:type=\"MSPage\">' +\n        ' <g id=\"mic_ff\" sketch:type=\"MSLayerGroup\">' +\n        ' <g sketch:type=\"MSShapeGroup\">' +\n        ' <circle id=\"path-1\" fill=\"rgb(255, 204, 0)\" cx=\"56\" cy=\"56\" r=\"56\"/>' +\n        ' </g>' +\n        ' <g id=\"speechkit_vector-9\" transform=\"translate(39.000000, 32.000000)\" ' +\n        ' sketch:type=\"MSShapeGroup\" opacity=\"0.9\">' +\n        ' <path id=\"Shape\" d=\"M17,4c2.8,0,5,2.3,5,5.2v15.6c0,2.9-2.2,5.2-5,5.2s-5-2.3-5-5.2V9.2C12,6.3,14.2,4,17,4 M17,0' +\n        ' c-5,0-9,4.1-9,9.2v15.6c0,5.1,4,9.2,9,9.2s9-4.1,9-9.2V9.2C26,4.1,22,0,17,0L17,0z\"/>' +\n        ' <path id=\"Shape_1_\" ' +\n        ' d=\"M34,23v1.1C34,34,26.4,42,17,42S0,34,0,24.1V23h4v0.1C4,31.3,9.8,38,17,38s13-6.7,13-14.9V23H34z\"/>' +\n        ' <rect id=\"Rectangle-311\" x=\"15\" y=\"41\" width=\"4\" height=\"10\"/>' +\n        ' </g>' +\n        ' </g>' +\n        ' </g>' +\n        ' </svg>';\n\n    namespace.ya.speechkit._mic_off = '<svg version=\"1.1\" id=\"Layer_1\" ' +\n        ' xmlns:sketch=\"http://www.bohemiancoding.com/sketch/ns\"' +\n        ' xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\n        ' x=\"0px\" y=\"0px\" viewBox=\"0 0 112 112\"' +\n        ' enable-background=\"new 0 0 112 112\" xml:space=\"preserve\">' +\n        ' <g id=\"tuts\" sketch:type=\"MSPage\">' +\n        ' <g id=\"mic_ff\" sketch:type=\"MSLayerGroup\">' +\n        ' <g id=\"speechkit_vector-9\" transform=\"translate(39.000000, 32.000000)\" ' +\n        ' sketch:type=\"MSShapeGroup\" opacity=\"0.9\">' +\n        ' <path id=\"Shape\" d=\"M17,4c2.8,0,5,2.3,5,5.2v15.6c0,2.9-2.2,5.2-5,5.2s-5-2.3-5-5.2V9.2C12,6.3,14.2,4,17,4 M17,0' +\n        ' c-5,0-9,4.1-9,9.2v15.6c0,5.1,4,9.2,9,9.2s9-4.1,9-9.2V9.2C26,4.1,22,0,17,0L17,0z\"/>' +\n        ' <path id=\"Shape_1_\" ' +\n        ' d=\"M34,23v1.1C34,34,26.4,42,17,42S0,34,0,24.1V23h4v0.1C4,31.3,9.8,38,17,38s13-6.7,13-14.9V23H34z\"/>' +\n        ' <rect id=\"Rectangle-311\" x=\"15\" y=\"41\" width=\"4\" height=\"10\"/>' +\n        ' </g>' +\n        ' </g>' +\n        ' </g>' +\n        ' </svg>';\n\n    /**\n     * @name Textline\n     * @class Класс для добавления элемента управления \"Поле для голосового ввода\".\n     * @param {String} target Идентификатор div-контейрена, в котором будет размещен элемент управления.\n     * @param {Object} [options] Опции распознавания.\n     * @param {Object} [options.onInputFinished] Функция, которая будет вызвана после завершения распознавания. В качесве ее\n     * аргументов передается финальный распознанный текст.\n     * @param {String} [options.apikey] API-ключ. Если не задан, то используется ключ, указанный\n     * в глобальных настройках {@link settings}.\n     * @param {Boolean} [options.allowStrongLanguage=false] Следует ли отключить фильтрацию обсценной лексики.\n     * @param {String} [options.model='notes'] Языковая модель для распознавания речи. Список доступных значений:\n     * <ul>\n     *     <li>'notes' (по умолчанию) — текст;</li>\n     *     <li>'queries' — короткие запросы;</li>\n     *     <li>'names' — имена; </li>\n     *     <li>'dates' — даты; </li>\n     *     <li>'maps' - топонимы;</li>\n     *     <li>'notes' - тексты;</li>\n     *     <li>'numbers' — числа.</li>\n     * </ul>\n     * <p>Если параметр не указан, то используется\n     * значение, заданное в глобальных настройках {@link settings}. Если в настройках значение не задано, то\n     * используется модель по умолчанию - 'notes'. </p>\n     * @param {String} [options.lang='ru-RU'] Язык, речь на котором следует распознавать. Возможные значения: 'ru-RU', 'en-US', 'tr-TR', 'uk-UA'.\n     * <p>Если параметр не указан, то используется\n     * значение, заданное в глобальных настройках {@link settings}. Если в настройках значение не задано, то по умолчанию\n     * выбирается русский язык: 'ru-RU'. </p>\n     * @param {ya.speechkit.FORMAT} [options.format=ya.speechkit.FORMAT.PCM16] Формат передачи аудио-сигнала.\n     */\n    namespace.ya.speechkit.Textline = function (target, options) {\n        if (!(this instanceof namespace.ya.speechkit.Textline)) {\n            return new namespace.ya.speechkit.Textline(target, options);\n        }\n\n        var el = document.getElementById(target);\n        if (el.tagName != 'INPUT') {\n            this.element = el;\n            this.textinput = document.createElement('input');\n            this.textinput.style.height = '100%';\n            this.textinput.style.width = '100%';\n        } else {\n            this.textinput = el;\n            this.element = null;\n        }\n        this.textinput.style.backgroundImage = 'url(\\'data:image/svg+xml;utf8,' +\n            namespace.ya.speechkit._mic_off + '\\')';\n        this.textinput.style.backgroundRepeat = 'no-repeat';\n        this.textinput.style.backgroundPosition = 'right center';\n        if (this.element) {\n            this.element.appendChild(this.textinput);\n        }\n\n        this.dict = null;\n\n        this.final_result = '';\n\n        var _this = this;\n\n        this.textinput.onmousemove = function (event) {\n            var rect = _this.textinput.getBoundingClientRect();\n            if (event.clientX - rect.x > rect.width - rect.height)\n            {\n                _this.textinput.style.cursor = 'pointer';\n            } else {\n                _this.textinput.style.cursor = 'text';\n            }\n        };\n\n        options = options || {};\n\n        options.dataCallback = function (text, uttr, merge) {\n            _this.textinput.value = text;\n            if (uttr) {\n                if (options.onInputFinished) {\n                    _this.final_result = text;\n                    options.onInputFinished(text);\n                }\n                _this.dict.abort();\n            }\n        };\n\n        options.initCallback = function () {\n            _this.textinput.style.backgroundImage = 'url(\\'data:image/svg+xml;utf8,' + ya.speechkit._mic_on + '\\')';\n        };\n\n        options.stopCallback = function () {\n            _this.textinput.style.backgroundImage = 'url(\\'data:image/svg+xml;utf8,' + ya.speechkit._mic_off + '\\')';\n            _this.dict = null;\n        };\n\n        this.textinput.onmousedown = function (event) {\n            var rect = _this.textinput.getBoundingClientRect();\n\n            if (event.clientX <= rect.width - rect.height) {\n                return;\n            }\n\n            if (!_this.dict) {\n                _this.dict = new ya.speechkit.SpeechRecognition();\n            }\n            if (_this.dict.isPaused())\n            {\n                _this.dict.start(options);\n            } else {\n                _this.dict.stop();\n            }\n        };\n\n        return {\n            /**\n             * Удаляет элемент управления.\n             * @name Textline.destroy\n             * @function\n             */\n            destroy: function () {\n                if (_this.dict) {\n                    _this.dict.stop();\n                }\n                _this.textinput.style.backgroundImage = '';\n                _this.textinput.onmousedown = function () {};\n                _this.textinput.onmousemove = function () {};\n\n                if (_this.element) {\n                    _this.element.removeChild(_this.textinput);\n                }\n            },\n            /**\n             * Получает финальный результат распознавания в синхронном режиме.\n             * @name Textline.value\n             * @function\n             * @returns {string} Результат распознавания.\n             *\n             * @example\n             * var textline = new ya.speechkit.Textline('myDiv');\n             *\n             * setTimeout(function () {\n             *     console.log(\"Результат распознавания: \" + textline.value());\n             * }, 5000);\n             */\n            value: function () {\n                return _this.final_result;\n            }\n        };\n    };\n}(speechkitNamespace));\n\n(function (namespace) {\n    'use strict';\n\n    if (typeof namespace.ya === 'undefined') {\n        namespace.ya = {};\n    }\n    if (typeof namespace.ya.speechkit === 'undefined') {\n        namespace.ya.speechkit = {};\n    }\n    /**\n     * @name settings\n     * @static\n     * @class Задает глобальные настройки API.\n     */\n\n    /**\n     * Язык. Возможные значения:\n     * <ul>\n     *      <li>'ru-RU',</li>\n     *      <li>'en-US',</li>\n     *      <li>'tr-TR'</li>\n     *      <li>'uk-UA' (для синтеза речи).</li>\n     * </ul>\n     * @field\n     * @name settings.lang\n     * @type String\n     */\n\n    /**\n     * <xref scope=\"external\" href=\"https://tech.yandex.ru/speechkit/jsapi/doc/dg/concepts/settings-docpage/\">Языковая модель</xref>.\n     * Список доступных значений:\n     * <ul>\n     *     <li>'notes' (по умолчанию) — общая лексика;</li>\n     *     <li>'queries' — короткие запросы;</li>\n     *     <li>'names' — имена; </li>\n     *     <li>'dates' — даты; </li>\n     *     <li>'maps' — топонимы;</li>\n     *     <li>'notes' — тексты;</li>\n     *     <li>'numbers' — числа.</li>\n     * </ul>\n     * @field\n     * @name settings.model\n     * @type String\n     */\n\n    /**\n     * API-ключ.\n     * @field\n     * @name settings.apikey\n     * @type String\n     */\n\n    /**\n     * UUID клиента.\n     * <p>Формируется автоматически, случайным образом. Является уникальным для каждого пользователя приложения.</p>\n     * @field\n     * @name settings.uuid\n     * @type String\n     */\n\n    var settings = {\n        websocketProtocol: 'wss://',\n        asrUrl: 'webasr.yandex.net/asrsocket.ws',\n        ttsUrl: 'https://tts.voicetech.yandex.net',\n        ttsStreamUrl: 'webasr.yandex.net/ttssocket.ws',\n        lang: 'ru-RU',\n        langWhitelist: ['ru-RU', 'tr-TR', 'en-US', 'en-GB', 'uk-UA', 'ru', 'tr', 'en', 'uk', 'en-EN'],\n        model: 'notes',\n        applicationName: 'jsapi',\n        apikey: '',\n        uuid: 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(\n            /[xy]/g,\n            function (c) {\n                var r = Math.random() * 16 | 0;\n                var v = c == 'x' ? r : (r & 0x3 | 0x8);\n                return v.toString(16);\n            }\n        )\n    };\n\n    if (typeof namespace.ya.speechkit._extend === 'undefined') {\n        namespace.ya.speechkit.settings = settings;\n    } else {\n        namespace.ya.speechkit.settings = namespace.ya.speechkit._extend(settings, namespace.ya.speechkit.settings);\n    }\n})(speechkitNamespace);\n\nmodule.exports = speechkitNamespace;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/speechkit/src/index.js\n// module id = 512\n// module chunks = 1 2","'use strict';\n\nconst xml = require('../../utils/xml');\nconst events = require('./events');\n\nclass XMLHandler {\n    constructor() {}\n\n    _toXML(string) {\n        return xml.fromStringOriginal(string);\n    }\n\n    /**\n     * Handles xml.getAttr method call.\n     * @param {Object} params\n     * @private\n     */\n    _getAttr({xmlString, selector, attr, sendResponse}) {\n        if (typeof xmlString === 'string') {\n            const xmlDoc = this._toXML(xmlString);\n            sendResponse({attr: xml.getAttrOriginal(xmlDoc, selector, attr)});\n        } else {\n            const errObj = {message: 'No serialized xml found.'}\n            sendResponse({errObj});\n        }\n    }\n\n    /**\n     * Handles xml.getText method call.\n     * @param {Object} params\n     * @private\n     */\n    _getText({xmlString, selector, sendResponse}) {\n        if (typeof xmlString === 'string') {\n            const xmlDoc = this._toXML(xmlString);\n            sendResponse({text: xml.getTextOriginal(xmlDoc, selector)});\n        } else {\n            const errObj = {message: 'No serialized xml found.'}\n            sendResponse({errObj});\n        }\n    }\n\n    /**\n     * Handles xml.selectAll method call.\n     * @param {Object} params\n     * @private\n     */\n    _selectAll({selector, parent, sendResponse}) {\n        if (typeof parent === 'string') {\n            const xmlDoc = this._toXML(parent);\n            sendResponse({selection: xml.selectAllOriginal(selector, xmlDoc)});\n        } else {\n            const errObj = {message: 'No serialized xml found.'}\n            sendResponse({errObj});\n        }\n    }\n\n    handle(req, _sender) {\n        switch (req.type) {\n            case events.backend.XML_FROM_STRING:\n                this._fromString(req.data);\n                break;\n            case events.backend.XML_GET_ATTR:\n                this._getAttr(req.data);\n                break;         \n            case events.backend.XML_GET_TEXT:\n                this._getText(req.data);\n                break;\n            case events.backend.XML_SELECT_ALL:\n                this._selectAll(req.data);\n                break;\n            default:\n                // Cannot handle.\n                return;\n        }\n\n        // Indicate an async response.\n        return true;\n    }\n};\n\nmodule.exports = new XMLHandler();\n\n\n\n// WEBPACK FOOTER //\n// ./modules/offscreen/xml-handler.js","/**\n * Запуск offscreen\n */\n'use strict';\n\nconst messaging = require('../offscreen/messaging');\n\nexports.run = () => {\n  messaging.init();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./modules/startup/offscreen.js"],"sourceRoot":""}