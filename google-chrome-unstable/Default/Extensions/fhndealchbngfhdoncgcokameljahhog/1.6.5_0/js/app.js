/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
'use strict';var f,aa=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},ba=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a},da=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");
},p=da(this),v=function(a,b){if(b)a:{var c=p;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&b!=null&&ba(c,a,{configurable:!0,writable:!0,value:b})}};
v("Symbol",function(a){if(a)return a;var b=function(g,h){this.$jscomp$symbol$id_=g;ba(this,"description",{configurable:!0,writable:!0,value:h})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",d=0,e=function(g){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(g||"")+"_"+d++,g)};return e},"es6","es3");
v("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=p[b[c]];typeof d==="function"&&typeof d.prototype[a]!="function"&&ba(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ea(aa(this))}})}return a},"es6","es3");
var ea=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a},y=function(a){return w(a,a)},w=function(a,b){a.raw=b;Object.freeze&&(Object.freeze(a),Object.freeze(b));return a},z=function(a){var b=typeof Symbol!="undefined"&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if(typeof a.length=="number")return{next:aa(a)};throw Error(String(a)+" is not an iterable or ArrayLike");},fa=typeof Object.create=="function"?Object.create:function(a){var b=function(){};b.prototype=
a;return new b},ha;if(typeof Object.setPrototypeOf=="function")ha=Object.setPrototypeOf;else{var ia;a:{var ja={a:!0},ka={};try{ka.__proto__=ja;ia=ka.a;break a}catch(a){}ia=!1}ha=ia?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}
var la=ha,ma=function(a,b){a.prototype=fa(b.prototype);a.prototype.constructor=a;if(la)la(a,b);else for(var c in b)if(c!="prototype")if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype},na=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");},oa=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=
this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};f=oa.prototype;f.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};f.stop_=function(){this.isRunning_=!1};f.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};f.JSC$2880_next_=function(a){this.yieldResult=a};f.JSC$2880_throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};
f.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};f.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};f.yield=function(a,b){this.nextAddress=b;return{value:a}};f.yieldAll=function(a,b){a=z(a);var c=a.next();na(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};f.jumpTo=function(a){this.nextAddress=a};
f.jumpToEnd=function(){this.nextAddress=0};f.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;b!=void 0&&(this.finallyAddress_=b)};f.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};f.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};f.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};
f.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
f.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();b.jumpTo!=void 0&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};f.forIn=function(a){return new pa(a)};var pa=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};
pa.prototype.getNext=function(){for(;this.properties_.length>0;){var a=this.properties_.pop();if(a in this.object_)return a}return null};var qa=function(a){this.context_=new oa;this.program_=a};f=qa.prototype;f.JSC$2891_next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.JSC$2880_next_);this.context_.JSC$2880_next_(a);return this.nextStep_()};
f.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};f.JSC$2891_throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.JSC$2880_next_);this.context_.JSC$2880_throw_(a);return this.nextStep_()};
f.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);na(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.JSC$2880_throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
f.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.JSC$2880_throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
var ra=function(a){this.next=function(b){return a.JSC$2891_next_(b)};this.throw=function(b){return a.JSC$2891_throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}},sa=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function g(h){h.done?d(h.value):Promise.resolve(h.value).then(b,c).then(g,e)}g(a.next())})},A=function(a){return sa(new ra(new qa(a)))},ta=function(){for(var a=Number(this),b=[],
c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b};
v("Promise",function(a){function b(){this.batch_=null}function c(h){return h instanceof e?h:new e(function(k){k(h)})}if(a)return a;b.prototype.asyncExecute=function(h){if(this.batch_==null){this.batch_=[];var k=this;this.asyncExecuteFunction(function(){k.executeBatch_()})}this.batch_.push(h)};var d=p.setTimeout;b.prototype.asyncExecuteFunction=function(h){d(h,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var h=this.batch_;this.batch_=[];for(var k=0;k<h.length;++k){var l=
h[k];h[k]=null;try{l()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};b.prototype.asyncThrow_=function(h){this.asyncExecuteFunction(function(){throw h;})};var e=function(h){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var k=this.createResolveAndReject_();try{h(k.resolve,k.reject)}catch(l){k.reject(l)}};e.prototype.createResolveAndReject_=function(){function h(m){return function(n){l||(l=!0,m.call(k,n))}}var k=this,l=!1;return{resolve:h(this.resolveTo_),
reject:h(this.reject_)}};e.prototype.resolveTo_=function(h){if(h===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(h instanceof e)this.settleSameAsPromise_(h);else{a:switch(typeof h){case "object":var k=h!=null;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(h):this.fulfill_(h)}};e.prototype.resolveToNonPromiseObj_=function(h){var k=void 0;try{k=h.then}catch(l){this.reject_(l);return}typeof k=="function"?this.settleSameAsThenable_(k,
h):this.fulfill_(h)};e.prototype.reject_=function(h){this.settle_(2,h)};e.prototype.fulfill_=function(h){this.settle_(1,h)};e.prototype.settle_=function(h,k){if(this.state_!=0)throw Error("Cannot settle("+h+", "+k+"): Promise already settled in state"+this.state_);this.state_=h;this.result_=k;this.state_===2&&this.scheduleUnhandledRejectionCheck_();this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var h=this;d(function(){if(h.notifyUnhandledRejection_()){var k=
p.console;typeof k!=="undefined"&&k.error(h.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var h=p.CustomEvent,k=p.Event,l=p.dispatchEvent;if(typeof l==="undefined")return!0;typeof h==="function"?h=new h("unhandledrejection",{cancelable:!0}):typeof k==="function"?h=new k("unhandledrejection",{cancelable:!0}):(h=p.document.createEvent("CustomEvent"),h.initCustomEvent("unhandledrejection",!1,!0,h));h.promise=this;h.reason=this.result_;return l(h)};
e.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){for(var h=0;h<this.onSettledCallbacks_.length;++h)g.asyncExecute(this.onSettledCallbacks_[h]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(h){var k=this.createResolveAndReject_();h.callWhenSettled_(k.resolve,k.reject)};e.prototype.settleSameAsThenable_=function(h,k){var l=this.createResolveAndReject_();try{h.call(k,l.resolve,l.reject)}catch(m){l.reject(m)}};e.prototype.then=
function(h,k){function l(x,t){return typeof x=="function"?function(u){try{m(x(u))}catch(q){n(q)}}:t}var m,n,r=new e(function(x,t){m=x;n=t});this.callWhenSettled_(l(h,m),l(k,n));return r};e.prototype.catch=function(h){return this.then(void 0,h)};e.prototype.callWhenSettled_=function(h,k){function l(){switch(m.state_){case 1:h(m.result_);break;case 2:k(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;this.onSettledCallbacks_==null?g.asyncExecute(l):this.onSettledCallbacks_.push(l);
this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(h){return new e(function(k,l){l(h)})};e.race=function(h){return new e(function(k,l){for(var m=z(h),n=m.next();!n.done;n=m.next())c(n.value).callWhenSettled_(k,l)})};e.all=function(h){var k=z(h),l=k.next();return l.done?c([]):new e(function(m,n){function r(u){return function(q){x[u]=q;t--;t==0&&m(x)}}var x=[],t=0;do x.push(void 0),t++,c(l.value).callWhenSettled_(r(x.length-1),n),l=k.next();while(!l.done)})};return e},"es6","es3");
var B=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},ua=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};v("Array.prototype.keys",function(a){return a?a:function(){return ua(this,function(b){return b})}},"es6","es3");
v("WeakMap",function(a){function b(){}function c(l){var m=typeof l;return m==="object"&&l!==null||m==="function"}function d(l){if(!B(l,g)){var m=new b;ba(l,g,{value:m})}}function e(l){var m=Object[l];m&&(Object[l]=function(n){if(n instanceof b)return n;Object.isExtensible(n)&&d(n);return m(n)})}if(function(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),m=Object.seal({}),n=new a([[l,2],[m,3]]);if(n.get(l)!=2||n.get(m)!=3)return!1;n.delete(l);n.set(m,4);return!n.has(l)&&n.get(m)==4}catch(r){return!1}}())return a;
var g="$jscomp_hidden_"+Math.random();e("freeze");e("preventExtensions");e("seal");var h=0,k=function(l){this.id_=(h+=Math.random()+1).toString();if(l){l=z(l);for(var m;!(m=l.next()).done;)m=m.value,this.set(m[0],m[1])}};k.prototype.set=function(l,m){if(!c(l))throw Error("Invalid WeakMap key");d(l);if(!B(l,g))throw Error("WeakMap key fail: "+l);l[g][this.id_]=m;return this};k.prototype.get=function(l){return c(l)&&B(l,g)?l[g][this.id_]:void 0};k.prototype.has=function(l){return c(l)&&B(l,g)&&B(l[g],
this.id_)};k.prototype.delete=function(l){return c(l)&&B(l,g)&&B(l[g],this.id_)?delete l[g][this.id_]:!1};return k},"es6","es3");
v("Map",function(a){if(function(){if(!a||typeof a!="function"||!a.prototype.entries||typeof Object.seal!="function")return!1;try{var k=Object.seal({x:4}),l=new a(z([[k,"s"]]));if(l.get(k)!="s"||l.size!=1||l.get({x:4})||l.set({x:4},"t")!=l||l.size!=2)return!1;var m=l.entries(),n=m.next();if(n.done||n.value[0]!=k||n.value[1]!="s")return!1;n=m.next();return n.done||n.value[0].x!=4||n.value[1]!="t"||!m.next().done?!1:!0}catch(r){return!1}}())return a;var b=new WeakMap,c=function(k){this[0]={};this[1]=
g();this.size=0;if(k){k=z(k);for(var l;!(l=k.next()).done;)l=l.value,this.set(l[0],l[1])}};c.prototype.set=function(k,l){k=k===0?0:k;var m=d(this,k);m.list||(m.list=this[0][m.id]=[]);m.entry?m.entry.value=l:(m.entry={next:this[1],previous:this[1].previous,head:this[1],key:k,value:l},m.list.push(m.entry),this[1].previous.next=m.entry,this[1].previous=m.entry,this.size++);return this};c.prototype.delete=function(k){k=d(this,k);return k.entry&&k.list?(k.list.splice(k.index,1),k.list.length||delete this[0][k.id],
k.entry.previous.next=k.entry.next,k.entry.next.previous=k.entry.previous,k.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this[0]={};this[1]=this[1].previous=g();this.size=0};c.prototype.has=function(k){return!!d(this,k).entry};c.prototype.get=function(k){return(k=d(this,k).entry)&&k.value};c.prototype.entries=function(){return e(this,function(k){return[k.key,k.value]})};c.prototype.keys=function(){return e(this,function(k){return k.key})};c.prototype.values=function(){return e(this,
function(k){return k.value})};c.prototype.forEach=function(k,l){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,k.call(l,n[1],n[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(k,l){var m=l&&typeof l;m=="object"||m=="function"?b.has(l)?m=b.get(l):(m=""+ ++h,b.set(l,m)):m="p_"+l;var n=k[0][m];if(n&&B(k[0],m))for(k=0;k<n.length;k++){var r=n[k];if(l!==l&&r.key!==r.key||l===r.key)return{id:m,list:n,index:k,entry:r}}return{id:m,list:n,index:-1,entry:void 0}},e=function(k,
l){var m=k[1];return ea(function(){if(m){for(;m.head!=k[1];)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:l(m)};m=null}return{done:!0,value:void 0}})},g=function(){var k={};return k.previous=k.next=k.head=k},h=0;return c},"es6","es3");
var va=function(a,b,c){if(a==null)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};v("Object.is",function(a){return a?a:function(b,c){return b===c?b!==0||1/b===1/c:b!==b&&c!==c}},"es6","es3");
v("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(c<0&&(c=Math.max(c+e,0));c<e;c++){var g=d[c];if(g===b||Object.is(g,b))return!0}return!1}},"es7","es3");v("String.prototype.includes",function(a){return a?a:function(b,c){return va(this,b,"includes").indexOf(b,c||0)!==-1}},"es6","es3");
v("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=va(this,b,"startsWith");b+="";var e=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var h=0;h<g&&c<e;)if(d[c++]!=b[h++])return!1;return h>=g}},"es6","es3");
v("Array.from",function(a){return a?a:function(b,c,d){c=c!=null?c:function(k){return k};var e=[],g=typeof Symbol!="undefined"&&Symbol.iterator&&b[Symbol.iterator];if(typeof g=="function"){b=g.call(b);for(var h=0;!(g=b.next()).done;)e.push(c.call(d,g.value,h++))}else for(g=b.length,h=0;h<g;h++)e.push(c.call(d,b[h],h));return e}},"es6","es3");
v("String.prototype.repeat",function(a){return a?a:function(b){var c=va(this,null,"repeat");if(b<0||b>1342177279)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");v("String.prototype.padStart",function(a){return a?a:function(b,c){var d=va(this,null,"padStart");b-=d.length;c=c!==void 0?String(c):" ";return(b>0&&c?c.repeat(Math.ceil(b/c.length)).substring(0,b):"")+d}},"es8","es3");
v("Array.prototype.values",function(a){return a?a:function(){return ua(this,function(b,c){return c})}},"es8","es3");
var wa=this||self,D=function(a,b,c,d){a=a.split(".");d=d||wa;a[0]in d||typeof d.execScript=="undefined"||d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||b===void 0)d[e]&&d[e]!==Object.prototype[e]?d=d[e]:d=d[e]={};else if(!c&&xa(b)&&xa(d[e]))for(var g in b)b.hasOwnProperty(g)&&(d[e][g]=b[g]);else d[e]=b},ya=function(a){var b=typeof a;return b!="object"?b:a?Array.isArray(a)?"array":b:"null"},za=function(a){var b=ya(a);return b=="array"||b=="object"&&typeof a.length=="number"},
xa=function(a){var b=typeof a;return b=="object"&&a!=null||b=="function"},Aa=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(d,e,g){for(var h=Array(arguments.length-2),k=2;k<arguments.length;k++)h[k-2]=arguments[k];return b.prototype[e].apply(d,h)}},Ba=function(a){return a};/*

 Copyright Google LLC
 SPDX-License-Identifier: Apache-2.0
*/
var E={};function Ca(a){if(a!==E)throw Error("Bad secret");};var Da=y([""]),Ea=w(["\x00"],["\\0"]),Fa=w(["\n"],["\\n"]),Ga=w(["\x00"],["\\u0000"]),Ha=y([""]),Ia=w(["\x00"],["\\0"]),Ja=w(["\n"],["\\n"]),Ka=w(["\x00"],["\\u0000"]);function F(a){return Object.isFrozen(a)&&Object.isFrozen(a.raw)}function La(a){return a.toString().indexOf("`")===-1}var Ma=La(function(a){return a(Da)})||La(function(a){return a(Ea)})||La(function(a){return a(Fa)})||La(function(a){return a(Ga)}),Na=F(Ha)&&F(Ia)&&F(Ja)&&F(Ka);var Oa,Pa=function(){if(Oa===void 0){var a=null,b=wa.trustedTypes;if(b&&b.createPolicy){try{a=b.createPolicy("goog#html",{createHTML:Ba,createScript:Ba,createScriptURL:Ba})}catch(c){wa.console&&wa.console.error(c.message)}Oa=a}else Oa=a}return Oa};var G=function(a,b){Ca(a);this.privateDoNotAccessOrElseWrappedHtml=b};G.prototype.toString=function(){return this.privateDoNotAccessOrElseWrappedHtml+""};function Qa(a){var b=Pa();return new G(E,b?b.createHTML(a):a)}function Ra(a){if(a instanceof G)return a.privateDoNotAccessOrElseWrappedHtml;throw Error("Unexpected type when unwrapping SafeHtml");};var H=function(a,b){Ca(a);this.privateDoNotAccessOrElseWrappedResourceUrl=b};H.prototype.toString=function(){return this.privateDoNotAccessOrElseWrappedResourceUrl+""};function Sa(a){var b=Pa();return new H(E,b?b.createScriptURL(a):a)}function Ta(a){if(a instanceof H)return a.privateDoNotAccessOrElseWrappedResourceUrl;throw Error("Unexpected type when unwrapping TrustedResourceUrl");};var I=function(a,b){Ca(a);this.privateDoNotAccessOrElseWrappedUrl=b};I.prototype.toString=function(){return this.privateDoNotAccessOrElseWrappedUrl};new I(E,"about:blank");new I(E,"about:invalid#zClosurez");function Ua(a){if(a instanceof I)return a.privateDoNotAccessOrElseWrappedUrl;throw Error("Unexpected type when unwrapping SafeUrl, got '"+a+"' of type '"+typeof a+"'");};var Va=[],Wa=function(a){console.warn("A URL with content '"+a+"' was sanitized away.")};Va.indexOf(Wa)===-1&&Va.push(Wa);function Xa(a){var b=ta.apply(1,arguments),c=b.length;if(!Array.isArray(a)||!Array.isArray(a.raw)||a.length!==a.raw.length||!Ma&&a===a.raw||!(Ma&&!Na||F(a))||c+1!==a.length)throw new TypeError("\n    ############################## ERROR ##############################\n\n    It looks like you are trying to call a template tag function (fn`...`)\n    using the normal function syntax (fn(...)), which is not supported.\n\n    The functions in the safevalues library are not designed to be called\n    like normal functions, and doing so invalidates the security guarantees\n    that safevalues provides.\n\n    If you are stuck and not sure how to proceed, please reach out to us\n    instead through:\n     - go/ise-hardening-yaqs (preferred) // LINE-INTERNAL\n     - g/ise-hardening // LINE-INTERNAL\n     - https://github.com/google/safevalues/issues\n\n    ############################## ERROR ##############################");
if(b.length===0)return Sa(a[0]);c=a[0].toLowerCase();if(/^data:/.test(c))throw Error("Data URLs cannot have expressions in the template literal input.");if(/^https:\/\//.test(c)||/^\/\//.test(c)){var d=c.indexOf("//")+2;var e=c.indexOf("/",d);if(e<=d)throw Error("Can't interpolate data in a url's origin, Please make sure to fully specify the origin, terminated with '/'.");d=c.substring(d,e);if(!/^[0-9a-z.:-]+$/i.test(d))throw Error("The origin contains unsupported characters.");if(!/^[^:]*(:[0-9]+)?$/i.test(d))throw Error("Invalid port number.");
if(!/(^|\.)[a-z][^.]*$/i.test(d))throw Error("The top-level domain must start with a letter.");d=!0}else d=!1;if(!d)if(/^\//.test(c))if(c==="/"||c.length>1&&c[1]!=="/"&&c[1]!=="\\")d=!0;else throw Error("The path start in the url is invalid.");else d=!1;if(!(d=d||RegExp("^[^:\\s\\\\/]+/").test(c)))if(/^about:blank/.test(c)){if(c!=="about:blank"&&!/^about:blank#/.test(c))throw Error("The about url is invalid.");d=!0}else d=!1;if(!d)throw Error("Trying to interpolate expressions in an unsupported url format.");
c=a[0];for(d=0;d<b.length;d++)c+=encodeURIComponent(b[d])+a[d+1];return Sa(c)};D("ng.safehtml.googSceHelper.isGoogHtmlType",function(a){return typeof a==="object"&&(a instanceof H||a instanceof G||a instanceof I||!1)},!0,void 0);D("ng.safehtml.googSceHelper.isCOMPILED",function(){return!0},!0,void 0);D("ng.safehtml.googSceHelper.unwrapAny",function(a){if(a instanceof H)return Ta(a).toString();if(a instanceof G)return Ra(a).toString();if(a instanceof I)return Ua(a);throw Error();},!0,void 0);
D("ng.safehtml.googSceHelper.unwrapGivenContext",function(a,b){if(a=="html")return Ra(b).toString();if(a=="resourceUrl"||a=="templateUrl")return Ta(b).toString();if(a=="url")return b instanceof H?Ta(b).toString():Ua(b);if(a=="css")throw Error("Unexpected type when unwrapping SafeStyle, got '"+b+"' of type '"+typeof b+"'");if(a=="js")throw Error("Unexpected type when unwrapping SafeScript");throw Error();},!0,void 0);var J=["NONE","ERROR","WARNING","INFO","DEBUG"],Ya={cep_proxy_url:!0,enable_auto_enrollment:!0,enable_certificate_renewal:!0,allow_machine_cert_enrollment:!0,user_enrollment_templates:!0,device_enrollment_templates:!0,placeholder_values:!0,company_info:!0,log_level:!0,user_cert_request_values:!0,device_cert_request_values:!0,signature_algo:!0,pending_ui_enabled:!0,renew_hours_before_expiry:!0,renew_reminder_interval:!0,request_timeout_seconds:!0,va_api_key:!0,va_enabled:!0,va_google_url:!0,va_shared_secret:!0,
va_request_timeout_seconds:!0,service_account_name:!0,service_account_password:!0,client_authentication:!0,use_key_based_renewal:!0,ces_renewal_url:!0,service_account_host:!0,service_account_host_password_mask:!0},K=J.indexOf("ERROR"),Za=J.indexOf("WARNING"),L=J.indexOf("INFO"),M=J.indexOf("DEBUG"),$a="",N=function(a,b,c){b>0&&b<=c&&b<J.length&&(a=J[b]+": "+a,console.log(a),$a+="\n"+a)},O=function(a,b){K>0&&K<=b&&K<J.length&&(a=J[K]+": "+a,console.log(a),$a+="\n"+a)},ab=function(a){var b="";a=new Uint8Array(a);
for(var c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},bb=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c},cb=function(a,b){var c="";a=a.getElementsByTagName(b);a!=null&&a!=void 0&&a.length!=0&&(c=a[a.length-1].innerHTML);if(c==null||c==void 0)c="";return c},db=function(a){return new Promise(function(b,c){try{chrome.enterprise.platformKeys.getCertificates(a,function(d){chrome.runtime.lastError?c(chrome.runtime.lastError):
b(d)})}catch(d){c(d)}})},eb=function(){return new Promise(function(a,b){try{chrome.storage.local.get("ignored_renewal_requests",function(c){c&&c.ignored_renewal_requests?a(c.ignored_renewal_requests):a([])})}catch(c){b(c)}})},fb=function(a){return"certificate_renewal_alarm:"+(new Uint8Array(a.serialNumber.value_block.value_hex)).toString()},gb=function(a){return A(function(b){if(a=="")return b.jumpTo(0);N("Cleaning alarm "+a,M,M);return b.yield(chrome.alarms.clear(a),0)})},ib=function(a,b,c){var d,
e;return A(function(g){if(g.nextAddress==1)return g.yield(hb(a),2);if(d=g.yieldResult)return g.return();e=a.notAfter.value;b>0&&e.setHours(e.getHours()-b);chrome.alarms.create(fb(a),{when:e.getTime(),periodInMinutes:c*60});g.jumpToEnd()})},hb=function(a){var b;return A(function(c){b=fb(a);return c.return(new Promise(function(d,e){chrome.alarms.get(b,function(g){chrome.runtime.lastError?e(chrome.runtime.lastError):d(g!=void 0?!0:!1)})}))})},jb=function(a){var b,c,d,e,g,h,k,l,m,n;return A(function(r){if(r.nextAddress==
1)return b=null,r.yield(eb(),2);if(r.nextAddress!=3)return c=r.yieldResult,c.length>0&&N("The following certificates are explicitly ignored for renewal by the user: "+c.join("\n"),M,M),r.yield(db(a),3);d=r.yieldResult;e=z(d);for(g=e.next();!g.done;g=e.next())if(h=g.value,k=window.org.pkijs.fromBER(h),l=new window.org.pkijs.simpl.CERT({schema:k.result}),b==null||b.notAfter.value<l.notAfter.value)c.includes((new Uint8Array(l.serialNumber.value_block.value_hex)).toString())||(b=l);if(!b)return r.return(null);
m=new Date;n=b.notAfter.value;return n<m?r.return(null):r.return(b)})},kb=function(a){var b,c,d,e;return A(function(g){if(g.nextAddress==1)return b="user",g.yield(jb("user"),2);if(g.nextAddress!=3)return d=c=g.yieldResult,a?g.yield(jb("system"),3):d?g.return({slot:b,cert:d}):g.return(null);(e=g.yieldResult)&&(!c||e.notAfter.value<c.notAfter.value)&&(b="system",d=e);return d?g.return({slot:b,cert:d}):g.return(null)})},lb=function(a,b){return a.replace(/\${(.+?)(:"(.+?)")?}/g,function(c,d,e,g){c=d.split(":");
for(d=0;d<c.length;++d)if(e=c[d],e in b&&b[e])return b[e];return g?g:""})},mb=function(a){for(var b=0;b<a.children.length;++b){var c=a.children[b];c.hasAttribute("id")&&c.getAttribute("id").startsWith("ccr-")&&c.removeAttribute("id");c.children.length&&mb(c)}},P=function(a){a=a.replace(/\s+/g," ").trim();a=a.replace(/>\s*/g,">");return a=a.replace(/\s*</g,"<")},nb=function(a){return Array.from(a).map(function(b){return b.toString(16).padStart(2,"0")}).join("")},ob=function(a,b){b=b===void 0?7E3:b;
var c,d,e;return A(function(g){if(g.nextAddress==1)return c=void 0,d=new Promise(function(h,k){c=setTimeout(function(){k("TimeoutError")},b)}),g.yield(Promise.race([a,d]),2);e=g.yieldResult;c!==void 0&&clearTimeout(c);return g.return(e)})},pb=function(a){return a.length==0?new Uint8Array(0):a.length%2!=0||a.match("^[0-9a-f]*$")==null?null:new Uint8Array(a.match(/.{1,2}/g).map(function(b){return parseInt(b,16)}))},qb=function(a){var b,c,d,e,g,h,k,l,m;return A(function(n){switch(n.nextAddress){case 1:return n.yield(window.crypto.subtle.generateKey({name:"AES-GCM",
length:256},!0,["encrypt"]),2);case 2:return b=n.yieldResult,c=new Uint8Array(16),window.crypto.getRandomValues(c),d=(new TextEncoder).encode(a),e=Uint8Array,n.yield(crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:128},b,d),3);case 3:return g=new e(n.yieldResult),h=nb(c)+nb(g),k=Uint8Array,n.yield(window.crypto.subtle.exportKey("raw",b),4);case 4:return l=new k(n.yieldResult),m=nb(l),n.return({mask:m,masked:h})}})},rb=function(a){var b,c,d,e,g;return A(function(h){if(h.nextAddress==1)return b=
pb(a.mask),h.yield(window.crypto.subtle.importKey("raw",b.buffer,{name:"AES-GCM"},!0,["decrypt"]),2);if(h.nextAddress!=3)return c=h.yieldResult,d=pb(a.masked.slice(0,32)),e=pb(a.masked.slice(32)),h.yield(window.crypto.subtle.decrypt({name:"AES-GCM",iv:d.buffer,tagLength:128},c,e.buffer),3);g=h.yieldResult;return h.return((new TextDecoder).decode(g))})},sb=function(a,b,c){var d,e;return A(function(g){switch(g.nextAddress){case 1:if(!a){g.jumpTo(2);break}return g.yield(jb("system"),3);case 3:return(d=
g.yieldResult)?g.return(null):b?g.return({slot:"system",method:"kerberos"}):c?g.return({slot:"system",method:"service_account"}):g.return(null);case 2:return g.yield(jb("user"),4);case 4:return(e=g.yieldResult)?g.return(null):b?g.return({slot:"user",method:"kerberos"}):g.return(null)}})};var ub=function(a){this.cesRenewalUrl_=this.cepProxyUrl_="";this.isMachineCertEnrollmentAllowed_=this.isAutoEnrollmentEnabled_=!1;this.userEnrollmentTemplates_=["ChromeOSWirelessUser"];this.deviceEnrollmentTemplates_=["ChromeOSWirelessDevice"];this.userCertRequestValues_={};this.deviceCertRequestValues_={};this.placeholderValues_={Username:"Username",Password:"Password",Uri:"Enrollment URI",RequestId:"Request ID",Header:"Certificate Enrollment"};this.companyInfo_={name:"Your company name goes here.",
logo:"Your company logo goes here.",help_url:"https://support.google.com/chrome/a/answer/6324985",help_text:"Please contact your administrator for assistance."};this.logLevel_=0;this.signatureAlgo_=tb.SHA512;this.isPendingUIEnabled_=!1;this.renewHoursBeforeExpiry_=120;this.renewReminderInterval_=24;this.requestTimeoutMilliseconds_=2E4;this.apiKey_="";this.isVerifiedAccessEnabled_=!1;this.verifiedAccessUrl_="https://verifiedaccess.googleapis.com/v1/challenge?key=";this.verifiedAccessSharedSecret_=
"";this.vaRequestTimeoutMilliseconds_=6E4;this.serviceAccountHostPasswordMask_=this.serviceAccountHost_=this.serviceAccountPassword_=this.serviceAccountName_="";this.clientAuthentication_="basic";this.isKeyBasedRenewalEnabled_=!1;this.JSC$3051_q_=a};f=ub.prototype;f.getLoginPageLoginTabLabel=function(){return chrome.i18n.getMessage("managed_login_tab_label")};f.getLoginPageStatusTabLabel=function(){return chrome.i18n.getMessage("managed_status_tab_label")};f.getLoginPageDeviceWideCheckboxText=function(){return chrome.i18n.getMessage("managed_login_device_wide_checkbox")};
f.getLoginPageUseServiceAccountCheckboxText=function(){return chrome.i18n.getMessage("managed_login_use_service_account_checkbox")};f.getLoginPageLoginButtonText=function(){return chrome.i18n.getMessage("managed_login_button")};f.getLoginPageStatusHeaderText=function(){return chrome.i18n.getMessage("managed_status_header")};f.getLoginPageStatusButtonText=function(){return chrome.i18n.getMessage("managed_status_button")};f.getLoginPageMoreOptionsText=function(){return chrome.i18n.getMessage("managed_more_options")};
f.getLoginPageHelpLabelText=function(){return chrome.i18n.getMessage("managed_help_text")};f.getLoginPageLicenseButtonText=function(){return chrome.i18n.getMessage("managed_license_button")};f.getLoginPageClipboardButtonText=function(){return chrome.i18n.getMessage("managed_clipboard_button")};f.getCompanyName=function(){return this.companyInfo_&&this.companyInfo_.name?this.companyInfo_.name:"Your company name goes here."};
f.getCompanyLogo=function(){return this.companyInfo_&&this.companyInfo_.logo?this.companyInfo_.logo:"Your company logo goes here."};f.getHelpUrl=function(){return this.companyInfo_&&this.companyInfo_.help_url?this.companyInfo_.help_url:"https://support.google.com/chrome/a/answer/6324985"};f.getHelpText=function(){return this.companyInfo_&&this.companyInfo_.help_text?this.companyInfo_.help_text:""};
f.getLoginPageHeaderText=function(){return this.placeholderValues_&&this.placeholderValues_.Header?this.placeholderValues_.Header=="managed_login_header"?chrome.i18n.getMessage("managed_login_header"):this.placeholderValues_.Header:"Certificate Enrollment"};
f.getUsernameFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.Username?this.placeholderValues_.Username=="managed_username_placeholder"?chrome.i18n.getMessage("managed_username_placeholder"):this.placeholderValues_.Username:"Username"};
f.getPasswordFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.Password?this.placeholderValues_.Password=="managed_password_placeholder"?chrome.i18n.getMessage("managed_password_placeholder"):this.placeholderValues_.Password:"Password"};f.getUriFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.Uri?this.placeholderValues_.Uri:"Enrollment URI"};
f.getRequestIdFormFieldPlaceholder=function(){return this.placeholderValues_&&this.placeholderValues_.RequestId?this.placeholderValues_.RequestId:"Request ID"};f.getCepProxyUrl=function(){return this.cepProxyUrl_};f.getCesRenewalUrl=function(){return this.cesRenewalUrl_};f.isMachineCertEnrollmentAllowed=function(){return this.isMachineCertEnrollmentAllowed_};f.getUserEnrollmentTemplates=function(){return this.userEnrollmentTemplates_};f.getDeviceEnrollmentTemplates=function(){return this.deviceEnrollmentTemplates_};
f.JSC$3053_getLogLevel=function(){return this.logLevel_};f.getSignatureAlgorithm=function(){return this.signatureAlgo_};f.isPendingUIEnabled=function(){return this.isPendingUIEnabled_};f.getHoursOffset=function(){return this.renewHoursBeforeExpiry_};f.getNotificationInterval=function(){return this.renewReminderInterval_};f.getXhrRequestTimeout=function(){return this.requestTimeoutMilliseconds_>0?this.requestTimeoutMilliseconds_:2E4};f.getApiKey=function(){return this.apiKey_};
f.isVerifiedAccessEnabled=function(){return this.isVerifiedAccessEnabled_};f.getVerifiedAccessUrl=function(){return this.verifiedAccessUrl_!=""?this.verifiedAccessUrl_:"https://verifiedaccess.googleapis.com/v1/challenge?key="};f.getVerifiedAccessSharedSecret=function(){return this.verifiedAccessSharedSecret_};f.getVerifiedAccessRequestTimeout=function(){return this.vaRequestTimeoutMilliseconds_>0?this.vaRequestTimeoutMilliseconds_:6E4};f.getServiceAccountName=function(){return this.serviceAccountName_};
f.getServiceAccountPassword=function(){return this.serviceAccountPassword_};f.getServiceAccountHost=function(){return this.serviceAccountHost_};f.getServiceAccountHostPasswordMask=function(){return this.serviceAccountHostPasswordMask_};f.getClientAuthentication=function(){return this.clientAuthentication_};f.getIsKeyBasedRenewalEnabled=function(){return this.isKeyBasedRenewalEnabled_};f.setCepProxyUrl_=function(a){this.cepProxyUrl_=a};f.setCesRenewalUrl_=function(a){this.cesRenewalUrl_=a};
f.setAutoEnrollmentEnabled_=function(a){this.isAutoEnrollmentEnabled_=a};f.setMachineCertEnrollmentAllowed_=function(a){this.isMachineCertEnrollmentAllowed_=a};f.setUserEnrollmentTemplates_=function(a){this.userEnrollmentTemplates_=a};f.setDeviceEnrollmentTemplates_=function(a){this.deviceEnrollmentTemplates_=a};f.setUserCertRequestValues_=function(a){this.userCertRequestValues_=a};f.getUserCertRequestValues=function(){return this.userCertRequestValues_};
f.setDeviceCertRequestValues_=function(a){this.deviceCertRequestValues_=a};f.getDeviceCertRequestValues=function(){return this.deviceCertRequestValues_};f.setPlaceholderValues_=function(a){this.placeholderValues_=a};f.setCompanyInfo_=function(a){this.companyInfo_=a};f.setLogLevel_=function(a){a=J.indexOf(a);a!=-1?this.logLevel_=a:N(chrome.i18n.getMessage("managed_log_level_error"),K,this.JSC$3053_getLogLevel())};
f.setSignatureAlgorithm_=function(a){tb[a]?this.signatureAlgo_=tb[a]:N(chrome.i18n.getMessage("managed_signature_algo_error"),K,this.JSC$3053_getLogLevel())};f.setPendingUIEnabled_=function(a){this.isPendingUIEnabled_=a};f.setRenewHoursBeforeExpiry_=function(a){this.renewHoursBeforeExpiry_=a};f.setRenewReminderInterval_=function(a){this.renewReminderInterval_=a};f.setXhrRequestTimeoutMilliseconds_=function(a){this.requestTimeoutMilliseconds_=a*1E3};f.setApiKey_=function(a){this.apiKey_=a};
f.setVerifiedAccessEnabled_=function(a){this.isVerifiedAccessEnabled_=a};f.setVerifiedAccessUrl_=function(a){this.verifiedAccessUrl_=a};f.setVerifiedAccessSharedSecret_=function(a){this.verifiedAccessSharedSecret_=a};f.setVaRequestTimeoutMilliseconds_=function(a){this.vaRequestTimeoutMilliseconds_=a*1E3};f.setServiceAccountName_=function(a){this.serviceAccountName_=a};f.setServiceAccountPassword_=function(a){this.serviceAccountPassword_=a};
f.setServiceAccountHost_=function(a){this.serviceAccountHost_=a};f.setServiceAccountHostPasswordMask_=function(a){this.serviceAccountHostPasswordMask_=a};f.setClientAuthentication_=function(a){Object.keys(vb).includes(a)&&(this.clientAuthentication_=a)};f.setIsKeyBasedRenewalEnabled_=function(a){this.isKeyBasedRenewalEnabled_=a};
f.populatePolicyChanges_=function(a){N(chrome.i18n.getMessage("managed_policy_handling_info"),L,this.JSC$3053_getLogLevel());a=JSON.parse(a);for(var b in a){var c=a[b];switch(b){case "cep_proxy_url":this.setCepProxyUrl_(c);break;case "enable_auto_enrollment":this.setAutoEnrollmentEnabled_(c);break;case "allow_machine_cert_enrollment":this.setMachineCertEnrollmentAllowed_(c);break;case "user_enrollment_templates":this.setUserEnrollmentTemplates_(c);break;case "device_enrollment_templates":this.setDeviceEnrollmentTemplates_(c);
break;case "user_cert_request_values":this.setUserCertRequestValues_(c);break;case "device_cert_request_values":this.setDeviceCertRequestValues_(c);break;case "placeholder_values":this.setPlaceholderValues_(c);break;case "company_info":this.setCompanyInfo_(c);break;case "log_level":this.setLogLevel_(c);break;case "signature_algo":this.setSignatureAlgorithm_(c);break;case "pending_ui_enabled":this.setPendingUIEnabled_(c);break;case "renew_hours_before_expiry":this.setRenewHoursBeforeExpiry_(c);break;
case "renew_reminder_interval":this.setRenewReminderInterval_(c);break;case "request_timeout_seconds":this.setXhrRequestTimeoutMilliseconds_(c);break;case "va_api_key":this.setApiKey_(c);break;case "va_enabled":this.setVerifiedAccessEnabled_(c);break;case "va_google_url":this.setVerifiedAccessUrl_(c);break;case "va_shared_secret":this.setVerifiedAccessSharedSecret_(c);break;case "va_request_timeout_seconds":this.setVaRequestTimeoutMilliseconds_(c);break;case "service_account_name":this.setServiceAccountName_(c);
break;case "service_account_password":this.setServiceAccountPassword_(c);break;case "service_account_host":this.setServiceAccountHost_(c);break;case "service_account_host_password_mask":this.setServiceAccountHostPasswordMask_(c);break;case "client_authentication":this.setClientAuthentication_(c);break;case "use_key_based_renewal":this.setIsKeyBasedRenewalEnabled_(c);break;case "ces_renewal_url":this.setCesRenewalUrl_(c)}}b=this.getCepProxyUrl();b===""?N(chrome.i18n.getMessage("managed_cep_empty_error"),
K,this.JSC$3053_getLogLevel()):this.isHttpsUrl_(b)||N(chrome.i18n.getMessage("managed_cep_http_error"),K,this.JSC$3053_getLogLevel());this.isHttpsUrl_(this.getVerifiedAccessUrl())||N(chrome.i18n.getMessage("managed_va_url_http_error"),K,this.JSC$3053_getLogLevel());this.isHttpsUrl_(this.getHelpUrl())||N(chrome.i18n.getMessage("managed_company_url_http_error"),K,this.JSC$3053_getLogLevel())};
f.requestPolicyUpdate=function(){var a=this,b=this.JSC$3051_q_.defer();N(chrome.i18n.getMessage("managed_policy_request_info"),L,M);chrome.runtime.sendMessage({action:"policyRequest"},function(c){N(chrome.i18n.getMessage("managed_policy_response_info"),L,M);c==="{}"||c===void 0?a.getPolicyUpdateDirectly_():a.populatePolicyChanges_(c);b.resolve()});return b.promise};
f.getPolicyUpdateDirectly_=function(){var a=this;chrome.storage.managed.get(function(b){if(Object.keys(b).length==0)N("No managed policy found. Consumer mode.",L,M);else{N("Managed policy found. Enterprise mode.",L,M);var c={},d;for(d in b){var e=b[d];Ya[d]?c[d]=e:(e=chrome.i18n.getMessage("invalid_policy_var",[d,e.toString()]),N(e,Za,M))}b=JSON.stringify(c);a.populatePolicyChanges_(b);chrome.runtime.sendMessage({action:"policyStore",data:b},function(){})}})};
f.isHttpsUrl_=function(a){return a.toLowerCase().slice(0,8)!=="https://"?!1:a.length>8};ub.$inject=["$q"];var tb={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},wb={},vb=(wb.basic=4,wb.kerberos=2,wb);function Q(a,b){if(Error.captureStackTrace)Error.captureStackTrace(this,Q);else{var c=Error().stack;c&&(this.stack=c)}a&&(this.message=String(a));b!==void 0&&(this.cause=b);this.reportErrorToServer=!0}Aa(Q,Error);Q.prototype.name="CustomError";function xb(a,b){for(var c=a.split("%s"),d="",e=c.length-1,g=0;g<e;g++)d+=c[g]+(g<b.length?b[g]:"%s");Q.call(this,d+c[e]);this.messagePattern=a}Aa(xb,Q);xb.prototype.name="AssertionError";function yb(a,b,c,d){var e="Assertion failed";if(c){e+=": "+c;var g=d}else a&&(e+=": "+a,g=b);throw new xb(""+e,g||[]);}
var zb=function(a,b,c){a||yb("",null,b,Array.prototype.slice.call(arguments,2));return a},R=function(a,b,c){typeof a!=="number"&&yb("Expected number but got %s: %s.",[ya(a),a],b,Array.prototype.slice.call(arguments,2));return a};var Ab=Array.prototype.indexOf?function(a,b,c){zb(a.length!=null);return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=c==null?0:c<0?Math.max(0,a.length+c):c;if(typeof a==="string")return typeof b!=="string"||b.length!=1?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Bb=/&/g,Cb=/</g,Db=/>/g,Eb=/"/g,Fb=/'/g,Gb=/\x00/g,Hb=/[\x00&<>"']/;function S(a,b){b=Qa(b);a=a.parseFromString(Ra(b),"text/xml");b=document.createNodeIterator(a,NodeFilter.SHOW_ALL);for(var c;c=b.nextNode();)if(c instanceof HTMLElement||c instanceof SVGElement)throw Error("attempted to parse an XML document that embeds HTML or SVG content");return a};var Ib=function(a,b){b?a=a.replace(Bb,"&amp;").replace(Cb,"&lt;").replace(Db,"&gt;").replace(Eb,"&quot;").replace(Fb,"&#39;").replace(Gb,"&#0;"):Hb.test(a)&&(a.indexOf("&")!=-1&&(a=a.replace(Bb,"&amp;")),a.indexOf("<")!=-1&&(a=a.replace(Cb,"&lt;")),a.indexOf(">")!=-1&&(a=a.replace(Db,"&gt;")),a.indexOf('"')!=-1&&(a=a.replace(Eb,"&quot;")),a.indexOf("'")!=-1&&(a=a.replace(Fb,"&#39;")),a.indexOf("\x00")!=-1&&(a=a.replace(Gb,"&#0;")));return a};var Jb=function(a){if(a.getValues&&typeof a.getValues=="function")return a.getValues();if(typeof Map!=="undefined"&&a instanceof Map||typeof Set!=="undefined"&&a instanceof Set)return Array.from(a.values());if(typeof a==="string")return a.split("");if(za(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}b=[];c=0;for(d in a)b[c++]=a[d];return b},Kb=function(a){if(a.getKeys&&typeof a.getKeys=="function")return a.getKeys();if(!a.getValues||typeof a.getValues!="function"){if(typeof Map!==
"undefined"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set!=="undefined"&&a instanceof Set)){if(za(a)||typeof a==="string"){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}b=[];c=0;for(var d in a)b[c++]=d;return b}}},Lb=function(a,b,c){if(a.forEach&&typeof a.forEach=="function")a.forEach(b,c);else if(za(a)||typeof a==="string")Array.prototype.forEach.call(a,b,c);else for(var d=Kb(a),e=Jb(a),g=e.length,h=0;h<g;h++)b.call(c,e[h],d&&d[h],a)};var Mb=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$"),Nb=function(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(d>=0){var g=a[c].substring(0,d);e=a[c].substring(d+1)}else g=a[c];b(g,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}};var Ob=function(a,b){this.domain_=this.userInfo_=this.scheme_="";this.port_=null;this.fragment_=this.path_="";this.JSC$3073_ignoreCase_=this.isReadOnly_=!1;var c;a instanceof Ob?(this.JSC$3073_ignoreCase_=b!==void 0?b:a.getIgnoreCase(),this.setScheme(a.getScheme()),this.setUserInfo(a.getUserInfo()),this.setDomain(a.getDomain()),this.setPort(a.getPort()),this.setPath(a.getPath()),this.setQueryData(a.getQueryData().JSC$3078_clone()),this.setFragment(a.getFragment())):a&&(c=String(a).match(Mb))?(this.JSC$3073_ignoreCase_=
!!b,this.setScheme(c[1]||"",!0),this.setUserInfo(c[2]||"",!0),this.setDomain(c[3]||"",!0),this.setPort(c[4]),this.setPath(c[5]||"",!0),this.setQueryData(c[6]||"",!0),this.setFragment(c[7]||"",!0)):(this.JSC$3073_ignoreCase_=!!b,this.queryData_=new T(null,this.JSC$3073_ignoreCase_))};f=Ob.prototype;
f.toString=function(){var a=[],b=this.getScheme();b&&a.push(Pb(b,Qb,!0),":");var c=this.getDomain();if(c||b=="file")a.push("//"),(b=this.getUserInfo())&&a.push(Pb(b,Qb,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.getPort(),c!=null&&a.push(":",String(c));if(c=this.getPath())this.hasDomain()&&c.charAt(0)!="/"&&a.push("/"),a.push(Pb(c,c.charAt(0)=="/"?Rb:Sb,!0));(c=this.getEncodedQuery())&&a.push("?",c);(c=this.getFragment())&&a.push("#",Pb(c,Tb));return a.join("")};
f.resolve=function(a){var b=this.JSC$3076_clone(),c=a.hasScheme();c?b.setScheme(a.getScheme()):c=a.hasUserInfo();c?b.setUserInfo(a.getUserInfo()):c=a.hasDomain();c?b.setDomain(a.getDomain()):c=a.hasPort();var d=a.getPath();if(c)b.setPort(a.getPort());else if(c=a.hasPath()){if(d.charAt(0)!="/")if(this.hasDomain()&&!this.hasPath())d="/"+d;else{var e=b.getPath().lastIndexOf("/");e!=-1&&(d=b.getPath().slice(0,e+1)+d)}e=d;if(e==".."||e==".")d="";else if(e.indexOf("./")!=-1||e.indexOf("/.")!=-1){d=e.lastIndexOf("/",
0)==0;e=e.split("/");for(var g=[],h=0;h<e.length;){var k=e[h++];k=="."?d&&h==e.length&&g.push(""):k==".."?((g.length>1||g.length==1&&g[0]!="")&&g.pop(),d&&h==e.length&&g.push("")):(g.push(k),d=!0)}d=g.join("/")}else d=e}c?b.setPath(d):c=a.hasQuery();c?b.setQueryData(a.getQueryData().JSC$3078_clone()):c=a.hasFragment();c&&b.setFragment(a.getFragment());return b};f.JSC$3076_clone=function(){return new Ob(this)};f.getScheme=function(){return this.scheme_};
f.setScheme=function(a,b){this.enforceReadOnly();if(this.scheme_=b?U(a,!0):a)this.scheme_=this.scheme_.replace(/:$/,"");return this};f.hasScheme=function(){return!!this.scheme_};f.getUserInfo=function(){return this.userInfo_};f.setUserInfo=function(a,b){this.enforceReadOnly();this.userInfo_=b?U(a):a;return this};f.hasUserInfo=function(){return!!this.userInfo_};f.getDomain=function(){return this.domain_};f.setDomain=function(a,b){this.enforceReadOnly();this.domain_=b?U(a,!0):a;return this};
f.hasDomain=function(){return!!this.domain_};f.getPort=function(){return this.port_};f.setPort=function(a){this.enforceReadOnly();if(a){a=Number(a);if(isNaN(a)||a<0)throw Error("Bad port number "+a);this.port_=a}else this.port_=null;return this};f.hasPort=function(){return this.port_!=null};f.getPath=function(){return this.path_};f.setPath=function(a,b){this.enforceReadOnly();this.path_=b?U(a,!0):a;return this};f.hasPath=function(){return!!this.path_};
f.hasQuery=function(){return this.queryData_.toString()!==""};f.setQueryData=function(a,b){this.enforceReadOnly();a instanceof T?(this.queryData_=a,this.queryData_.JSC$3078_setIgnoreCase(this.JSC$3073_ignoreCase_)):(b||(a=Pb(a,Ub)),this.queryData_=new T(a,this.JSC$3073_ignoreCase_));return this};f.setQuery=function(a,b){return this.setQueryData(a,b)};f.getEncodedQuery=function(){return this.queryData_.toString()};f.getDecodedQuery=function(){return this.queryData_.toDecodedString()};
f.getQueryData=function(){return this.queryData_};f.JSC$3076_getQuery=function(){return this.getEncodedQuery()};f.setParameterValue=function(a,b){this.enforceReadOnly();this.queryData_.set(a,b);return this};f.setParameterValues=function(a,b){this.enforceReadOnly();Array.isArray(b)||(b=[String(b)]);this.queryData_.setValues(a,b);return this};f.getParameterValues=function(a){return this.queryData_.getValues(a)};f.getParameterValue=function(a){return this.queryData_.get(a)};f.getFragment=function(){return this.fragment_};
f.setFragment=function(a,b){this.enforceReadOnly();this.fragment_=b?U(a):a;return this};f.hasFragment=function(){return!!this.fragment_};f.hasSameDomainAs=function(a){return(!this.hasDomain()&&!a.hasDomain()||this.getDomain()==a.getDomain())&&(!this.hasPort()&&!a.hasPort()||this.getPort()==a.getPort())};
f.makeUnique=function(){this.enforceReadOnly();this.setParameterValue("zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36));return this};f.JSC$3076_removeParameter=function(a){this.enforceReadOnly();this.queryData_.remove(a);return this};f.setReadOnly=function(a){this.isReadOnly_=a;return this};f.isReadOnly=function(){return this.isReadOnly_};
f.enforceReadOnly=function(){if(this.isReadOnly_)throw Error("Tried to modify a read-only Uri");};f.JSC$3076_setIgnoreCase=function(a){this.JSC$3073_ignoreCase_=a;this.queryData_&&this.queryData_.JSC$3078_setIgnoreCase(a);return this};f.getIgnoreCase=function(){return this.JSC$3073_ignoreCase_};
var U=function(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""},Pb=function(a,b,c){return typeof a==="string"?(a=encodeURI(a).replace(b,Vb),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null},Vb=function(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)},Qb=/[#\/\?@]/g,Sb=/[#\?:]/g,Rb=/[#\?]/g,Ub=/[#\?@]/g,Tb=/#/g,T=function(a,b){this.count_=this.keyMap_=null;this.encodedQuery_=a||null;this.JSC$3074_ignoreCase_=!!b};f=T.prototype;
f.ensureKeyMapInitialized_=function(){if(!this.keyMap_&&(this.keyMap_=new Map,this.count_=0,this.encodedQuery_)){var a=this;Nb(this.encodedQuery_,function(b,c){a.add(decodeURIComponent(b.replace(/\+/g," ")),c)})}};f.getCount=function(){this.ensureKeyMapInitialized_();return this.count_};f.add=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);var c=this.keyMap_.get(a);c||this.keyMap_.set(a,c=[]);c.push(b);this.count_=R(this.count_)+1;return this};
f.remove=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.has(a)?(this.invalidateCache_(),this.count_=R(this.count_)-this.keyMap_.get(a).length,this.keyMap_.delete(a)):!1};f.clear=function(){this.invalidateCache_();this.keyMap_=null;this.count_=0};f.isEmpty=function(){this.ensureKeyMapInitialized_();return this.count_==0};f.containsKey=function(a){this.ensureKeyMapInitialized_();a=this.getKeyName_(a);return this.keyMap_.has(a)};
f.containsValue=function(a){var b=this.getValues();return Ab(b,a)>=0};f.forEach=function(a,b){this.ensureKeyMapInitialized_();this.keyMap_.forEach(function(c,d){c.forEach(function(e){a.call(b,e,d,this)},this)},this)};f.getKeys=function(){this.ensureKeyMapInitialized_();for(var a=Array.from(this.keyMap_.values()),b=Array.from(this.keyMap_.keys()),c=[],d=0;d<b.length;d++)for(var e=a[d],g=0;g<e.length;g++)c.push(b[d]);return c};
f.getValues=function(a){this.ensureKeyMapInitialized_();var b=[];if(typeof a==="string")this.containsKey(a)&&(b=b.concat(this.keyMap_.get(this.getKeyName_(a))));else{a=Array.from(this.keyMap_.values());for(var c=0;c<a.length;c++)b=b.concat(a[c])}return b};f.set=function(a,b){this.ensureKeyMapInitialized_();this.invalidateCache_();a=this.getKeyName_(a);this.containsKey(a)&&(this.count_=R(this.count_)-this.keyMap_.get(a).length);this.keyMap_.set(a,[b]);this.count_=R(this.count_)+1;return this};
f.get=function(a,b){if(!a)return b;a=this.getValues(a);return a.length>0?String(a[0]):b};f.setValues=function(a,b){this.remove(a);if(b.length>0){this.invalidateCache_();var c=this.keyMap_,d=c.set;a=this.getKeyName_(a);var e=b.length;if(e>0){for(var g=Array(e),h=0;h<e;h++)g[h]=b[h];e=g}else e=[];d.call(c,a,e);this.count_=R(this.count_)+b.length}};
f.toString=function(){if(this.encodedQuery_)return this.encodedQuery_;if(!this.keyMap_)return"";for(var a=[],b=Array.from(this.keyMap_.keys()),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.getValues(d);for(var g=0;g<d.length;g++){var h=e;d[g]!==""&&(h+="="+encodeURIComponent(String(d[g])));a.push(h)}}return this.encodedQuery_=a.join("&")};f.toDecodedString=function(){return U(this.toString())};f.invalidateCache_=function(){this.encodedQuery_=null};
f.filterKeys=function(a){this.ensureKeyMapInitialized_();this.keyMap_.forEach(function(b,c){Ab(a,c)>=0||this.remove(c)},this);return this};f.JSC$3078_clone=function(){var a=new T;a.encodedQuery_=this.encodedQuery_;this.keyMap_&&(a.keyMap_=new Map(this.keyMap_),a.count_=this.count_);return a};f.getKeyName_=function(a){a=String(a);this.JSC$3074_ignoreCase_&&(a=a.toLowerCase());return a};
f.JSC$3078_setIgnoreCase=function(a){a&&!this.JSC$3074_ignoreCase_&&(this.ensureKeyMapInitialized_(),this.invalidateCache_(),this.keyMap_.forEach(function(b,c){var d=c.toLowerCase();c!=d&&(this.remove(c),this.setValues(d,b))},this));this.JSC$3074_ignoreCase_=a};f.extend=function(a){for(var b=0;b<arguments.length;b++)Lb(arguments[b],function(c,d){this.add(d,c)},this)};var Wb=y(["../html/notice.html"]),Xb=y(["../html/help_text_anchor.html"]),Yb=y(["../html/help_anchor.html"]),Zb=y(["../html/password_mask_tool.html"]),V=function(a,b,c,d,e,g,h){var k=this;this.isRequestingNewCertificate_=!0;this.useServiceAccountCheckboxText=this.deviceWideCheckboxText=this.h2Text=this.enrollOrCheckStatusButtonText=this.showOrHidePendingRequestText="";this.showDeviceWideCheckbox=!0;this.showServiceAccountCheckbox=!1;this.maskedPassword=this.passwordMask=this.passwordValueToBeMasked=
this.passwordValue=this.usernameValue=this.passwordFormFieldPlaceholder=this.usernameFormFieldPlaceholder="";this.isUserRequestingDeviceWideCertValue=!1;this.checkStatusButtonText_=this.requestIdValue=this.requestIdFormFieldPlaceholder=this.uriValue=this.uriFormFieldPlaceholder=this.loginButtonText_="";this.invalidCharacterText=chrome.i18n.getMessage("login_invalid_character");this.passwordMaskToolName=this.helpLabelText=this.helpText=this.helpUrl=this.moreOptionsValue=this.moreOptionsText="";this.pendingUIEnabled=
!0;this.copyToClipboardButtonText=this.licenseNoticeButtonText="";this.showPendingRequestText_=chrome.i18n.getMessage("login_show_pending");this.hidePendingRequestText_=chrome.i18n.getMessage("login_hide_pending");this.privacyLinkText=chrome.i18n.getMessage("login_privacy_link");this.helpCenterText=chrome.i18n.getMessage("login_help_center_text");this.deviceWideHelpText=chrome.i18n.getMessage("login_device_help");this.useServiceAccountHelpText=chrome.i18n.getMessage("login_service_account_help");
this.loadingText=chrome.i18n.getMessage("login_loading_text");this.companyLogo=this.companyName=this.kerberosAuthenticationText="";this.clientAuthentication="basic";this.managedPolicyService_=a;this.tokenService_=b;this.certificatePolicyService_=c;this.certificateSavingService_=d;this.enrollmentAgentService_=e;this.mdDialog_=g;this.scope_=h;this.useServiceAccount=!1;this.DUMMY_SERVICE_ACCOUNT_PASSWORD_="dummy-password";this.HOSTED_SERVICE_ACCOUNT_USERNAME_PLACEHOLDER_="...";this.managedPolicyService_.requestPolicyUpdate().then(function(){return A(function(l){k.setFormValuesFromManagedPolicy_();
k.checkAutoEnrollmentQueryParameters_();l.jumpToEnd()})},function(){})};f=V.prototype;
f.checkAutoEnrollmentQueryParameters_=function(){var a=this,b,c;return A(function(d){switch(d.nextAddress){case 1:b=(new Ob(window.location.href)).getQueryData();c=b.get("autoEnrollmentType");switch(c){case "auto_provision":return d.jumpTo(2);case "renewal":return d.jumpTo(3);default:N("Query parameter unknown.",K,a.managedPolicyService_.JSC$3053_getLogLevel())}d.jumpTo(0);break;case 2:return d.yield(a.autoEnrollCertificate_(),5);case 5:d.jumpTo(0);break;case 3:return d.yield(a.doAutoRenewal_(),6);
case 6:d.jumpTo(0)}})};
f.doAutoRenewal_=function(){var a=this,b,c;return A(function(d){switch(d.nextAddress){case 1:return N("Auto-renewal requested.",M,a.managedPolicyService_.JSC$3053_getLogLevel()),d.yield(kb(a.managedPolicyService_.isMachineCertEnrollmentAllowed()),2);case 2:b=d.yieldResult;if(!b)return N("No certificate found for auto renewal.",M,a.managedPolicyService_.JSC$3053_getLogLevel()),d.return();N("Certificate found for auto renewal.",M,a.managedPolicyService_.JSC$3053_getLogLevel());c=b.slot==="system";if(!a.managedPolicyService_.getIsKeyBasedRenewalEnabled()){d.jumpTo(3);
break}return d.yield(a.tokenService_.setTokenFromPlatformKeys(c),4);case 4:return a.doKeyBasedRenewal_(b.cert),d.return();case 3:if(a.useKerberosAuth_())return a.autoEnrollWithKerberos_(c),d.return();if(!c)return N("Renewal of user certificates is not enabled.",K,a.managedPolicyService_.JSC$3053_getLogLevel()),d.return();if(!a.isServiceAccountConfigured_()){d.jumpTo(0);break}return d.yield(a.tokenService_.setTokenFromPlatformKeys(c),6);case 6:a.autoEnrollWithServiceAccount_(),d.jumpToEnd()}})};
f.isServiceAccountConfigured_=function(){return this.managedPolicyService_.getServiceAccountName()&&this.managedPolicyService_.getServiceAccountName()!=""||this.managedPolicyService_.getServiceAccountHost()&&this.managedPolicyService_.getServiceAccountHost()!=""?!0:!1};f.useKerberosAuth_=function(){return this.clientAuthentication==="kerberos"};
f.doKeyBasedRenewal_=function(a){var b=this,c;return A(function(d){if(d.nextAddress==1)return N("Sending key-based renewal request to CES: "+b.managedPolicyService_.getCesRenewalUrl()+".",M,b.managedPolicyService_.JSC$3053_getLogLevel()),b.startProgress_(0),d.setCatchFinallyBlocks(2),d.yield(b.certificateSavingService_.renewCertificate(b.managedPolicyService_.getCesRenewalUrl(),a),4);if(d.nextAddress!=2)return b.notify_(chrome.i18n.getMessage("success_title"),chrome.i18n.getMessage("certificate_renewal_alert"),
!0),c=fb(a),gb(c),d.leaveTryBlock(0);d.enterCatchBlock();b.notify_(chrome.i18n.getMessage("failure_title"),chrome.i18n.getMessage("certificate_renewal_failure_alert"),!0);d.jumpToEnd()})};
f.autoEnrollCertificate_=function(){var a=this,b,c;return A(function(d){if(d.nextAddress==1)return d.setCatchFinallyBlocks(2),d.yield(sb(a.managedPolicyService_.isMachineCertEnrollmentAllowed(),a.useKerberosAuth_(),a.isServiceAccountConfigured_()),4);if(d.nextAddress!=2){b=d.yieldResult;if(!b)return N("Failure to auto-provision certificate: either a valid certificate already exists on the device or auto-provisioning is not supported by policy.",M,a.managedPolicyService_.JSC$3053_getLogLevel()),d.return();
switch(b.method){case "kerberos":a.autoEnrollWithKerberos_(b.slot==="system");break;case "service_account":a.autoEnrollWithServiceAccount_();break;default:N("Unknown provisioning method.",K,a.managedPolicyService_.JSC$3053_getLogLevel())}return d.leaveTryBlock(0)}c=d.enterCatchBlock();N(c.message,K,a.managedPolicyService_.JSC$3053_getLogLevel());d.jumpToEnd()})};
f.autoEnrollWithServiceAccount_=function(){N("Auto-triggering enrollment of a device wide\n        certificate using the provided service account.",L,this.managedPolicyService_.JSC$3053_getLogLevel());var a=this.managedPolicyService_.getDeviceEnrollmentTemplates(),b=this.managedPolicyService_.isMachineCertEnrollmentAllowed();this.isServiceAccountConfigured_()&&a&&b&&(this.useServiceAccount=!0,this.handleUseServiceAccountChange(),this.decideEnrollmentRequest())};
f.autoEnrollWithKerberos_=function(a){var b=this;this.isUserRequestingDeviceWideCertValue=a;N(a?"Auto-triggering enrollment of a device wide certificate using Kerberos.":"Auto-triggering enrollment of a user certificate using Kerberos.",L,this.managedPolicyService_.JSC$3053_getLogLevel());this.startProgress_(0);setTimeout(function(){b.submitForm_()},1E4)};
f.handleUseServiceAccountChange=function(){var a=this;this.useServiceAccount?(this.managedPolicyService_.getServiceAccountHost()?(this.usernameValue=this.HOSTED_SERVICE_ACCOUNT_USERNAME_PLACEHOLDER_,this.getEnrollmentCredentials_().then(function(b){a.usernameValue=b.username;a.scope_.$apply()},function(){})):this.usernameValue=this.managedPolicyService_.getServiceAccountName(),this.passwordValue=this.DUMMY_SERVICE_ACCOUNT_PASSWORD_):this.passwordValue=this.usernameValue=""};
f.handleRequestingDeviceWideCertChange=function(){this.useServiceAccount=this.isUserRequestingDeviceWideCertValue&&this.isServiceAccountConfigured_()?this.showServiceAccountCheckbox=!0:this.showServiceAccountCheckbox=!1};
f.getEnrollmentCredentials_=function(){var a=this,b,c,d,e,g;return A(function(h){switch(h.nextAddress){case 1:if(!a.useServiceAccount||!a.managedPolicyService_.getServiceAccountHost()){h.jumpTo(2);break}return h.yield(fetch(a.managedPolicyService_.getServiceAccountHost(),{method:"GET",cache:"no-cache"}),3);case 3:return b=h.yieldResult,N("HostedServiceAccount: Got status: ${response.status}",K,a.managedPolicyService_.JSC$3053_getLogLevel()),b.ok?h.yield(b.json(),4):h.return(Promise.reject("Failed to get hosted credentials."));
case 4:c=h.yieldResult;if(!c.hasOwnProperty("username")||!c.hasOwnProperty("maskedPassword"))return N("HostedServiceAccount: Missing fields",K,a.managedPolicyService_.JSC$3053_getLogLevel()),h.return(Promise.reject("Missing fields"));d=c.username;e=c.maskedPassword;N("ServiceAccountHost: Unmasking",L,a.managedPolicyService_.JSC$3053_getLogLevel());return h.yield(rb({masked:e,mask:a.managedPolicyService_.getServiceAccountHostPasswordMask()}),5);case 5:return g=h.yieldResult,h.return({username:d,password:g});
case 2:return a.useServiceAccount&&a.managedPolicyService_.getServiceAccountName()?h.return({username:a.managedPolicyService_.getServiceAccountName(),password:a.managedPolicyService_.getServiceAccountPassword()}):h.return({username:a.usernameValue,password:a.passwordValue})}})};f.getDeviceWideValue_=function(){return this.useServiceAccount?!0:this.isUserRequestingDeviceWideCertValue};
f.failureAlert_=function(a){N(a,K,this.managedPolicyService_.JSC$3053_getLogLevel());this.notify_(chrome.i18n.getMessage("failure_title"),chrome.i18n.getMessage("login_failure_alert"),!0)};f.pendingAlert_=function(a,b,c){N(a,L,this.managedPolicyService_.JSC$3053_getLogLevel());this.requestIdValue===""&&this.uriValue===""&&(this.requestIdValue=b,this.uriValue=c);this.notify_(chrome.i18n.getMessage("pending_title"),a,!0)};
f.notify_=function(a,b,c){var d=chrome.i18n.getMessage("okay_button");a=this.mdDialog_.alert().title(a).htmlContent(b).ok(d);c&&this.hideProgress_();this.mdDialog_.show(a)};f.resetOnEscape=function(){document.getElementById("moreOptionsMenu").className.indexOf("md-open")==-1&&this.removeNegativeTabIndexes()};f.setNegativeTabIndexes=function(){this.setTabIndexes_("-1")};f.removeNegativeTabIndexes=function(){this.setTabIndexes_("")};
f.setTabIndexes_=function(a){for(var b=document.getElementsByClassName("elementToHideWhenMenuIsOpen"),c=0;c<b.length;c++)b[c].setAttribute("tabindex",a);document.getElementById("checkboxToHideWhenMenuIsOpen").setAttribute("tabindex",a==="-1"?"-1":"0")};f.startProgress_=function(a){document.getElementsByClassName("hiddenProgressCircular")[a].style.visibility="visible"};
f.hideProgress_=function(){for(var a=document.getElementsByClassName("hiddenProgressCircular"),b=0;b<a.length;b++)a[b].style.visibility="hidden"};f.showLicense=function(){this.mdDialog_.show({controller:"ccr.controllers.LoginPageCtrl",templateUrl:Xa(Wb),clickOutsideToClose:!0})};f.copyToClipboard=function(){var a=document.createElement("input");a.style.position="fixed";a.style.zIndex="-1";a.value=$a;document.body.appendChild(a);a.select();document.execCommand("copy");document.body.removeChild(a)};
f.showHelpText=function(){var a=Xa(Xb);this.helpText===""&&(a=Xa(Yb));this.mdDialog_.show({controller:"ccr.controllers.LoginPageCtrl",templateUrl:a,clickOutsideToClose:!0,parent:angular.element(document.body)})};f.showPasswordMaskTool=function(){this.passwordMask=this.maskedPassword=this.passwordValueToBeMasked="";this.mdDialog_.show({controller:"ccr.controllers.LoginPageCtrl",templateUrl:Xa(Zb),clickOutsideToClose:!0,parent:angular.element(document.body)})};
f.generateMaskedPassword=function(){var a=this,b;return A(function(c){if(c.nextAddress==1)return c.yield(qb(a.passwordValueToBeMasked),2);b=c.yieldResult;a.maskedPassword=b.masked;a.passwordMask=b.mask;c.jumpToEnd()})};
f.setFormValuesFromManagedPolicy_=function(){this.h2Text=this.managedPolicyService_.getLoginPageHeaderText();this.deviceWideCheckboxText=this.managedPolicyService_.getLoginPageDeviceWideCheckboxText();this.showDeviceWideCheckbox=this.managedPolicyService_.isMachineCertEnrollmentAllowed();this.useServiceAccountCheckboxText=this.managedPolicyService_.getLoginPageUseServiceAccountCheckboxText();this.usernameFormFieldPlaceholder=this.managedPolicyService_.getUsernameFormFieldPlaceholder();this.passwordFormFieldPlaceholder=
this.managedPolicyService_.getPasswordFormFieldPlaceholder();this.loginButtonText_=this.managedPolicyService_.getLoginPageLoginButtonText();this.uriFormFieldPlaceholder=this.managedPolicyService_.getUriFormFieldPlaceholder();this.requestIdFormFieldPlaceholder=this.managedPolicyService_.getRequestIdFormFieldPlaceholder();this.checkStatusButtonText_=this.managedPolicyService_.getLoginPageStatusButtonText();this.moreOptionsText=this.managedPolicyService_.getLoginPageMoreOptionsText();this.helpUrl=this.managedPolicyService_.getHelpUrl();
this.helpText=this.managedPolicyService_.getHelpText();this.helpLabelText=this.managedPolicyService_.getLoginPageHelpLabelText();this.licenseNoticeButtonText=this.managedPolicyService_.getLoginPageLicenseButtonText();this.copyToClipboardButtonText=this.managedPolicyService_.getLoginPageClipboardButtonText();this.passwordMaskToolName="Password mask tool";this.companyName=this.managedPolicyService_.getCompanyName();this.companyLogo=this.managedPolicyService_.getCompanyLogo();this.pendingUIEnabled=this.managedPolicyService_.isPendingUIEnabled();
this.showOrHidePendingRequestText=this.showPendingRequestText_;this.enrollOrCheckStatusButtonText=this.loginButtonText_;this.kerberosAuthenticationText=chrome.i18n.getMessage("kerberos_authentication_text",this.enrollOrCheckStatusButtonText);this.clientAuthentication=this.managedPolicyService_.getClientAuthentication();var a=this.managedPolicyService_.getDeviceEnrollmentTemplates(),b=this.managedPolicyService_.isMachineCertEnrollmentAllowed();this.isServiceAccountConfigured_()&&a&&b&&(this.isUserRequestingDeviceWideCertValue=
this.useServiceAccount=this.showServiceAccountCheckbox=!0,this.handleUseServiceAccountChange(),this.handleRequestingDeviceWideCertChange())};
f.flipBetweenSubmitAndCheck=function(){if(this.isRequestingNewCertificate_){document.getElementById("extraFieldsForCheckStatus").className="showExtraFieldsForCheckStatus";var a=document.getElementById("mainCard");a.className=a.className.replace("smallMainCard","bigMainCard").trim();a=document.getElementsByClassName("inputsRequiredForPendingRequest");for(var b=0;b<a.length;b++)a[b].setAttribute("required","");this.showOrHidePendingRequestText=this.hidePendingRequestText_;this.enrollOrCheckStatusButtonText=
this.checkStatusButtonText_;this.isRequestingNewCertificate_=!1}else{document.getElementById("extraFieldsForCheckStatus").className="hideExtraFieldsForCheckStatus";a=document.getElementById("mainCard");a.className=a.className.replace("bigMainCard","smallMainCard").trim();a=document.getElementsByClassName("inputsRequiredForPendingRequest");for(b=0;b<a.length;b++)a[b].removeAttribute("required");this.showOrHidePendingRequestText=this.showPendingRequestText_;this.enrollOrCheckStatusButtonText=this.loginButtonText_;
this.isRequestingNewCertificate_=!0}};f.decideEnrollmentRequest=function(){this.managedPolicyService_.isVerifiedAccessEnabled()?this.submitVaForm_():this.isRequestingNewCertificate_?this.submitForm_():this.queryStatus_()};
f.submitVaForm_=function(){var a=this,b,c,d,e,g,h,k,l,m;return A(function(n){switch(n.nextAddress){case 1:return N("Submit button triggered with va.",L,a.managedPolicyService_.JSC$3053_getLogLevel()),b=!a.useKerberosAuth_(),n.setCatchFinallyBlocks(2),n.yield(a.getEnrollmentCredentials_(),4);case 4:c=n.yieldResult;n.leaveTryBlock(3);break;case 2:return d=n.enterCatchBlock(),a.failureAlert_(d.message),n.return();case 3:e=b?c.username:null;g=b?c.password:null;h=a.getDeviceWideValue_();if(e===""&&b)return a.notify_(chrome.i18n.getMessage("failure_title"),
chrome.i18n.getMessage("empty_username"),!0),n.return();k="";l=a.managedPolicyService_.getCepProxyUrl();m=a.managedPolicyService_.getUserEnrollmentTemplates();a.startProgress_(0);a.tokenService_.setTokenFromPlatformKeys(h).then(function(){a.tokenService_.getCurrentToken()===void 0?(k=a.tokenService_.JSC$3147_getErrorMessage(),a.notify_(chrome.i18n.getMessage("failure_title"),k,!0)):a.enrollToGivenEndpoint_(a.enrollmentAgentService_,l,m,e,g)},function(){k=a.tokenService_.JSC$3147_getErrorMessage();
a.notify_(chrome.i18n.getMessage("failure_title"),k,!0)});n.jumpToEnd()}})};
f.submitForm_=function(){var a=this,b,c,d,e,g,h,k;return A(function(l){switch(l.nextAddress){case 1:return N("Submit button triggered.",L,a.managedPolicyService_.JSC$3053_getLogLevel()),b=!a.useKerberosAuth_(),l.setCatchFinallyBlocks(2),l.yield(a.getEnrollmentCredentials_(),4);case 4:c=l.yieldResult;l.leaveTryBlock(3);break;case 2:return d=l.enterCatchBlock(),a.failureAlert_(d.message),l.return();case 3:e=b?c.username:null;g=b?c.password:null;h=a.getDeviceWideValue_();if(!e&&b)return a.notify_(chrome.i18n.getMessage("failure_title"),
chrome.i18n.getMessage("empty_username"),!0),l.return();k="";a.startProgress_(0);a.tokenService_.setTokenFromPlatformKeys(h).then(function(){a.tokenService_.getCurrentToken()===void 0?(k=a.tokenService_.JSC$3147_getErrorMessage(),a.notify_(chrome.i18n.getMessage("failure_title"),k,!0)):a.certificatePolicyService_.contactPolicyServer(e,g).then(function(){var m=a.certificatePolicyService_.getAllEnrollmentUris();m.length>0?a.enrollToEachEndpointTuple_(m,e,g):(k=chrome.i18n.getMessage("login_no_uri_failure"),
a.failureAlert_(k))},function(){a.certificatePolicyService_.isSpecificErrorPresent()?a.notify_(chrome.i18n.getMessage("failure_title"),a.certificatePolicyService_.JSC$3102_getErrorMessage(),!0):a.failureAlert_(chrome.i18n.getMessage("login_cep_failure"))})},function(){k=a.tokenService_.JSC$3147_getErrorMessage();a.notify_(chrome.i18n.getMessage("failure_title"),k,!0)});l.jumpToEnd()}})};
f.enrollToEachEndpointTuple_=function(a,b,c){a=a.shift();this.enrollToGivenEndpoint_(this.certificateSavingService_,a.uri,[a.name],b,c)};
f.enrollToGivenEndpoint_=function(a,b,c,d,e){var g=this,h="";a.enroll(b,d,e,c).then(function(){a.isEnrolledSuccessfully()?g.notify_(chrome.i18n.getMessage("success_title"),chrome.i18n.getMessage("login_success_alert"),!0):a.isRequestPending()?(h=a.JSC$3102_getErrorMessage(),g.pendingAlert_(h,a.getPendingRequestId(),a.getPendingRequestUri())):(h=a.JSC$3102_getErrorMessage(),g.failureAlert_(h))},function(){a.isSpecificErrorPresent()?g.notify_(chrome.i18n.getMessage("failure_title"),a.JSC$3102_getErrorMessage(),
!0):g.failureAlert_(chrome.i18n.getMessage("login_enrollment_failure"))})};
f.queryStatus_=function(){var a=this,b,c,d,e,g,h,k,l,m;return A(function(n){switch(n.nextAddress){case 1:N("Query status button triggered.",L,a.managedPolicyService_.JSC$3053_getLogLevel());if(a.uriValue==null||a.uriValue==void 0||!a.uriValue.startsWith("https://"))return a.notify_(chrome.i18n.getMessage("failure_title"),chrome.i18n.getMessage("login_query_uri"),!0),n.return();b=!a.useKerberosAuth_();n.setCatchFinallyBlocks(2);return n.yield(a.getEnrollmentCredentials_(),4);case 4:c=n.yieldResult;
n.leaveTryBlock(3);break;case 2:return d=n.enterCatchBlock(),a.failureAlert_(d.message),n.return();case 3:e=b?c.username:null,g=b?c.password:null,h=a.getDeviceWideValue_(),k=Ib(a.uriValue),l=Ib(a.requestIdValue),m="",a.startProgress_(0),a.tokenService_.setTokenFromPlatformKeys(h).then(function(){a.tokenService_.getCurrentToken()===void 0?(m=a.tokenService_.JSC$3147_getErrorMessage(),a.notify_(chrome.i18n.getMessage("failure_title"),m,!0)):a.certificateSavingService_.checkPendingRequestStatus(k,l,
e,g).then(function(){a.certificateSavingService_.isEnrolledSuccessfully()?a.notify_(chrome.i18n.getMessage("success_title"),chrome.i18n.getMessage("login_success_alert"),!0):a.certificateSavingService_.isRequestPending()?(m=a.certificateSavingService_.JSC$3102_getErrorMessage(),a.pendingAlert_(m,a.certificateSavingService_.getPendingRequestId(),a.certificateSavingService_.getPendingRequestUri())):(m=a.certificateSavingService_.JSC$3102_getErrorMessage(),a.failureAlert_(m))},function(){a.certificateSavingService_.isSpecificErrorPresent()?
a.notify_(chrome.i18n.getMessage("failure_title"),a.certificateSavingService_.JSC$3102_getErrorMessage(),!0):a.failureAlert_(chrome.i18n.getMessage("login_enrollment_failure"))})},function(){m=a.tokenService_.JSC$3147_getErrorMessage();a.notify_(chrome.i18n.getMessage("failure_title"),m,!0)}),n.jumpToEnd()}})};D("ccr.controllers.LoginPageCtrl",V,!0,void 0);V.prototype.decideEnrollmentRequest=V.prototype.decideEnrollmentRequest;V.prototype.flipBetweenSubmitAndCheck=V.prototype.flipBetweenSubmitAndCheck;
V.prototype.generateMaskedPassword=V.prototype.generateMaskedPassword;V.prototype.showPasswordMaskTool=V.prototype.showPasswordMaskTool;V.prototype.showHelpText=V.prototype.showHelpText;V.prototype.copyToClipboard=V.prototype.copyToClipboard;V.prototype.showLicense=V.prototype.showLicense;V.prototype.removeNegativeTabIndexes=V.prototype.removeNegativeTabIndexes;V.prototype.setNegativeTabIndexes=V.prototype.setNegativeTabIndexes;V.prototype.resetOnEscape=V.prototype.resetOnEscape;
V.prototype.handleRequestingDeviceWideCertChange=V.prototype.handleRequestingDeviceWideCertChange;V.prototype.handleUseServiceAccountChange=V.prototype.handleUseServiceAccountChange;V.$inject="managedPolicyService tokenService certificatePolicyService certificateSavingService enrollmentAgentService $mdDialog $scope".split(" ");var $b=function(a,b){this.JSC$3096_managedPolicy_=a;this.JSC$3096_q_=b;this.replacements={}};f=$b.prototype;f.doReplacementsOnSubject_=function(a){for(var b={},c=z(ac),d=c.next();!d.done;d=c.next())d=d.value,d in a&&a[d]&&(b[d]=lb(a[d],this.replacements));return b};f.doReplacementsOnSubjectAlternativeNames_=function(a){var b=[];a=z(a);for(var c=a.next();!c.done;c=a.next()){var d=c.value;"NameType"in d&&"Name"in d&&(c=d.NameType,d=lb(d.Name,this.replacements),b.push({NameType:c,Name:d}))}return b};
f.populateReplacements_=function(){var a=this,b=[],c=[];if(chrome&&chrome.enterprise&&chrome.enterprise.deviceAttributes){if(chrome.enterprise.deviceAttributes.getDirectoryDeviceId){c.push("enterprise.deviceAttributes.getDirectoryDeviceId");var d=this.JSC$3096_q_.defer();b.push(d.promise);chrome.enterprise.deviceAttributes.getDirectoryDeviceId(function(l){a.replacements.DEVICE_DIRECTORY_ID=l;d.resolve()})}if(chrome.enterprise.deviceAttributes.getDeviceAssetId){c.push("enterprise.deviceAttributes.getDeviceAssetId");
var e=this.JSC$3096_q_.defer();b.push(e.promise);chrome.enterprise.deviceAttributes.getDeviceAssetId(function(l){a.replacements.DEVICE_ASSET_ID=l;e.resolve()})}if(chrome.enterprise.deviceAttributes.getDeviceAnnotatedLocation){c.push("enterprise.deviceAttributes.getDeviceAnnotatedLocation");var g=this.JSC$3096_q_.defer();b.push(g.promise);chrome.enterprise.deviceAttributes.getDeviceAnnotatedLocation(function(l){a.replacements.DEVICE_ANNOTATED_LOCATION=l;g.resolve()})}if(chrome.enterprise.deviceAttributes.getDeviceSerialNumber){c.push("enterprise.deviceAttributes.getDeviceSerialNumber");
var h=this.JSC$3096_q_.defer();b.push(h.promise);chrome.enterprise.deviceAttributes.getDeviceSerialNumber(function(l){a.replacements.DEVICE_SERIAL_NUMBER=l;h.resolve()})}}if(chrome&&chrome.identity&&chrome.identity.getProfileUserInfo){c.push("chrome.identity.getProfileUserInfo");var k=this.JSC$3096_q_.defer();b.push(k.promise);chrome.identity.getProfileUserInfo(function(l){l=l.email;a.replacements.USER_EMAIL=l;var m="",n="",r=l.lastIndexOf("@");r!=-1&&(m=l.substring(0,r),n=l.substring(r+1));a.replacements.USER_ID=
m;a.replacements.USER_DOMAIN=n;k.resolve()})}N("Found the following APIs: "+c.join(),M,this.JSC$3096_managedPolicy_.JSC$3053_getLogLevel());return this.JSC$3096_q_.all(b)};f.logAvailableReplacements_=function(){for(var a=[],b=z(Object.keys(this.replacements)),c=b.next();!c.done;c=b.next())c=c.value,this.replacements[c]?a.push(c):a.push(c+" (no value)");N("Available placeholders: "+a.join(),M,this.JSC$3096_managedPolicy_.JSC$3053_getLogLevel())};
f.getCertRequestValues=function(a){var b=this,c=this.JSC$3096_q_.defer();this.populateReplacements_().then(function(){var d=a?b.JSC$3096_managedPolicy_.getDeviceCertRequestValues():b.JSC$3096_managedPolicy_.getUserCertRequestValues(),e={};b.logAvailableReplacements_();"Subject"in d&&(e.Subject=b.doReplacementsOnSubject_(d.Subject));"SubjectAlternativeNames"in d&&d.SubjectAlternativeNames instanceof Array&&(e.SubjectAlternativeNames=b.doReplacementsOnSubjectAlternativeNames_(d.SubjectAlternativeNames));
c.resolve(e)});return c.promise};$b.$inject=["managedPolicyService","$q"];var ac="CommonName Country DeviceSerialNumber Locality Organization OrganizationUnit State".split(" ");var W=function(a,b,c){this.managedPolicy=a;this.tokenService=b;this.JSC$3100_q=c;this.hasSpecificError=!1;this.JSC$3100_errorMessage=""};W.prototype.isSpecificErrorPresent=function(){return this.hasSpecificError};W.prototype.JSC$3102_getErrorMessage=function(){return this.JSC$3100_errorMessage};W.$inject=["managedPolicyService","tokenService","$q"];var bc=function(a,b,c){W.call(this,a,b,c);this.enrollmentUris_=[]};ma(bc,W);f=bc.prototype;
f.contactPolicyServer=function(a,b){var c=this,d=this.JSC$3100_q.defer(),e=this.managedPolicy.getCepProxyUrl();N("Contacting CEP server at: "+e,M,this.managedPolicy.JSC$3053_getLogLevel());var g=new DOMParser,h=S(g,cc);h.getElementById("ccr-cep-proxy-url").textContent=e;this.managedPolicy.getClientAuthentication()==="basic"&&(g=S(g,dc),g.getElementById("ccr-basic-auth-username").textContent=a,g.getElementById("ccr-basic-auth-password").textContent=b,h.getElementById("ccr-header").appendChild(g.firstElementChild));
mb(h);var k=(new XMLSerializer).serializeToString(h);(function(){var l,m,n,r,x,t;return A(function(u){switch(u.nextAddress){case 1:return l=c.managedPolicy.getXhrRequestTimeout(),u.setCatchFinallyBlocks(2),m=fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/soap+xml; charset=utf-8"},credentials:"include",body:k}),u.yield(ob(m,l),4);case 4:return n=u.yieldResult,u.yield(n.text(),5);case 5:r=u.yieldResult;((x=n)==null?0:x.ok)?(c.cepSuccessCallback_(r),d.resolve()):
(c.cepFailureCallback_(r,n.statusText),d.reject());u.leaveTryBlock(0);break;case 2:t=u.enterCatchBlock(),t==="TimeoutError"?(c.hasSpecificError=!0,c.JSC$3100_errorMessage=chrome.i18n.getMessage("policy_timeout_error"),N(c.JSC$3100_errorMessage,K,c.managedPolicy.JSC$3053_getLogLevel())):console.log("Server rejected request with error: "+t),d.reject(),u.jumpToEnd()}})})();return d.promise};
f.cepSuccessCallback_=function(a){var b=new DOMParser;a=S(b,a).getElementsByTagName("GetPoliciesResponse")[0].children;var c,d;for(b=0;b<a.length;b++)a[b].tagName==X.RESPONSE?c=a[b]:a[b].tagName==X.CAS&&(d=a[b]);this.enrollmentUris_=[];c&&d&&(c=this.mapAndFilterTemplateNamesAndCaRefs_(c),this.enrollmentUris_=this.getAvailableEndpointsFromCaTag_(d,c))};
f.mapAndFilterTemplateNamesAndCaRefs_=function(a){var b=this.tokenService.getMatchingTemplates(),c=a.getElementsByTagName(X.POLICY);a={};for(var d=0;d<c.length;d++){var e=c[d];a[e.getElementsByTagName(X.COMMON_NAME)[0].innerHTML]=e.getElementsByTagName(X.CA_REFERENCE)[0].innerHTML}c=[];for(d=0;d<b.length;d++)if(e=b[d],a[e]){var g={name:e};g.ca=a[e];c.push(g)}return c};
f.getAvailableEndpointsFromCaTag_=function(a,b){var c=[];a=a.getElementsByTagName(X.CA_REFERENCE_ID);for(var d=0;d<b.length;d++)for(var e=b[d].ca,g=0;g<a.length;g++)if(a[g].innerHTML===e)for(var h=a[g].parentElement.getElementsByTagName(X.CAURI),k=0;k<h.length;k++){var l=h[k],m=l.getElementsByTagName(X.CLIENT_AUTHENTICATION);m=m[m.length-1];var n=vb[this.managedPolicy.getClientAuthentication()];m&&m.innerHTML===n.toString()&&(m=l.getElementsByTagName(X.RENEWAL_ONLY),m=m[m.length-1],!m||m.innerHTML==
"false")&&(l=l.getElementsByTagName(X.URI),l=l[l.length-1])&&(l=l.innerHTML,m={},m.name=b[d].name,m.uri=l,c.push(m))}return c};f.cepFailureCallback_=function(a,b){var c=new DOMParser;a=S(c,a);cb(a,"Value").slice(-20)==="FailedAuthentication"?(this.hasSpecificError=!0,this.JSC$3100_errorMessage=chrome.i18n.getMessage("invalid_credentials")):(this.hasSpecificError=!1,this.JSC$3100_errorMessage=chrome.i18n.getMessage("policy_bad_response",b));N(this.JSC$3100_errorMessage,K,this.managedPolicy.JSC$3053_getLogLevel())};
f.getAllEnrollmentUris=function(){return this.enrollmentUris_};bc.prototype.contactPolicyServer.$inject=["user","pass"];bc.$inject=["managedPolicyService","tokenService","$q"];
var X={RESPONSE:"response",CAS:"cAs",POLICY:"policy",CA_REFERENCE:"cAReference",COMMON_NAME:"commonName",CA_REFERENCE_ID:"cAReferenceID",CAURI:"cAURI",CLIENT_AUTHENTICATION:"clientAuthentication",RENEWAL_ONLY:"renewalOnly",URI:"uri"},cc=P('\n<s:Envelope\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope"\n    xmlns:a="http://www.w3.org/2005/08/addressing"\n    xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">\n  <s:Header id="ccr-header">\n    <a:Action s:mustUnderstand="1">\n      http://schemas.microsoft.com/windows/pki/2009/01/enrollmentpolicy/IPolicy/GetPolicies\n    </a:Action>\n    <a:ReplyTo>\n      <a:Address>\n        http://www.w3.org/2005/08/addressing/anonymous\n    </a:Address>\n  </a:ReplyTo>\n  <a:To s:mustUnderstand="1" id="ccr-cep-proxy-url">\n  </a:To>\n  </s:Header>\n  <s:Body\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      xmlns:xsd="http://www.w3.org/2001/XMLSchema">\n    <GetPolicies\n        xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollmentpolicy">\n      <client>\n        <lastUpdate>0001-01-01T00:00:00</lastUpdate>\n        <preferredLanguage xsi:nil="true"></preferredLanguage>\n      </client>\n      <requestFilter xsi:nil="true"></requestFilter>\n    </GetPolicies>\n  </s:Body>\n</s:Envelope>\n'),dc=
P('\n<o:Security\n    xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope"\n    xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"\n    s:mustUnderstand="1">\n  <o:UsernameToken u:Id="uuid-12df19ba-93db-4f41-8d7e-8bb789168bf9-1">\n    <o:Username id="ccr-basic-auth-username">\n    </o:Username>\n    <o:Password id="ccr-basic-auth-password">\n    </o:Password>\n  </o:UsernameToken>\n</o:Security>\n');
P('\n<GetPolicies\n    xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollmentpolicy"\n    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n  <client>\n    <lastUpdate>0001-01-01T00:00:00</lastUpdate>\n    <preferredLanguage xsi:nil="true"></preferredLanguage>\n  </client>\n  <requestFilter xsi:nil="true"></requestFilter>\n</GetPolicies>\n');var Y=function(a,b,c,d){W.call(this,a,b,d);this.certRequestValuesService_=c;this.isCurrentRequestPending=this.hasEnrolledSuccessfully=!1;this.currentRequestUri=this.currentRequestId=this.currentCsr="";a={};this.subjectAttributeMap_=(a.CommonName="2.5.4.3",a.Country="2.5.4.6",a.DeviceSerialNumber="2.5.4.5",a.Locality="2.5.4.7",a.Organization="2.5.4.10",a.OrganizationUnit="2.5.4.11",a.State="2.5.4.8",a)};ma(Y,W);f=Y.prototype;
f.certHelper=function(a){return this.tokenService.getCurrentToken()?this.generateCsr_(a):null};f.getAdditionalSubjectTypesAndValues=function(a){var b=[];if("Subject"in a){a=a.Subject;for(var c in this.subjectAttributeMap_)c in a&&b.push(new window.org.pkijs.simpl.ATTR_TYPE_AND_VALUE({type:this.subjectAttributeMap_[c],value:new window.org.pkijs.asn1.UTF8STRING({value:a[c]})}))}return b};f.makeValidIA5String=function(a){return a.replace(/[^\x00-\x7F]/g,"")};
f.mapIA5StringSubjectAltName=function(a,b){if(!(a in ec))return null;var c=ec[a],d=this.makeValidIA5String(b);b!=d&&N("SAN value for NameType:"+a+" was not a valid IA5String - filtered",Za,this.managedPolicy.JSC$3053_getLogLevel());return new window.org.pkijs.simpl.GENERAL_NAME({NameType:c,Name:d})};
f.createGeneralNameWithOtherName=function(a,b){a=new window.org.pkijs.asn1.SEQUENCE({value:[new window.org.pkijs.asn1.OID({value:a}),new window.org.pkijs.asn1.ASN1_CONSTRUCTED({id_block:{tag_class:3,tag_number:0},value:[b]})]});a=new window.org.pkijs.simpl.GENERAL_NAME({NameType:0,Name:a.value_block});a.NameType=0;return a};
f.mapWellKnownOtherName=function(a,b){return a=="userPrincipalName"?this.createGeneralNameWithOtherName("1.3.6.1.4.1.311.20.2.3",new window.org.pkijs.asn1.UTF8STRING({value:b})):null};
f.createSubjectAltNameExtension=function(a){if(!("SubjectAlternativeNames"in a))return null;a=a.SubjectAlternativeNames;for(var b=[],c=0;c<a.length;++c){var d=a[c].NameType,e=a[c].Name,g=this.mapIA5StringSubjectAltName(d,e);g||(g=this.mapWellKnownOtherName(d,e));g?b.push(g):N("Skipping unsupport SAN NameType:"+d,Za,this.managedPolicy.JSC$3053_getLogLevel())}return b.length==0?null:new window.org.pkijs.simpl.EXTENSION({extnID:"2.5.29.17",critical:!1,extnValue:(new window.org.pkijs.simpl.GENERAL_NAMES({names:b})).toSchema().toBER(!1)})};
f.getAdditionalExtensions=function(a){var b=[];(a=this.createSubjectAltNameExtension(a))&&b.push(a);return b};
f.generateCsr_=function(a,b){var c=this,d=this.JSC$3100_q.defer(),e=this.JSC$3100_q.defer(),g=e.promise;e.resolve();var h=new window.org.pkijs.simpl.PKCS10;h.version=0;h.attributes=[];var k=this.managedPolicy.getSignatureAlgorithm(),l,m,n=this.tokenService.getCurrentToken().subtleCrypto,r=window.crypto.subtle;window.org.pkijs.getCrypto=function(){return c.tokenService.getCurrentToken().subtleCrypto};var x=!1;e=function(t){x||(x=!0,t&&(c.JSC$3100_errorMessage=chrome.i18n.getMessage(t)),c.currentCsr=
"",d.reject());return d};g.then(function(){var t=window.org.pkijs.getAlgorithmParameters("RSASSA-PKCS1-V1_5","generatekey");"hash"in t.algorithm&&(t.algorithm.hash.name=k);return n.generateKey(t.algorithm,!1,t.usages)},e.bind(this,void 0)).then(function(t){l=t.publicKey;m=t.privateKey},e.bind(this,"saving_generate_key_failure")).then(function(){return h.subjectPublicKeyInfo.importKey(l)},e.bind(this,"saving_generate_extract_failure")).then(function(){return r.digest({name:"SHA-1"},h.subjectPublicKeyInfo.subjectPublicKey.value_block.value_hex)},
e.bind(this,"saving_generate_export_failure")).then(function(t){c.subjectPublicKeyDigestResult_=t;return c.certRequestValuesService_.getCertRequestValues(c.tokenService.getCurrentTokenType()=="system")},e.bind(this,"saving_generate_digest_failure")).then(function(t){var u=[];u.push(new window.org.pkijs.simpl.EXTENSION({extnID:"1.3.6.1.4.1.311.20.2",critical:!1,extnValue:(new window.org.pkijs.asn1.BMPSTRING({value:a})).toBER(!1)}));u.push(new window.org.pkijs.simpl.EXTENSION({extnID:"2.5.29.14",critical:!1,
extnValue:(new window.org.pkijs.asn1.OCTETSTRING({value_hex:c.subjectPublicKeyDigestResult_})).toBER(!1)}));b&&h.attributes.push(new window.org.pkijs.simpl.ATTRIBUTE({type:"1.3.6.1.4.1.311.13.1",values:[b.toSchema(!1)]}));Array.prototype.push.apply(u,c.getAdditionalExtensions(t));h.attributes.push(new window.org.pkijs.simpl.ATTRIBUTE({type:"1.2.840.113549.1.9.14",values:[(new window.org.pkijs.simpl.EXTENSIONS({extensions_array:u})).toSchema()]}));Array.prototype.push.apply(h.subject.types_and_values,
c.getAdditionalSubjectTypesAndValues(t))},e.bind(this,"saving_cert_request_values_failure")).then(function(){return h.sign(m,k)},e.bind(this,"saving_generate_push_failure")).then(function(){var t=h.toSchema().toBER(!1);c.currentCsr=window.btoa(ab(t));d.resolve()},e.bind(this,"saving_generate_sign_failure"));return d.promise};f.getKeyPair_=function(a,b){return new Promise(function(c,d){try{chrome.platformKeys.getKeyPair(a,b,function(e,g){chrome.runtime.lastError?d(chrome.runtime.lastError):c([e,g])})}catch(e){d(e)}})};
f.generateCsrForRenewal_=function(a,b){var c=this,d,e,g,h,k,l,m,n,r,x,t,u;return A(function(q){switch(q.nextAddress){case 1:return d=c.managedPolicy.getSignatureAlgorithm(),h=window.org.pkijs.getCrypto,window.org.pkijs.getCrypto=function(){return c.tokenService.getCurrentToken().subtleCrypto},k={name:"RSASSA-PKCS1-v1_5",hash:{name:d}},l=function(ca){window.org.pkijs.getCrypto=h;c.currentCsr="";ca&&(c.JSC$3100_errorMessage=chrome.i18n.getMessage(ca))},q.setCatchFinallyBlocks(2),q.yield(c.getKeyPair_(b.toSchema(!1).toBER(),
k),4);case 4:m=q.yieldResult;e=m[1];q.leaveTryBlock(3);break;case 2:return q.enterCatchBlock(),l("renewal_request_key_pair_failure"),q.return(Promise.reject());case 3:return q.setCatchFinallyBlocks(5),q.yield(c.generateCsr_(a,b),7);case 7:q.leaveTryBlock(6);break;case 5:return q.enterCatchBlock(),l("renewal_generate_pkcs10_failure"),q.return(Promise.reject());case 6:return n=bb(window.atob(c.currentCsr)),g=new window.org.pkijs.simpl.CMS_SIGNED_DATA({encapContentInfo:new window.org.pkijs.simpl.cms.EncapsulatedContentInfo({eContentType:"1.2.840.113549.1.7.1",
eContent:new window.org.pkijs.asn1.OCTETSTRING({name:"eContent",value_hex:n})}),signerInfos:[new window.org.pkijs.simpl.CMS_SIGNER_INFO({version:1,sid:new window.org.pkijs.simpl.cms.IssuerAndSerialNumber({issuer:b.issuer,serialNumber:b.serialNumber})})],certificates:[b]}),q.setCatchFinallyBlocks(8),q.yield(g.sign(e,0,d,null),10);case 10:q.leaveTryBlock(9);break;case 8:return r=q.enterCatchBlock(),N(r,K,c.managedPolicy.JSC$3053_getLogLevel()),l("renewal_sign_cms_failure"),q.return(Promise.reject());
case 9:g.signerInfos[0].signatureAlgorithm=new window.org.pkijs.simpl.ALGORITHM_IDENTIFIER({algorithm_id:"1.2.840.113549.1.1.1",algorithm_params:new window.org.pkijs.asn1.NULL}),x=new window.org.pkijs.simpl.CMS_CONTENT_INFO({contentType:"1.2.840.113549.1.7.2",content:g.toSchema()}),t=x.toSchema(),u=t.toBER(!1),c.currentCsr=window.btoa(ab(u)),window.org.pkijs.getCrypto=h,q.jumpToEnd()}})};f.JSC$3108_getLogLevel=function(){return this.managedPolicy.JSC$3053_getLogLevel()};
f.setFetchError=function(a){a==="TimeoutError"?(this.hasSpecificError=!0,a=this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_timeout_error")):a=a.toString();return a};f.isClientAuthBasic=function(){return this.managedPolicy.getClientAuthentication()==="basic"};
f.enroll=function(a,b,c,d){var e=this,g=this.JSC$3100_q.defer();if(d.length==0)return this.hasEnrolledSuccessfully=!1,this.hasSpecificError=!0,this.JSC$3100_errorMessage=chrome.i18n.getMessage("login_no_uri_failure"),N(this.JSC$3100_errorMessage,K,this.managedPolicy.JSC$3053_getLogLevel()),g.reject(),g.promise;d=this.certHelper(d[0]);if(d===null)return this.hasEnrolledSuccessfully=!1,g.reject(),g.promise;d.then(function(){if(e.currentCsr=="")e.hasEnrolledSuccessfully=!1,N(e.JSC$3100_errorMessage,
K,e.managedPolicy.JSC$3053_getLogLevel()),g.reject();else{var h=e.prepareBody(a,fc,b,c,e.isClientAuthBasic(),"ccr-certificate-request",null);(function(){var k,l,m,n,r,x,t,u;return A(function(q){switch(q.nextAddress){case 1:return k=e.getFetchTimeout(),q.setCatchFinallyBlocks(2),l=fetch(a,{method:"POST",headers:{"Content-Type":"application/soap+xml; charset=utf-8"},credentials:"include",body:h}),q.yield(ob(l,k),4);case 4:return m=q.yieldResult,((n=m)==null?0:n.ok)?q.yield(m.text(),8):q.yield(m.text(),
7);case 7:r=q.yieldResult;O("Server rejected the enrol request with error, code: "+m.status,e.JSC$3108_getLogLevel());e.enrollFailureCallback(r,m.statusText);g.reject();q.jumpTo(6);break;case 8:x=q.yieldResult,e.enrollSuccessCallback(x),e.isEnrolledSuccessfully()||e.isRequestPending()?g.resolve():g.reject();case 6:q.leaveTryBlock(0);break;case 2:t=q.enterCatchBlock(),e.hasEnrolledSuccessfully=!1,u=e.setFetchError(t),O(u,e.JSC$3108_getLogLevel()),g.reject(),q.jumpToEnd()}})})()}},function(){g.reject()});
return g.promise};f.getFetchTimeout=function(){return this.managedPolicy.getXhrRequestTimeout()};
f.prepareBody=function(a,b,c,d,e,g,h){var k=new DOMParser,l=S(k,gc);l.getElementById("ccr-cep-proxy-url").textContent=a;a=S(k,b);b=b==hc?h:this.currentCsr;a.getElementById(g).textContent=b;l.getElementById("ccr-body").appendChild(a.firstElementChild);e&&(c=zb(c),d=zb(d),e=l.getElementById("ccr-header"),g=e.appendChild,b=new DOMParser,b=S(b,ic),b.getElementById("ccr-basic-auth-username").textContent=c,b.getElementById("ccr-basic-auth-password").textContent=d,d=zb(b.firstElementChild),g.call(e,d));
mb(l);return(new XMLSerializer).serializeToString(l)};
f.renewCertificate=function(a,b){var c=this,d,e;return A(function(g){switch(g.nextAddress){case 1:d=c.tokenService.getCurrentTokenType()=="system"?c.managedPolicy.getDeviceEnrollmentTemplates():c.managedPolicy.getUserEnrollmentTemplates();if(!c.tokenService.getCurrentToken()||d.length==0)return N("No template found for key-based renewal.",K,c.managedPolicy.JSC$3053_getLogLevel()),c.hasEnrolledSuccessfully=!1,g.return(Promise.reject());g.setCatchFinallyBlocks(2);return g.yield(c.generateCsrForRenewal_(d[0],
b),4);case 4:g.leaveTryBlock(3);break;case 2:return e=g.enterCatchBlock(),N("Generating CSR failed with the following error: "+e,K,c.managedPolicy.JSC$3053_getLogLevel()),c.hasEnrolledSuccessfully=!1,g.return(Promise.reject());case 3:return g.return(new Promise(function(h,k){var l=c.prepareBody(a,fc,null,null,!1,"ccr-certificate-request",null);(function(){var m,n,r,x,t,u,q,ca;return A(function(C){switch(C.nextAddress){case 1:return C.setCatchFinallyBlocks(2),m=c.getFetchTimeout(),n=fetch(a,{method:"POST",
headers:{"Content-Type":"application/soap+xml; charset=utf-8"},body:l}),C.yield(ob(n,m),4);case 4:return r=C.yieldResult,((x=r)==null?0:x.ok)?C.yield(r.text(),8):C.yield(r.text(),7);case 7:t=C.yieldResult;O("Server rejected the renewal request with error, code: "+r.status,c.JSC$3108_getLogLevel());c.enrollFailureCallback(t,r.statusText);k();C.jumpTo(6);break;case 8:u=C.yieldResult,c.enrollSuccessCallback(u),c.isEnrolledSuccessfully()||c.isRequestPending()?h():k();case 6:C.leaveTryBlock(0);break;case 2:q=
C.enterCatchBlock(),c.hasEnrolledSuccessfully=!1,ca=c.setFetchError(q),O(ca,c.JSC$3108_getLogLevel()),k(),C.jumpToEnd()}})})()}))}})};
f.checkPendingRequestStatus=function(a,b,c,d){var e=this,g=this.JSC$3100_q.defer();if(!this.tokenService.getCurrentToken())return this.hasEnrolledSuccessfully=!1,this.currentCsr="",g.reject(),g.promise;var h=this.prepareBody(a,hc,c,d,this.isClientAuthBasic(),"ccr-request-id",b);(function(){var k,l,m,n,r,x,t,u;return A(function(q){switch(q.nextAddress){case 1:return q.setCatchFinallyBlocks(2),k=e.getFetchTimeout(),l=fetch(a,{method:"POST",headers:{"Content-Type":"application/soap+xml; charset=utf-8"},
credentials:"include",body:h}),q.yield(ob(l,k),4);case 4:return m=q.yieldResult,((n=m)==null?0:n.ok)?q.yield(m.text(),8):q.yield(m.text(),7);case 7:r=q.yieldResult;O(r,e.JSC$3108_getLogLevel());e.enrollFailureCallback(r,m.statusText);g.reject();q.jumpTo(6);break;case 8:x=q.yieldResult,e.enrollSuccessCallback(x),e.isEnrolledSuccessfully()||e.isRequestPending()?g.resolve():g.reject();case 6:q.leaveTryBlock(0);break;case 2:t=q.enterCatchBlock(),e.hasEnrolledSuccessfully=!1,u=e.setFetchError(t),O(u,e.JSC$3108_getLogLevel()),
g.reject(),q.jumpToEnd()}})})();return g.promise};
f.enrollSuccessCallback=function(a){this.isCurrentRequestPending=this.hasEnrolledSuccessfully=!1;var b=!1;try{var c=S(new DOMParser,a)}catch(e){console.log("Error parsing CA response",e),b=!0}if(!c||b)this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_no_cert_failure");else{a="";b=c.getElementsByTagName("BinarySecurityToken");if(b!=null&&b!=void 0)for(var d=0;d<b.length;++d)if(b[d].getAttribute("ValueType")=="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"){a=b[d].innerHTML;
break}if(a==null||a==void 0)a="";b=cb(c,"RequestID");d="";c=c.getElementsByTagName("Reference");c!=null&&c!=void 0&&c.length!=0&&(d=c[c.length-1].getAttribute("URI"));if(d==null||d==void 0)d="";c=d;a.length>0?this.storeCertificate(a)?(N("Successfully enrolled a certificate.",L,this.managedPolicy.JSC$3053_getLogLevel()),this.hasEnrolledSuccessfully=!0):this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_store_failure"):c.length>0?(N("Certificate is pending.",L,this.managedPolicy.JSC$3053_getLogLevel()),
N("Pending certificate requestUri="+c+" and requestId="+b,M,this.managedPolicy.JSC$3053_getLogLevel()),this.isCurrentRequestPending=!0,this.currentRequestId=b,this.currentRequestUri=c,this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_pending",[b,c])):this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_no_cert_failure")}};
f.enrollFailureCallback=function(a,b){this.hasEnrolledSuccessfully=!1;var c=new DOMParser;var d=void 0;d=d===void 0?{}:d;a instanceof G?d=a:(a=String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),d.preserveSpaces&&(a=a.replace(/(^|[\r\n\t ]) /g,"$1&#160;")),d.preserveNewlines&&(a=a.replace(/(\r\n|\n|\r)/g,"<br>")),d.preserveTabs&&(a=a.replace(/(\t+)/g,'<span style="white-space:pre">$1</span>')),d=Qa(a));c=c.parseFromString(Ra(d),"text/xml");
a=cb(c,"Text");d=a.slice(0,35);a=a.slice(0,6);cb(c,"Value").slice(-20)==="FailedAuthentication"?(this.hasSpecificError=!0,this.JSC$3100_errorMessage=chrome.i18n.getMessage("invalid_credentials")):d==="Denied by Policy Module  0x80094800"?(this.hasSpecificError=!0,this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_template_error")):a==="Denied"?(this.hasSpecificError=!0,this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_denied")):(this.hasSpecificError=!1,this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_bad_response",
b));N(this.JSC$3100_errorMessage,K,this.managedPolicy.JSC$3053_getLogLevel())};
f.storeCertificate=function(a){var b=this;N("Attempting to store a cert.",M,this.managedPolicy.JSC$3053_getLogLevel());if(a.length>0){var c=bb(window.atob(a));chrome.enterprise.platformKeys.importCertificate(this.tokenService.getCurrentToken().id,c,function(){var d=b.managedPolicy.getHoursOffset(),e=b.managedPolicy.getNotificationInterval(),g=window.org.pkijs.fromBER(c);g=new window.org.pkijs.simpl.CERT({schema:g.result});ib(g,d,e)});return!0}return!1};f.isEnrolledSuccessfully=function(){return this.hasEnrolledSuccessfully};
f.isRequestPending=function(){return this.isCurrentRequestPending};f.getPendingRequestId=function(){return this.currentRequestId};f.getPendingRequestUri=function(){return this.currentRequestUri};Y.$inject=["managedPolicyService","tokenService","certRequestValuesService","$q"];
var gc=P('\n<s:Envelope xmlns:a="http://www.w3.org/2005/08/addressing"\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope">\n  <s:Header id="ccr-header">\n    <a:Action s:mustUnderstand="1">\n      http://schemas.microsoft.com/windows/pki/2009/01/enrollment/RST/wstep\n    </a:Action>\n    <a:ReplyTo>\n      <a:Address>http://www.w3.org/2005/08/addressing/anonymous</a:Address>\n    </a:ReplyTo>\n    <a:To s:mustUnderstand="1" id="ccr-cep-proxy-url">\n    </a:To>\n  </s:Header>\n  <s:Body xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      xmlns:xsd="http://www.w3.org/2001/XMLSchema"\n      id="ccr-body">\n  </s:Body>\n</s:Envelope>\n'),fc=
P('\n<RequestSecurityToken\n    xmlns="http://docs.oasis-open.org/ws-sx/ws-trust/200512">\n  <TokenType>\n    http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\n  </TokenType>\n  <RequestType>\n    http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue\n  </RequestType>\n  <BinarySecurityToken\n      EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd#base64binary"\n      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd#PKCS7"\n      xmlns="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" id="ccr-certificate-request">\n  </BinarySecurityToken>\n  <RequestID xsi:nil="true"\n      xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollment"\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" />\n</RequestSecurityToken>\n'),
ic=P('\n<o:Security\n    xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"\n    xmlns:s="http://www.w3.org/2003/05/soap-envelope"\n    s:mustUnderstand="1">\n  <o:UsernameToken>\n    <o:Username id="ccr-basic-auth-username">\n    </o:Username>\n    <o:Password id="ccr-basic-auth-password">\n    </o:Password>\n  </o:UsernameToken>\n</o:Security>\n'),hc=P('\n<RequestSecurityToken\n    xmlns="http://docs.oasis-open.org/ws-sx/ws-trust/200512">\n  <TokenType>\n    http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3\n  </TokenType>\n  <RequestType>\n    http://schemas.microsoft.com/windows/pki/2009/01/enrollment/QueryTokenStatus\n  </RequestType>\n  <RequestID\n      xmlns="http://schemas.microsoft.com/windows/pki/2009/01/enrollment"\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      id="ccr-request-id">\n  </RequestID>\n</RequestSecurityToken>\n'),
ec={rfc822Name:1,dNSName:2,uniformResourceIdentifier:6};var jc=function(a,b,c,d,e,g){Y.call(this,a,b,c,g);this.JSC$3138_http_=e;this.verifiedAccessService_=d;this.chromeIdentityEmail_=""};ma(jc,Y);f=jc.prototype;
f.enroll=function(a,b,c,d){var e=this,g=this.JSC$3100_q.defer(),h=this.certHelper(d[0]);if(h===null)return g.reject(),g.promise;h.then(function(){e.currentCsr==""?(e.hasEnrolledSuccessfully=!1,N(e.JSC$3100_errorMessage,K,e.managedPolicy.JSC$3053_getLogLevel()),g.reject()):e.verifiedAccessService_.makeCsrToken().then(function(){var k=e.verifiedAccessService_.getCsrToken();k==""?(e.setErrorBasedOnVerifiedAccess_(),g.reject()):e.setChromeIdentityEmail_().then(function(){e.postEnrollmentRequest_(a,b,
c,d,k).then(function(){e.isEnrolledSuccessfully()||e.isRequestPending()?g.resolve():g.reject()},function(){g.reject()})},function(){g.reject()})},function(){e.setErrorBasedOnVerifiedAccess_();g.reject()})},function(){g.reject()});return g.promise};
f.postEnrollmentRequest_=function(a,b,c,d,e){var g=this;return this.JSC$3138_http_.post(a,{adUsername:b,adPassword:c,templates:d,csrToken:e,expectedIdentity:this.chromeIdentityEmail_,vaSharedSecret:this.managedPolicy.getVerifiedAccessSharedSecret(),pkcsCsr:this.currentCsr,csrType:"pkcs10",shouldEnrollForMachine:this.tokenService.isCurrentTokenSystemType()},{withCredentials:!0,timeout:this.managedPolicy.getVerifiedAccessRequestTimeout(),headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(h){g.enrollSuccessCallback(h.data.certificate)},
function(h){h.status===-1?g.JSC$3100_errorMessage=chrome.i18n.getMessage("cea_timed_out"):(h=h.data.error,g.isKeyForValidMessage_(h)?g.JSC$3100_errorMessage=chrome.i18n.getMessage(h):g.JSC$3100_errorMessage=chrome.i18n.getMessage("cea_error_other"));g.hasSpecificError=!0;g.hasEnrolledSuccessfully=!1})};
f.enrollSuccessCallback=function(a){this.isCurrentRequestPending=this.hasEnrolledSuccessfully=!1;a==""?this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_no_cert_failure"):(this.hasEnrolledSuccessfully=a=this.storeCertificate(a),a||(this.JSC$3100_errorMessage=chrome.i18n.getMessage("saving_store_failure")))};
f.setErrorBasedOnVerifiedAccess_=function(){this.hasEnrolledSuccessfully=!1;this.hasSpecificError=this.verifiedAccessService_.isSpecificErrorPresent();this.JSC$3100_errorMessage=this.verifiedAccessService_.JSC$3102_getErrorMessage();N(this.JSC$3100_errorMessage,K,this.managedPolicy.JSC$3053_getLogLevel())};f.isKeyForValidMessage_=function(a){return chrome.i18n.getMessage(a)!=""};
f.setChromeIdentityEmail_=function(){var a=this,b=this.JSC$3100_q.defer(),c=b.promise;chrome.identity.getProfileUserInfo(function(d){a.chromeIdentityEmail_=d.email;b.resolve()});return c};jc.$inject="managedPolicyService tokenService certRequestValuesService verifiedAccessService $http $q".split(" ");var kc=function(a,b){this.JSC$3084_managedPolicy_=a;this.JSC$3084_q_=b;this.currentToken_=void 0;this.errorMessage_=this.tokenType_=""};f=kc.prototype;
f.setTokenFromPlatformKeys=function(a){var b=this,c=this.JSC$3084_q_.defer();chrome.enterprise!=void 0&&chrome.enterprise.platformKeys!=void 0?chrome.enterprise.platformKeys.getTokens(function(d){for(var e=void 0,g=void 0,h=0;h<d.length;h++)switch(d[h].id){case "user":e=d[h];break;case "system":g=d[h]}a?b.JSC$3084_managedPolicy_.isMachineCertEnrollmentAllowed()?g!=void 0?(b.currentToken_=g,b.tokenType_=lc.SYSTEM,c.resolve()):(b.errorMessage_=chrome.i18n.getMessage("token_no_system_failure"),b.currentToken_=
void 0,b.tokenType_="",c.reject()):(b.errorMessage_=chrome.i18n.getMessage("token_system_unallowed_failure"),b.currentToken_=void 0,b.tokenType_="",c.reject()):e!=void 0?(b.currentToken_=e,b.tokenType_=lc.USER,c.resolve()):(b.errorMessage_=chrome.i18n.getMessage("token_no_user_failure"),b.currentToken_=void 0,b.tokenType_="",c.reject())}):(this.errorMessage_=chrome.i18n.getMessage("token_no_user_failure"),this.currentToken_=void 0,this.tokenType_="",c.reject());return c.promise};
f.getCurrentToken=function(){return this.currentToken_};f.getCurrentTokenType=function(){return this.tokenType_};f.JSC$3147_getErrorMessage=function(){return this.errorMessage_};f.getMatchingTemplates=function(){return this.tokenType_===lc.USER?this.JSC$3084_managedPolicy_.getUserEnrollmentTemplates():this.tokenType_===lc.SYSTEM?this.JSC$3084_managedPolicy_.getDeviceEnrollmentTemplates():[]};f.isCurrentTokenSystemType=function(){return this.tokenType_===lc.SYSTEM};
kc.$inject=["managedPolicyService","$q"];var lc={USER:"user",SYSTEM:"system"};var mc=function(a,b,c,d,e){W.call(this,a,b,e);this.JSC$3141_http_=c;this.csrToken_="";this.rawChallenge_={challenge:{data:"",signature:""}};this.encodedChallenge_=""};ma(mc,W);f=mc.prototype;f.getCsrToken=function(){return this.csrToken_};
f.makeCsrToken=function(){var a=this,b=this.JSC$3100_q.defer();this.getChallengeFromEndpoint_().then(function(){a.encodedChallenge_=a.encodeChallenge_(a.rawChallenge_);a.generateChallengeResponse_(a.encodedChallenge_).then(function(){b.resolve()},function(){a.JSC$3100_errorMessage==""&&(a.JSC$3100_errorMessage=chrome.i18n.getMessage("generate_challenge_response_failed"));b.reject()})},function(){a.JSC$3100_errorMessage==""&&(a.JSC$3100_errorMessage=chrome.i18n.getMessage("get_challenge_failed"));
b.reject()});return b.promise};
f.getChallengeFromEndpoint_=function(){var a=this,b=this.managedPolicy.getApiKey(),c=this.managedPolicy.getVerifiedAccessUrl();if(c.slice(0,5)!=="https"||b=="")return c=this.JSC$3100_q.defer(),b=c.promise,c.reject(),b;b=c+b;c={"Content-Type":"application/json; charset=utf-8","User-Agent":"CCRVA-"+chrome.runtime.getManifest().version+"-"+c};return this.JSC$3141_http_.post(b,{},{withCredentials:!0,timeout:this.managedPolicy.getVerifiedAccessRequestTimeout(),headers:c}).then(function(d){a.rawChallenge_=d.data},
function(d){a.JSC$3100_errorMessage=d.status===-1?chrome.i18n.getMessage("get_challenge_timed_out"):chrome.i18n.getMessage("get_challenge_failed");a.rawChallenge_={challenge:{data:"",signature:""}}})};
f.generateChallengeResponse_=function(a){var b=this,c=this.JSC$3100_q.defer(),d=c.promise;a=window.atob(a);a=bb(a);try{if(chrome.enterprise!=void 0&&chrome.enterprise.platformKeys!=void 0){var e=function(g){g=ab(g);b.csrToken_=window.btoa(g);c.resolve()};this.tokenService.isCurrentTokenSystemType()?chrome.enterprise.platformKeys.challengeMachineKey(a,e):chrome.enterprise.platformKeys.challengeUserKey(a,!0,e)}else this.JSC$3100_errorMessage=chrome.i18n.getMessage("cea_no_api_failure"),N(this.JSC$3100_errorMessage,
K,this.managedPolicy.JSC$3053_getLogLevel()),c.reject()}catch(g){this.JSC$3100_errorMessage=chrome.i18n.getMessage("generate_challenge_response_failed"),N(this.JSC$3100_errorMessage,K,this.managedPolicy.JSC$3053_getLogLevel()),N(g.message,K,this.managedPolicy.JSC$3053_getLogLevel()),c.reject()}return d};f.setSpecificError_=function(a){this.JSC$3100_errorMessage=a;this.hasSpecificError=!0};
f.encodeChallenge_=function(a){var b=window.atob(a.challenge.data);a=window.atob(a.challenge.signature);var c="\n"+nc(b.length);c=c+b+"\u0012"+nc(a.length);c+=a;return window.btoa(c)};mc.$inject=["managedPolicyService","tokenService","$http","$timeout","$q"];function nc(a){return a<=127?String.fromCharCode(a):String.fromCharCode(128+(a&127),a>>>7)};var Z=angular.module("ccrApp.services",[]);Z.service("managedPolicyService",ub);Z.service("requestService",W);Z.service("certificatePolicyService",bc);Z.service("certificateSavingService",Y);Z.service("tokenService",kc);Z.service("verifiedAccessService",mc);Z.service("enrollmentAgentService",jc);Z.service("certRequestValuesService",$b);angular.module("ccrApp.directives",[]);angular.module("ccrApp.controllers",["ngRoute","ngSanitize","ccrApp.services"]).controller("ccr.controllers.LoginPageCtrl",V);
angular.module("ccrApp",["ngMaterial","ccrApp.services","ccrApp.directives","ccrApp.controllers"]);var oc=document.getElementById("angular-bootstrap");angular.element(oc).ready(function(){var a=document.getElementById("angular-bootstrap");a&&angular.bootstrap(a,["ccrApp"])});
