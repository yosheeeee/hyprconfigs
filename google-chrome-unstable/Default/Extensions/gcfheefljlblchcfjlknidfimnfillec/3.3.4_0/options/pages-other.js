import{s as p}from"./mixins-saveSettings.js";import{m as h,h as c,o as a,j as g,w as l,b as i,i as o,d,c as _,e as b,B as f,C as k}from"../common/vendor.js";import{s as S}from"../common/funcs.js";/* empty css             */import{_ as y}from"../common/plugin-vue_export-helper.js";const V={name:"Common",mixins:[p],computed:{...h(["track"]),isScrobblingImageVisible(){return this.scrobblingFormat.includes("%cover%")},cover(){return this.track.cover?this.track.cover.replace("%%","400x400"):"https://music.yandex.ru/blocks/playlist-cover/playlist-cover_no_cover1.png"},textExample(){return S({format:this.scrobblingFormat,artists:this.track.artists,title:this.track.title,version:this.track.version,cover:this.cover}).replaceAll(/\\n|\n/g,"<br/>")},scrobbling:{get(){return this.settings.scrobbling},set(e){this.onScrobblingClick(e)}},scrobblingFilename:{get(){return this.settings.scrobblingFilename},set(e){this.saveSettings({key:"scrobblingFilename",value:e})}},scrobblingFormat:{get(){return this.settings.scrobblingFormat},set(e){this.saveSettings({key:"scrobblingFormat",value:e})}},scrobblingClearOnPause:{get(){return this.settings.scrobblingClearOnPause},set(e){this.saveSettings({key:"scrobblingClearOnPause",value:e})}},scrobblingSaveCoverSeparate:{get(){return this.settings.scrobblingSaveCoverSeparate},set(e){this.saveSettings({key:"scrobblingSaveCoverSeparate",value:e})}},scrobblingCoverFilename:{get(){return this.settings.scrobblingCoverFilename},set(e){this.saveSettings({key:"scrobblingCoverFilename",value:e})}}},methods:{async onScrobblingClick(e){if(e){try{if(await chrome.permissions.contains({permissions:["downloads","downloads.shelf"]})){this.saveSettings({key:"scrobbling",value:e});return}}catch(s){this.$message.error("Ошибка при проверке разрешений"),console.error("chrome.permissions.contains error:",s);return}try{if(await chrome.permissions.request({permissions:["downloads","downloads.shelf"]})){this.saveSettings({key:"scrobbling",value:e});return}}catch(s){this.$message.error("Ошибка при запросе разрешений"),console.error("chrome.permissions.request error:",s);return}this.$message.error("Для включения данной опции необходимо предоставить разрешения"),await this.$nextTick(),this.saveSettings({key:"scrobbling",value:!1})}else this.saveSettings({key:"scrobbling",value:e})}}},C=e=>(f("data-v-9a19224c"),e=e(),k(),e),x={class:"scrobbling__wrapper"},F={class:"scrobbling__column-first"},w={key:0,style:{"margin-left":"1em"}},P={class:"scrobbling__example-wrapper"},I=["innerHTML"],U=["src"],B=C(()=>i("div",{class:"scrobbling__column-second"},[i("h1",null,"ВАЖНАЯ ИНФОРМАЦИЯ!"),i("ul",null,[i("li",null,'В настройках браузера в разделе "Скачанные файлы" должна быть указана папка по умолчанию для сохранения файла и выключена опция "Всегда указывать место для скачивания", иначе браузер будет каждый раз спрашивать куда сохранить файл; '),i("li",null,"Папка по умолчанию должна быть с правами на запись;"),i("li",null,"Если указан путь в имени файла, то он будет относительно этой папки по умолчанию. Нельзя указывать путь, ведущий за пределы папки по умолчанию (например ../folder/ymusic.txt) ")])],-1));function O(e,s,T,q,N,r){const m=c("el-checkbox"),n=c("el-form-item"),u=c("el-input"),v=c("el-form");return a(),g(v,{ref:"form","label-position":"top",class:"scrobbling"},{default:l(()=>[i("div",x,[i("div",F,[o(n,null,{default:l(()=>[o(m,{modelValue:r.scrobbling,"onUpdate:modelValue":s[0]||(s[0]=t=>r.scrobbling=t)},{default:l(()=>[d("Включить трансляцию в файл")]),_:1},8,["modelValue"])]),_:1}),r.scrobbling?(a(),_("div",w,[o(n,{label:'Имя файла (относительный путь к файлу, может содержать директории, например some_folder/ymusic.txt, но нельзя указывать "../"):'},{default:l(()=>[o(u,{modelValue:r.scrobblingFilename,"onUpdate:modelValue":s[1]||(s[1]=t=>r.scrobblingFilename=t)},null,8,["modelValue"])]),_:1}),o(n,null,{default:l(()=>[o(m,{modelValue:r.scrobblingClearOnPause,"onUpdate:modelValue":s[2]||(s[2]=t=>r.scrobblingClearOnPause=t)},{default:l(()=>[d("Включить очистку файла на паузе")]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"Формат данных (доступны %artists%, %track%, %version%, %cover%):"},{default:l(()=>[r.scrobbling?(a(),g(u,{key:0,autosize:"",type:"textarea",modelValue:r.scrobblingFormat,"onUpdate:modelValue":s[3]||(s[3]=t=>r.scrobblingFormat=t)},null,8,["modelValue"])):b("",!0)]),_:1}),i("div",P,[i("div",{class:"scrobbling__example",innerHTML:r.textExample},null,8,I),r.isScrobblingImageVisible?(a(),_("img",{key:0,class:"scrobbling__image",src:r.cover,alt:"track cover"},null,8,U)):b("",!0)]),o(n,null,{default:l(()=>[o(m,{style:{"margin-top":"1em"},modelValue:r.scrobblingSaveCoverSeparate,"onUpdate:modelValue":s[4]||(s[4]=t=>r.scrobblingSaveCoverSeparate=t)},{default:l(()=>[d("Сохранять обложку в отдельный файл")]),_:1},8,["modelValue"])]),_:1}),r.scrobblingSaveCoverSeparate?(a(),g(n,{key:0,label:'Имя файла с обложкой (относительный путь к файлу, может содержать директории, например some_folder/cover.jpg, но нельзя указывать "../"):'},{default:l(()=>[o(u,{modelValue:r.scrobblingCoverFilename,"onUpdate:modelValue":s[5]||(s[5]=t=>r.scrobblingCoverFilename=t)},null,8,["modelValue"])]),_:1})):b("",!0)])):b("",!0)]),B])]),_:1},512)}const M=y(V,[["render",O],["__scopeId","data-v-9a19224c"]]);export{M as default};
