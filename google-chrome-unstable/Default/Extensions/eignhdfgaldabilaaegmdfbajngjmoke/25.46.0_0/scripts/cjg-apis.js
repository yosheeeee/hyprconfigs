"use strict";!function(){function e(e,n){for(var t in n)T(e,t,{get:n[t],enumerable:!0})}var g=self,a=g.location,d="undefined"!=typeof chrome&&chrome||{},T=Object.defineProperty,n={},t=(e(n,{list:function(){return ae},missingAccountData:function(){return w},noAccountData:function(){return v},signin:function(){return ce},signout:function(){return ue}}),d.runtime.getURL("PATH/").replace("/PATH/","")),r=t.startsWith("safari-web-extension://"),N=!r&&t.startsWith("moz-extension://");function o(){var e;try{e=d.i18n.getMessage("@@extension_id")}catch(e){}return e||t.split("://")[1]}var i="https://www.google.com",c="https://ogs.google.com",E=cjBasics.navigator.contentScriptsOnSearchBlockable?c:i,M=["https://news.google.com",i,c],D=o(),H={};function F(e){var o,n=H[e];return n||(o=e,n=new Promise(function(n,e){var t=!1,r=(setTimeout(function(){t||e(new Error("timeout"))},1250),cjce.createElement("basic-iframe",{hidden:!0,src:o+"/images/cjg-proxy/"+D+"_"+cjBasics.generateUniqueId()+"/",sandbox:"allow-same-origin allow-scripts",onBmMessage:function(e){"cjgProxyReady"===e&&(t=!0,n(r))}}));document.head.appendChild(r)}),H[e]=n)}function W(e,n){n&&n.endsWith(".google.com");var r=i||i,o=(cjBasics.webRequest.transformRequestHeadersWithDnr([e],[{header:"origin",operation:"set",value:r}],["xmlhttprequest"]),cjBasics.webRequest.addListener("onBeforeSendHeaders",function(e){for(var n=e.requestHeaders,t=0;t<n.length;++t)if("origin"===n[t].name.toLowerCase()){n.splice(t,1);break}return n.push({name:"Origin",value:r}),o.removeListener(),{requestHeaders:n}},{types:["xmlhttprequest"],urls:[e]},["blocking","requestHeaders","extraHeaders"]))}function u(n,t,e){if("undefined"==typeof document)return Promise.reject(new Error("Running in service worker"));e&&W(n,e);var r=-1!==M.indexOf(e)?e:E;return F(r).then(function(e){return e.cjceSendFrameRequest({method:"cjgOriginRequest",value:btoa(JSON.stringify({url:n,parameters:t}))},r).then(function(e){if(e.success)return e.response;throw e.response})})}function s(e,n,t){return W(e,t),cjBasics.ajax(e,n)}function z(e,n,t){return N||"undefined"==typeof document?s(e,n,t).catch(function(){return u(e,n,t)}):u(e,n,t).catch(function(){return s(e,n,t)})}function G(t,r,o){cjBasics.navigator.getCurrentTabIdRequest().then(function(e){var e=e===cjBasics.navigator.noTabId||-1!==a.search.indexOf("environment=popup"),n=(n=(n=e)&&g.screenTop)||(0<(n=(g.height-600)/2)?Math.round(n):void 0),e=0<(e=(e=e)&&g.screenLeft)?e:0<(e=(g.width-600)/2)?Math.round(e):void 0;cjBasics.navigator.isMac&&e&&(e+=6),d.runtime.sendMessage({method:"createNewPopup",data:{leftPosition:e,method:o,redirectUrl:r,requestUrl:t,topPosition:n}})})}var c={},X=(e(c,{getAccountsBackupCookie:function(){return h},getLoginEmail:function(){return Y},getSapisId:function(){return V},setCookieWebRequest:function(){return m}}),"https://www.google.com"),Z={groups:"groupsloginpref",play:"PLAY_ACTIVE_ACCOUNT",sites:"SITESM",store:"PLAY_ACTIVE_ACCOUNT"};function l(t,r){return new Promise(function(n){d.cookies.get({name:t,url:r},function(e){d.runtime.lastError&&"SAPISID"===t&&"https://www.google.com"===r?n(l("SAPISID","https://accounts.google.com")):n(e?e.value:null)})})}function J(e){return!e||-1===(e=e.split("=")[1]).indexOf("@")?null:e}function Y(e){return l(Z[e],"https://"+e+".google.com").then(J)}function V(){return l("SAPISID",X)}function h(e){return cjBasics.navigator.isFirefox?new Promise(function(n){d.cookies.getAll({url:e},function(e){d.runtime.lastError||!Array.isArray(e)?n(""):(e=e.map(function(e){return e.name+"="+e.value}).join("; "),n(e))})}):Promise.resolve("")}function m(r,e,n){var o;cjBasics.navigator.isFirefox&&-1!==r.indexOf("SAPISID=")&&(o=cjBasics.webRequest.addListener("onBeforeSendHeaders",function(e){o.removeListener();for(var n=e.requestHeaders,t=0;t<n.length;t++)if("cookie"===n[t].name.toLowerCase())return;return cjBasics.webRequest.setHasFirefoxContentBlocking(!0),n.push({name:"Cookie",value:r}),{requestHeaders:n}},{types:[n?"sub_frame":"xmlhttprequest"],urls:[e]},["blocking","requestHeaders"]))}var K="https://accounts.google.com",f="https://www.google.com",p=a.pathname,Q="/views/background.html"===p||"/background.js"===p,v={displayName:cjBasics.lang.i18n("cj_i18n_02717","Not signed in"),authuser:"0",obfuscatedId:"ACCOUNT_ID_NONE",pageId:null,validSession:!1,onlyAccount:!0,onlyAccountOrPage:!0},w={displayName:cjBasics.lang.i18n("cj_i18n_06286","A Google user"),photoUrl:"/images/avatar.svg",authuser:"0",obfuscatedId:"me",pageId:null,validSession:!0,onlyAccount:!0,onlyAccountOrPage:!0};function $(e){e=e.split(".postMessage",2)[1].split("www.google.com",1)[0],e=decodeURIComponent(e.replace(/\\x/g,"%").replace(/\\n/g,"")).slice(2,-14);return JSON.parse(e)}function ee(e){if(Array.isArray(e)&&Array.isArray(e[1]))return e[1].map(function(e){return{displayName:e[2],displayEmail:e[3],photoUrl:e[4],authuser:e[7]?e[7].toString():"0",pageId:e[8],validSession:0!==e[9]&&!1!==e[9],obfuscatedId:e[10],ownedBySelectedAccount:e[11]}});throw new TypeError("Invalid API response")}function A(e){return s(e,{method:"POST",credentials:"include",fetchAs:"json"},f)}function y(e){return cjBasics.ajax(e+"&origin="+encodeURIComponent(f),{credentials:"include",fetchAs:"text"}).then($)}function ne(e){return u(e,{method:"POST",credentials:"include",fetchAs:"json"},f)}function te(e){e=e,(n=Math.floor(1e3*Math.random()))<100&&(n+=103),n=K+"/ListAccounts?json=standard&source=ogb&md=1&cc=1&mn=1&mo=1&gpsia=1&fwput="+n,e&&(!1!==e.listPages&&(n+="&listPages=1"),e.authuser&&(n+="&authuser="+encodeURIComponent(e.authuser)),e.pageId)&&(n+="&pageId="+encodeURIComponent(e.pageId));var n,t=n;return cjBasics.navigator.isFirefox?h(t).then(function(e){return m(e,t),A(t).catch(function(){return m(e,t+"&origin="+encodeURIComponent(f)),y(t)}).catch(function(){return m(e,t),ne(t)})}):(cjBasics.navigator.isSafari?y(t).catch(function(){return A(t)}):A(t).catch(function(){return y(t)})).catch(function(){return ne(t)})}function re(n){var e;return!0!==navigator.onLine?Promise.reject():(e=te(n),Q?e:e.catch(function(){return e=n,new Promise(function(t,r){d.runtime.sendMessage({method:"listAccounts",data:e},function(e){var n=e.error,e=e.response;(n?r:t)(e)})});var e}))}function oe(e){if(1===e.length)e[0].onlyAccount=!0,e[0].onlyAccountOrPage=!0;else if(1<e.length){for(var n,t=0;t<e.length;t++){if("0"!==e[t].authuser)return e;e[t].pageId||(n=e[t])}n&&(n.onlyAccount=!0)}return e}function ae(n){return re(n).then(ee).then(oe).catch(function(){return null}).then(function(e){return n.includeFallback?Array.isArray(e)?[v]:[w]:e})}function ie(e,n,t){var r=o(),r=f+"/images/cjg-apis/"+r+"_"+cjBasics.generateUniqueId()+"/"+t,n=n||{};return n.continue=r,n.hl=cjBasics.lang.getCurrent(),G(cjBasics.urlParams.attach(K+"/"+e,n),r+"*",t)}function ce(e){var n="AddSession";return ie(n=e&&!1===e.validSession?"AccountChooser":n,{Email:"string"==typeof(n=e&&e.displayEmail)&&-1!==n.indexOf("@")&&2<n.length?n:null},"signin")}function ue(){ie("Logout",null,"signout")}var p={},j=(e(p,{getTokenInfo:function(){return ge},requestPermissions:function(){return we},requireToken:function(){return x},revokePermissions:function(){return ve}}),"https://www.google.com"),b="https://accounts.google.com",se="https://oauth2.googleapis.com",le="https://g.carlosjeurissen.com/webext-auth",I=g.atob("NDk0MDg2MDMwODUxLTkzdmplNzc4a29ncjlkbmZxMmhobGkyZTkxOHA0aGhhLmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29t"),_=o(),S={},fe={};function ge(e){e=cjBasics.urlParams.attach(se+"/tokeninfo",{access_token:e,prettyPrint:"false"});return cjBasics.ajax(e,{fetchAs:"json"})}function P(e){return e.pageId?"https://www.googleapis.com/auth/youtube.readonly":"https://www.googleapis.com/auth/userinfo.profile"}function de(e,n){return Promise.reject({cjg_error:"not_authorized",cjg_missing_scopes:n})}function he(e,n,t){var r,o;return n&&n.accessToken?(r=[],o=n.grantedScopes||[],t.forEach(function(e){-1===o.indexOf(e)&&r.push(e)}),0<r.length?de(0,r):n.accessToken):de(0,t)}function me(e,s){var l=Boolean(d.webRequest),f=!l;return new Promise(function(t){var r,a,i=_+"---"+cjBasics.generateUniqueId(),c=document.createElement("iframe");function o(e,n){var o=function(e,n){if(!(n=n.split("#")[1]))return null;if(-1===n.indexOf("&"))try{n=g.atob(n)}catch(e){}return!(n=new URLSearchParams(n)).get("error")&&n.get("state")===e&&n.get("access_token")||null}(i,e);!o&&n?t(null):(c.remove(),r&&r.removeListener(),a&&a.removeListener(),f&&d.runtime.onMessage.removeListener(u),e=ge(o).then(function(e){var n,t,r;return e.aud!==I?null:(n=e,t=Date.now(),n=(r=Number(n.expires_in))?t+r:(r=Number(n.exp))?1e3*r:t,r=e.scope?e.scope.split(" "):[],{accessToken:o,expireTime:n,grantedScopes:r})},function(){return null}),t(e))}function u(e){var n;"cjgAuthUrl"===e.method&&(e=e.data)&&(n=new URL(e)).origin===j&&(n.pathname.startsWith("/cjg-auth/")||n.pathname.startsWith("/images/cjg-auth/"))&&o(e,!0)}l&&(a=cjBasics.webRequest.addListener("onBeforeRedirect",function(e){o(e.redirectUrl)},{types:["sub_frame"],urls:[j+"/images/cjg-auth/"+_+"*",j+"/cjg-auth/"+_+"*",b+"/*"+_+"*"]}),r=cjBasics.webRequest.catchAndStop([j+"/images/cjg-auth/"+_+"*",j+"/cjg-auth/"+_+"*"],function(e){o(e)})),f&&(d.runtime.onMessage.addListener(u),cjBasics.navigator.isSafari)&&g.addEventListener("message",function(e){e.origin===j&&(e=e.data)&&u({method:e.bm_method,data:e.bm_value})}),c.style.display="none";var n=cjBasics.urlParams.attach(b+"/o/oauth2/v2/auth",{authuser:e.authuser,client_id:I,include_granted_scopes:"true",pageId:e.pageId||null,prompt:"none",redirect_uri:le,response_type:"token",scope:s,state:i});c.src=n,cjBasics.navigator.isFirefox?h(n).then(function(e){m(e,n,!0),setTimeout(function(){document.body.appendChild(c)})}):document.body.appendChild(c)})}function x(n,e){var t=e,r=n.pageId+"-"+n.obfuscatedId,e=(Array.isArray(t)&&0!==t.length||(t=[P(n)]),S[r]);if(e){if(e.expireTime>Date.now()+1e4)return he(0,e,t);S[r]=null}var o,a,e=fe[r];return e||(o=t[0],a=P(n),e=me(n,o).then(function(e){return e||o===a?e:me(n,a)}),fe[r]=e),e.then(function(e){return e&&(S[r]=e),he(0,e,t)})}function pe(e){return cjBasics.ajax(se+"/revoke",{fetchAs:"json",method:"POST",body:JSON.stringify({token:e}),headers:{"Content-Type":"application/json"}})}function ve(e){return x(e).then(pe)}function we(e,n){var t;e=e,n=n,n=Array.isArray(n)?n:[],t=P(e),-1===n.indexOf(t)&&n.push(t),G(cjBasics.urlParams.attach(b+"/o/oauth2/v2/auth",{authuser:e.authuser||"0",hl:cjBasics.lang.getCurrent(),client_id:I,login_hint:e.displayEmail,pageId:e.pageId||null,redirect_uri:le,response_type:"token",scope:n.join(" "),state:_+"---permissionrequest"}),j+"/cjg-auth/"+_+"*","auth")}var Ae={};function C(e){return e.obfuscatedId+"-"+e.pageId+"-cjg"}function ye(e,n){return browserStorage.local.getItem(C(e)+"-"+n)}function je(e,n,t){return browserStorage.local.setItem(C(e)+"-"+n,t)}function be(e,n){var t=C(e),e=Array.isArray(n)?n.map(function(e){return t+"-"+e}):t+"-"+n;return browserStorage.local.remove(e)}e(Ae,{getItem:function(){return ye},remove:function(){return be},setItem:function(){return je}});var Ie={};e(Ie,{getIsAdmin:function(){return Se},getIsConsumerGmail:function(){return O},getIsOne:function(){return Pe},getSource:function(){return k},getUserDomain:function(){return _e}});var B={};function k(e){var n,t,r=e.pageId+"-"+e.authuser;return B[r]||(B[r]=(e="https://myaccount.google.com"+(t="",(e=e=e)&&((n=e.authuser)&&"0"!==n&&(t+="/u/"+n),n=e.pageId)&&(t+="/b/"+n),t)+"/?hl=en",cjBasics.ajax(e,{fetchAs:"text"}))),B[r]}function O(e){e=e.displayEmail;return e?e.endsWith("@gmail.com")||e.endsWith("@googlemail.com"):null}function _e(e){return!e.validSession||O(e)?Promise.resolve(null):k(e).then(function(e){var n,e=(e=e).replace("domainName\\u003d","domainName=");if(-1!==e.indexOf("domainName=")&&4<(n=e.split("domainName=",2)[1].split('"',1)[0]).length&&n.length<200&&"gmail.com"!==n&&"googlemail.com"!==n)return n;if(-1!==e.indexOf("managed by"))n=e.split("managed by")[1];else{if(-1===e.indexOf("gbpbt"))return null;n=e.split("gbpbt")[1]}return(n=n.split("<b>")[1].split("<")[0]).length<200?n:null},function(){return null})}function Se(e){return!e.validSession||O(e)?Promise.resolve(null):k(e).then(function(e){return-1!==e.indexOf('data-pid="199"')||-1!==e.indexOf("https://admin.google.com")})}function Pe(n){var t;return n.validSession?(t=k(n).then(function(e){return-1!==e.indexOf("M4.02,28.27C2.73,25.8,2,22.98,2,20c0-2.87,0.68-5.59,1.88-8l-1.72-1.04C0.78,13.67,0,16.75,0,20c0,3.31,0.8,6.43,2.23,9.18L4.02,28.27z")}).then(function(e){return e?(je(n,"bm_cache_v33__account__one",!0),!0):(be(n,"bm_cache_v33__account__one"),!1)}),ye(n,"bm_cache_v33__account__one").then(function(e){return"boolean"==typeof e?e:t})):Promise.resolve(!1)}var q,xe={},Ce=(e(xe,{changeAccount:function(){return L},getAccountsList:function(){return Oe},getCurrentAccountFromCache:function(){return ke},init:function(){return qe},resetCache:function(){return Be}}),new Promise(function(e){q=e}));function Be(){Ce=new Promise(function(e){q=e})}function ke(){return browserStorage.local.getItem("bm_pref__account__current").then(function(e){return e||w})}function L(e,n){return"function"==typeof n&&n(e),browserStorage.local.setItem("bm_pref__account__current",e).then(function(){n||r||cjBasics.reloadAll(!0)})}function Oe(){return Ce}function qe(o){return ke().then(function(r){return ae({authuser:r.authuser}).then(function(e){if(q(e),Array.isArray(e))if(0===e.length||!e[0].validSession)r.obfuscatedId!==v.obfuscatedId&&L(v);else{for(var n=0;n<e.length;n++){var t=e[n];if(r.obfuscatedId===t.obfuscatedId&&r.pageId===t.pageId)return t.validSession?r.validSession&&r.displayEmail===t.displayEmail&&r.authuser===t.authuser?void((r.photoUrl!==t.photoUrl||r.displayName!==t.displayName||r.onlyAccount!==t.onlyAccount||r.onlyAccountOrPage!==t.onlyAccountOrPage)&&L(t,o||!0)):void L(t):void L(e[0])}L(e[0])}}),r})}function R(e){for(var n="",t=7;0<=t;t--)n+=(e>>>4*t&15).toString(16);return n}function U(e,n){return e<<n|e>>>32-n}var Le="https://www.google.com";function Re(t){return V().then(function(e){var n=Math.floor(Date.now()/1e3),e=[n,e,t||Le].join(" ");return"SAPISIDHASH "+n+"_"+function(e){for(var n,t,r,o,a,i,c,u,s=Array.from({length:80}),l=1732584193,f=4023233417,g=2562383102,d=271733878,h=3285377520,m=(e=unescape(encodeURIComponent(e))).length,p=[],v=0;v<m-3;v+=4)t=e.charCodeAt(v)<<24|e.charCodeAt(v+1)<<16|e.charCodeAt(v+2)<<8|e.charCodeAt(v+3),p.push(t);switch(m%4){case 0:v=2147483648;break;case 1:v=e.charCodeAt(m-1)<<24|8388608;break;case 2:v=e.charCodeAt(m-2)<<24|e.charCodeAt(m-1)<<16|32768;break;case 3:v=e.charCodeAt(m-3)<<24|e.charCodeAt(m-2)<<16|e.charCodeAt(m-1)<<8|128}for(p.push(v);p.length%16!=14;)p.push(0);for(p.push(m>>>29,m<<3&4294967295),n=0;n<p.length;n+=16){for(v=0;v<16;v++)s[v]=p[n+v];for(v=16;v<=79;v++)s[v]=U(s[v-3]^s[v-8]^s[v-14]^s[v-16],1);for(r=l,o=f,a=g,i=d,c=h,v=0;v<=19;v++)u=U(r,5)+(o&a|~o&i)+c+s[v]+1518500249&4294967295,c=i,i=a,a=U(o,30),o=r,r=u;for(v=20;v<=39;v++)u=U(r,5)+(o^a^i)+c+s[v]+1859775393&4294967295,c=i,i=a,a=U(o,30),o=r,r=u;for(v=40;v<=59;v++)u=U(r,5)+(o&a|o&i|a&i)+c+s[v]+2400959708&4294967295,c=i,i=a,a=U(o,30),o=r,r=u;for(v=60;v<=79;v++)u=U(r,5)+(o^a^i)+c+s[v]+3395469782&4294967295,c=i,i=a,a=U(o,30),o=r,r=u;l=l+r&4294967295,f=f+o&4294967295,g=g+a&4294967295,d=d+i&4294967295,h=h+c&4294967295}return(u=R(l)+R(f)+R(g)+R(d)+R(h)).toLowerCase()}(e)})}function Ue(o,a,i){var c=Le;return Re(c).then(function(e){var n=new URL(o),t=n.hostname,t=(n.hostname="content.googleapis.com"===t||"www.googleapis.com"===t||"www.google.com"===t?"clients6.google.com":t.replace("googleapis.com","clients6.google.com"),i.account),r=(a.credentials="include",a.headers||{}),e=(r.Authorization=e,r["X-Goog-AuthUser"]=t.authuser,t.pageId&&(r["X-Goog-PageId"]=t.pageId),i.key);return"string"==typeof e&&((t=new URLSearchParams(n.search)).set("key",e),n.search=t,r["X-Goog-Api-Key"]=e),a.headers=r,z(n.href,a,c)})}function Te(e,n,t){return Ue(e,n,t).catch(function(){return Ue(e,n,t)})}g.cjgApis={account:n,auth:p,cache:Ae,info:Ie,login:c,originRequest:z,request:function(n,t,e){var r,o=e||{},a=(o.account,o.account=o.account||w,t||{}),i=o.pa;return!0===i?Te(n,a,o):(r="optional"===i&&!0,x(e.account,e.requiredScopes).then(function(e){return t.headers=t.headers||{},t.headers.Authorization="Bearer "+e,cjBasics.ajax(n,t)},function(e){if(r)return Te(n,a,o).catch(function(){throw e});throw e}))},session:xe}}();