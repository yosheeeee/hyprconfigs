"use strict";!function(){var D=document;cjce.registerTemplate("bm-p-adsense",function(e,s){var n,a,t,c,i,r,l,_={},o=(new Date).getDate(),d=["https://www.googleapis.com/auth/adsense.readonly"],m="https://adsense.googleapis.com/v2/",u=window.atob("QUl6YVN5QXBVTVBOVFlnbW55UVUwcGdSSXdEcm42OHdGbXZ2bVp3");function p(e,n){e=e,n=n,a="https://www.google.com/adsense/new/",t=s.account.authuser,r?a+="u/"+t+"/"+r+"/":"0"!==t&&((n=n||{}).authuser=t),a+=e||"home";var a,t=n?cjBasics.urlParams.attach(a,n):a;s.openTab(t)}function g(e){var n=new Date;return n.setDate(o-e),{year:n.getFullYear(),month:n.getMonth()+1,day:n.getDate()}}function j(e){if(e&&e.body&&e.body.indexOf("noAdSenseAccount"))return v();var n;"not_authorized"===e.cjg_error&&(n=e,f({message:cjBasics.lang.i18n("cj_i18n_00235","Before you can use this page, you need to give access to load your Google AdSense data"),actionLabel:cjBasics.lang.i18n("cj_i18n_01916","Continue with Google"),actionG:!0,action:function(){cjgApis.auth.requestPermissions(s.account,n.cjg_missing_scopes)}}))}function h(e,n){n=n||{},n.prettyPrint="false",e=cjBasics.urlParams.attach(m+e,n);return cjgApis.request(e,{fetchAs:"json"},{account:s.account,pa:"optional",key:u,requiredScopes:d}).catch(j)}var b,y=[{label:cjBasics.lang.i18n("cj_i18n_00225","Today so far"),reportId:"today",range:"TODAY",start:"today",end:"today"},{label:cjBasics.lang.i18n("cj_i18n_00226","Yesterday"),reportId:"yesterday",range:"YESTERDAY",start:"today-1d",end:"today-1d",previous:{label:cjBasics.lang.i18n("cj_i18n_00227","vs same day last week"),start:"today-8d",end:"today-8d",startDate:g(8),endDate:g(8)}},{label:cjBasics.lang.i18n("cj_i18n_01181","Last 28 days").replace("28","7"),range:"LAST_7_DAYS",start:"today-7d",end:"today-1d",reportId:"last7days",previous:{label:cjBasics.lang.i18n("cj_i18n_01180","vs previous 28 days").replace("28","7"),start:"today-14d",end:"today-8d",startDate:g(14),endDate:g(8)}},{label:cjBasics.lang.i18n("cj_i18n_00228","This month so far"),reportId:"thismonth",range:"MONTH_TO_DATE",start:"startOfMonth",end:"today",previous:{label:cjBasics.lang.i18n("cj_i18n_01179","vs same period last year"),start:"startOfMonth-1y",end:"today-1y",startDate:g(365+o),endDate:g(365)}}];function f(e){c.cjceSetLoading(!1),i||(i=!0,t&&(t.hidden=!0),n.textContent="",e=cjce.createElement("bm-fulldialog",{inline:!0,bmApis:s,onNewTab:function(){p("home")},lockup:{label:cjBasics.lang.i18n("cj_i18n_00179","AdSense")},iconName:"ad_sense",message:e.message,actionLabel:e.actionLabel,actionG:e.actionG,action:e.action}),n.appendChild(e))}function v(){f({message:cjBasics.lang.i18n("cj_i18n_00233","There is no AdSense account attached to this Google account"),actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){s.pageManager.navigate("accountchooser")}})}function w(e){var n,a,t;if(r)return n="accounts/"+r+"/reports:generate",a=cjBasics.lang.getCurrent().replace("-","_"),a={dateRange:e.range,languageCode:a,fields:"*",metrics:"ESTIMATED_EARNINGS"},(t=e.range)?a.dateRange=t:(a["startDate.year"]=e.startDate.year,a["startDate.month"]=e.startDate.month,a["startDate.day"]=e.startDate.day,a["endDate.year"]=e.endDate.year,a["endDate.month"]=e.endDate.month,a["endDate.day"]=e.endDate.day),h(n,a).then(function(e){var n=e.headers[0];return{revenue:(e=(e=e.totals)||[],Array.isArray(e)?e[0]||0:(e=e.cells,Array.isArray(e)&&0!==e.length&&(e=e[0])&&e.value||0)),currency:n.currencyCode||n.currency}});throw v(),new Error("No AdSense Account")}function A(){var n="bm_cache_v33__adsense__mainaccount",a=h("accounts",{fields:"accounts/name"}).then(function(e){var e=e.accounts||e.items;return Array.isArray(e)?((e=e[0]||{}).name||e.id||"").replace("accounts/",""):null}).then(function(e){return(r=e)?cjgApis.cache.setItem(s.account,n,e):v(),e});return cjgApis.cache.getItem(s.account,n).then(function(e){if(!r&&e&&"string"==typeof e)return r=e}).then(function(e){if(!e)return a})}function B(r,o,d){return c=r,i=function(e){var n,a,t,c,i=e[0].revenue,s=e[0].currency;o.textContent=i+" "+s,r.previous&&e[1]&&(t=e[1].revenue,e[1].currency===s)&&(n=0<(n=e=i-t)?"up":n<0?"down":"neutral",a=D.createDocumentFragment(),(c=cjce.createElement("cjmd-icon",{name:"down"==n?"__mdi:trending_down":"__mdi:trending_up"})).classList.add("bm-p-adsense-card__changeicon"),a.appendChild(c),c=i,i=(0<(c=Math.round(1e3*(c/t-1))/10)?"+":"")+c+"%",t=e,c=s,(e=(t=(Math.round(100*Math.abs(t))/100).toString()).split(".")[1])?e.length<2&&(t+="0"):t+=".00",s=t+" "+c+" ("+i+")",(e=D.createElement("span")).className="bm-p-adsense-card__changetext",e.textContent=s,a.appendChild(e),d.textContent="",d.dataset.type=n,d.appendChild(a))},new Promise(function(n,e){var a="bm_cache_v33__adsense__reports__"+c.start+"__"+c.end,t=!1;cjgApis.cache.getItem(s.account,a).then(function(e){!t&&e&&i(e)}),l.then(function(){_[a]=!0;var e=[w(c)];return c.previous&&e.push(w(c.previous)),Promise.all(e)}).then(function(e){t=!0,i(e),cjgApis.cache.setItem(s.account,a,e),n()},function(){})});var c,i}function C(){var s,r;i||(s=D.createDocumentFragment(),r=[],y.forEach(function(e){n=e,(e=cjce.createElement("cjmd-card",{interactive:!0,withPadding:!0,onClick:function(){p("reporting",{rt:"d",uim:"d",d:n.reportId,ct:n.reportCt||null})}})).classList.add("bm-p-adsense-card"),(i=D.createElement("div")).className="bm-p-adsense-card__date",i.textContent=n.label,e.appendChild(i),(c=D.createElement("div")).className="bm-p-adsense-card__amount",c.textContent=cjBasics.lang.i18n("cj_i18n_00325","Loading…"),e.appendChild(c),n.previous&&((t=D.createElement("div")).className="cjmd-secondarytext bm-p-adsense-card__comparison",t.textContent=n.previous.label,i.appendChild(t),(a=D.createElement("div")).className="bm-p-adsense-card__change",a.textContent="⁣",e.appendChild(a)),e.cjceAdsenseLoadContent=function(){return B(n,c,a)};var n,a,t,c,i=e;r.push(i.cjceAdsenseLoadContent()),s.appendChild(i)}),Promise.all(r).then(function(){c.cjceSetLoading(!1)}),n.textContent="",n.appendChild(s))}c=cjce.createElement("bm-ogb",{drawer:!0,loading:!0,serviceIcon:"ad_sense",serviceLabel:cjBasics.lang.i18n("cj_i18n_00179","AdSense"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),bmApis:s,onNewTab:function(){p("home")}}),e.appendChild(c),a=c.cjceDrawerEl,t=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:refresh",label:cjBasics.lang.i18n("cj_i18n_01182","Refresh reports"),onClick:function(){c.cjceSetLoading(!0),cjgApis.cache.remove(s.account,Object.keys(_)).then(C)}}),c.cjceAppendChild(t),b=cjce.createElement("bm-navlist",{compact:!0,items:[{id:"home",iconName:"__mdi:home",label:cjBasics.lang.i18n("cj_i18n_00291","Home"),newTabUrl:"home"},{iconName:"__mdi:picture_in_picture",label:cjBasics.lang.i18n("cj_i18n_01530","Ads"),newTabUrl:"myads/sites",adsenseParams:{product:"SELF_SERVICE_CONTENT_ADS"},external:!0},{iconName:"__mdi:admob",label:cjBasics.lang.i18n("cj_i18n_00580","AdMob"),newTabUrl:"main/adMob",adsenseParams:{product:"SELF_SERVICE_G_MOB_DISPLAY_APP"},external:!0},{iconName:"__mdi:video_youtube",label:cjBasics.lang.i18n("cj_i18n_07506","AdSense for YouTube"),newTabUrl:"youtube",external:!0},{iconName:"__mdi:web",label:cjBasics.lang.i18n("cj_i18n_01150","Sites"),newTabUrl:"sites/list",external:!0,divider:!0},{iconName:"__mdi:admin_panel_settings",label:cjBasics.lang.i18n("cj_i18n_07006","Privacy & messaging"),newTabUrl:"privacymessaging",external:!0},{iconName:"__mdi:block",label:cjBasics.lang.i18n("cj_i18n_07507","Brand safety"),newTabUrl:"brand-safety",external:!0},{iconName:"__mdi:assessment",label:cjBasics.lang.i18n("cj_i18n_01152","Reports"),newTabUrl:"reporting",adsenseParams:{rt:"d",uim:"d"},external:!0},{iconName:"__mdi:trending_up",label:cjBasics.lang.i18n("cj_i18n_01153","Optimalization"),newTabUrl:"opt/opportunities",external:!0},{iconName:"__mdi:policy",label:cjBasics.lang.i18n("cj_i18n_07005","Policy centre"),newTabUrl:"policy-center",external:!0,divider:!0},{iconName:"__mdi:payments",label:cjBasics.lang.i18n("cj_i18n_01154","Payments"),newTabUrl:"payments",external:!0},{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:"settings",external:!0}],selectedId:"home",bmApis:s,onNewTab:function(e,n){p(n.newTabUrl,n.adsenseParams)}}),a.appendChild(b),n=cjce.createElement("cjmd-container",{scrollable:"noScroll",shadow:"transparentOnScroll"}),e.appendChild(n),l=A(),C()})}();