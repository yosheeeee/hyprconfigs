"use strict";!function(){var n=self,u=n.location,l="undefined"!=typeof chrome&&chrome||{},r=l.runtime.getURL("PATH/").replace("/PATH/",""),_=r.startsWith("safari-web-extension://"),f=!_&&r.startsWith("moz-extension://"),R=!_&&!f;function i(e,r){return new Promise(function(t,n){l.notifications.create(e,r,function(){var e=l.runtime.lastError;e?n(e):t()})})}var o=l.action||l.browserAction||l.pageAction;function t(e){o.setPopup({popup:e})}function F(){var e;t(f?null:((e=l.runtime.getManifest()).action||e.browser_action||e.page_action||{}).default_popup||"")}function S(){return i={active:!0,currentWindow:!0},new Promise(function(n,r){l.tabs.query(i,function(e){var t=l.runtime.lastError;t?r(t):Array.isArray(e)?_&&i&&i.url?(t=e.filter(function(e){return e.url}),n(t)):n(e):r(new Error("No array returned"))}),setTimeout(n,2e3)}).then(function(e){return e[0]},function(){return null});var i}function d(e,t){return new Promise(function(n,r){l.tabs.update(e,t,function(e){var t=l.runtime.lastError;t?r(t):n(e)})})}function a(e){return new Promise(function(n,r){l.windows.create(e,function(e){var t=l.runtime.lastError;t?r(t):n(e)})})}function s(o){return new Promise(function(n,r){function i(e){var t=e.message||"";"openerTabId"in o&&-1!==t.indexOf("openerTabId")?(delete o.openerTabId,n(s(o))):R&&-1!==t.indexOf("Saved groups are not editable")?n():r(e)}try{l.tabs.create(o,function(e){var t=l.runtime.lastError;t?i(t):n(e)})}catch(e){i(e)}})}function c(e){n.open(e,"_blank","noopener")}function m(t){try{n.top.location.href=t}catch(e){c(t)}}function p(e,t,n,i){var r={url:e};return!1===t&&n&&(r.active=!1),i&&(r.openerTabId=i.id,r.index=i.index+1),s(r).then(function(e){var t,n,r;return t=e,n=i,l.tabs.group&&t&&n&&(r=n.groupId,t.groupId!==r)&&l.tabs.group({groupId:r,tabIds:t.id},function(){l.runtime.lastError||(t.groupId=r)}),e},function(){c(e)})}function g(e,t,n,r,i){if(!e)return Promise.reject(new Error("Missing URL"));if(!n){if(t)return a({incognito:Boolean(r&&r.incognito),url:e}).catch(function(){return p(e,t,n,r)});if(!1===n)return function t(n,e){var r=e||null;return d(r,{url:n}).catch(function(){if(!r)return S().then(function(e){if(e.id)return t(n,e.id);m(n)});m(n)})}(e,i)}return p(e,t,n,r)}function b(e,t,n){var r;g(l.runtime.getURL((r=l.runtime.getManifest()).options_page||(r.options_ui||{}).page||"/views/options.html"),e,t,n)}function h(e,t,n){return e||t?b(e,t,n):new Promise(function(e,t){l.runtime.openOptionsPage(function(){(l.runtime.lastError?t:e)()})}).catch(function(){return b(e,t,n)})}var v=!0;try{var e=l.i18n.getMessage("@@ui_locale");"string"==typeof e&&"und"!==e&&(I=e.replace("_","-"))}catch(e){v=!1}if(!I)try{var y=l.runtime.getManifest().default_locale;"string"==typeof y&&y.replace("_","-")}catch(e){}function w(e,t){return e&&v&&l.i18n.getMessage(e)||t||""}function W(){}function V(e){e=e.split(".");return e[0]+"."+e[1]}var x=l.menus||l.contextMenus,e=Boolean(x),T=[];function q(o){return new Promise(function(r,i){function t(e){var t=e&&e.message||"",n=!1;"visible"in o&&-1!==t.indexOf("visible")&&(delete o.visible,n=!0),"icons"in o&&-1!==t.indexOf("icons")&&(delete o.icons,n=!0),n?r(q(o)):-1===t.indexOf("duplicate")&&-1===t.indexOf("already exists")&&-1===t.indexOf("already contains")&&i(e)}try{x.create(o,function(){var e=l.runtime.lastError;e?t(e):r()})}catch(e){t(e)}})}function N(e){for(var t=0;t<e.length;t++){var n=e[t],n=(q(n),n.id);-1===T.indexOf(n)&&T.push(n)}}function D(e,t){x&&0!==e.length&&(N(e),l.runtime.onInstalled.addListener(function(){N(e)}),t=t,!x.onClicked.hasListener(t))&&x.onClicked.addListener(t)}var j,H=_||/^Mac|^iP/.test(navigator.platform);function z(e){return Array.isArray(e.modifiers)?h(e.modifiers.includes("Shift"),e.modifiers.includes(H?"Command":"Ctrl")):h()}function P(e){return a(e).catch(function(){return g(e.url)})}function O(e){e=e||{};e.view="cm",e.tf="0",P({url:cjBasics.urlParams.attach("https://mail.google.com/mail",e),width:500,height:516,type:"panel"})}function G(){var e=function(){var e=x.ContextType;if(!e)return l.browserAction?["browser_action"]:l.pageAction?["page_action"]:["action"];for(var t=[],n=["ACTION","BROWSER_ACTION","PAGE_ACTION"],r=0;r<n.length;r++){var i=e[n[r]];i&&t.push(i)}return t}();j={openInTab:{contexts:e,limitToPages:["extensionsettings"],title:w("cj_i18n_01545","Open in a new tab"),onClick:function(){g(l.runtime.getURL("/views/app.html"))}},openInPanel:{contexts:e,limitToPages:["extensionsettings"],title:w("cj_i18n_01546","Open in a panel"),onClick:function(){setTimeout(function(){P({type:"panel",url:l.runtime.getURL("/views/app.html"),height:596,width:600,focused:!0})})}},openPreferences:{contexts:e,limitToPages:["extensionsettings"],title:w("cj_i18n_01440","Preferences"),onClick:z},translateSelection:{contexts:["selection"],limitToPages:["translate"],icons:{16:"/images/services/translate_16dp.svg"},title:w("cj_i18n_01547","Translate text"),onClick:function(e){var t=navigator.languages||[navigator.language],t=(t=t[0]).startsWith("zh-")?t:t.startsWith("mni")?"mni-Mtei":t.split("-",1)[0];P({url:cjBasics.urlParams.attach("https://translate.google.com/",{op:"translate",sl:"auto",tl:t,text:e.selectionText}),width:500,height:516,type:"panel"})}},emailSelection:{contexts:["selection"],limitToPages:["gmail","inbox"],icons:{16:"/images/services/gmail_16dp.svg"},title:w("cj_i18n_01548","Mail this text"),onClick:function(e){O({body:"".concat(e.selectionText,"\n\nSource: ").concat(e.pageUrl,"\n")})}},emailToSelection:{contexts:["selection"],limitToPages:["gmail","inbox"],icons:{16:"/images/services/gmail_16dp.svg"},title:w("cj_i18n_01549","Write mail to address"),onClick:function(e){O({to:e.selectionText})}},gmailThisPage:{contexts:["page"],limitToPages:["gmail","inbox"],icons:{16:"/images/services/gmail_16dp.svg"},title:w("cj_i18n_01552","Mail this page"),onClick:function(e,t){O({su:t.title,body:e.pageUrl})}},translateThisPage:{contexts:["page"],limitToPages:["translate"],icons:{16:"/images/services/translate_16dp.svg"},title:w("cj_i18n_07195","Translate this page"),onClick:function(e,t){var n="https://translate.google.com/website?u="+encodeURIComponent(t.url);d(t.id,{url:n})}}}}function J(){var r=Object.keys(cjBasics.pages),e=Object.keys(j).filter(function(e){if("openPreferences"===e)return _||f;var t=j[e].limitToPages;if(!Array.isArray(t))return!0;for(var n=0;n<t.length;n++)if(-1!==r.indexOf(t[n]))return!0;return!1}),t=null,n=e;if(x)for(var i=Array.isArray(t),o=Array.isArray(n),a=0;a<T.length;a++){var s=T[a],c=!(i&&-1!==t.indexOf(s)||o&&-1===n.indexOf(s));x.update(s,{visible:c})}}function k(e){var t,e="/pages/wei_"+e+"/"+e+"-",n=f?".svg":".png";t={16:e+"16"+n,19:e+"19"+n,32:e+"32"+n,38:e+"38"+n},o.setIcon({path:t},function(){l.runtime.lastError&&o.setIcon({path:t[32]||t[16]})})}function K(e){var t=r+"/views/app.html";e&&(t+="?environment="+encodeURIComponent(e)),o.onClicked.addListener(function(){g(t)})}var Q,B,C,A,L,I,E,X,Y,M,Z,$=l.runtime.id;function U(){C&&(C=null,g(Y),l.storage.local.remove("cj_landing_lastupdated"),B.onExecute&&B.onExecute(),M)&&(o.onClicked.removeListener(U),E&&F(),!0===M)&&o.setBadgeText({text:""})}function ee(){var t,n,e,r="cj_landing_update_notification";t=r,n={requireInteraction:!0,type:"basic",iconUrl:(e=(e=A).icons)?e[160]||e[80]||e[128]||e[48]||e[Object.keys(e)[0]]:null,message:w("cj_i18n_06287","Click to view changelog"),title:w("cj_i18n_06288","{APP_NAME} has been updated").replace("{APP_NAME}",A.name)},i(t,n).catch(function(e){e=e&&e.message||"";if("requireInteraction"in n&&-1!==e.indexOf("requireInteraction"))return delete n.requireInteraction,i(t,n)}),l.notifications.onClicked.addListener(function(e){e===r&&(U(),l.notifications.clear(r))})}function te(){M&&(E&&t(""),!0===M)&&(o.setBadgeBackgroundColor({color:"#EA4335"}),o.setBadgeText({text:_?"*":"âœµ"})),B.onUpdateAvailable&&B.onUpdateAvailable()}function ne(){function e(){U(),l.windows.onFocusChanged.removeListener(e),l.tabs.onCreated.removeListener(e)}l.windows.onFocusChanged.addListener(e),l.tabs.onCreated.addListener(e)}setTimeout(function(){u.reload()},4e7),l.storage&&l.storage.local&&(l.storage.local.get(null,function(e){e=Object.keys(e).filter(function(e){return-1===e.indexOf("bm_pref")&&-1===e.indexOf("bm_cache_v33")&&!e.startsWith("cj_landing_")&&!e.startsWith("__sync_storage__")&&"__sync_fallback__"!==e&&!e.endsWith("bm_cache_v32__bookmarks__bookmarks")});0<e.length&&l.storage.local.remove(e)}),l.storage.sync)&&(Q={prefTasksDueDate:"bm_pref__tasks__duedate",prefDriveThumbnailView:"bm_pref__drive__thumbs",prefatariThumbnailView:"bm_pref__atari__thumbs",prefatariFilterBy:"bm_pref__atari__filter",prefatariOrderBy:"bm_pref__atari__order",prefdatastudioFilterBy:"bm_pref__datastudio__filter",prefdatastudioOrderBy:"bm_pref__datastudio__order",prefdocsThumbnailView:"bm_pref__docs__thumbs",prefdocsFilterBy:"bm_pref__docs__filter",prefdocsOrderBy:"bm_pref__docs__order",prefdrawingsThumbnailView:"bm_pref__drawings__thumbs",prefdrawingsFilterBy:"bm_pref__drawings__filter",prefdrawingsOrderBy:"bm_pref__drawings__order",prefformsThumbnailView:"bm_pref__forms__thumbs",prefformsFilterBy:"bm_pref__forms__filter",prefformsOrderBy:"bm_pref__forms__order",prefjamboardThumbnailView:"bm_pref__jamboard__thumbs",prefjamboardFilterBy:"bm_pref__jamboard__filter",prefjamboardOrderBy:"bm_pref__jamboard__order",prefmymapsThumbnailView:"bm_pref__mymaps__thumbs",prefmymapsFilterBy:"bm_pref__mymaps__filter",prefmymapsOrderBy:"bm_pref__mymaps__order",prefscriptFilterBy:"bm_pref__script__filter",prefscriptOrderBy:"bm_pref__script__order",prefsheetsThumbnailView:"bm_pref__sheets__thumbs",prefsheetsFilterBy:"bm_pref__sheets__filter",prefsheetsOrderBy:"bm_pref__sheets__order",prefslidesThumbnailView:"bm_pref__slides__thumbs",prefslidesFilterBy:"bm_pref__slides__filter",prefslidesOrderBy:"bm_pref__slides__order","dense-mode":"bm_pref__main__densemode","selected-services":"bm_pref__portal__services",serviceClicks:"bm_pref__applauncher__clicks","news-edition":"bm_pref__news__edition",prefTrendsHottrendsEdition:"bm_pref__trends__edition"},l.storage.sync.get(null,function(n){var r=Object.keys(n),i=[],o={},a=!1;r.forEach(function(e){var t;e.startsWith("bm_pref")||(i.push(e),(t=Q[e])&&-1===r.indexOf(t)&&(a=!0,o[t]=n[e]))}),a&&l.storage.sync.set(o),0<i.length&&l.storage.sync.remove(i)})),e&&(G(),D(Object.keys(j).map(function(e){var t=j[e],e={id:e,contexts:t.contexts||["page"],title:t.title};return t.icons&&(e.icons=t.icons),e}),function(e,t){j[e.menuItemId].onClick(e,t)}),J()),l.runtime.getManifest().chrome_url_overrides?(K("newtab"),k("newtab")):"undefined"!=typeof getComputedStyle&&getComputedStyle(document.documentElement).getPropertyValue("--arc-palette-background")&&K(),browserStorage.sync.getItem("bm_pref__main__extensionicon").then(function(e){"gsa_nobg"===e&&k("gsa_nobg")}),l.runtime.onMessage.addListener(function(e,t,n){var s,c,r=e&&e.method;if(r&&t.id===$){if("createNewPopup"!==r)return"listAccounts"===r?(cjgApis.account.list(e.data).then(function(e){n({error:!1,response:e})},function(e){n({error:!0,response:e})}),!0):void 0;s=e.data,c=l.webRequest,a({type:"popup",url:s.requestUrl,height:600,width:600,left:s.leftPosition||300,top:s.topPosition||64}).then(function(e){var n=e&&e.tabs[0].id,t=e&&e.id;function r(e){var t;if(!cjBasics.navigator.isFirefox)return t=(e=new URL(e.url)).hash||"#","signin"===s.method?t="#signin":"signout"===s.method&&(t="#signout"),e=u.origin+"/views/cjg-popup.html"+e.search+t,n&&d(n,{url:e}),{redirectUrl:e}}function i(){l.tabs.onRemoved.removeListener(a),l.runtime.onMessage.removeListener(o),"object"==typeof c&&c.onBeforeRequest.removeListener(r)}function o(e){"closeAuthPopup"===e.method&&(l.windows.remove(t),i())}function a(e){e===n&&i()}l.runtime.onMessage.addListener(o),l.tabs.onRemoved.addListener(a),"object"==typeof c&&c.onBeforeRequest.addListener(r,{tabId:n,urls:[s.redirectUrl],types:["main_frame"]},["blocking"])})}}),B={updateBadge:"custom",websitePath:"black-menu-for-google",onExecute:function(){k("blackmenu")},onUpdateAvailable:function(){k("blackmenubadge")}},A=l.runtime.getManifest(),L=A.version,I=A.browser_action||A.action,E=I&&I.default_popup,X=(I=(B.origin||"https://apps.jeurissen.co")+"/"+(B.websitePath||"")+"/")+"installed",Y=I+"whatsnew?installed=1",M=B.updateBadge,Z=864e5*(B.passiveActionButton?1.5:4.5),l.runtime.setUninstallURL(I+"uninstalled"),l.storage.local.get(["cj_landing_lastupdated","cj_landing_versionnumber"],function(e){var t,n=Date.now();C=e.cj_landing_lastupdated,"string"!=typeof(e=e.cj_landing_versionnumber)?g(X):C||(t=V(e),V(L)!==t&&(C=n,l.storage.local.set({cj_landing_lastupdated:n}))),C&&!B.noUpdateNotice&&(B.useNotification&&l.notifications?ee():(!M||(t=n,te(),Z<t-C))&&ne(),B.handleTrigger)&&l.runtime.onMessage.addListener(function e(t){t=t&&t.method;t&&"cjeLandingOpen"===t&&(U(),l.runtime.onMessage.removeListener(e))}),e!==L&&l.storage.local.set({cj_landing_versionnumber:L})}),o.onClicked.addListener(U),l.runtime.onStartup.addListener(W),l.runtime.onInstalled.addListener(W),l.runtime.onInstalled.addListener(function(){}),"undefined"!=typeof document&&(document.body.textContent="")}();