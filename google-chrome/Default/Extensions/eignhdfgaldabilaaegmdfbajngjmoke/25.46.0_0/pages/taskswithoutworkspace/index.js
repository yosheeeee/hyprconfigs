"use strict";!function(){function a(e,a){var c=a.indexOf(e);return a.slice(Math.max(0,c+e.length))}function c(e,a){e=a.lastIndexOf(e);return a.slice(0,Math.max(0,e))}function M(e){e=a("AF_initDataCallback({key: 'ds:1'",e),e=c("sideChannel:",a(" data:",e)),e=c("]",e)+"]",e=JSON.parse(e);return(e[5]||e[8]).map(function(e){return{id:"room/"+e[0][1],label:e[2]}})}cjce.registerTemplate("bm-p-taskswithoutworkspace",function(e,c){var t,n,i,a,s,o,r,l="https://calendar.google.com",m="https://tasks.google.com",d=c.wizPath+"/embed/",u=m+d,d=cjgFrontend.companion.getInitData(),_=d.id,h=d.hash,b=d.parameters,d=cjBasics.generateUniqueId(),g=cjBasics.lang.i18n("cj_i18n_06917","My Tasks"),p="list/~default",j="list/~starred",f=p,v=[{id:p,label:g}],k=[],w="",C={bm_cid:"taskswithcompanion",bm_cst:"1",bm_iid:d,bm_wiz:"1",bm_udm:c.darkMode?"1":null,fullWidth:"1",hl:cjBasics.lang.getCurrent()};function B(e){var a=u+"fullscreen/",e=(e&&-1!==e.indexOf("starred")&&(a+=j),cjBasics.urlParams.attach(a,{origin:l}));c.openTab(e)}function T(e){e=e&&e.label||g;t.cjceSetPageLabel(e)}function A(){a=[{iconName:"__mdi:star_border",id:j,label:cjBasics.lang.i18n("cj_i18n_00004","Starred"),newTabUrl:!0}],v.forEach(function(e){e.iconName="__mdi:list_alt",e.newTabUrl=!0,e.id===f&&T(e),a.push(e)}),Array.isArray(k)&&0<k.length&&(a.push({color:!0,header:!0,label:cjBasics.lang.i18n("cj_i18n_06918","Rooms")}),k.forEach(function(e){e.iconName="__mdi:group",e.newTabUrl=!0,e.id===f&&T(e),a.push(e)}));var a,e=a,c=JSON.stringify(e.map(function(e){return[e.id,e.label]}));c!==w&&(w=c,c=cjce.createElement("bm-navlist",{isSelector:!0,selectedId:f,items:e,onChange:function(e,a){t.cjceSetLoading(!0),T(a);a=e.startsWith("room/")||e.startsWith("space/");i.hidden=a,n.src=cjBasics.urlParams.attach(u+e,C)},onNewTab:function(e){B(e)}}),t.cjceDrawerEl.textContent="",t.cjceDrawerEl.appendChild(c))}function E(e){n.cjceSendFrameCommand({method:"bmCstClickDomElement",value:e},m)}function I(){E('body > div > c-wiz > div[role="menu"] div[role="separator"] + [aria-label][role="menuitem"]')}function N(){E("h2 + div > div:first-child[data-allow-task-list-reordering] > div"),setTimeout(I),setTimeout(I,10),setTimeout(I,50),setTimeout(I,100),setTimeout(I,200),setTimeout(I,300),setTimeout(I,500)}function y(){E("div>button")}function x(){E('div[data-menu-corner="top-end"][data-anchor-corner="bottom-end"]')}Object.keys(b).forEach(function(e){C[e]=b[e]}),t=cjce.createElement("bm-ogb",{loading:!0,drawer:!0,serviceIcon:"tasks",bmApis:c,onNewTab:function(){B(f)},serviceLabel:cjBasics.lang.i18n("cj_i18n_00439","Tasks"),pageLabel:g}),e.appendChild(t),i=cjce.createElement("ccbm-iconbutton",{iconName:"__mdi:date_range",label:cjBasics.lang.i18n("cj_i18n_00302","Calendar"),onClick:function(){c.pageManager.navigate("calendar")},onMetaClick:function(){var e=l+"/calendar/u/"+c.account.authuser+"/r";c.openTab(e)}}),t.cjceAppendChild(i),s=cjce.createElement("ccbm-iconbutton",{iconName:cjBasics.navigator.isSafari?"__mdi:more_horiz":"__mdi:more_vert",label:cjBasics.lang.i18n("cj_i18n_06294","More actions"),onClick:x}),t.cjceAppendChild(s),s.parentNode.appendChild(s),cjBasics.webRequest.handleIframeHeaders([m+"/*bm_iid="+d+"*"],{handleFirefoxInject:!0,handleSwCache:!0}),r=o=!1,a="https://chat.google.com"+c.wizPath+"/",cjBasics.ajax(a+"?shell=9").then(M).catch(function(){return cjBasics.ajax(a+"?shell=8").then(M)}).catch(function(){return[]}).then(function(e){r=!0,0<e.length&&cjgApis.cache.setItem(c.account,"bm_cache_v33__tasks__spaces",e),k=e,A()}),Promise.all([cjgApis.cache.getItem(c.account,"bm_cache_v33__tasks__activeview"),cjgApis.cache.getItem(c.account,"bm_cache_v33__tasks__tasklists"),cjgApis.cache.getItem(c.account,"bm_cache_v33__tasks__spaces")]).then(function(e){e[0]&&(f=e[0]);var a=e[1],a=(!o&&Array.isArray(a)&&0<a.length&&(v=a),e[2]);!r&&Array.isArray(a)&&0<a.length&&(k=a),A()}),s=cjBasics.urlParams.attach(u+"list/",C)+h,n=cjce.createElement("bm-iframe",{src:s,solid:!0,shadow:!0,sandbox:"allow-scripts allow-forms allow-same-origin allow-popups",onLoad:function(){t.cjceSetLoading(!1)},onBmMessage:function(e,a){"taskswithcompanionData"===e&&(o=!0,f=(e=a).activeView||p,0<(e=e.tasklists).length&&(v=e,cjgApis.cache.setItem(c.account,"bm_cache_v33__tasks__tasklists",v)),f.startsWith("list/")&&cjgApis.cache.setItem(c.account,"bm_cache_v33__tasks__activeview",f),A())},onMessage:function(e){e=cjgFrontend.companion.handleOpenUrlMessage(e,_,c.account);e&&c.openTab(e)}}),e.appendChild(n),s=cjce.createElement("ccbm-fabgroup",{items:[cjce.createElement("gmd-fab",{label:cjBasics.lang.i18n("cj_i18n_06336","New task"),onClick:y}),cjce.createElement("ccbm-fab",{mini:!0,iconName:"__mdi:post_add",label:cjBasics.lang.i18n("cj_i18n_06919","Create a new list"),onClick:N})]}),e.appendChild(s)})}();