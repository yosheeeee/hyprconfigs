"use strict";cjce.registerTemplate("bm-p-voice",function(c,n){var i,t,s,l,o,r,e,d="https://voice.google.com",m=d+"/u/"+n.account.authuser+"/",b="https://www.google.com/voice/b/"+n.account.authuser+"/",a=cjBasics.generateUniqueId(),p={bm_cid:"voicewithwebapp",bm_iid:a,bm_cst:"1",hl:cjBasics.lang.getCurrent()},u=cjBasics.urlParams.attach(m,p),j="calls",g=j,_="#00897b",h=cjBasics.webRequest.getWrifSupported(),v=!0,f={voicemail:{name:"__mdi:voicemail"},sms:{name:"__mdi:textsms"},missed:{name:"__mdi:call_missed",color:"#ea4335"},received:{name:"__mdi:call_received",color:"#34a853"},placed:{name:"__mdi:call_made",color:_}},w=["missed","received","voicemail","","","","","","","received","sms","sms"];function C(){i={calls:{iconName:"__mdi:call",label:cjBasics.lang.i18n("cj_i18n_01170","Calls"),testId:"sidenav-calls",newTabUrl:!0},messages:{iconName:"__mdi:message",label:cjBasics.lang.i18n("cj_i18n_01128","Messages"),testId:"sidenav-messages",newTabUrl:!0,external:!h},voicemail:{iconName:"__mdi:voicemail",label:cjBasics.lang.i18n("cj_i18n_01129","Voicemail"),testId:"sidenav-voicemail",newTabUrl:!0,external:!h,divider:!0},archive:{iconName:"__mdi:archive",label:cjBasics.lang.i18n("cj_i18n_00821","Archive"),testId:"sidenav-archive",newTabUrl:!0,external:!h},spam:{iconName:"__mdi:report",label:cjBasics.lang.i18n("cj_i18n_00306","Spam"),testId:"sidenav-spam",newTabUrl:!0,external:!h,divider:!0},credits:{iconName:"__mdi:account_balance_wallet",label:cjBasics.lang.i18n("cj_i18n_00398","Credits"),newTabUrl:!0,external:!h},settings:{iconName:"__mdi:settings",label:cjBasics.lang.i18n("cj_i18n_00298","Settings"),newTabUrl:!0,external:!h,testId:"settings-ogb-button"}}}function B(c){var e=cjce.createElement("cjmd-card",{withPadding:!0}),a=cjce.createElement("cjmd-title",{label:c.displayNumber}),a=(e.appendChild(a),w[c.type]||"placed"),a=f[a],a=cjce.createElement("cjmd-icon",a),a=(a.classList.add("bm-p-voice-callicon"),e.appendChild(a),document.createElement("p")),a=(a.textContent=c.displayStartDateTime,e.appendChild(a),cjce.createElement("cjmd-secondarytext",{label:c.relativeStartTime})),a=(e.appendChild(a),cjce.createElement("ccbm-button",{outline:!0,color:_,label:cjBasics.lang.i18n("cj_i18n_00213","Call"),onClick:function(){var e,a;e=c.phoneNumber,a={authuser:n.account.authuser},e?(a.hip=e,a.hpn=e):a.hip="",e=cjBasics.urlParams.attach("https://plus.google.com/hangouts/_/",a),n.openTab(e)}}));return a.classList.add("bm-p-voice-callbutton"),e.appendChild(a),e}function T(){var n=cjce.createElement("cjmd-container",{scrollable:!0,shadow:"transparentOnScroll"});function e(){var e=cjce.createElement("cjmd-emptystate",{color:_,label:cjBasics.lang.i18n("cj_i18n_00394","No recent calls"),iconName:"__mdi:call"});n.appendChild(e)}return cjce.applyTemplate(n,"bm-loading"),cjBasics.ajax(b+"inbox/recent/all/?hl="+cjBasics.lang.getCurrent(),{fetchAs:"xml"}).then(function(e){e=e.querySelector("json").textContent.replace("<![CDATA[","").replace("]]>","");return JSON.parse(e).messages}).then(function(c){0===Object.keys(c).length?e():Object.keys(c).forEach(function(e){var a=c[e];a.isTrash||a.isSpam||(a=B(c[e]),n.appendChild(a))})},e).then(function(){n.cjceSetLoading(!1)}),n}function S(){var e=cjce.createElement("bm-ogb",{drawer:{color:_},serviceIcon:"voice",serviceLabel:cjBasics.lang.i18n("cj_i18n_00443","Voice"),pageLabel:h?cjBasics.lang.i18n("cj_i18n_00291","Home"):cjBasics.lang.i18n("cj_i18n_01170","Calls"),searchbox:{color:_,onSubmit:E,submitInNewTab:!0},bmApis:n,onNewTab:function(){h?N():n.openTab(m)}}),a=(c.appendChild(e),e.cjceDrawerEl),a=(n.setOnPageDisplayHandler(e.cjceSearchboxEl.select),t=cjce.createElement("bm-navlist",{isSelector:!0,items:i,selectedId:j,onChange:x,onNewTab:function(e){e="credits"===e?m+"settings#payments":m+e;n.openTab(e)}}),a.appendChild(t),e.cjceSearchboxEl);return n.setOnPageDisplayHandler(a.select),cjBasics.ajax(b+"request/user?hl="+cjBasics.lang.getCurrent(),{fetchAs:"json"}).then(function(e){e=e&&e.formattedCredit;if(e)return e;throw new Error},function(){throw new Error}).then(function(e){var a;e&&1<e.length&&((a=t.cjceGetItemElement("credits")).classList.add("bm-p-voice-credits"),!h&&n.darkMode&&a.classList.add("bm-p-voice-credits--dark"),a.dataset.creditcount=e)},function(){}),e}function x(e){var a='[gv-test-id="'+i[e].testId+'"]';"credits"===e?(t.cjceSelectedId="settings",j="settings",a='gv-nav-item[ng-if*="obs_isCreditVisible"], gv-nav-item[ng-click*="onCreditClick"]'):"markallasread"===e?(t.cjceSelectedId=j,a='gv-nav-item[ng-click*="onMarkAllAsRead"]'):j=e,o.cjceSendFrameCommand({method:"bmCstClickDomElement",value:a},d)}function E(e){e=cjBasics.urlParams.attach(m+"search",{from:"[]",q:JSON.stringify(e.split(" "))});n.openTab(e)}function N(){o.cjceGetCleanUrl(d).then(function(e){e=e||m;n.openTab(e)})}C(),s=S(),c.appendChild(s),h&&(r=cjBasics.webRequest.addListener("onBeforeRequest",function(e){var a;return v=!1,c.textContent="",a=cjce.createElement("bm-fulldialog",{bmApis:n,onNewTab:function(){n.openTab(m)},lockup:{label:cjBasics.lang.i18n("cj_i18n_00443","Voice")},iconName:"voice",message:cjBasics.lang.i18n("cj_i18n_01175","You are not signed up to Voice yet"),actionLabel:cjBasics.lang.i18n("cj_i18n_00337","Sign up"),action:function(){n.openTab(m+"signup")}}),c.appendChild(a),r&&r.removeListener(),{cancel:!0}},{types:["sub_frame"],urls:[m+"about"]},["blocking"])),h?(h=!1,(e=cjce.createElement("bm-ogb",{displayBack:!0,floating:!0,serviceLabel:cjBasics.lang.i18n("cj_i18n_00443","Voice"),pageLabel:cjBasics.lang.i18n("cj_i18n_00325","Loadingâ€¦"),searchbox:{color:_,onSubmit:E,submitInNewTab:!0},bmApis:n,onNewTab:N,onBack:function(){x(j),e.hidden=!0,"signup"===g&&(o.src="about:blank",setTimeout(function(){o.src=u}))}})).hidden=!0,l=e,c.appendChild(l),cjBasics.webRequest.handleIframeHeaders([d+"/*bm_iid="+a+"*"],{handleSecVariables:!0,handleSwCache:!0,useMobileUserAgent:!0}),cjBasics.webRequest.addListener("onBeforeRedirect",function(e){e=e.redirectUrl;-1===e.indexOf("bm_iid=")&&(o.src=cjBasics.urlParams.attach(e,p))},{types:["sub_frame"],urls:[d+"/*bm_iid="+a+"*"]}),o=cjce.createElement("bm-iframe",{src:u,solid:"#fff",shadow:!0,onBmMessage:function(e,a){"voicewithwebappLoaded"===e?v=!1:"voicewithwebappPageTitle"===e?l.cjceSetPageLabel(a):"voicewithwebappUpdateView"===e&&a&&(l.hidden=!(e="back"===a||"signup"===a),g=a,e||(j=a,t.cjceSelectedId=a,e=i[a].label,s.cjceSetPageLabel(e)))}}),c.appendChild(o),setTimeout(function(){var e;v&&(h=!1,C(),c.textContent="",s=S(),c.appendChild(s),e=T(),c.appendChild(e))},3e3)):(a=T(),c.appendChild(a))});